<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: December 2007
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Mainly for handling environments during the third translation *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{^
#include "ats_counter.cats" /* only needed for [ATS/Geizella] */
%}</span> <span class="comment">// end of [%{^]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Deb <span class="keyword">=</span> "ats_debug.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Loc <span class="keyword">=</span> "ats_location.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lst <span class="keyword">=</span> "ats_list.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Map <span class="keyword">=</span> "ats_map_lin.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_stadyncst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_patcst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp3.sats"</span>

<span class="keyword">staload</span> <span class="staexp">TR2 <span class="keyword">=</span> "ats_trans2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">SOL <span class="keyword">=</span> "ats_staexp2_solve.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_stadyncst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_trans3_env.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_reference.sats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_reference.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_map_lin.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">THISFILENAME "ats_trans3_env.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> $Lab<span class="keyword">.</span>eq_label_label</span>
<span class="neuexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> $Loc<span class="keyword">.</span>prerr_location</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> prerr_loc_error3 <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
  <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2738"><span class="dyncstuse">$Loc<span class="keyword">.</span>prerr_location</span></a> loc<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">)</span>
<span class="comment">// end of [prerr_loc_error3]
</span>
<span class="keyword">fn</span> prerr_interror <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr "INTERNAL ERROR (ats_trans3_env)"

<span class="keyword">fn</span> prerr_loc_interror <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2738"><span class="dyncstuse">$Loc<span class="keyword">.</span>prerr_location</span></a> loc<span class="keyword">;</span> prerr ": INTERNAL ERROR (ats_trans3_env)"
<span class="keyword">end</span> <span class="comment">// end of [prerr_loc_interror]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5160"><span class="dyncstimp">c3str_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  c3str_loc<span class="keyword">=</span> loc
<span class="keyword">,</span> c3str_kind<span class="keyword">=</span> C3STRKINDnone
<span class="keyword">,</span> c3str_node<span class="keyword">=</span> C3STRprop s2e
<span class="keyword">}</span> <span class="comment">// end of [c3str_prop]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5203"><span class="dyncstimp">c3str_itmlst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> knd<span class="keyword">,</span> s3is<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  c3str_loc<span class="keyword">=</span> loc
<span class="keyword">,</span> c3str_kind<span class="keyword">=</span> knd
<span class="keyword">,</span> c3str_node<span class="keyword">=</span> C3STRitmlst s3is
<span class="keyword">}</span> <span class="comment">// end of [c3str_itmlst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5268"><span class="dyncstimp">c3str_metric_nat</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  c3str_loc<span class="keyword">=</span> loc
<span class="keyword">,</span> c3str_kind<span class="keyword">=</span> C3STRKINDmetric_nat
<span class="keyword">,</span> c3str_node<span class="keyword">=</span> <span class="keyword">begin</span>
    C3STRprop <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#10410"><span class="dyncstuse">s2exp_gte_int_int_bool</span></a> <span class="keyword">(</span>s2e<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30522"><span class="dyncstuse">s2exp_int_0</span></a><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [c3str_node]
</span><span class="keyword">}</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5317"><span class="dyncstimp">c3str_metric_dec</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> met<span class="keyword">,</span> met_bound<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  c3str_loc<span class="keyword">=</span> loc
<span class="keyword">,</span> c3str_kind<span class="keyword">=</span> C3STRKINDmetric_dec
<span class="keyword">,</span> c3str_node<span class="keyword">=</span> C3STRprop <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30755"><span class="dyncstuse">s2exp_metlt</span></a> <span class="keyword">(</span>met<span class="keyword">,</span> met_bound<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">}</span>

<span class="keyword">implement</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5406"><span class="dyncstimp">c3str_pattern_match_exhaustiveness</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> knd<span class="keyword">,</span> p2tcs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  c3str_loc<span class="keyword">=</span> loc
<span class="keyword">,</span> c3str_kind<span class="keyword">=</span> C3STRKINDpattern_match_exhaustiveness <span class="keyword">(</span>knd<span class="keyword">,</span> p2tcs<span class="keyword">)</span>
<span class="keyword">,</span> c3str_node<span class="keyword">=</span> C3STRprop <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#6912"><span class="dyncstuse">s2exp_bool</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a><span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [c3str_pattern_match_exhaustiveness]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5495"><span class="dyncstimp">h3ypo_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  h3ypo_loc<span class="keyword">=</span> loc<span class="keyword">,</span> h3ypo_node <span class="keyword">=</span> H3YPOprop s2p
<span class="keyword">}</span> <span class="comment">// end of [h3ypo_prop]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5538"><span class="dyncstimp">h3ypo_bind</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  h3ypo_loc<span class="keyword">=</span> loc<span class="keyword">,</span> h3ypo_node <span class="keyword">=</span> H3YPObind <span class="keyword">(</span>s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [h3ypo_bind]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5593"><span class="dyncstimp">h3ypo_eqeq</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">'{</span>
  h3ypo_loc<span class="keyword">=</span> loc<span class="keyword">,</span> h3ypo_node <span class="keyword">=</span> H3YPOeqeq <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [h3ypo_eqeq]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">viewtypedef</span>
<span class="staexp"><a name="4178"><span class="stacstdec">s2varbindmap <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1634"><span class="stacstuse">$Map<span class="keyword">.</span>map_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1998"><span class="stacstuse">stamp_t</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span></span></a></span>

<span class="keyword">val</span> s2varbind_svs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#10015"><span class="stacstuse">ref</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt</span></a> <span class="keyword">(</span>list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">val</span> s2varbind_svs_lst<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#10015"><span class="stacstuse">ref</span></a> <span class="keyword">(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt</span></a> <span class="keyword">(</span>list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">val</span> the_s2varbindmap <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#4178"><span class="stacstuse">s2varbindmap</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1706"><span class="dyncstuse">$Map<span class="keyword">.</span>map_make</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1998"><span class="stacstuse">stamp_t</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span>
    <span class="keyword">(</span><span class="keyword">lam</span> <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstamp_2esats.html#2027"><span class="dyncstuse">$Stamp<span class="keyword">.</span>compare_stamp_stamp</span></a> <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">)</span> <span class="comment">// end of [the_s2varbindmap]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6366"><span class="dyncstimp">the_s2varbindmap_initialize</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2varbindmap<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1981"><span class="dyncstuse">$Map<span class="keyword">.</span>map_cleanup&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1998"><span class="stacstuse">stamp_t</span></a></span><span class="keyword">,</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_s2varbindmap_initialize]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6410"><span class="dyncstimp">fprint_the_s2varbindmap</span></a>
  <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pfout</span> <span class="keyword">|</span> out<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>
    out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20956"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20956"><span class="stacstuse">FILE</span></a></span></a> m</span><span class="keyword">,</span> kis<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <span class="keyword">@(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1998"><span class="stacstuse">stamp_t</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span></span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> kis <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>ki<span class="keyword">,</span> kis<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
         <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstamp_2esats.html#2149"><span class="dyncstuse">$Stamp<span class="keyword">.</span>fprint_stamp</span></a> <span class="keyword">(</span><span class="prfexp">pfout</span> <span class="keyword">|</span> out<span class="keyword">,</span> ki<span class="keyword">.</span>0<span class="keyword">)</span><span class="keyword">;</span>
         fprint_string <span class="keyword">(</span><span class="prfexp">pfout</span> <span class="keyword">|</span> out<span class="keyword">,</span>  " -&gt; "<span class="keyword">)</span><span class="keyword">;</span>
         <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#27187"><span class="dyncstuse">fprint_s2exp</span></a> <span class="keyword">(</span><span class="prfexp">pfout</span> <span class="keyword">|</span> out<span class="keyword">,</span> ki<span class="keyword">.</span>1<span class="keyword">)</span><span class="keyword">;</span>
         fprint_string <span class="keyword">(</span><span class="prfexp">pfout</span> <span class="keyword">|</span> out<span class="keyword">,</span>  "\n"<span class="keyword">)</span><span class="keyword">;</span>
         loop <span class="keyword">(</span>out<span class="keyword">,</span> kis<span class="keyword">)</span>
       <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [loop]
</span>  <span class="keyword">val</span> kis <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2546"><span class="dyncstuse">$Map<span class="keyword">.</span>map_list_inf</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2varbindmap<span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  loop <span class="keyword">(</span>out<span class="keyword">,</span> kis<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_the_s2varbindmap]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6502"><span class="dyncstimp">print_the_s2varbindmap</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_stdout</span> <span class="keyword">|</span> ptr_stdout<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#11347"><span class="dyncstuse">stdout_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6410"><span class="dyncstuse">fprint_the_s2varbindmap</span></a> <span class="keyword">(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#10580"><span class="dyncstuse"><span class="prfexp">file_mode_lte_w_w</span></span></a> <span class="keyword">|</span> <span class="keyword">!</span>ptr_stdout<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#11588"><span class="dyncstuse">stdout_view_set</span></a> <span class="keyword">(</span><span class="prfexp">pf_stdout</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [print_the_s2varbindmap]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6538"><span class="dyncstimp">prerr_the_s2varbindmap</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_stderr</span> <span class="keyword">|</span> ptr_stderr<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#11795"><span class="dyncstuse">stderr_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6410"><span class="dyncstuse">fprint_the_s2varbindmap</span></a> <span class="keyword">(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#10580"><span class="dyncstuse"><span class="prfexp">file_mode_lte_w_w</span></span></a> <span class="keyword">|</span> <span class="keyword">!</span>ptr_stderr<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12036"><span class="dyncstuse">stderr_view_set</span></a> <span class="keyword">(</span><span class="prfexp">pf_stderr</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [prerr_the_s2varbindmap]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6577"><span class="dyncstimp">the_s2varbindmap_add</span></a> <span class="keyword">(</span>s2v<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> stamp <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#17119"><span class="dyncstuse">s2var_stamp_get</span></a> <span class="keyword">(</span>s2v<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "the_s2varbindmap_add: s2v = "; print s2v; print_newline ();
    print "the_s2varbindmap_add: s2e = "; print s2e; print_newline ();
    print "the_s2varbindmap_add: stamp = "; $Stamp.print_stamp stamp; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2varbindmap<span class="keyword">)</span>
<span class="comment">(*
    val () = $effmask_ref (case+ $Map.map_search (!p, stamp) of
      | ~None_vt () =&gt; () | ~Some_vt s2e0 =&gt; begin
          prerr "the_s2varbindmap_add: a binding for the static variable [";
          prerr s2v; prerr "] already exists: "; prerr_newline ();
          prerr "the_s2varbindmap_add: s2e = "; prerr s2e; prerr_newline ();
          prerr "the_s2varbindmap_add: s2e0 = "; prerr s2e0; prerr_newline ();
          $Err.abort {void} ()
        end // end of [Some_vt]
    ) // end of [val]
*)</span>
  <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2066"><span class="dyncstuse">$Map<span class="keyword">.</span>map_insert</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> stamp<span class="keyword">,</span> s2e<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">!</span>s2varbind_svs := list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> <span class="keyword">!</span>s2varbind_svs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_s2varbindmap_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6635"><span class="dyncstimp">the_s2varbindmap_find</span></a> <span class="keyword">(</span>s2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "the_s2varbindmap_find: s2v = "; print s2v; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> stamp <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#17119"><span class="dyncstuse">s2var_stamp_get</span></a> <span class="keyword">(</span>s2v<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2varbindmap<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2271"><span class="dyncstuse">$Map<span class="keyword">.</span>map_search</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> stamp<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_s2varbindmap_find]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6862"><span class="dyncstimp">the_s2varbindmap_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "the_s2varbindmap_pop: the_s2varbindmap =\n"; print_the_s2varbindmap ()
  end // end of [val]
*)</span>
  <span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>n<span class="keyword">&gt;.</span></span>
    <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#4178"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#4178"><span class="stacstuse">s2varbindmap</span></a></span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a></span></a> l</span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> l</span><span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21858"><span class="stacstuse">list</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2272"><span class="stacstuse">s2var_t</span></a><span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s2vs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> stamp <span class="keyword">=</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#17119"><span class="dyncstuse">s2var_stamp_get</span></a> s2v<span class="keyword">)</span>
        <span class="keyword">val</span> ans <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2168"><span class="dyncstuse">$Map<span class="keyword">.</span>map_remove</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> stamp<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> ans <span class="keyword">of</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>Some_vt _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">,</span> s2vs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>s2varbind_svs_lst <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2vss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2varbindmap<span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">,</span> <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><span class="keyword">!</span>s2varbind_svs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <span class="keyword">!</span>s2varbind_svs := s2vs<span class="keyword">;</span> <span class="keyword">!</span>s2varbind_svs_lst := s2vss
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the_s2varbindmap_pop: [s2varbind_svs_lst] is empty."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span><span class="keyword">end</span> <span class="comment">// end of [s2varbindmap_pop]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6896"><span class="dyncstimp">the_s2varbindmap_push</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2vs <span class="keyword">=</span> <span class="keyword">!</span>s2varbind_svs
<span class="keyword">in</span>
  <span class="keyword">!</span>s2varbind_svs := list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
  <span class="keyword">!</span>s2varbind_svs_lst := list_cons <span class="keyword">(</span>s2vs<span class="keyword">,</span> <span class="keyword">!</span>s2varbind_svs_lst<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_s2varbindmap_push]
</span>
<span class="keyword">end</span> <span class="comment">// end of [loca]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="8814"><span class="stacstdec">s2Varsetlst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2441"><span class="stacstuse">s2Varset_t</span></a></span></a></span>

<span class="keyword">val</span> the_s2Varset <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2441"><span class="stacstuse">s2Varset_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#20922"><span class="dyncstuse">s2Varset_nil</span></a><span class="keyword">)</span>
<span class="keyword">val</span> the_s2Varsetlst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#8814"><span class="stacstuse">s2Varsetlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6144"><span class="dyncstimp">the_s2Varset_env_add</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">!</span>the_s2Varset := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#21092"><span class="dyncstuse">s2Varset_add</span></a> <span class="keyword">(</span><span class="keyword">!</span>the_s2Varset<span class="keyword">,</span> s2V<span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6190"><span class="dyncstimp">the_s2Varset_env_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_s2Varset

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6230"><span class="dyncstimp">the_s2Varset_env_get_prev</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2Varsetlst<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
  <span class="keyword">|</span> list_vt_cons <span class="keyword">(</span>sVs<span class="keyword">,</span> <span class="keyword">!</span>sVss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> sVs<span class="keyword">)</span>
  <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#20922"><span class="dyncstuse">s2Varset_nil</span></a><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_s2Varset_env_get_prev]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6275"><span class="dyncstimp">the_s2Varset_env_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s2Varsetlst<span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>sVs<span class="keyword">,</span> sVss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><span class="keyword">!</span>the_s2Varset := sVs<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span>p := <span class="keyword">(</span>sVss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#8814"><span class="stacstuse">s2Varsetlst</span></a></span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">)</span>
  <span class="keyword">end</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": the_s2Varset_env_pop"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// endof [if]
</span><span class="keyword">end</span> <span class="comment">// end of [the_s2Varset_env_pop]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6309"><span class="dyncstimp">the_s2Varset_env_push</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s2Varsetlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span><span class="keyword">$effmask_ref</span> <span class="keyword">(</span><span class="keyword">!</span>the_s2Varset<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_s2Varset_env_push]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> s2lablst_is_prefix
  <span class="keyword">(</span>s2ls1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9196"><span class="stacstuse">s2lablst</span></a></span><span class="keyword">,</span> s2ls2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9196"><span class="stacstuse">s2lablst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23028"><span class="stacstuse">Option_vt</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9196"><span class="stacstuse">s2lablst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2ls1 <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2l1<span class="keyword">,</span> s2ls1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2l1 <span class="keyword">of</span>
    <span class="keyword">|</span> S2LAB1lab <span class="keyword">(</span>l1<span class="keyword">,</span> s2e1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2ls2 <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2l2<span class="keyword">,</span> s2ls2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2l2 <span class="keyword">of</span>
        <span class="keyword">|</span> S2LAB0lab l2 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <span class="keyword">if</span> l1 <span class="keyword">=</span> l2 <span class="keyword">then</span> s2lablst_is_prefix <span class="keyword">(</span>s2ls1<span class="keyword">,</span> s2ls2<span class="keyword">)</span> <span class="keyword">else</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [S2LAB0lab]
</span>        <span class="keyword">|</span> S2LAB1lab <span class="keyword">(</span>l2<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <span class="keyword">if</span> l1 <span class="keyword">=</span> l2 <span class="keyword">then</span>
              <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#34664"><span class="dyncstuse">s2exp_syneq</span></a> <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">then</span> s2lablst_is_prefix <span class="keyword">(</span>s2ls1<span class="keyword">,</span> s2ls2<span class="keyword">)</span>
              <span class="keyword">else</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">else</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [S2LAB1lab]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2LAB1lab]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// raise an exception?
</span>    <span class="keyword">end</span> <span class="comment">// end [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s2ls2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2lablst_is_prefix]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2var_fin_check
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2var_fin_check: d2v = "; print_d2var d2v; print_newline ()
  end // end of [val]
  val os2e = d2var_typ_get (d2v)
  val () = case+ os2e of
    | Some _ =&gt; (print "d2var_fin_check: os2e = Some _"; print_newline ())
    | None _ =&gt; (print "d2var_fin_check: os2e = None _"; print_newline ())
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7527"><span class="dyncstuse">d2var_typ_get</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">of</span> 
  <span class="keyword">|</span> Some s2e <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7434"><span class="dyncstuse">d2var_fin_get</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">of</span> 
    <span class="keyword">|</span> D2VARFINsome s2e0 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
        val () = begin
          print "d2var_fin_check: D2VARFINsome: d2v = "; print d2v; print_newline ();
          print "d2var_fin_check: D2VARFINsome: s2e = "; print s2e; print_newline ();
          print "d2var_fin_check: D2VARFINsome: s2e0 = "; print s2e0; print_newline ();
        end // end of [val]
*)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#3473"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_tyleq_solve</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e0<span class="keyword">)</span>
        <span class="keyword">val</span> knd <span class="keyword">=</span> C3STRKINDvarfin <span class="keyword">(</span>d2v<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e0<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15670"><span class="dyncstuse">trans3_env_pop_sta_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> Some s2e0<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2VARFINsome]
</span>    <span class="keyword">|</span> D2VARFINvbox s2e0 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#3473"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_tyleq_solve</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e0<span class="keyword">)</span>
        <span class="keyword">val</span> knd <span class="keyword">=</span> C3STRKINDvarfin <span class="keyword">(</span>d2v<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e0<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15670"><span class="dyncstuse">trans3_env_pop_sta_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> Some s2e0<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2VARFINvbox]
</span>    <span class="keyword">|</span> D2VARFINdone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// handled by [funarg_varfin_check]
</span>    <span class="keyword">|</span> D2VARFINnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26720"><span class="dyncstuse">s2exp_is_linear</span></a> s2e <span class="keyword">then</span> <span class="keyword">begin</span>
          prerr_loc_error3 loc0<span class="keyword">;</span>
          prerr ": the linear dynamic variable ["<span class="keyword">;</span>
          prerr d2v<span class="keyword">;</span>
          prerr "] needs to be consumed but it is preserved with the type ["<span class="keyword">;</span>
          prerr s2e<span class="keyword">;</span>
          prerr "] instead."<span class="keyword">;</span>
          <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [if]
</span>      <span class="keyword">in</span>
        <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7033"><span class="dyncstuse">d2var_lin_get</span></a> d2v &gt;= 0 <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">(* end of [D2VARFINnone] *)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>  <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7434"><span class="dyncstuse">d2var_fin_get</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> D2VARFINdone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// handled by [funarg_varfin_check]
</span>    <span class="keyword">|</span> D2VARFINnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the linear dynamic variable ["<span class="keyword">;</span> prerr d2v<span class="keyword">;</span>
        prerr "] needs to be preserved but it is consumed instead."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">(* end of [_] *)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None]
</span><span class="keyword">end</span> <span class="comment">(* end of [d2var_fin_check] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">assume</span> <span class="staexp">d2varset_env_token <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a></span>

<span class="keyword">datatype</span> <span class="staexp"><a name="13646"><span class="stacstdec">ld2vsitem</span></a></span> <span class="keyword">=</span> <span class="comment">// local dynamic variables
</span>  <span class="keyword">|</span> LD2VSITEMlam <span class="comment">// marker for nonlinear lambda
</span>  <span class="keyword">|</span> LD2VSITEMllam <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#10015"><span class="stacstuse">ref</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3017"><span class="stacstuse">d2varlst</span></a><span class="keyword">)</span></span> <span class="comment">// marker for linear lambda
</span>  <span class="keyword">|</span> LD2VSITEMset <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2749"><span class="stacstuse">d2varset_t</span></a></span> <span class="comment">// local dynamic variable set
</span><span class="comment">// end of [ld2vsitem]
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="13889"><span class="stacstdec">ld2vsitemlst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13646"><span class="stacstuse">ld2vsitem</span></a></span></a></span>

<span class="keyword">val</span> the_ld2vs <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2749"><span class="stacstuse">d2varset_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9626"><span class="dyncstuse">d2varset_nil</span></a><span class="keyword">)</span>
<span class="keyword">val</span> the_ld2vsitems <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11785"><span class="dyncstimp">the_d2varset_env_add</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">!</span>the_ld2vs := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9954"><span class="dyncstuse">d2varset_add</span></a> <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11831"><span class="dyncstimp">the_d2varset_env_adds</span></a> <span class="keyword">(</span>d2vs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">!</span>the_ld2vs := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10011"><span class="dyncstuse">d2varset_adds</span></a> <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> d2vs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_adds]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11880"><span class="dyncstimp">the_d2varset_env_add_p2at</span></a> <span class="keyword">(</span>p2t<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d2vs <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3339"><span class="dyncstuse">d2varlst_of_d2varlstord</span></a> <span class="keyword">(</span>p2t<span class="keyword">.</span>p2at_dvs<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>the_ld2vs := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10011"><span class="dyncstuse">d2varset_adds</span></a> <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> d2vs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_add_p2at]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11928"><span class="dyncstimp">the_d2varset_env_add_p2atlst</span></a> <span class="keyword">(</span>p2ts<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> p2ts <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>p2t<span class="keyword">,</span> p2ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11880"><span class="dyncstuse">the_d2varset_env_add_p2at</span></a> p2t<span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11928"><span class="dyncstuse">the_d2varset_env_add_p2atlst</span></a> p2ts
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [the_d2varset_env_add_p2atlst]  
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12060"><span class="dyncstimp">the_d2varset_env_print_ld2vs</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> print <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">)</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11984"><span class="dyncstimp">the_d2varset_env_prerr_ld2vs</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">)</span>

<span class="keyword">fn</span> the_d2varset_env_get_llam_ld2vs
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3017"><span class="stacstuse">d2varlst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <span class="keyword">!</span>the_ld2vsitems <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>LD2VSITEMllam r<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span>r
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror loc0<span class="keyword">;</span>
      prerr ": the_d2varset_env_get_llam_ld2vs"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3017"><span class="stacstuse">d2varlst</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_get_llam_ld2vs]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12137"><span class="dyncstimp">the_d2varset_env_pop_lam</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">prval</span> <span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf</span><span class="keyword">;</span> <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">var</span> ld2vsitems_var<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span> <span class="keyword">=</span> list_nil
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> <span class="keyword">!</span>the_ld2vsitems <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>ld2vsitem<span class="keyword">,</span> ld2vsitems<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> ld2vsitem <span class="keyword">of</span>
      <span class="keyword">|</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ld2vsitems_var := ld2vsitems
      <span class="keyword">|</span> LD2VSITEMllam _ <span class="keyword">=&gt;</span> ld2vsitems_var := ld2vsitems
      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> ld2vsitems_var <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>ld2vsitem<span class="keyword">,</span> ld2vsitems<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> ld2vsitem <span class="keyword">of</span>
      <span class="keyword">|</span> LD2VSITEMset ld2vs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">!</span>the_ld2vs := ld2vs<span class="keyword">;</span> <span class="keyword">!</span>the_ld2vsitems := ld2vsitems
        <span class="keyword">end</span>
      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": the_d2varset_env_pop_lam"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_pop_lam]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12208"><span class="dyncstimp">the_d2varset_env_push_lam</span></a> <span class="keyword">(</span>lin<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> marker <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">if</span> lin <span class="keyword">&gt;</span> 0 <span class="keyword">then</span>
      <span class="keyword">(</span>LD2VSITEMllam <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3017"><span class="stacstuse">d2varlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_nil<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">else</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13646"><span class="stacstuse">ld2vsitem</span></a></span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_ld2vsitems :=
     list_cons <span class="keyword">(</span>marker<span class="keyword">,</span> list_cons <span class="keyword">(</span>LD2VSITEMset <span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> <span class="keyword">!</span>the_ld2vsitems<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_ld2vs := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9626"><span class="dyncstuse">d2varset_nil</span></a>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_push_lam]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12279"><span class="dyncstimp">the_d2varset_env_pop_let</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">prval</span> <span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf</span><span class="keyword">;</span> <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> <span class="keyword">!</span>the_ld2vsitems <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>ld2vsitem<span class="keyword">,</span> ld2vsitems<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> ld2vsitem <span class="keyword">of</span>
      <span class="keyword">|</span> LD2VSITEMset ld2vs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">!</span>the_ld2vs := ld2vs<span class="keyword">;</span> <span class="keyword">!</span>the_ld2vsitems := ld2vsitems
        <span class="keyword">end</span>
      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": the_d2varset_env_pop_let"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_pop_let]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12350"><span class="dyncstimp">the_d2varset_env_push_let</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_ld2vsitems :=
    list_cons <span class="keyword">(</span>LD2VSITEMset <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">!</span>the_ld2vsitems<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_ld2vs := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9626"><span class="dyncstuse">d2varset_nil</span></a> <span class="comment">// it is not a constructor
</span><span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_push_let]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12413"><span class="dyncstimp">the_d2varset_env_pop_try</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12137"><span class="dyncstuse">the_d2varset_env_pop_lam</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_pop_try]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12484"><span class="dyncstimp">the_d2varset_env_push_try</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12208"><span class="dyncstuse">the_d2varset_env_push_lam</span></a> <span class="keyword">(</span>0<span class="comment">(*lin*)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_push_try]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12547"><span class="dyncstimp">the_d2varset_env_d2var_is_lam_local</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>itms<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span><span class="keyword">,</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> itms <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>itm<span class="keyword">,</span> itms<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> itm <span class="keyword">of</span>
      <span class="keyword">|</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a>
      <span class="keyword">|</span> LD2VSITEMllam _ <span class="keyword">=&gt;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a>
      <span class="keyword">|</span> LD2VSITEMset dvs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10271"><span class="dyncstuse">d2varset_ismem</span></a> <span class="keyword">(</span>dvs<span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">then</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4327"><span class="dyncstuse">true</span></a> <span class="keyword">else</span> aux <span class="keyword">(</span>itms<span class="keyword">,</span> d2v<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [LD2VSITEMset]
</span>      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": d2var_is_lam_local: aux: d2v = "<span class="keyword">;</span> prerr d2v<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> ans<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10271"><span class="dyncstuse">d2varset_ismem</span></a> <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> ans <span class="keyword">then</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4327"><span class="dyncstuse">true</span></a> <span class="keyword">else</span> aux <span class="keyword">(</span><span class="keyword">!</span>the_ld2vsitems<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_d2var_is_lam_local]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12608"><span class="dyncstimp">the_d2varset_env_d2var_is_llam_local</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>itms<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span><span class="keyword">,</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> itms <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>itm<span class="keyword">,</span> itms<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> itm <span class="keyword">of</span>
      <span class="keyword">|</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a>
      <span class="keyword">|</span> LD2VSITEMllam r <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">!</span>r := list_cons <span class="keyword">(</span>d2v<span class="keyword">,</span> <span class="keyword">!</span>r<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>itms<span class="keyword">,</span> d2v<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [LD2VSITEMllam]
</span>      <span class="keyword">|</span> LD2VSITEMset dvs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10271"><span class="dyncstuse">d2varset_ismem</span></a> <span class="keyword">(</span>dvs<span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">then</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4327"><span class="dyncstuse">true</span></a> <span class="keyword">else</span> aux <span class="keyword">(</span>itms<span class="keyword">,</span> d2v<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [LD2VSITEMset]
</span>      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": d2var_is_llam_local: aux: d2v = "<span class="keyword">;</span> prerr d2v<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> ans<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10271"><span class="dyncstuse">d2varset_ismem</span></a> <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "d2var_is_llam_local: the_ld2vs = ";
    print (!the_ld2vs);
    print_newline ();
    print "d2var_is_llam_local: d2v = ";
    print (d2v);
    print_newline ();
    print "d2var_is_llam_local: ans = ";
    print (ans);
    print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> ans <span class="keyword">then</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4327"><span class="dyncstuse">true</span></a> <span class="keyword">else</span> aux <span class="keyword">(</span><span class="keyword">!</span>the_ld2vsitems<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_d2var_is_llam_local]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12671"><span class="dyncstimp">the_d2varset_env_check</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "the_d2varset_env_check: enter"; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10465"><span class="dyncstuse">d2varset_foreach_cloptr</span></a>
    <span class="keyword">(</span><span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> <span class="keyword">lam</span> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2var_fin_check <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_check]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12718"><span class="dyncstimp">the_d2varset_env_check_llam</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> auxCK <span class="keyword">(</span>d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7527"><span class="dyncstuse">d2var_typ_get</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> Some s2e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26759"><span class="dyncstuse">s2exp_is_nonlin</span></a> s2e <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">else</span> <span class="keyword">begin</span>
          prerr_loc_error3 loc0<span class="keyword">;</span>
          prerr ": the linear dynamic variable ["<span class="keyword">;</span> prerr d2v<span class="keyword">;</span>
          prerr "] needs to be consumed but it is preserved with the type ["<span class="keyword">;</span>
          prerr s2e<span class="keyword">;</span>
          prerr "] instead."<span class="keyword">;</span>
          <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [if]
</span>      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [auxCK]
</span>  <span class="keyword">fun</span> auxlst <span class="keyword">(</span>d2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3017"><span class="stacstuse">d2varlst</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2vs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>d2v<span class="keyword">,</span> d2vs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>auxCK d2v<span class="keyword">;</span> auxlst d2vs<span class="keyword">)</span> <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [auxlst]
</span><span class="keyword">in</span>
  auxlst <span class="keyword">(</span>the_d2varset_env_get_llam_ld2vs <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_check_llam]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12792"><span class="dyncstimp">the_d2varset_env_find_view</span></a> <span class="keyword">(</span>s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">exception</span> NotFound <span class="comment">// local exception
</span>  <span class="keyword">exception</span> Found <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span> <span class="comment">// local exception
</span>  <span class="keyword">typedef</span> <span class="staexp"><a name="21061"><span class="stacstdec">env_t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a></span></a></span><span class="keyword">;</span> <span class="keyword">val</span> env <span class="keyword">=</span> s2e0 <span class="comment">// closure environment
</span>  <span class="keyword">fn</span> f <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a></span></a></span></span> <span class="keyword">|</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#21061"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#21061"><span class="stacstuse">env_t</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7527"><span class="dyncstuse">d2var_typ_get</span></a> d2v <span class="keyword">of</span>
    <span class="keyword">|</span> Some s2e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#34664"><span class="dyncstuse">s2exp_syneq</span></a> <span class="keyword">(</span>env<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">$raise</span> Found <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// this happens if [d2v] is linear and consumed
</span>  <span class="keyword">end</span> <span class="comment">// end of [f]
</span>  <span class="keyword">fun</span> loop <span class="keyword">(</span>
      <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a></span></a></span></span> <span class="keyword">|</span> ld2vsitems<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#21061"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#21061"><span class="stacstuse">env_t</span></a></span></a></span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> ld2vsitems <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>ld2vsitem<span class="keyword">,</span> ld2vsitems<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> ld2vsitem <span class="keyword">of</span>
          <span class="keyword">|</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">$raise</span> NotFound <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">|</span> LD2VSITEMllam _<span class="comment">(*r_d2vs*)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// continue search
</span>          <span class="keyword">|</span> LD2VSITEMset dvs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10329"><span class="dyncstuse">d2varset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#21061"><span class="stacstuse">env_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> dvs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [LD2VSITEMset]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span>
      <span class="keyword">in</span>
        loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> ld2vsitems<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [loop]
</span><span class="keyword">in</span>
  <span class="keyword">try</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp">pf <span class="keyword">=</span> unit_v <span class="keyword">(</span><span class="keyword">)</span></span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10329"><span class="dyncstuse">d2varset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#21061"><span class="stacstuse">env_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">!</span>the_ld2vsitems<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf</span>
  <span class="keyword">in</span>
    None_vt <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">with</span>
    <span class="keyword">|</span> <span class="keyword">~</span>NotFound <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>Found d2v <span class="keyword">=&gt;</span> Some_vt d2v
  <span class="comment">// end of [try]
</span><span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_find_view]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12972"><span class="dyncstimp">the_d2varset_env_find_viewat</span></a> <span class="keyword">(</span>s2r0<span class="keyword">,</span> s2ls0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">exception</span> NotFound <span class="comment">// local exception
</span>  <span class="keyword">exception</span> Found <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12859"><span class="stacstuse">d2varset_env_find_viewat_t</span></a></span> <span class="comment">// local exception
</span>  <span class="keyword">dataviewtype</span> <span class="staexp"><a name="22572"><span class="stacstdec">env_vt</span></a></span> <span class="keyword">=</span> ENVcon <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9196"><span class="stacstuse">s2lablst</span></a><span class="keyword">)</span></span>

  <span class="keyword">fn</span> f <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a></span></a></span></span> <span class="keyword">|</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#22572"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#22572"><span class="stacstuse">env_vt</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7527"><span class="dyncstuse">d2var_typ_get</span></a> d2v <span class="keyword">of</span>
    <span class="keyword">|</span> Some s2e <span class="keyword">=&gt;</span> <span class="keyword">let</span> <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e <span class="keyword">in</span>
        <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8814"><span class="dyncstuse">un_s2exp_at_viewt0ype_addr_view</span></a> s2e <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2ts2a <span class="comment">(*type/addr*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> <span class="keyword">(</span>s2r<span class="keyword">,</span> s2ls_ft<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#34965"><span class="dyncstuse">s2exp_addr_normalize</span></a> s2ts2a<span class="keyword">.</span>1
            <span class="keyword">val+</span> ENVcon <span class="keyword">(</span>s2r0<span class="keyword">,</span> s2ls0<span class="keyword">)</span> <span class="keyword">=</span> env
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> 0 <span class="keyword">of</span>
              <span class="keyword">|</span> _ <span class="keyword">when</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#34664"><span class="dyncstuse">s2exp_syneq</span></a> <span class="keyword">(</span>s2r0<span class="keyword">,</span> s2r<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                <span class="keyword">case+</span> s2lablst_is_prefix <span class="keyword">(</span>s2ls_ft<span class="keyword">,</span> s2ls0<span class="keyword">)</span> <span class="keyword">of</span>
                <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2ls_bk<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                    <span class="keyword">$raise</span> Found <span class="keyword">@(</span>d2v<span class="keyword">,</span> s2ts2a<span class="keyword">.</span>0<span class="keyword">,</span> s2ts2a<span class="keyword">.</span>1<span class="keyword">,</span> s2ls_ft<span class="keyword">,</span> s2ls_bk<span class="keyword">)</span>
                  <span class="keyword">end</span>
                <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
                <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>              <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span>
          <span class="keyword">in</span>
            fold@ env
          <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [let]
</span>    <span class="keyword">|</span> None <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// this happens if [d2v] is linear and consumed
</span>  <span class="keyword">end</span> <span class="comment">// end of [f]
</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>
      <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a></span></a></span></span>
    <span class="keyword">|</span> ld2vsitems<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#22572"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#22572"><span class="stacstuse">env_vt</span></a></span></a></span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> ld2vsitems <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>ld2vsitem<span class="keyword">,</span> ld2vsitems<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> ld2vsitem <span class="keyword">of</span>
          <span class="keyword">|</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">$raise</span> NotFound <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">|</span> LD2VSITEMllam _<span class="comment">(*r_d2vs*)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// continue search
</span>          <span class="keyword">|</span> LD2VSITEMset dvs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10329"><span class="dyncstuse">d2varset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#22572"><span class="stacstuse">env_vt</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> dvs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [LD2VSITEMset]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span>
      <span class="keyword">in</span>
        loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> ld2vsitems<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [loop]
</span><span class="keyword">in</span>
  <span class="keyword">try</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp">pf <span class="keyword">=</span> unit_v <span class="keyword">(</span><span class="keyword">)</span></span>
    <span class="keyword">val</span> env <span class="keyword">=</span> ENVcon <span class="keyword">(</span>s2r0<span class="keyword">,</span> s2ls0<span class="keyword">)</span> <span class="comment">// cloenv
</span>    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10329"><span class="dyncstuse">d2varset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#22572"><span class="stacstuse">env_vt</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> loop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">!</span>the_ld2vsitems<span class="keyword">,</span> env<span class="keyword">)</span>
    <span class="keyword">val+</span> <span class="keyword">~</span>ENVcon <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> env
    <span class="keyword">prval</span> <span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf</span>
  <span class="keyword">in</span>
    None_vt <span class="keyword">(</span><span class="keyword">)</span>  
  <span class="keyword">end</span> <span class="keyword">with</span>
    <span class="keyword">|</span> <span class="keyword">~</span>NotFound <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>Found x <span class="keyword">=&gt;</span> Some_vt x
  <span class="comment">// end of [try]
</span><span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_find_viewat]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13313"><span class="dyncstimp">the_d2varset_env_stbefitemlst_save</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> sbis<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13268"><span class="stacstuse">stbefitemlst</span></a></span> <span class="keyword">=</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="24761"><span class="stacstdec">sbisptr <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> sbis</span></a></span>
  <span class="keyword">viewdef</span> <span class="staexp"><a name="24790"><span class="stacstdec">V <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13268"><span class="stacstuse">stbefitemlst</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> sbis</span></a></span>
  <span class="keyword">fun</span> f <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24790"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24790"><span class="stacstuse">V</span></a></span></a></span></span> <span class="keyword">|</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">,</span> sbis<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24761"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24761"><span class="stacstuse">sbisptr</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> lin <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7033"><span class="dyncstuse">d2var_lin_get</span></a> d2v
<span class="comment">(*
    val () = begin
      print "the_d2varset_env_stbefitemlst_save: f: d2v = "; print d2v; print_newline ();
      print "the_d2varset_env_stbefitemlst_save: f: lin = "; print lin; print_newline ();
    end // end of [val]
*)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> lin &gt;= 0 <span class="keyword">then</span> <span class="keyword">let</span> <span class="keyword">val</span> sbi <span class="keyword">=</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13370"><span class="dyncstuse">stbefitem_make</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> lin<span class="keyword">)</span> <span class="keyword">in</span> <span class="keyword">!</span>sbis := list_cons <span class="keyword">(</span>sbi<span class="keyword">,</span> <span class="keyword">!</span>sbis<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="comment">(* end of [f] *)</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24790"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24790"><span class="stacstuse">V</span></a></span></a></span></span> <span class="keyword">|</span> xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#13889"><span class="stacstuse">ld2vsitemlst</span></a></span><span class="keyword">,</span> sbis<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24761"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24761"><span class="stacstuse">sbisptr</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> x <span class="keyword">of</span>
      <span class="keyword">|</span> LD2VSITEMlam <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">|</span> LD2VSITEMllam _ <span class="keyword">=&gt;</span> aux <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs<span class="keyword">,</span> sbis<span class="keyword">)</span>
      <span class="keyword">|</span> LD2VSITEMset dvs <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10329"><span class="dyncstuse">d2varset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24790"><span class="stacstuse">V</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24761"><span class="stacstuse">sbisptr</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> dvs<span class="keyword">,</span> f<span class="keyword">,</span> sbis<span class="keyword">)</span>
          <span class="keyword">end</span>
        <span class="keyword">in</span>
          aux <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> xs<span class="keyword">,</span> sbis<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">(* LD2VSITEMset *)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">prval</span> <span class="prfexp">pf <span class="keyword">=</span> view@ sbis</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#10329"><span class="dyncstuse">d2varset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24790"><span class="stacstuse">V</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#24761"><span class="stacstuse">sbisptr</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">!</span>the_ld2vs<span class="keyword">,</span> f<span class="keyword">,</span> <span class="keyword">&amp;</span>sbis<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">!</span>the_ld2vsitems<span class="keyword">,</span> <span class="keyword">&amp;</span>sbis<span class="keyword">)</span>
<span class="keyword">in</span>
  view@ sbis := pf<span class="keyword">;</span> sbis
<span class="keyword">end</span> <span class="comment">// end of [the_d2varset_env_stbefitemlst_save]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_s3itemlst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">val</span> the_s3itemlstlst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2918"><span class="stacstuse">s3itemlstlst_vt</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8207"><span class="dyncstimp">trans3_env_s3itemlst_copy</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s3itemlst<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#3364"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_copy__boxed</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_Env_s3itemlst_copy]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8254"><span class="dyncstimp">trans3_env_s3itemlst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s3itemlst<span class="keyword">)</span>
  <span class="keyword">val</span> s3is <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  s3is
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_s3itemlst_get]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8300"><span class="dyncstimp">trans3_env_s3itemlst_set</span></a> <span class="keyword">(</span>s3is<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s3itemlst<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p := s3is<span class="keyword">;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> list_vt_cons _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> Some_vt s3is<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_s3itemlst_set]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8374"><span class="dyncstimp">trans3_env_add_svar</span></a> <span class="keyword">(</span>s2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s3itemlst<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMsvar s2v<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_svar]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstimp">trans3_env_add_svarlst</span></a> <span class="keyword">(</span>s2vs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>n<span class="keyword">&gt;.</span></span>
    <span class="keyword">(</span>s3is<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a></span><span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21858"><span class="stacstuse">list</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2272"><span class="stacstuse">s2var_t</span></a><span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s2vs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>list_vt_cons <span class="keyword">(</span>S3ITEMsvar s2v<span class="keyword">,</span> s3is<span class="keyword">)</span><span class="keyword">,</span> s2vs<span class="keyword">)</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s3is
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_s3itemlst<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := aux <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> s2vs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_svarlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8470"><span class="dyncstimp">trans3_env_add_sVar</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6144"><span class="dyncstuse">the_s2Varset_env_add</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
 <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMsVar s2V<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_sVar]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8515"><span class="dyncstimp">trans3_env_add_sVarlst</span></a> <span class="keyword">(</span>s2Vs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>n<span class="keyword">&gt;.</span></span>
    <span class="keyword">(</span>s3is<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a></span><span class="keyword">,</span> s2Vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21858"><span class="stacstuse">list</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2386"><span class="stacstuse">s2Var_t</span></a><span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">)</span>
    <span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2Vs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2V<span class="keyword">,</span> s2Vs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">$effmask_all</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6144"><span class="dyncstuse">the_s2Varset_env_add</span></a> s2V<span class="keyword">)</span><span class="keyword">;</span>
        aux <span class="keyword">(</span>list_vt_cons <span class="keyword">(</span>S3ITEMsVar s2V<span class="keyword">,</span> s3is<span class="keyword">)</span><span class="keyword">,</span> s2Vs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s3is
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := aux <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> s2Vs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_sVarlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8566"><span class="dyncstimp">trans3_env_add_cstr</span></a> <span class="keyword">(</span>c3t<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMcstr c3t<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_cstr]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8609"><span class="dyncstimp">trans3_env_add_cstr_ref</span></a> <span class="keyword">(</span>r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMcstr_ref r<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_cstr_ref]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8661"><span class="dyncstimp">trans3_env_add_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2p<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Etyleq <span class="keyword">(</span>knd<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">when</span> knd <span class="keyword">&gt;</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#3473"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_tyleq_solve</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span> <span class="comment">// end of [S2Etyleq when ...]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8566"><span class="dyncstuse">trans3_env_add_cstr</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5160"><span class="dyncstuse">c3str_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="comment">// end of [trans3_env_add_prop]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstimp">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2ps <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2p<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8661"><span class="dyncstuse">trans3_env_add_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstuse">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2ps<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [trans3_env_add_proplst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8778"><span class="dyncstimp">trans3_env_add_proplstlst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2pss<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2pss <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2ps<span class="keyword">,</span> s2pss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstuse">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2ps<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8778"><span class="dyncstuse">trans3_env_add_proplstlst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2pss<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [trans3_env_add_proplstlst]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8847"><span class="dyncstimp">trans3_env_add_eqeq</span></a>
  <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "trans3_env_add_eqeq: s2e1 = "; print_s2exp s2e1; print_newline ();
    print "trans3_env_add_eqeq: s2e2 = "; print_s2exp s2e2; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2p <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30104"><span class="dyncstuse">s2exp_eqeq</span></a> <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8661"><span class="dyncstuse">trans3_env_add_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_eqeq]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8918"><span class="dyncstimp">trans3_env_add_tyleq</span></a>
  <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2p <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#31580"><span class="dyncstuse">s2exp_tyleq</span></a> <span class="keyword">(</span>0<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="comment">// already tried
</span><span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8661"><span class="dyncstuse">trans3_env_add_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_add_tyleq]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9012"><span class="dyncstimp">trans3_env_hypo_add_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "trans3_env_hypo_add_prop: s2p = "; print s2p; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> h3p <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5495"><span class="dyncstuse">h3ypo_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMhypo h3p<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_prop]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstimp">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2ps <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2p<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9012"><span class="dyncstuse">trans3_env_hypo_add_prop</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2p<span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2ps<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [trans3_env_hypo_add_proplst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9140"><span class="dyncstimp">trans3_env_hypo_add_bind</span></a>
  <span class="keyword">(</span>loc<span class="keyword">,</span> s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "trans3_env_hypo_add_bind: s2v1 = "; print s2v1; print_newline ();
    print "trans3_env_hypo_add_bind: s2e2 = "; print s2e2; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> os2e1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6635"><span class="dyncstuse">the_s2varbindmap_find</span></a> <span class="keyword">(</span>s2v1<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> os2e1 <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2e1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9218"><span class="dyncstuse">trans3_env_hypo_add_eqeq</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
    <span class="comment">// end of [Some_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6577"><span class="dyncstuse">the_s2varbindmap_add</span></a> <span class="keyword">(</span>s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
      <span class="keyword">val</span> h3p <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5538"><span class="dyncstuse">h3ypo_bind</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
    <span class="keyword">in</span>
      <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMhypo h3p<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_bind]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9218"><span class="dyncstimp">trans3_env_hypo_add_eqeq</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "trans3_env_hypo_add_eqeq: s2e1 = "; print s2e1; print_newline ();
    print "trans3_env_hypo_add_eqeq: s2e2 = "; print s2e2; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> h3p <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5593"><span class="dyncstuse">h3ypo_eqeq</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMhypo h3p<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_eqeq]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9295"><span class="dyncstimp">trans3_env_hypo_add_s2qualst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> s2vps<span class="keyword">.</span>0<span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9295"><span class="dyncstuse">trans3_env_hypo_add_s2qualst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2vpss<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_s2qualst]
</span>
<span class="comment">// used in [trans3_env_hypo_add_p2atcstlstlst]
</span><span class="keyword">fn</span> trans3_env_hypo_add_disj <span class="keyword">(</span>s3iss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2659"><span class="stacstuse">s3itemlstlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMdisj s3iss<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_p2atcstlstlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="32574"><span class="dyncstdec">print_the_s3itemlst <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span></span></a>
  <span class="keyword">=</span> "ats_trans3_env_print_the_s3itemlst"
<span class="comment">// end of [print_the_s3itemlst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#32574"><span class="dyncstimp">print_the_s3itemlst</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#4323"><span class="dyncstuse">print_s3itemlst_vt</span></a> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [print_the_s3itemlst]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="32859"><span class="dyncstdec">print_the_s3itemlstlst <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span></span></a>
  <span class="keyword">=</span> "ats_trans3_env_print_the_s3itemlstlst"
<span class="comment">// end of [print_the_s3itemlstlst]
</span>  
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#32859"><span class="dyncstimp">print_the_s3itemlstlst</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> ps<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlstlst
<span class="keyword">in</span>
  <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#4578"><span class="dyncstuse">print_s3itemlstlst_vt</span></a> <span class="keyword">!</span>ps<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [print_the_s3itemlstlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="33190"><span class="dyncstdec">free_the_s3itemlst <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span></span></a>
  <span class="keyword">=</span> "ats_trans3_env_free_the_s3itemlst"
<span class="comment">// end of [free_the_s3itemlst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2edats.html#33190"><span class="dyncstimp">free_the_s3itemlst</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
  <span class="keyword">val</span> s3is <span class="keyword">=</span> <span class="keyword">!</span>p
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#3568"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_free__boxed</span></a> <span class="keyword">(</span>s3is<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [free_the_s3itemlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15630"><span class="dyncstimp">trans3_env_pop_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = $effmask_ref begin
    print "trans3_env_pop_sta: the_s3itemlst = "; print_the_s3itemlst (); print_newline ();
    print "trans3_env_pop_sta: the_s3itemlstlst = "; print_the_s3itemlstlst (); print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6862"><span class="dyncstuse">the_s2varbindmap_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6275"><span class="dyncstuse">the_s2Varset_env_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> s3is1 <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> ps<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlstlst
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>ps <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>s3is<span class="keyword">,</span> s3iss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>ps := <span class="keyword">(</span>s3iss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2918"><span class="stacstuse">s3itemlstlst_vt</span></a></span><span class="keyword">)</span><span class="keyword">;</span> s3is<span class="keyword">)</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">!</span>ps := list_vt_nil <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">;</span> list_vt_nil <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2205"><span class="stacstuse">s3item</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_vt_nil]
</span>  <span class="keyword">end</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a></span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": trans3_env_pop_sta: [the_s3itemlstlst] is empty."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
  <span class="keyword">val</span> s3is0 <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>p := s3is1<span class="keyword">)</span>
<span class="keyword">in</span>
  s3is0
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_pop_sta]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15670"><span class="dyncstimp">trans3_env_pop_sta_and_add</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> cstrknd<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s3is0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15630"><span class="dyncstuse">trans3_env_pop_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> c3t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5203"><span class="dyncstuse">c3str_itmlst</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> cstrknd<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#4588"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_reverse_list</span></a> s3is0<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "trans3_env_pop_sta_and_add: c3t = "; print c3t; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>S3ITEMcstr c3t<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_pop_sta_and_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstimp">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc<span class="keyword">)</span> <span class="keyword">=</span>
 <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15670"><span class="dyncstuse">trans3_env_pop_sta_and_add</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> C3STRKINDnone <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of ...
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15785"><span class="dyncstimp">trans3_env_pop_sta_and_free</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s3is <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15630"><span class="dyncstuse">trans3_env_pop_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#3568"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_free__boxed</span></a> <span class="keyword">(</span>s3is<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_pop_sta_and_free]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstimp">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "trans3_env_push_sta: the_s3itemlst = "; print_the_s3itemlst (); print_newline ();
    print "trans3_env_push_sta: the_s3itemlstlst = "; print_the_s3itemlstlst (); print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">var</span> s3is0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2876"><span class="stacstuse">s3itemlst_vt</span></a>?</span> <span class="comment">// uninitialized
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlst
  <span class="keyword">in</span>
    s3is0 := <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">!</span>p := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> ps<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> the_s3itemlstlst
  <span class="keyword">in</span>
    <span class="keyword">!</span>ps := list_vt_cons <span class="keyword">(</span>s3is0<span class="keyword">,</span> <span class="keyword">!</span>ps<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6896"><span class="dyncstuse">the_s2varbindmap_push</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6309"><span class="dyncstuse">the_s2Varset_env_push</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_push_sta]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstimp">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2t<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2V <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#18933"><span class="dyncstuse">s2Var_make_srt</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2t<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#19600"><span class="dyncstuse">s2Var_sVarset_set</span></a> <span class="keyword">(</span>s2V<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6230"><span class="dyncstuse">the_s2Varset_env_get_prev</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8470"><span class="dyncstuse">trans3_env_add_sVar</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#32147"><span class="dyncstuse">s2exp_Var</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2exp_Var_make_srt]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10048"><span class="dyncstimp">s2exp_Var_make_var</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2exp_Var_make_var: s2v = "; print s2v; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2V <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#18983"><span class="dyncstuse">s2Var_make_var</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2v<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#19600"><span class="dyncstuse">s2Var_sVarset_set</span></a> <span class="keyword">(</span>s2V<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6230"><span class="dyncstuse">the_s2Varset_env_get_prev</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "s2exp_Var_make_var: s2V = "; print s2V; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8470"><span class="dyncstuse">trans3_env_add_sVar</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#32147"><span class="dyncstuse">s2exp_Var</span></a> <span class="keyword">(</span>s2V<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2exp_Var_make_var]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10123"><span class="dyncstimp">s2qua_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2qua_instantiate_and_add: s2vs = "; print s2vs; print_newline ();
    print "s2qua_instantiate_and_add: s2ps = "; print s2ps; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> sub <span class="keyword">=</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span> <span class="keyword">=</span>
      <span class="keyword">case+</span> s2vs <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
          val () = begin
            print "s2qua_instantiate_and_add: aux: s2v = "; print s2v; print_newline ()
          end
*)</span>
          <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10048"><span class="dyncstuse">s2exp_Var_make_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2v<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33428"><span class="dyncstuse">stasub_add</span></a> <span class="keyword">(</span>aux <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">)</span><span class="keyword">,</span> s2v<span class="keyword">,</span> s2e<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33402"><span class="dyncstuse">stasub_nil</span></a>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span>  <span class="keyword">val</span> s2ps_new <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33917"><span class="dyncstuse">s2explst_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2ps<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "s2qua_instantiate_and_add: s2ps_new = "; print s2ps_new; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstuse">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2ps_new<span class="keyword">)</span><span class="keyword">;</span> sub
<span class="keyword">end</span> <span class="comment">// end of [s2qua_instantiate_and_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10209"><span class="dyncstimp">s2qua_instantiate_with_and_add</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a></span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9393"><span class="stacstuse">s2explst</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">(</span>list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> s2vs<span class="keyword">)</span><span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e<span class="keyword">,</span> s2es<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s2t_s2v <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#16824"><span class="dyncstuse">s2var_srt_get</span></a> s2v <span class="keyword">and</span> s2t_s2e <span class="keyword">=</span> s2e<span class="keyword">.</span>s2exp_srt
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// sort-checking
</span>          <span class="keyword">if</span> s2t_s2e &lt;= s2t_s2v <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">begin</span>
            prerr_loc_error3 loc_arg<span class="keyword">;</span>
            prerr ": the static expression ["<span class="keyword">;</span>
            prerr s2e<span class="keyword">;</span>
            prerr "] is of sort ["<span class="keyword">;</span>
            prerr s2t_s2e<span class="keyword">;</span>
            prerr "] but is expected to be of sort ["<span class="keyword">;</span>
            prerr s2t_s2v<span class="keyword">;</span>
            prerr "]."<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33428"><span class="dyncstuse">stasub_add</span></a> <span class="keyword">(</span>aux <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2es<span class="keyword">)</span><span class="keyword">,</span> s2v<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons, list_cons]
</span>    <span class="keyword">|</span> <span class="keyword">(</span>list_nil _<span class="keyword">,</span> list_nil _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33402"><span class="dyncstuse">stasub_nil</span></a>
    <span class="keyword">|</span> <span class="keyword">(</span>list_cons _<span class="keyword">,</span> list_nil _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the static application needs more arguments."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons, list_nil]
</span>    <span class="keyword">|</span> <span class="keyword">(</span>list_nil _<span class="keyword">,</span> list_cons _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the static application needs less arguments."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_nil, list_cons]
</span>  <span class="keyword">val</span> sub <span class="keyword">=</span> aux <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2es<span class="keyword">)</span>
  <span class="keyword">val</span> s2ps_new <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33917"><span class="dyncstuse">s2explst_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2ps<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstuse">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2ps_new<span class="keyword">)</span>
<span class="keyword">in</span>
  sub
<span class="keyword">end</span> <span class="comment">// end of [s2qua_instantiate_with_and_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10337"><span class="dyncstimp">s2qua_hypo_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">@(</span>sub<span class="keyword">,</span> s2vs_new<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33658"><span class="dyncstuse">stasub_extend_svarlst</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33402"><span class="dyncstuse">stasub_nil</span></a><span class="keyword">,</span> s2vs<span class="keyword">)</span>
  <span class="keyword">val</span> s2ps_new <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33917"><span class="dyncstuse">s2explst_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2ps<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> s2vs_new
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2ps_new<span class="keyword">)</span>
<span class="keyword">in</span>
  sub
<span class="keyword">end</span> <span class="comment">// end of [s2qua_hypo_instantiate_and_add]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10449"><span class="dyncstimp">s2exp_metric_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2vopt<span class="keyword">,</span> met<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d2vopt <span class="keyword">of</span>
  <span class="keyword">|</span> Some d2v_stamp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> met_bound <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7035"><span class="dyncstuse">metric_env_get</span></a> d2v_stamp <span class="keyword">of</span>
        <span class="keyword">|</span> Some s2es <span class="keyword">=&gt;</span> s2es <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            prerr ": s2exp_metric_instantiate: no metric bound"<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>            
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9393"><span class="stacstuse">s2explst</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9393"><span class="stacstuse">s2explst</span></a></span>
      <span class="keyword">val</span> sgn <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#3105"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_length_compare</span></a> <span class="keyword">(</span>met<span class="keyword">,</span> met_bound<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#5696"><span class="dyncstuse">assert_errmsg_bool1</span></a> <span class="keyword">(</span>sgn <span class="keyword">=</span> 0<span class="keyword">,</span>
        "INTERNAL ERROR: s2exp_metric_instantiate: metric length mismatch"
      <span class="keyword">)</span> <span class="comment">// end of [assert_errmsg]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9758"><span class="dyncstuse">trans3_env_add_metric_dec</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> met<span class="keyword">,</span> met_bound<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>  <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2exp_metric_instantiate]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10541"><span class="dyncstimp">s2exp_exi_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e0 <span class="keyword">in</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Eexi <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10123"><span class="dyncstuse">s2qua_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span>
        <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10541"><span class="dyncstuse">s2exp_exi_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Eexi]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> s2e0
<span class="keyword">end</span> <span class="comment">// end of [s2exp_exi_instantiate_all]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10599"><span class="dyncstimp">s2exp_exi_instantiate_one</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e0 <span class="keyword">in</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Eexi <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10123"><span class="dyncstuse">s2qua_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Eexi]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span>
        prerr "] is expected to be existentially quantified."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s2exp_exi_instantiate_one]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10657"><span class="dyncstimp">s2exp_exi_instantiate_seq</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s2es0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e0 <span class="keyword">in</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Eexi <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10209"><span class="dyncstuse">s2qua_instantiate_with_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s2es0<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Eexi]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span>
        prerr "] is expected to be existentially quantified."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s2exp_exi_instantiate_seq]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10749"><span class="dyncstimp">s2exp_exi_instantiate_sexparg</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2a<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2a<span class="keyword">.</span>s2exparg_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2EXPARGall <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10541"><span class="dyncstuse">s2exp_exi_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span>
  <span class="keyword">|</span> S2EXPARGone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10599"><span class="dyncstuse">s2exp_exi_instantiate_one</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span>
  <span class="keyword">|</span> S2EXPARGseq s2es <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10657"><span class="dyncstuse">s2exp_exi_instantiate_seq</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2a<span class="keyword">.</span>s2exparg_loc<span class="keyword">,</span> s2es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2EXPARGseq]
</span><span class="comment">// end of [s2exp_exi_instantiate_sexparg]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10829"><span class="dyncstimp">funarg_varfin_check</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    $Loc.print_location loc0; print ": funarg_varfin_check"; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">fn</span> auxvar
    <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
    val () = begin
      print "funarg_varfin_check: auxvar: d2v (bef) = "; print_d2var d2v; print_newline ()
    end // end of [val]
*)</span>
    <span class="keyword">val</span> d2v <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7341"><span class="dyncstuse">d2var_view_get</span></a> d2v <span class="keyword">of</span>
      <span class="keyword">|</span> D2VAROPTsome d2v <span class="keyword">=&gt;</span> d2v <span class="keyword">|</span> D2VAROPTnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2v
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span>
<span class="comment">(*
    val () = begin
      print "funarg_varfin_check: auxvar: d2v (aft) = "; print_d2var d2v; print_newline ()
    end // end of [val]
*)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> d2var_fin_check <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7476"><span class="dyncstuse">d2var_fin_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> D2VARFINdone <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="comment">// done!
</span>  <span class="keyword">end</span> <span class="comment">// end of [auxvar]
</span>
  <span class="keyword">fun</span> auxpatlst
    <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> p3ts<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#2925"><span class="stacstuse">p3atlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> p3ts <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>p3t<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> p3t<span class="keyword">.</span>p3at_node <span class="keyword">of</span>
          <span class="keyword">|</span> P3Tvar <span class="keyword">(</span>_<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">=&gt;</span> auxvar <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
          <span class="keyword">|</span> P3Tas <span class="keyword">(</span>_<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">,</span> _<span class="comment">(*p3at*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> auxvar <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        auxpatlst <span class="keyword">(</span>loc0<span class="keyword">,</span> p3ts<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [auxpatlst]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15545"><span class="dyncstuse">the_lamloop_env_arg_get</span></a> loc0 <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt p3ts <span class="keyword">=&gt;</span> auxpatlst <span class="keyword">(</span>loc0<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror loc0<span class="keyword">;</span>
      prerr ": funarg_varfin_check: no argument(s)."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">(* end of [funarg_varfin_check] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10873"><span class="dyncstimp">s2exp_wth_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2exp_wth_instantiate: s2e0 = "; print s2e0; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">fn</span> aux <span class="keyword">(</span>
      loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span>
    <span class="keyword">,</span> refval<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span>
    <span class="keyword">,</span> p3t<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#2770"><span class="stacstuse">p3at</span></a></span>
    <span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a></span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> d2v <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> p3t<span class="keyword">.</span>p3at_node <span class="keyword">of</span>
      <span class="keyword">|</span> P3Tvar <span class="keyword">(</span>_<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2v
      <span class="keyword">|</span> P3Tas <span class="keyword">(</span>_<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">,</span> _<span class="comment">(*p2at*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2v
      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          prerr_loc_interror loc0<span class="keyword">;</span>
          prerr ": s2exp_wth_instantiate: aux: p3t = "<span class="keyword">;</span> prerr p3t<span class="keyword">;</span>
          <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span> <span class="comment">// end of [val]
</span><span class="comment">(*
    val () = begin
      print "s2exp_wth_instantiate: aux: refval = "; print refval; print_newline ();
      print "s2exp_wth_instantiate: aux: d2v = "; print d2v; print_newline ();
      print "s2exp_wth_instantiate: aux: s2e = "; print s2e; print_newline ();
    end // end of [val]
*)</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> refval <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> refval <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7476"><span class="dyncstuse">d2var_fin_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> D2VARFINsome s2e<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="comment">(* refval = 1 *)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2v_view <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#8002"><span class="dyncstuse">d2var_view_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
        <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
        <span class="keyword">val</span> s2e_at <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8747"><span class="dyncstuse">s2exp_at_viewt0ype_addr_view</span></a> <span class="keyword">(</span>s2e<span class="keyword">,</span> s2e_addr<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7476"><span class="dyncstuse">d2var_fin_set</span></a> <span class="keyword">(</span>d2v_view<span class="keyword">,</span> D2VARFINsome s2e_at<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">fun</span> auxlst <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> p3ts<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#2925"><span class="stacstuse">p3atlst</span></a></span><span class="keyword">,</span> wths2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8597"><span class="stacstuse">wths2explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> wths2es <span class="keyword">of</span>
    <span class="keyword">|</span> WTHS2EXPLSTcons_some <span class="keyword">(</span>refval<span class="keyword">,</span> s2e<span class="keyword">,</span> wths2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#5696"><span class="dyncstuse">assert_errmsg_bool1</span></a> <span class="keyword">(</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#1642"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_is_cons</span></a> p3ts<span class="keyword">,</span> "INTERNAL ERROR: s2exp_wth_instantiate"
        <span class="keyword">)</span> <span class="comment">// end of [assert_errmsg]
</span>        <span class="keyword">val+</span> list_cons <span class="keyword">(</span>p3t<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=</span> p3ts
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> refval<span class="keyword">,</span> p3t<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">in</span>
        auxlst <span class="keyword">(</span>loc0<span class="keyword">,</span> p3ts<span class="keyword">,</span> wths2es<span class="keyword">)</span>     
      <span class="keyword">end</span> <span class="comment">// end of [WTHS2EXPLSTcons_some]
</span>    <span class="keyword">|</span> WTHS2EXPLSTcons_none <span class="keyword">(</span>wths2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
        val () = assert_errmsg_bool1 (
          $Lst.list_is_cons p3ts, "INTERNAL ERROR: s2exp_wth_instantiate"
        ) // end of [assert_errmsg]
*)</span>
        <span class="keyword">val-</span> list_cons <span class="keyword">(</span>p3t<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=</span> p3ts
      <span class="keyword">in</span>
        auxlst <span class="keyword">(</span>loc0<span class="keyword">,</span> p3ts<span class="keyword">,</span> wths2es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [WTHS2EXPLSTcons_none]
</span>    <span class="keyword">|</span> WTHS2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10541"><span class="dyncstuse">s2exp_exi_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Ewth <span class="keyword">(</span>s2e<span class="keyword">,</span> wths2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> p3ts <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15545"><span class="dyncstuse">the_lamloop_env_arg_get</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt p3ts <span class="keyword">=&gt;</span> p3ts <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_interror loc0<span class="keyword">;</span>
            prerr ": s2exp_wth_instantiate"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#2925"><span class="stacstuse">p3atlst</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#2925"><span class="stacstuse">p3atlst</span></a></span>
    <span class="keyword">in</span>
      auxlst <span class="keyword">(</span>loc0<span class="keyword">,</span> p3ts<span class="keyword">,</span> wths2es<span class="keyword">)</span><span class="keyword">;</span> s2e
    <span class="keyword">end</span> <span class="comment">// end of [S2Ewth]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> s2e0
<span class="keyword">end</span> <span class="comment">// end of [s2exp_wth_instantiate]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstimp">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e0 <span class="keyword">in</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Euni <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10123"><span class="dyncstuse">s2qua_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span>
        <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Euni]
</span>    <span class="keyword">|</span> S2Emetfn <span class="keyword">(</span>d2vopt<span class="keyword">,</span> s2es_met<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10449"><span class="dyncstuse">s2exp_metric_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2vopt<span class="keyword">,</span> s2es_met<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Emetfn]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> s2e0
<span class="keyword">end</span> <span class="comment">// end [s2exp_uni_instantiate_all]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10992"><span class="dyncstimp">s2exp_uni_instantiate_one</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e0 <span class="keyword">in</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Euni <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10123"><span class="dyncstuse">s2qua_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Euni]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span>
        prerr "] is expected to be universally quantified."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s2exp_uni_instantiate_one]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11050"><span class="dyncstimp">s2exp_uni_instantiate_seq</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s2es0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e0 <span class="keyword">in</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Euni <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10209"><span class="dyncstuse">s2qua_instantiate_with_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s2es0<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Euni]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span>
        prerr "] is expected to be universally quantified."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s2exp_uni_instantiate_seq]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11142"><span class="dyncstimp">s2exp_uni_instantiate_sexparg</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2a<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2a<span class="keyword">.</span>s2exparg_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2EXPARGone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10992"><span class="dyncstuse">s2exp_uni_instantiate_one</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span>
  <span class="keyword">|</span> S2EXPARGall <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span>
  <span class="keyword">|</span> S2EXPARGseq s2es <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11050"><span class="dyncstuse">s2exp_uni_instantiate_seq</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2a<span class="keyword">.</span>s2exparg_loc<span class="keyword">,</span> s2es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2EXPARGseq]
</span><span class="comment">// end of [s2exp_uni_instantiate_sexparg]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11217"><span class="dyncstimp">s2exp_uni_instantiate_sexparglst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2as<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2as <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2a<span class="keyword">,</span> s2as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11142"><span class="dyncstuse">s2exp_uni_instantiate_sexparg</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2a<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11217"><span class="dyncstuse">s2exp_uni_instantiate_sexparglst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2as<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s2e0
<span class="comment">// end of [s2exp_uni_instantiate_sexparglst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11320"><span class="dyncstimp">s2exp_template_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss<span class="keyword">,</span> ts2ess<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux0 <span class="keyword">(</span>sub<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span><span class="keyword">,</span> s2vpss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10049"><span class="stacstuse">s2qualst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10049"><span class="stacstuse">s2qualst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        list_cons <span class="keyword">(</span><span class="keyword">@(</span>s2vps<span class="keyword">.</span>0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33917"><span class="dyncstuse">s2explst_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">,</span> aux0 <span class="keyword">(</span>sub<span class="keyword">,</span> s2vpss<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux0]
</span>  <span class="keyword">fun</span> aux1 <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> subs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span><span class="keyword">,</span> s2vpss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10049"><span class="stacstuse">s2qualst</span></a></span><span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><span class="keyword">@(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sub <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10123"><span class="dyncstuse">s2qua_instantiate_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vps<span class="keyword">.</span>0<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span>
        <span class="keyword">val</span> s2vpss <span class="keyword">=</span> aux0 <span class="keyword">(</span>sub<span class="keyword">,</span> s2vpss<span class="keyword">)</span>
        <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">in</span>
        aux1 <span class="keyword">(</span>loc0<span class="keyword">,</span> list_cons <span class="keyword">(</span>sub<span class="keyword">,</span> subs<span class="keyword">)</span><span class="keyword">,</span> s2vpss<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#2934"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_reverse</span></a> subs<span class="keyword">,</span> s2e<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux1]
</span>  <span class="keyword">fun</span> aux2
    <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> subs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span><span class="keyword">,</span> s2vpss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10049"><span class="stacstuse">s2qualst</span></a></span><span class="keyword">,</span>
     ts2ess<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8466"><span class="stacstuse">tmps2explstlst</span></a></span><span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">@(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> ts2ess <span class="keyword">of</span>
    <span class="keyword">|</span> TMPS2EXPLSTLSTcons <span class="keyword">(</span>loc<span class="keyword">,</span> s2es<span class="keyword">,</span> ts2ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> sub <span class="keyword">=</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10209"><span class="dyncstuse">s2qua_instantiate_with_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vps<span class="keyword">.</span>0<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">,</span>loc<span class="keyword">,</span>  s2es<span class="keyword">)</span>
          <span class="keyword">end</span>
          <span class="keyword">val</span> s2vpss <span class="keyword">=</span> aux0 <span class="keyword">(</span>sub<span class="keyword">,</span> s2vpss<span class="keyword">)</span>
          <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33866"><span class="dyncstuse">s2exp_subst</span></a> <span class="keyword">(</span>sub<span class="keyword">,</span> s2e<span class="keyword">)</span>
        <span class="keyword">in</span>
          aux2 <span class="keyword">(</span>loc0<span class="keyword">,</span> list_cons <span class="keyword">(</span>sub<span class="keyword">,</span> subs<span class="keyword">)</span><span class="keyword">,</span> s2vpss<span class="keyword">,</span> ts2ess<span class="keyword">,</span> s2e<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          prerr_loc_error3 loc0<span class="keyword">;</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: s2exp_template_instantiate"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
          prerr ": too many template arguments are given."<span class="keyword">;</span>
          <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>      <span class="keyword">end</span> <span class="comment">// end of [TMPS2EMPLSTLSTcons]
</span>    <span class="keyword">|</span> TMPS2EXPLSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux1 <span class="keyword">(</span>loc0<span class="keyword">,</span> subs<span class="keyword">,</span> s2vpss<span class="keyword">,</span> s2e<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux2]
</span><span class="keyword">in</span>
  aux2 <span class="keyword">(</span>loc0<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> s2vpss<span class="keyword">,</span> ts2ess<span class="keyword">,</span> s2e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2exp_template_instantiate]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11455"><span class="dyncstimp">s2exp_absuni_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2exp_absuni_and_add: before: s2e0 = "; print s2e0; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2vss2pss2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35798"><span class="dyncstuse">s2exp_absuni</span></a> s2e0
<span class="comment">(*
  val () = begin
    print "s2exp_absuni_and_add: after: s2vs = "; print s2vss2pss2e.0;
    print_newline ()
  end // end of [val]
  val () = begin
    print "s2exp_absuni_and_add: before: s2e = "; print s2vss2pss2e.2;
    print_newline ()
  end // end of [val]
*)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a></span> <span class="keyword">=</span> s2vss2pss2e<span class="keyword">.</span>0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#17059"><span class="dyncstuse">s2varlst_sVarset_set</span></a> <span class="keyword">(</span>s2vs<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6190"><span class="dyncstuse">the_s2Varset_env_get</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> <span class="keyword">(</span>s2vss2pss2e<span class="keyword">.</span>0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vss2pss2e<span class="keyword">.</span>1<span class="keyword">)</span>
<span class="keyword">in</span>
  s2vss2pss2e<span class="keyword">.</span>2
<span class="keyword">end</span> <span class="comment">// end of [s2exp_absuni_and_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11511"><span class="dyncstimp">s2exp_opnexi_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2exp_opnexi_and_add: before: s2e0 = "; print s2e0;
    print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2vss2pss2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35858"><span class="dyncstuse">s2exp_opnexi</span></a> s2e0
<span class="comment">(*
  val () = begin
    print "s2exp_opnexi_and_add: after: s2vs = "; print s2vss2pss2e.0;
    print_newline ()
  end // end of [val]
  val () = begin
    print "s2exp_opnexi_and_add: after: s2e = "; print s2vss2pss2e.2;
    print_newline ()
  end // end of [val]
*)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a></span> <span class="keyword">=</span> s2vss2pss2e<span class="keyword">.</span>0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#17059"><span class="dyncstuse">s2varlst_sVarset_set</span></a> <span class="keyword">(</span>s2vs<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6190"><span class="dyncstuse">the_s2Varset_env_get</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> <span class="keyword">(</span>s2vs<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vss2pss2e<span class="keyword">.</span>1<span class="keyword">)</span>
<span class="keyword">in</span>
  s2vss2pss2e<span class="keyword">.</span>2
<span class="keyword">end</span> <span class="comment">// end of [s2exp_opnexi_and_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11566"><span class="dyncstimp">s2explst_opnexi_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2es0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2vss2pss2es <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35918"><span class="dyncstuse">s2explst_opnexi</span></a> s2es0
<span class="comment">//
</span>  <span class="keyword">val</span> s2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2615"><span class="stacstuse">s2varlst</span></a></span> <span class="keyword">=</span> s2vss2pss2es<span class="keyword">.</span>0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#17059"><span class="dyncstuse">s2varlst_sVarset_set</span></a> <span class="keyword">(</span>s2vs<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6190"><span class="dyncstuse">the_s2Varset_env_get</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> <span class="keyword">(</span>s2vs<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vss2pss2es<span class="keyword">.</span>1<span class="keyword">)</span>
<span class="keyword">in</span>
  s2vss2pss2es<span class="keyword">.</span>2
<span class="keyword">end</span> <span class="comment">// end of [s2exp_opnexi_and_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11630"><span class="dyncstimp">s2expopt_opnexi_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> os2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> os2e0 <span class="keyword">of</span>
  <span class="keyword">|</span> Some s2e0 <span class="keyword">=&gt;</span> Some <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11511"><span class="dyncstuse">s2exp_opnexi_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2expopt_opnexi_and_add]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9364"><span class="dyncstimp">trans3_env_hypo_add_p2atcst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tc<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11511"><span class="dyncstuse">s2exp_opnexi_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">)</span> <span class="keyword">in</span> <span class="keyword">case+</span> p2tc <span class="keyword">of</span>
    <span class="keyword">|</span> P2TCany <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">|</span> P2TCbool b <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7685"><span class="dyncstuse">un_s2exp_bool_bool_t0ype</span></a> s2e0 <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2e_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#4589"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_hypo_equal_solve</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_arg<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#6912"><span class="dyncstuse">s2exp_bool</span></a> b<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P2TCbool]
</span>    <span class="keyword">|</span> P2TCchar c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7685"><span class="dyncstuse">un_s2exp_bool_bool_t0ype</span></a> s2e0 <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2e_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#4589"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_hypo_equal_solve</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_arg<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#29670"><span class="dyncstuse">s2exp_char</span></a> c<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P2TCchar]
</span>    <span class="keyword">|</span> P2TCcon <span class="keyword">(</span>d2c<span class="keyword">,</span> p2tcs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
      <span class="keyword">|</span> S2Edatcontyp <span class="keyword">(</span>d2c1<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">if</span> <span class="keyword">(</span>d2c &lt;&gt; d2c1<span class="keyword">)</span> <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9012"><span class="dyncstuse">trans3_env_hypo_add_prop</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#6912"><span class="dyncstuse">s2exp_bool</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [S2Edatcontyp]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">@(</span>s2vpss_d2c<span class="keyword">,</span> s2e_d2c<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans2_2esats.html#4572"><span class="dyncstuse">$TR2<span class="keyword">.</span>p1at_con_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span>s2es_fun_arg<span class="keyword">,</span> s2e_fun_res<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
            <span class="keyword">case+</span> s2e_d2c<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
            <span class="keyword">|</span> S2Efun <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> s2es<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">@(</span>s2es<span class="keyword">,</span> s2e<span class="keyword">)</span>
            <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
                prerr ": tran3_env_hypo_add_p2atcst: P2TCcon"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
                <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><span class="keyword">@(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9393"><span class="stacstuse">s2explst</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
              <span class="keyword">end</span> <span class="comment">// end of [_]
</span>          <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">@(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9393"><span class="stacstuse">s2explst</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9276"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span></span>
<span class="comment">(*
          val () = begin
            print "trans3_env_hypo_add_p2atcst: s2vpss_d2c = "; print_s2qualst s2vpss_d2c; print_newline ()
          end // end of [val]
          val () = begin
            print "trans3_env_hypo_add_p2atcst: s2es_arg_res = "; print_s2explst s2es_fun_arg; print_newline ()
          end // end of [val]
          val () = begin
            print "trans3_env_hypo_add_p2atcst: s2e_fun_res = "; print_s2exp s2e_fun_res; print_newline ()
          end // end of [val]
*)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss_d2c<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
            <span class="keyword">fun</span> aux <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2vpss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10049"><span class="stacstuse">s2qualst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
              <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
              <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> s2vps<span class="keyword">.</span>0<span class="keyword">;</span>
                  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span><span class="keyword">;</span>
                  aux <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss<span class="keyword">)</span>
                <span class="keyword">end</span>
              <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">}</span> <span class="comment">// end of [where]
</span>          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#4589"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_hypo_equal_solve</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_fun_res<span class="keyword">,</span> s2e0<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9444"><span class="dyncstuse">trans3_env_hypo_add_p2atcstlst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcs<span class="keyword">,</span> s2es_fun_arg<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [P2TCcon]
</span>    <span class="keyword">|</span> P2TCempty _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">|</span> P2TCfloat _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">|</span> P2TCint i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7807"><span class="dyncstuse">un_s2exp_int_int_t0ype</span></a> s2e0 <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_arg <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#4589"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_hypo_equal_solve</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_arg<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30570"><span class="dyncstuse">s2exp_intinf</span></a> i<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P2TCint]
</span>    <span class="keyword">|</span> P2TCintc xs <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7807"><span class="dyncstuse">un_s2exp_int_int_t0ype</span></a> s2e0 <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_arg <span class="keyword">=&gt;</span> aux <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#1717"><span class="dyncstuse">intinflst_of_intinfset</span></a> xs<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
          <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1851"><span class="stacstuse">intinf_t</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
            <span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
                <span class="keyword">val</span> s2p <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#10654"><span class="dyncstuse">s2exp_neq_int_int_bool</span></a> <span class="keyword">(</span>s2e_arg<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30570"><span class="dyncstuse">s2exp_intinf</span></a> x<span class="keyword">)</span>
              <span class="keyword">in</span>
                <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9012"><span class="dyncstuse">trans3_env_hypo_add_prop</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2p<span class="keyword">)</span><span class="keyword">;</span> aux xs
              <span class="keyword">end</span>
            <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">}</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P2TCintc]
</span>    <span class="keyword">|</span> P2TCrec <span class="keyword">(</span>_<span class="keyword">,</span> lp2tcs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> S2Etyrec <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> ls2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9535"><span class="dyncstuse">trans3_env_hypo_add_labp2atcstlst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> lp2tcs<span class="keyword">,</span> ls2es<span class="keyword">)</span>
          <span class="keyword">end</span>
        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P2TCrec]
</span>    <span class="keyword">|</span> P2TCstring _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_p2atcst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9444"><span class="dyncstimp">trans3_env_hypo_add_p2atcstlst</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcs<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> p2tcs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#2347"><span class="stacstuse">p2atcstlst</span></a></span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9393"><span class="stacstuse">s2explst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p2tcs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>p2tc<span class="keyword">,</span> p2tcs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2es <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9364"><span class="dyncstuse">trans3_env_hypo_add_p2atcst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tc<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
          aux <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcs<span class="keyword">,</span> s2es<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> 1
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s2es <span class="keyword">of</span> list_cons _ <span class="keyword">=&gt;</span> 1 <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> 0
      <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> err <span class="keyword">=</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcs<span class="keyword">,</span> s2es<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_loc_interror loc0<span class="keyword">;</span>
    prerr ": trans3_env_hypo_add_p2atcstlst"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_p2atcstlst]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9535"><span class="dyncstimp">trans3_env_hypo_add_labp2atcstlst</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> lp2tcs<span class="keyword">,</span> ls2es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> lp2tcs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#2177"><span class="stacstuse">labp2atcstlst</span></a></span><span class="keyword">,</span> ls2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8353"><span class="stacstuse">labs2explst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> lp2tcs <span class="keyword">of</span>
    <span class="keyword">|</span> LABP2ATCSTLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> p2tc<span class="keyword">,</span> lp2tcs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> ls2es <span class="keyword">of</span>
      <span class="keyword">|</span> LABS2EXPLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> s2e<span class="keyword">,</span> ls2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9364"><span class="dyncstuse">trans3_env_hypo_add_p2atcst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tc<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
          aux <span class="keyword">(</span>loc0<span class="keyword">,</span> lp2tcs<span class="keyword">,</span> ls2es<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [LABS2EXPLSTcons]
</span>      <span class="keyword">|</span> LABS2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> 1
      <span class="keyword">end</span> <span class="comment">// end of [LABP2ATCSTLSTcons]
</span>    <span class="keyword">|</span> LABP2ATCSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> ls2es <span class="keyword">of</span> LABS2EXPLSTcons _ <span class="keyword">=&gt;</span> 1 <span class="keyword">|</span> LABS2EXPLSTnil _ <span class="keyword">=&gt;</span> 0
      <span class="keyword">end</span> <span class="comment">// end of [LABP2ATCSTLSTnil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> err <span class="keyword">=</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> lp2tcs<span class="keyword">,</span> ls2es<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_loc_interror loc0<span class="keyword">;</span>
    prerr ": trans3_env_hypo_add_labp2atcstlst"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_labp2atcstlst]
</span>
<span class="comment">//
</span>
<span class="comment">// for adding sequentiality assumption
</span><span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9638"><span class="dyncstimp">trans3_env_hypo_add_p2atcstlstlst</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcss<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>p2tcss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#2526"><span class="stacstuse">p2atcstlstlst</span></a></span><span class="keyword">,</span> s3iss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2631"><span class="stacstuse">s3itemlst</span></a><span class="keyword">)</span></span><span class="keyword">)</span>
    <span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#2659"><span class="stacstuse">s3itemlstlst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p2tcss <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>p2tcs<span class="keyword">,</span> p2tcss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9444"><span class="dyncstuse">trans3_env_hypo_add_p2atcstlst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcs<span class="keyword">,</span> s2es<span class="keyword">)</span>
        <span class="keyword">val</span> s3is <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15630"><span class="dyncstuse">trans3_env_pop_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">val</span> s3is <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#4588"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_reverse_list</span></a> s3is
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>p2tcss<span class="keyword">,</span> list_vt_cons <span class="keyword">(</span>s3is<span class="keyword">,</span> s3iss<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#4588"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_reverse_list</span></a> <span class="keyword">(</span>s3iss<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  trans3_env_hypo_add_disj <span class="keyword">(</span>aux <span class="keyword">(</span>p2tcss<span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [trans3_env_hypo_add_p2atcstlstlst]
</span>
<span class="comment">//
</span>
<span class="comment">// for checking termination metric being decreasing
</span><span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9758"><span class="dyncstimp">trans3_env_add_metric_dec</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> met<span class="keyword">,</span> met_bound<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="keyword">val</span> c3t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5317"><span class="dyncstuse">c3str_metric_dec</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> met<span class="keyword">,</span> met_bound<span class="keyword">)</span> <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8566"><span class="dyncstuse">trans3_env_add_cstr</span></a> c3t
  <span class="keyword">end</span>
<span class="comment">// end of [trans3_env_add_metric]
</span>
<span class="comment">// for checking pattern matching exhaustiveness
</span><span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9864"><span class="dyncstimp">trans3_env_add_p2atcstlstlst_false</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> casknd<span class="keyword">,</span> p2tcss<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=</span> aux p2tcss <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>p2tcss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#2526"><span class="stacstuse">p2atcstlstlst</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> p2tcss <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>p2tcs<span class="keyword">,</span> p2tcss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9444"><span class="dyncstuse">trans3_env_hypo_add_p2atcstlst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> p2tcs<span class="keyword">,</span> s2es<span class="keyword">)</span>
        <span class="keyword">val</span> c3t <span class="keyword">=</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5406"><span class="dyncstuse">c3str_pattern_match_exhaustiveness</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> casknd<span class="keyword">,</span> p2tcs<span class="keyword">)</span>
        <span class="keyword">end</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8566"><span class="dyncstuse">trans3_env_add_cstr</span></a> <span class="keyword">(</span>c3t<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
      <span class="keyword">in</span>
        aux p2tcss
      <span class="keyword">end</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">}</span> <span class="comment">// end of [trans3_env_add_p2atcstlstlst_false]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15881"><span class="dyncstimp">trans3_env_initialize</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6366"><span class="dyncstuse">the_s2varbindmap_initialize</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2069"><span class="dyncstuse">Bool_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2097"><span class="dyncstuse">Bool_bool_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2158"><span class="dyncstuse">Char_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2186"><span class="dyncstuse">Char_char_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2313"><span class="dyncstuse">Int_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2340"><span class="dyncstuse">Int_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2822"><span class="dyncstuse">Uint_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2850"><span class="dyncstuse">Uint_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2371"><span class="dyncstuse">Lint_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2399"><span class="dyncstuse">Lint_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2882"><span class="dyncstuse">Ulint_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2911"><span class="dyncstuse">Ulint_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2570"><span class="dyncstuse">Size_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2598"><span class="dyncstuse">Size_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2630"><span class="dyncstuse">Ssize_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2659"><span class="dyncstuse">Ssize_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2477"><span class="dyncstuse">Ptr_type</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2503"><span class="dyncstuse">Ptr_addr_type</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2692"><span class="dyncstuse">Strbuf_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2722"><span class="dyncstuse">Strbuf_int_int_t0ype</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#14862"><span class="dyncstuse">s2cst_sup_add</span></a> <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> s2c0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2760"><span class="dyncstuse">String_type</span></a><span class="keyword">)</span>
    <span class="keyword">val</span> s2c1 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#1678"><span class="dyncstuse">s2cstref_cst_get</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#2789"><span class="dyncstuse">String_int_type</span></a><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9396"><span class="dyncstuse">clo_viewt0ype_viewt0ype_assume</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9440"><span class="dyncstuse">cloptr_viewt0ype_viewtype_assume</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9486"><span class="dyncstuse">cloref_t0ype_type_assume</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9546"><span class="dyncstuse">crypt_viewt0ype_viewt0ype_assume</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#10854"><span class="dyncstuse">sizeof_viewt0ype_int_assume</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span><span class="keyword">}</span> <span class="comment">// end of [trans3_env_initilize]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_trans3_env.sats] *)</span>
</pre>
</body>
</html>
