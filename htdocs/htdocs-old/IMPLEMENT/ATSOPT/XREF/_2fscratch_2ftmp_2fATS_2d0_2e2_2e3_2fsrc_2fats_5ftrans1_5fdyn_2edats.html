<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: August 2007
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="comment">(* The first translation mainly resolves the issue of operator fixity *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Deb <span class="keyword">=</span> "ats_debug.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Eff <span class="keyword">=</span> "ats_effect.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Fil <span class="keyword">=</span> "ats_filename.sats"</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="1751"><span class="stacstdec">fil_t <span class="keyword">=</span> $Fil<span class="keyword">.</span>filename_t</span></a></span>
<span class="keyword">staload</span> <span class="staexp">Fix <span class="keyword">=</span> "ats_fixity.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Glo <span class="keyword">=</span> "ats_global.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Loc <span class="keyword">=</span> "ats_location.sats"</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="1881"><span class="stacstdec">loc_t <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_t</span></a></span>
<span class="keyword">staload</span> <span class="staexp">Lst <span class="keyword">=</span> "ats_list.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Par <span class="keyword">=</span> "ats_parser.sats"</span>
<span class="keyword">staload</span> <span class="staexp">PM <span class="keyword">=</span> "ats_posmark.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Sym <span class="keyword">=</span> "ats_symbol.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Syn <span class="keyword">=</span> "ats_syntax.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_syntax.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_staexp1.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp1.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp1_syndef.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_trans1_env.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_e1xp_eval.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_trans1.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">THISFILENAME "ats_trans1_dyn.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">nil list_nil</span>
<span class="keyword">#define</span> <span class="neuexp">cons list_cons</span>
<span class="keyword">#define</span> <span class="neuexp">:: list_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> $Sym<span class="keyword">.</span>eq_symbol_symbol</span>
<span class="keyword">macdef</span> <span class="neuexp">prerr_symbol <span class="keyword">=</span> $Sym<span class="keyword">.</span>prerr_symbol</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">CLOPTR 1</span><span class="keyword">;</span> <span class="keyword">#define</span> <span class="neuexp">CLOREF ~1</span>
<span class="keyword">macdef</span> <span class="neuexp">FUNCLOcloptr <span class="keyword">=</span> $Syn<span class="keyword">.</span>FUNCLOclo CLOPTR</span>
<span class="keyword">macdef</span> <span class="neuexp">FUNCLOcloref <span class="keyword">=</span> $Syn<span class="keyword">.</span>FUNCLOclo CLOREF</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> prerr_loc_error1 <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">(</span>$Loc<span class="keyword">.</span>prerr_location loc<span class="keyword">;</span> prerr ": error(1)"<span class="keyword">)</span>
<span class="comment">// end of [prerr_loc_error1]
</span>
<span class="keyword">fn</span> prerr_loc_interror <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  $Loc<span class="keyword">.</span>prerr_location loc<span class="keyword">;</span> prerr ": INTERNAL ERROR (ats_trans1_dyn)"
<span class="keyword">end</span> <span class="comment">// end of [prerr_loc_interror]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="3022"><span class="stacstdec">efc <span class="keyword">=</span> $Eff<span class="keyword">.</span>effcst</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="3048"><span class="stacstdec">efcopt <span class="keyword">=</span> Option efc</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> dcstextdef_tr
  <span class="keyword">(</span>ext<span class="keyword">:</span> <span class="staexp">Stropt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">dcstextdef</span> <span class="keyword">=</span>
  <span class="keyword">if</span> stropt_is_none ext <span class="keyword">then</span> DCSTEXTDEFnone <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">val</span> ext <span class="keyword">=</span> stropt_unsome ext
    <span class="keyword">var</span> ismac <span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> false
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
      <span class="keyword">if</span> string_isnot_at_end <span class="keyword">(</span>ext<span class="keyword">,</span> 0<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> c <span class="keyword">=</span> ext[<span class="prfexp">0</span><span class="keyword">]</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> <span class="keyword">(</span>c <span class="keyword">=</span> '#'<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>ismac := true<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>    <span class="comment">// end of [val]
</span>  <span class="keyword">in</span>
    <span class="keyword">if</span> ismac <span class="keyword">then</span> DCSTEXTDEFsome_mac ext <span class="keyword">else</span> DCSTEXTDEFsome_fun ext
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="comment">// end of [dcstextdef_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// translation of dynamic constants
</span>
<span class="keyword">local</span> <span class="comment">// defining [d0cstdec_tr]
</span>
<span class="keyword">fun</span> aux1 <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">p0arglst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s1explst</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> x<span class="keyword">.</span>p0arg_ann <span class="keyword">of</span>
    <span class="keyword">|</span> Some s0e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">let</span> <span class="keyword">val</span> s1e <span class="keyword">=</span> s0exp_tr s0e <span class="keyword">in</span> s1e :: aux1 xs <span class="keyword">end</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error1 <span class="keyword">(</span>x<span class="keyword">.</span>p0arg_loc<span class="keyword">)</span><span class="keyword">;</span>
        prerr ": unascribed variable: ["<span class="keyword">;</span> prerr_symbol x<span class="keyword">.</span>p0arg_sym<span class="keyword">;</span> prerr "]."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [None]
</span>    <span class="keyword">end</span> <span class="comment">(* end of [cons] *)</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux1]
</span>
<span class="keyword">fun</span> aux2
  <span class="keyword">(</span>fc<span class="keyword">:</span> <span class="staexp">funclo</span><span class="keyword">,</span> lin<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> prf<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> oefc<span class="keyword">:</span> <span class="staexp">efcopt</span><span class="keyword">,</span>
   fst<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> lst<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">d0arglst</span><span class="keyword">,</span> s1e_res<span class="keyword">:</span> <span class="staexp">s1exp</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">s1exp</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> x :: xs <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> x<span class="keyword">.</span>d0arg_node <span class="keyword">of</span>
    <span class="keyword">|</span> D0ARGdyn ys <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc_x <span class="keyword">=</span> x<span class="keyword">.</span>d0arg_loc
        <span class="keyword">val</span> s1e_arg<span class="keyword">:</span> <span class="staexp">s1exp</span> <span class="keyword">=</span> s1exp_list <span class="keyword">(</span>loc_x<span class="keyword">,</span> aux1 ys<span class="keyword">)</span>
        <span class="keyword">val</span> s1e_res<span class="keyword">:</span> <span class="staexp">s1exp</span> <span class="keyword">=</span> aux2 <span class="keyword">(</span>fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">,</span> fst+1<span class="keyword">,</span> lst<span class="keyword">,</span> xs<span class="keyword">,</span> s1e_res<span class="keyword">)</span>
        <span class="keyword">val</span> loc_res <span class="keyword">=</span> s1e_res<span class="keyword">.</span>s1exp_loc
        <span class="keyword">val</span> loc <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc_x<span class="keyword">,</span> loc_res<span class="keyword">)</span>
        <span class="keyword">val</span> fc <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> fst <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> FUNCLOcloptr <span class="keyword">else</span> fc<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">funclo</span>
        <span class="keyword">val</span> imp <span class="keyword">=</span> <span class="keyword">(</span>
          <span class="keyword">if</span> lst <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
            s1exp_imp <span class="keyword">(</span>loc_res<span class="keyword">,</span> fc<span class="keyword">,</span> 0<span class="keyword">,</span> 0<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
            s1exp_imp <span class="keyword">(</span>loc_res<span class="keyword">,</span> fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [if]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1exp</span>
      <span class="keyword">in</span>
        lst := lst + 1<span class="keyword">;</span> s1exp_app <span class="keyword">(</span>loc<span class="keyword">,</span> imp<span class="keyword">,</span> loc<span class="keyword">,</span> <span class="keyword">'[</span>s1e_arg<span class="keyword">,</span> s1e_res<span class="keyword">]</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D0ARGdyn]
</span>    <span class="keyword">|</span> D0ARGdyn2 <span class="keyword">(</span>ys1<span class="keyword">,</span> ys2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc_x <span class="keyword">=</span> x<span class="keyword">.</span>d0arg_loc
        <span class="keyword">val</span> s1es_arg <span class="keyword">=</span> s1exp_list2 <span class="keyword">(</span>loc_x<span class="keyword">,</span> aux1 ys1<span class="keyword">,</span> aux1 ys2<span class="keyword">)</span>
        <span class="keyword">val</span> s1e_res <span class="keyword">=</span> aux2 <span class="keyword">(</span>fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">,</span> fst+1<span class="keyword">,</span> lst<span class="keyword">,</span> xs<span class="keyword">,</span> s1e_res<span class="keyword">)</span>
        <span class="keyword">val</span> loc_res <span class="keyword">=</span> s1e_res<span class="keyword">.</span>s1exp_loc
        <span class="keyword">val</span> loc <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc_x<span class="keyword">,</span> loc_res<span class="keyword">)</span>
        <span class="keyword">val</span> fc <span class="keyword">=</span> <span class="keyword">if</span> fst <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> FUNCLOcloptr <span class="keyword">else</span> fc
        <span class="keyword">val</span> imp<span class="keyword">:</span> <span class="staexp">s1exp</span> <span class="keyword">=</span>
          <span class="keyword">if</span> lst <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
            s1exp_imp <span class="keyword">(</span>loc_res<span class="keyword">,</span> fc<span class="keyword">,</span> 0<span class="keyword">,</span> 0<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
            s1exp_imp <span class="keyword">(</span>loc_res<span class="keyword">,</span> fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [if]
</span>      <span class="keyword">in</span>
        lst := lst + 1<span class="keyword">;</span> s1exp_app <span class="keyword">(</span>loc<span class="keyword">,</span> imp<span class="keyword">,</span> loc<span class="keyword">,</span> <span class="keyword">'[</span>s1es_arg<span class="keyword">,</span> s1e_res<span class="keyword">]</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D0ARGdyn2]
</span>    <span class="keyword">|</span> D0ARGsta s0qs <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc_x <span class="keyword">=</span> x<span class="keyword">.</span>d0arg_loc
        <span class="keyword">val</span> s1qs <span class="keyword">=</span> s0qualst_tr s0qs
        <span class="keyword">val</span> s1e_res <span class="keyword">=</span> aux2 <span class="keyword">(</span>fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">,</span> fst<span class="keyword">,</span> lst<span class="keyword">,</span> xs<span class="keyword">,</span> s1e_res<span class="keyword">)</span>
        <span class="keyword">val</span> loc_res <span class="keyword">=</span> s1e_res<span class="keyword">.</span>s1exp_loc
        <span class="keyword">val</span> loc <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc_x<span class="keyword">,</span> loc_res<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> lst <span class="keyword">=</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
          prerr_loc_error1 <span class="keyword">(</span>loc_res<span class="keyword">)</span><span class="keyword">;</span>
          prerr ": illegal use of effect annotation"<span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        s1exp_uni <span class="keyword">(</span>loc<span class="keyword">,</span> s1qs<span class="keyword">,</span> s1e_res<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">(* end of [D0ARGsta] *)</span>
    <span class="keyword">end</span> <span class="comment">(* end of [::] *)</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s1e_res
<span class="keyword">end</span> <span class="comment">// end of [aux2]
</span>
<span class="keyword">fn</span> aux3 <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> isfun<span class="keyword">:</span> <span class="staexp">bool</span>
  <span class="keyword">,</span> isprf<span class="keyword">:</span> <span class="staexp">bool</span>
  <span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">d0arglst</span>
  <span class="keyword">,</span> otags<span class="keyword">:</span> <span class="staexp">Option e0fftaglst</span>
  <span class="keyword">,</span> s1e_res<span class="keyword">:</span> <span class="staexp">s1exp</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> fc<span class="keyword">:</span> <span class="staexp">funclo</span> <span class="keyword">=</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">var</span> lin<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0 <span class="keyword">and</span> prf<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> isprf <span class="keyword">then</span> 1 <span class="keyword">else</span> 0<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span>
  <span class="keyword">var</span> oefc<span class="keyword">:</span> <span class="staexp">efcopt</span> <span class="keyword">=</span> None <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> otags <span class="keyword">of</span>
    <span class="keyword">|</span> Some tags <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span>ofc1<span class="keyword">,</span> lin1<span class="keyword">,</span> prf1<span class="keyword">,</span> efc1<span class="keyword">)</span> <span class="keyword">=</span> $Eff<span class="keyword">.</span>e0fftaglst_tr <span class="keyword">(</span>tags<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> ofc1 <span class="keyword">of</span>
          <span class="keyword">|</span> Some fc1 <span class="keyword">=&gt;</span> fc := fc1 <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        lin := lin1<span class="keyword">;</span> prf := prf + prf1<span class="keyword">;</span> oefc := Some efc1
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> fc <span class="keyword">of</span>
    <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOclo knd <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> knd &lt;&gt; CLOREF <span class="keyword">then</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> knd <span class="keyword">=</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
            prerr_loc_error1 <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
            prerr ": a closure at the toplevel"
          <span class="keyword">end</span> <span class="comment">// end of [val]
</span>          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> knd <span class="keyword">=</span> 1 <span class="keyword">then</span> <span class="keyword">begin</span>
            prerr_loc_error1 <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
            prerr ": a closure pointer is not allowed at the toplevel"
          <span class="keyword">end</span> <span class="comment">// end of [val]
</span>          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">in</span>
          <span class="comment">// nothing
</span>        <span class="keyword">end</span> <span class="comment">// end of [if]
</span>      <span class="keyword">end</span> <span class="comment">// end of [FUNCLOclo]
</span>    <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [val]
</span>  <span class="keyword">var</span> lst<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
<span class="keyword">in</span>
  aux2 <span class="keyword">(</span>fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">,</span> 0<span class="keyword">,</span> lst<span class="keyword">,</span> xs<span class="keyword">,</span> s1e_res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux3]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">fn</span> d0cstdec_tr <span class="keyword">(</span>
    isfun<span class="keyword">:</span> <span class="staexp">bool</span>
  <span class="keyword">,</span> isprf<span class="keyword">:</span> <span class="staexp">bool</span>
  <span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">d0cstdec</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1cstdec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc0 <span class="keyword">=</span> d<span class="keyword">.</span>d0cstdec_loc
  <span class="keyword">val</span> s1e_res <span class="keyword">=</span> s0exp_tr d<span class="keyword">.</span>d0cstdec_res
  <span class="keyword">val</span> arg <span class="keyword">=</span> d<span class="keyword">.</span>d0cstdec_arg <span class="keyword">and</span> eff <span class="keyword">=</span> d<span class="keyword">.</span>d0cstdec_eff
  <span class="keyword">val</span> s1e <span class="keyword">=</span> aux3 <span class="keyword">(</span>loc0<span class="keyword">,</span> isfun<span class="keyword">,</span> isprf<span class="keyword">,</span> arg<span class="keyword">,</span> eff<span class="keyword">,</span> s1e_res<span class="keyword">)</span>
  <span class="keyword">val</span> extdef <span class="keyword">=</span> dcstextdef_tr <span class="keyword">(</span>d<span class="keyword">.</span>d0cstdec_extdef<span class="keyword">)</span>
<span class="keyword">in</span>
  d1cstdec_make <span class="keyword">(</span>
    loc0<span class="keyword">,</span> d<span class="keyword">.</span>d0cstdec_fil<span class="keyword">,</span> d<span class="keyword">.</span>d0cstdec_sym<span class="keyword">,</span> s1e<span class="keyword">,</span> extdef
  <span class="keyword">)</span> <span class="comment">// end of [d1cstdec_make]
</span><span class="keyword">end</span> <span class="comment">// end of [d0cstdec_tr]
</span>
<span class="keyword">fun</span> d0cstdeclst_tr
  <span class="keyword">(</span>isfun<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> isprf<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> ds<span class="keyword">:</span> <span class="staexp">d0cstdeclst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1cstdeclst</span> <span class="keyword">=</span> <span class="keyword">case+</span> ds <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d<span class="keyword">,</span> ds<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      cons <span class="keyword">(</span>d0cstdec_tr <span class="keyword">(</span>isfun<span class="keyword">,</span> isprf<span class="keyword">,</span> d<span class="keyword">)</span><span class="keyword">,</span> d0cstdeclst_tr <span class="keyword">(</span>isfun<span class="keyword">,</span> isprf<span class="keyword">,</span> ds<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [d0cstdeclst_tr]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// translation of dynamic patterns
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="8540"><span class="stacstdec">p1atitm <span class="keyword">=</span> $Fix<span class="keyword">.</span>item p1at</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="8573"><span class="stacstdec">p1atitmlst <span class="keyword">=</span> List p1atitm</span></a></span>

<span class="keyword">val</span> p1atitm_app <span class="keyword">:</span> <span class="staexp">p1atitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span><span class="keyword">fn</span> f <span class="keyword">(</span>
  p1t1<span class="keyword">:</span> <span class="staexp">p1at</span>
<span class="keyword">,</span> p1t2<span class="keyword">:</span> <span class="staexp">p1at</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">p1atitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>p1t1<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> p1t2<span class="keyword">.</span>p1at_loc<span class="keyword">)</span>
  <span class="keyword">val</span> p1t_app <span class="keyword">=</span> <span class="keyword">case+</span> p1t2<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
    <span class="keyword">|</span> P1Tlist <span class="keyword">(</span>npf<span class="keyword">,</span> p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        p1at_app_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> p1t1<span class="keyword">,</span> p1t2<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> npf<span class="keyword">,</span> p1ts<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P1Tlist]
</span>    <span class="keyword">|</span> P1Tsvararg s1a <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p1t1<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
        <span class="keyword">|</span> P1Tapp_sta <span class="keyword">(</span>p1t1<span class="keyword">,</span> s1as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            p1at_app_sta <span class="keyword">(</span>loc<span class="keyword">,</span> p1t1<span class="keyword">,</span> $Lst<span class="keyword">.</span>list_extend <span class="keyword">(</span>s1as<span class="keyword">,</span> s1a<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [P1Tapp_sta]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            p1at_app_sta <span class="keyword">(</span>loc<span class="keyword">,</span> p1t1<span class="keyword">,</span> cons <span class="keyword">(</span>s1a<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [P1Tsvararg]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        p1at_app_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> p1t1<span class="keyword">,</span> p1t2<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> 0<span class="keyword">,</span> cons <span class="keyword">(</span>p1t2<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="comment">(*
    val () = begin
      print "p1atitm_app: f: p1t_app = "; print p1t_app; print_newline ()
    end // end of [val]
*)</span>
  <span class="keyword">in</span>
    $Fix<span class="keyword">.</span>ITEMatm p1t_app
  <span class="keyword">end</span> <span class="comment">// end of [f]
</span><span class="comment">//
</span><span class="keyword">in</span>
  $Fix<span class="keyword">.</span>item_app f
<span class="keyword">end</span> <span class="comment">// end of [app_p1at_item]
</span>
<span class="keyword">fun</span> p1at_make_opr <span class="keyword">(</span>p1t<span class="keyword">:</span> <span class="staexp">p1at</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">$Fix<span class="keyword">.</span>fxty_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1atitm</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  $Fix<span class="keyword">.</span>oper_make <span class="staexp"><span class="keyword">{</span>p1at<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="keyword">lam</span> x <span class="keyword">=&gt;</span> x<span class="keyword">.</span>p1at_loc
  <span class="keyword">,</span> <span class="keyword">lam</span> <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> p1at_app_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> 0<span class="keyword">,</span> xs<span class="keyword">)</span>
  <span class="keyword">,</span> p1t
  <span class="keyword">,</span> f
  <span class="keyword">)</span> <span class="comment">// end of [oper_make]
</span><span class="keyword">end</span> <span class="comment">// end of [p1at_make_opr]
</span>
<span class="keyword">val</span> p1atitm_backslash <span class="keyword">:</span> <span class="staexp">p1atitm</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  $Fix<span class="keyword">.</span>oper_make_backslash <span class="staexp"><span class="keyword">{</span>p1at<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="keyword">lam</span> x <span class="keyword">=&gt;</span> x<span class="keyword">.</span>p1at_loc<span class="keyword">,</span>
    <span class="keyword">lam</span> <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> p1at_app_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> 0<span class="keyword">,</span> xs<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">// end of [oper_make_backslash]
</span><span class="keyword">end</span> <span class="comment">// end of [p1atitm_backslash]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> s0vararg_tr <span class="keyword">(</span>s0a<span class="keyword">:</span> <span class="staexp">s0vararg</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s1vararg</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s0a <span class="keyword">of</span>
  <span class="keyword">|</span> S0VARARGseq <span class="keyword">(</span>s0as<span class="keyword">)</span> <span class="keyword">=&gt;</span> S1VARARGseq <span class="keyword">(</span>s0arglst_tr s0as<span class="keyword">)</span>
  <span class="keyword">|</span> S0VARARGone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> S1VARARGone <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> S0VARARGall <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> S1VARARGall <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [s0vararg_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> p0at_tr_errmsg_opr <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1at</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  prerr_loc_error1 loc<span class="keyword">;</span>
  prerr ": the operator needs to be applied"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
  $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>p1at<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [p0at_tr_errmsg_opr]
</span>
<span class="keyword">implement</span>
p0at_tr p0t0 <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span><span class="keyword">fun</span> aux_item <span class="keyword">(</span>p0t0<span class="keyword">:</span> <span class="staexp">p0at</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1atitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> p0t0<span class="keyword">.</span>p0at_loc <span class="keyword">in</span> <span class="keyword">case+</span> p0t0<span class="keyword">.</span>p0at_node <span class="keyword">of</span>
    <span class="keyword">|</span> P0Tann <span class="keyword">(</span>p0t<span class="keyword">,</span> s0e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p1t <span class="keyword">=</span> p0at_tr p0t <span class="keyword">and</span> s1e <span class="keyword">=</span> s0exp_tr s0e
        <span class="keyword">val</span> p1t_ann <span class="keyword">=</span> p1at_ann <span class="keyword">(</span>loc<span class="keyword">,</span> p1t<span class="keyword">,</span> s1e<span class="keyword">)</span>
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm p1t_ann
      <span class="keyword">end</span> <span class="comment">// end of [P0Tann]
</span>    <span class="keyword">|</span> P0Tapp _ <span class="keyword">=&gt;</span> <span class="keyword">let</span> 
        <span class="keyword">val</span> p1t <span class="keyword">=</span> $Fix<span class="keyword">.</span>fixity_resolve
          <span class="keyword">(</span>loc<span class="keyword">,</span> p1atitm_app<span class="keyword">,</span> aux_itemlst p0t0<span class="keyword">)</span>
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm p1t
      <span class="keyword">end</span> <span class="comment">// end of [P0Tapp]
</span>    <span class="keyword">|</span> P0Tas <span class="keyword">(</span>id<span class="keyword">,</span> p0t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_as <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">,</span> p0at_tr p0t<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P0Tas]
</span>    <span class="keyword">|</span> P0Tchar c<span class="comment">(*char*)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_char <span class="keyword">(</span>loc<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">|</span> P0Texist <span class="keyword">(</span>s0as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s1as <span class="keyword">=</span> s0arglst_tr s0as
        <span class="keyword">fn</span> f <span class="keyword">(</span>
          body<span class="keyword">:</span> <span class="staexp">p1at</span>
        <span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">p1atitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
          <span class="keyword">val</span> loc <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc<span class="keyword">,</span> body<span class="keyword">.</span>p1at_loc<span class="keyword">)</span>
        <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_exist <span class="keyword">(</span>loc<span class="keyword">,</span> s1as<span class="keyword">,</span> body<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [f]
</span>      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>exist_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P0Texist]
</span>    <span class="keyword">|</span> P0Tfloat f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_float <span class="keyword">(</span>loc<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">|</span> P0Tfree <span class="keyword">(</span>p0t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_free <span class="keyword">(</span>loc<span class="keyword">,</span> p0at_tr p0t<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P0Tfree]
</span>    <span class="keyword">|</span> P0Tide id <span class="keyword">when</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_UNDERSCORE <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_anys loc<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tide id <span class="keyword">when</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_BACKSLASH <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        p1atitm_backslash
      <span class="keyword">end</span> <span class="comment">// end of [P0Tide when ...]
</span>    <span class="keyword">|</span> P0Tide id <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p1t <span class="keyword">=</span> p1at_ide <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">case+</span> the_fxtyenv_find id <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt f <span class="keyword">=&gt;</span> p1at_make_opr <span class="keyword">(</span>p1t<span class="keyword">,</span> f<span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm p1t
      <span class="keyword">end</span> <span class="comment">// end of [P0Tide]
</span>    <span class="keyword">|</span> P0Tint <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_int <span class="keyword">(</span>loc<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tlist <span class="keyword">(</span>p0ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p1ts <span class="keyword">=</span> p0atlst_tr p0ts
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_list <span class="keyword">(</span>loc<span class="keyword">,</span> p1ts<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tlist2 <span class="keyword">(</span>p0ts1<span class="keyword">,</span> p0ts2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s1es1 <span class="keyword">=</span> p0atlst_tr p0ts1 <span class="keyword">and</span> s1es2 <span class="keyword">=</span> p0atlst_tr p0ts2
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_list2 <span class="keyword">(</span>loc<span class="keyword">,</span> s1es1<span class="keyword">,</span> s1es2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tlst <span class="keyword">(</span>p0ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p1ts <span class="keyword">=</span> p0atlst_tr p0ts
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_lst <span class="keyword">(</span>loc<span class="keyword">,</span> p1ts<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Topide id <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_ide <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">|</span> P0Tqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_qid <span class="keyword">(</span>loc<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">|</span> P0Trec <span class="keyword">(</span>recknd<span class="keyword">,</span> lp0ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_rec <span class="keyword">(</span>loc<span class="keyword">,</span> recknd<span class="keyword">,</span> labp0atlst_tr lp0ts<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tref <span class="keyword">(</span>id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_ref <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Trefas <span class="keyword">(</span>id<span class="keyword">,</span> p0t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_refas <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">,</span> p0at_tr p0t<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tsvararg s0a <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_svararg <span class="keyword">(</span>loc<span class="keyword">,</span> s0vararg_tr s0a<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Tstring str <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_string <span class="keyword">(</span>loc<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Ttup <span class="keyword">(</span>tupknd<span class="keyword">,</span> p0ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p1ts <span class="keyword">=</span> p0atlst_tr p0ts
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_tup <span class="keyword">(</span>loc<span class="keyword">,</span> tupknd<span class="keyword">,</span> p1ts<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> P0Ttup2 <span class="keyword">(</span>tupknd<span class="keyword">,</span> p0ts1<span class="keyword">,</span> p0ts2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p1ts1 <span class="keyword">=</span> p0atlst_tr p0ts1
        <span class="keyword">val</span> p1ts2 <span class="keyword">=</span> p0atlst_tr p0ts2
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>p1at_tup2 <span class="keyword">(</span>loc<span class="keyword">,</span> tupknd<span class="keyword">,</span> p1ts1<span class="keyword">,</span> p1ts2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P0Ttup2]
</span><span class="comment">(*
    | _ =&gt; begin
        prerr_loc_interror p0t0.p0at_loc;
        prerr ": p0at_tr: not available yet"; prerr_newline ();
        $Err.abort {p1atitm} ()
      end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux_item]
</span><span class="comment">//
</span><span class="keyword">and</span> aux_itemlst <span class="keyword">(</span>p0t0<span class="keyword">:</span> <span class="staexp">p0at</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1atitmlst</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>res<span class="keyword">:</span> <span class="staexp">p1atitmlst</span><span class="keyword">,</span> p0t0<span class="keyword">:</span> <span class="staexp">p0at</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1atitmlst</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> p0t0<span class="keyword">.</span>p0at_node <span class="keyword">of</span>
    <span class="keyword">|</span> P0Tapp <span class="keyword">(</span>p0t1<span class="keyword">,</span> p0t2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> res <span class="keyword">=</span> aux_item p0t2 :: res <span class="keyword">in</span> aux <span class="keyword">(</span>res<span class="keyword">,</span> p0t1<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [P0Tapp]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> aux_item p0t0 :: res
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> p0t0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux_itemlst]
</span><span class="comment">//
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> aux_item p0t0 <span class="keyword">of</span>
  <span class="keyword">|</span> $Fix<span class="keyword">.</span>ITEMatm p1t <span class="keyword">=&gt;</span> p1t
  <span class="keyword">|</span> $Fix<span class="keyword">.</span>ITEMopr _ <span class="keyword">=&gt;</span> p0at_tr_errmsg_opr p0t0<span class="keyword">.</span>p0at_loc
<span class="keyword">end</span> <span class="comment">// end of [p0at_tr]
</span>
<span class="keyword">implement</span>
p0atlst_tr <span class="keyword">(</span>p0ts<span class="keyword">)</span> <span class="keyword">=</span>
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>p0ts<span class="keyword">,</span> p0at_tr<span class="keyword">)</span>
<span class="comment">// end of [p0atlst_tr]
</span>
<span class="keyword">implement</span>
labp0atlst_tr <span class="keyword">(</span>lp0ts<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> lp0ts <span class="keyword">of</span>
  <span class="keyword">|</span> LABP0ATLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> p0t<span class="keyword">,</span> lp0ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      LABP1ATLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> p0at_tr p0t<span class="keyword">,</span> labp0atlst_tr lp0ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [LABP0ATLSTcons]
</span>  <span class="keyword">|</span> LABP0ATLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABP1ATLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> LABP0ATLSTdot <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABP1ATLSTdot <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [labp0atlst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// translation of dynamic expressions
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="14861"><span class="stacstdec">d1expitm <span class="keyword">=</span> $Fix<span class="keyword">.</span>item d1exp</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="14896"><span class="stacstdec">d1expitmlst <span class="keyword">=</span> List d1expitm</span></a></span>

<span class="keyword">val</span> d1expitm_app
  <span class="keyword">:</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span><span class="keyword">fn</span> f <span class="keyword">(</span>
  d1e1<span class="keyword">:</span> <span class="staexp">d1exp</span>
<span class="keyword">,</span> d1e2<span class="keyword">:</span> <span class="staexp">d1exp</span>
<span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine
    <span class="keyword">(</span>d1e1<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d1e2<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span>
  <span class="keyword">val</span> d1e_app <span class="keyword">=</span> d1exp_app_syndef <span class="keyword">(</span>loc<span class="keyword">,</span> d1e1<span class="keyword">,</span> d1e2<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "d1expitm_app: f: d1e_app = "; print d1e_app; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  $Fix<span class="keyword">.</span>ITEMatm d1e_app
<span class="keyword">end</span> <span class="comment">// end of [f]
</span><span class="comment">//
</span><span class="keyword">in</span>
  $Fix<span class="keyword">.</span>item_app f
<span class="keyword">end</span> <span class="comment">// end of [app_d1exp_item]
</span>
<span class="keyword">fun</span> d1exp_make_opr <span class="keyword">(</span>
  d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">$Fix<span class="keyword">.</span>fxty_t</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  $Fix<span class="keyword">.</span>oper_make <span class="staexp"><span class="keyword">{</span>d1exp<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="keyword">lam</span> x <span class="keyword">=&gt;</span> x<span class="keyword">.</span>d1exp_loc
  <span class="keyword">,</span> <span class="keyword">lam</span> <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_app_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> 0<span class="keyword">,</span> xs<span class="keyword">)</span>
  <span class="keyword">,</span> d1e
  <span class="keyword">,</span> f
  <span class="keyword">)</span> <span class="comment">// end of [oper_make]
</span><span class="keyword">end</span> <span class="comment">// end of [d1exp_make_opr]
</span>
<span class="keyword">val</span> d1expitm_backslash<span class="keyword">:</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
  $Fix<span class="keyword">.</span>oper_make_backslash <span class="staexp"><span class="keyword">{</span>d1exp<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="keyword">lam</span> x <span class="keyword">=&gt;</span> x<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span>
    <span class="keyword">lam</span> <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_app_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> x<span class="keyword">,</span> loc_arg<span class="keyword">,</span> 0<span class="keyword">,</span> xs<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="comment">// end of [oper_make_backslash]
</span><span class="comment">// end of [d1expitm_backslash]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> s0exparg_tr <span class="keyword">(</span>
  loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> s0a<span class="keyword">:</span> <span class="staexp">s0exparg</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1exparg</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s0a <span class="keyword">of</span>
  <span class="keyword">|</span> S0EXPARGone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s1exparg_one <span class="keyword">(</span>loc<span class="keyword">)</span>
  <span class="keyword">|</span> S0EXPARGall <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s1exparg_all <span class="keyword">(</span>loc<span class="keyword">)</span>
  <span class="keyword">|</span> S0EXPARGseq <span class="keyword">(</span>s0as<span class="keyword">)</span> <span class="keyword">=&gt;</span> s1exparg_seq <span class="keyword">(</span>loc<span class="keyword">,</span> s0explst_tr s0as<span class="keyword">)</span>
<span class="comment">// end of [s0exparg_tr]
</span>
<span class="keyword">fn</span> s0expdarg_tr <span class="keyword">(</span>
  d0e<span class="keyword">:</span> <span class="staexp">d0exp</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1exparg</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d0e
<span class="keyword">in</span>
  <span class="keyword">case+</span> d1e<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D1Esexparg s1a <span class="keyword">=&gt;</span> s1a
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_loc_interror <span class="keyword">(</span>d0e<span class="keyword">.</span>d0exp_loc<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr ": d0exp_tr: D0Efoldat"
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s1exparg<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s0expdarg_tr]
</span>
<span class="keyword">fun</span> s0expdarglst_tr
  <span class="keyword">(</span>d0es<span class="keyword">:</span> <span class="staexp">d0explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s1exparglst</span> <span class="keyword">=</span> <span class="keyword">case+</span> d0es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d0e<span class="keyword">,</span> d0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>s0expdarg_tr d0e<span class="keyword">,</span> s0expdarglst_tr d0es<span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [s0expdarglst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*

fun d1exp_retpos_set (d1e0: d1exp): void = let
//
  fn* aux (
    d1e: d1exp
  ) : void = begin
    case+ d1e.d1exp_node of
    | D1Eann_type (d1e, _(*s1e*)) =&gt; aux (d1e)
    | D1Ecaseof (_(*casknd*), retpos, _(*inv*), _(*d1es*), c1ls) =&gt; begin
        !retpos := 1; auxclaulst (c1ls)
      end // end of [D1Ecaseof]
    | D1Eif (retpos, _(*inv*), _(*cond*), d1e_then, od1e_else) =&gt; begin
        !retpos := 1; aux d1e_then; auxopt od1e_else
      end // end of [D1Eif]
    | D1Esif (retpos, _(*inv*), _(*cond*), d1e_then, d1e_else) =&gt; begin
        !retpos := 1; aux d1e_then; aux d1e_else
      end // end of [D1Esif]
    | D1Eseq (d1es) =&gt; begin case+ d1es of
      | list_cons (d1e, d1es) =&gt; auxseq (d1e, d1es) | list_nil () =&gt; ()
      end
    | D1Elet (_(*d1cs*), d1e) =&gt; aux (d1e)
    | _ =&gt; ()
  end // end of [aux]
//
  and auxopt
    (od1e: d1expopt): void = begin
    case+ od1e of Some d1e =&gt; aux d1e | None () =&gt; ()
  end // end of [auxopt]
//
  and auxseq (
    d1e: d1exp, d1es: d1explst
  ) : void = begin case+ d1es of
    | list_cons (d1e, d1es) =&gt; auxseq (d1e, d1es) | list_nil () =&gt; aux d1e
  end // end of [auxseq]
//
  and auxclau (c1l: c1lau): void = aux (c1l.c1lau_exp)
//
  and auxclaulst
    (c1ls: c1laulst): void = begin case+ c1ls of
    | list_cons (c1l, c1ls) =&gt; (auxclau c1l; auxclaulst c1ls) | list_nil () =&gt; ()
  end // end of [auxclaulst]
//
in
  aux (d1e0)
end // end of [d1exp_retpos_set]

*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> lamkind_isat <span class="staexp"><span class="keyword">.&lt;&gt;.</span></span>
  <span class="keyword">(</span>knd<span class="keyword">:</span> <span class="staexp">lamkind</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">case+</span> knd <span class="keyword">of</span>
  <span class="keyword">|</span> LAMKINDlam _ <span class="keyword">=&gt;</span> 0
  <span class="keyword">|</span> LAMKINDatlam _ <span class="keyword">=&gt;</span> 1
  <span class="keyword">|</span> LAMKINDllam _ <span class="keyword">=&gt;</span> 0
  <span class="keyword">|</span> LAMKINDatllam _ <span class="keyword">=&gt;</span> 1
  <span class="keyword">|</span> LAMKINDfix _ <span class="keyword">=&gt;</span> 0
  <span class="keyword">|</span> LAMKINDatfix _ <span class="keyword">=&gt;</span> 1
  <span class="keyword">|</span> LAMKINDifix _ <span class="keyword">=&gt;</span> 0
<span class="comment">// end of [lamkind_isat]
</span>
<span class="keyword">fun</span> lamkind_islin <span class="staexp"><span class="keyword">.&lt;&gt;.</span></span>
  <span class="keyword">(</span>knd<span class="keyword">:</span> <span class="staexp">lamkind</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">case+</span> knd <span class="keyword">of</span>
  <span class="keyword">|</span> LAMKINDlam _ <span class="keyword">=&gt;</span> 0
  <span class="keyword">|</span> LAMKINDatlam _ <span class="keyword">=&gt;</span> 0
  <span class="keyword">|</span> LAMKINDllam _ <span class="keyword">=&gt;</span> 1
  <span class="keyword">|</span> LAMKINDatllam _ <span class="keyword">=&gt;</span> 1
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> 0
<span class="comment">// end of [lamkind_islin]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
d0exp_lams_dyn_tr <span class="keyword">(</span>
  lamknd<span class="keyword">,</span> oloc<span class="keyword">,</span> ofc<span class="keyword">,</span> lin<span class="keyword">,</span> args<span class="keyword">,</span> res<span class="keyword">,</span> oefc<span class="keyword">,</span> d0e_body
<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>
      lamknd<span class="keyword">:</span> <span class="staexp">lamkind</span>
    <span class="keyword">,</span> args<span class="keyword">:</span> <span class="staexp">f0arglst</span>
    <span class="keyword">,</span> d1e_body<span class="keyword">:</span> <span class="staexp">d1exp</span>
    <span class="keyword">,</span> flag<span class="keyword">:</span> <span class="staexp">int</span>
    <span class="keyword">)</span> <span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1exp</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> args <span class="keyword">of</span>
    <span class="keyword">|</span> arg :: args <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc_arg <span class="keyword">=</span> arg<span class="keyword">.</span>f0arg_loc
        <span class="keyword">val</span> d1e_body <span class="keyword">=</span> aux <span class="keyword">(</span>lamknd<span class="keyword">,</span> args<span class="keyword">,</span> d1e_body<span class="keyword">,</span> flag1<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
          <span class="keyword">val</span> flag1 <span class="keyword">=</span> <span class="keyword">(</span>
            <span class="keyword">case+</span> arg<span class="keyword">.</span>f0arg_node <span class="keyword">of</span> F0ARGdyn _ <span class="keyword">=&gt;</span> flag + 1 <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> flag
          <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span>
        <span class="keyword">}</span> <span class="comment">// end of [where]
</span>        <span class="keyword">val</span> loc_body <span class="keyword">=</span> d1e_body<span class="keyword">.</span>d1exp_loc
        <span class="keyword">val</span> loc <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> oloc <span class="keyword">of</span>
          <span class="keyword">|</span> Some loc <span class="keyword">=&gt;</span> loc <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc_arg<span class="keyword">,</span> loc_body<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [None]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">loc_t</span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        <span class="keyword">case+</span> arg<span class="keyword">.</span>f0arg_node <span class="keyword">of</span>
        <span class="keyword">|</span> F0ARGsta1 s0qs <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            d1exp_lam_sta_syn <span class="keyword">(</span>loc<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s0qualst_tr s0qs<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [F0ARGsta1]
</span>        <span class="keyword">|</span> F0ARGsta2 s0as <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            d1exp_lam_sta_ana <span class="keyword">(</span>loc<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s0arglst_tr s0as<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [F0ARGsta2]
</span>        <span class="keyword">|</span> F0ARGdyn p0t <span class="keyword">when</span> flag <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> p1t <span class="keyword">=</span> p0at_tr p0t
            <span class="keyword">val</span> isat <span class="keyword">=</span> lamkind_isat <span class="keyword">(</span>lamknd<span class="keyword">)</span>
          <span class="keyword">in</span>
            <span class="keyword">if</span> isat <span class="keyword">=</span> 0 <span class="keyword">then</span>
              d1exp_lam_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> lin<span class="keyword">,</span> p1t<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
            <span class="keyword">else</span>
              d1exp_laminit_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> lin<span class="keyword">,</span> p1t<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
            <span class="comment">// end of [if]
</span>          <span class="keyword">end</span> <span class="comment">// end of [F0ARGdyn when ...]
</span>        <span class="keyword">|</span> F0ARGdyn p0t <span class="comment">(* flag &gt; 0 *)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> p1t <span class="keyword">=</span> p0at_tr p0t
            <span class="keyword">val</span> d1e_body <span class="keyword">=</span> <span class="comment">// linear closure
</span><span class="comment">(*
** funcloknd is set to FUNCLOcloptr if no annotation is available
*)</span>
              d1exp_ann_funclo_opt <span class="keyword">(</span>loc_body<span class="keyword">,</span> d1e_body<span class="keyword">,</span> FUNCLOcloptr<span class="keyword">)</span>
            <span class="comment">// end of [val]
</span>          <span class="keyword">in</span>
            d1exp_lam_dyn <span class="keyword">(</span>loc<span class="keyword">,</span> lin<span class="keyword">,</span> p1t<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [F0ARGdyn]
</span>        <span class="keyword">|</span> F0ARGmet s0es <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            d1exp_lam_met <span class="keyword">(</span>loc<span class="keyword">,</span> loc_arg<span class="keyword">,</span> s0explst_tr s0es<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [F0ARGmet]
</span>      <span class="keyword">end</span> <span class="comment">// end of [::]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1e_body
  <span class="keyword">end</span> <span class="comment">(* end of [aux] *)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> d1e_body <span class="keyword">=</span> d0exp_tr d0e_body
<span class="comment">//
</span><span class="comment">(*
  val () = d1exp_retpos_set (d1e_body) // set retpos for case/if/sif-expressions
*)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> d1e_body <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> res <span class="keyword">of</span>
    <span class="keyword">|</span> Some s0e <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc <span class="keyword">=</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>s0e<span class="keyword">.</span>s0exp_loc<span class="keyword">,</span> d1e_body<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span>
        <span class="keyword">end</span>
        <span class="keyword">val</span> s1e <span class="keyword">=</span> s0exp_tr s0e
      <span class="keyword">in</span>
        d1exp_ann_type <span class="keyword">(</span>loc<span class="keyword">,</span> d1e_body<span class="keyword">,</span> s1e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1e_body <span class="comment">// end of [None]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1exp</span>
<span class="comment">//
</span>  <span class="keyword">val</span> d1e_body <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> oefc <span class="keyword">of</span>
    <span class="keyword">|</span> Some efc <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        d1exp_ann_effc <span class="keyword">(</span>d1e_body<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d1e_body<span class="keyword">,</span> efc<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1e_body
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1exp</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> d1e_body <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> ofc <span class="keyword">of</span>
    <span class="keyword">|</span> Some fc <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        d1exp_ann_funclo <span class="keyword">(</span>d1e_body<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d1e_body<span class="keyword">,</span> fc<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1e_body
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1exp</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>lamknd<span class="keyword">,</span> args<span class="keyword">,</span> d1e_body<span class="keyword">,</span> 0<span class="comment">(*flag*)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d0exp_lams_dyn_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> termination_metric_check
  <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> is_met<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> oefc<span class="keyword">:</span> <span class="staexp">efcopt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> oefc <span class="keyword">of</span>
  <span class="keyword">|</span> Some efc <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> is_okay <span class="keyword">=</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> is_met <span class="keyword">then</span> true <span class="keyword">else</span> $Eff<span class="keyword">.</span>effcst_contain_ntm efc
      <span class="keyword">end</span> <span class="keyword">:</span> <span class="staexp">bool</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> <span class="keyword">(</span>is_okay<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">begin</span>
        prerr_loc_error1 loc<span class="keyword">;</span>
        prerr ": a termination metric is missing"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>    <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>  <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [None]
</span><span class="comment">// end of [termination_metric_check]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> i0nvarg_tr <span class="keyword">(</span>arg<span class="keyword">:</span> <span class="staexp">i0nvarg</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">i1nvarg</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> os1e <span class="keyword">=</span> s0expopt_tr arg<span class="keyword">.</span>i0nvarg_typ
<span class="keyword">in</span>
  i1nvarg_make <span class="keyword">(</span>arg<span class="keyword">.</span>i0nvarg_loc<span class="keyword">,</span> arg<span class="keyword">.</span>i0nvarg_sym<span class="keyword">,</span> os1e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [i0nvarg_tr]
</span>
<span class="keyword">fun</span> i0nvarglst_tr <span class="keyword">(</span>args<span class="keyword">:</span> <span class="staexp">i0nvarglst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">i1nvarglst</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> args <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>arg<span class="keyword">,</span> args<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>i0nvarg_tr arg<span class="keyword">,</span> i0nvarglst_tr args<span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [i0nvarglst_tr]
</span>
<span class="keyword">fn</span> i0nvresstate_tr
  <span class="keyword">(</span>res<span class="keyword">:</span> <span class="staexp">i0nvresstate</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">i1nvresstate</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s1qs <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> res<span class="keyword">.</span>i0nvresstate_qua <span class="keyword">of</span>
    <span class="keyword">|</span> Some s0qs <span class="keyword">=&gt;</span> s0qualst_tr s0qs <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1qualst</span>
  <span class="keyword">val</span> arg <span class="keyword">=</span> i0nvarglst_tr res<span class="keyword">.</span>i0nvresstate_arg
<span class="keyword">in</span>
  i1nvresstate_make <span class="keyword">(</span>s1qs<span class="keyword">,</span> arg<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [i0nvresstate_tr]
</span>
<span class="keyword">fn</span> loopi0nv_tr
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> inv<span class="keyword">:</span> <span class="staexp">loopi0nv</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">loopi1nv</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> qua <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> inv<span class="keyword">.</span>loopi0nv_qua <span class="keyword">of</span>
    <span class="keyword">|</span> Some s0qs <span class="keyword">=&gt;</span> s0qualst_tr s0qs <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1qualst</span>
  <span class="keyword">val</span> met <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> inv<span class="keyword">.</span>loopi0nv_met <span class="keyword">of</span>
    <span class="keyword">|</span> Some s0es <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>s0explst_tr s0es<span class="keyword">)</span>
    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s1explstopt</span>
  <span class="keyword">val</span> arg <span class="keyword">=</span> i0nvarglst_tr inv<span class="keyword">.</span>loopi0nv_arg
  <span class="keyword">val</span> res <span class="keyword">=</span> i0nvresstate_tr inv<span class="keyword">.</span>loopi0nv_res
<span class="keyword">in</span>
  loopi1nv_make <span class="keyword">(</span>loc0<span class="keyword">,</span> qua<span class="keyword">,</span> met<span class="keyword">,</span> arg<span class="keyword">,</span> res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [loopi0nv_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> m0atch_tr
  <span class="keyword">(</span>m0at<span class="keyword">:</span> <span class="staexp">m0atch</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">m1atch</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr m0at<span class="keyword">.</span>m0atch_exp
  <span class="keyword">val</span> op1t <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> m0at<span class="keyword">.</span>m0atch_pat <span class="keyword">of</span>
    <span class="keyword">|</span> Some p0t <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>p0at_tr p0t<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p1atopt</span>
<span class="keyword">in</span>
  m1atch_make <span class="keyword">(</span>m0at<span class="keyword">.</span>m0atch_loc<span class="keyword">,</span> d1e<span class="keyword">,</span> op1t<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [m0atch_tr]
</span>
<span class="keyword">fn</span> m0atchlst_tr
  <span class="keyword">(</span>m0ats<span class="keyword">:</span> <span class="staexp">m0atchlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">m1atchlst</span> <span class="keyword">=</span>
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>m0ats<span class="keyword">,</span> m0atch_tr<span class="keyword">)</span>
<span class="comment">// end of [m0atchlst_tr]
</span>
<span class="keyword">fn</span> c0lau_tr
  <span class="keyword">(</span>c0l<span class="keyword">:</span> <span class="staexp">c0lau</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">c1lau</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> gp0t <span class="keyword">=</span> c0l<span class="keyword">.</span>c0lau_pat
  <span class="keyword">val</span> gua <span class="keyword">=</span> m0atchlst_tr <span class="keyword">(</span>gp0t<span class="keyword">.</span>guap0at_gua<span class="keyword">)</span>
  <span class="keyword">val</span> p1t <span class="keyword">=</span> p0at_tr <span class="keyword">(</span>gp0t<span class="keyword">.</span>guap0at_pat<span class="keyword">)</span>
  <span class="keyword">val</span> body <span class="keyword">=</span> d0exp_tr <span class="keyword">(</span>c0l<span class="keyword">.</span>c0lau_body<span class="keyword">)</span>
<span class="keyword">in</span>
  c1lau_make <span class="keyword">(</span>c0l<span class="keyword">.</span>c0lau_loc<span class="keyword">,</span> p1t<span class="keyword">,</span> gua<span class="keyword">,</span> c0l<span class="keyword">.</span>c0lau_seq<span class="keyword">,</span> c0l<span class="keyword">.</span>c0lau_neg<span class="keyword">,</span> body<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [c0lau_tr]
</span>
<span class="keyword">fn</span> c0laulst_tr <span class="keyword">(</span>c0ls<span class="keyword">:</span> <span class="staexp">c0laulst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">c1laulst</span> <span class="keyword">=</span>
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>c0ls<span class="keyword">,</span> c0lau_tr<span class="keyword">)</span>
<span class="comment">// end of [c0laulst_tr]
</span>
<span class="keyword">fn</span> sc0lau_tr
  <span class="keyword">(</span>sc0l<span class="keyword">:</span> <span class="staexp">sc0lau</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sc1lau</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> sp1t <span class="keyword">=</span> sp0at_tr <span class="keyword">(</span>sc0l<span class="keyword">.</span>sc0lau_pat<span class="keyword">)</span>
  <span class="keyword">val</span> body <span class="keyword">=</span> d0exp_tr <span class="keyword">(</span>sc0l<span class="keyword">.</span>sc0lau_body<span class="keyword">)</span>
<span class="keyword">in</span>
  sc1lau_make <span class="keyword">(</span>sc0l<span class="keyword">.</span>sc0lau_loc<span class="keyword">,</span> sp1t<span class="keyword">,</span> body<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [sc0lau_tr]
</span>
<span class="keyword">fn</span> sc0laulst_tr <span class="keyword">(</span>sc0ls<span class="keyword">:</span> <span class="staexp">sc0laulst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sc1laulst</span> <span class="keyword">=</span>
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>sc0ls<span class="keyword">,</span> sc0lau_tr<span class="keyword">)</span>
<span class="comment">// end of [sc0laulst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
d0exp_tr d0e0 <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span><span class="keyword">fn</span> opr_errmsg
  <span class="keyword">(</span>d0e<span class="keyword">:</span> <span class="staexp">d0exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_loc_error1 <span class="keyword">(</span>d0e<span class="keyword">.</span>d0exp_loc<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr ": the operator needs to be applied"
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d1exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [opr_errmsg]
</span><span class="comment">//
</span><span class="keyword">fun</span> aux_item <span class="keyword">(</span>
  d0e0<span class="keyword">:</span> <span class="staexp">d0exp</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc0 <span class="keyword">=</span> d0e0<span class="keyword">.</span>d0exp_loc
<span class="keyword">in</span>
  <span class="keyword">case+</span> d0e0<span class="keyword">.</span>d0exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D0Eann <span class="keyword">(</span>d0e<span class="keyword">,</span> s0e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d0e <span class="keyword">and</span> s1e <span class="keyword">=</span> s0exp_tr s0e
      <span class="keyword">val</span> d1e_ann <span class="keyword">=</span> d1exp_ann_type <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">,</span> s1e<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm d1e_ann
    <span class="keyword">end</span> <span class="comment">// end of [D0Eann]
</span>  <span class="keyword">|</span> D0Eapp _ <span class="keyword">=&gt;</span> <span class="keyword">let</span> 
      <span class="keyword">val</span> d1e <span class="keyword">=</span>
        $Fix<span class="keyword">.</span>fixity_resolve <span class="keyword">(</span>loc0<span class="keyword">,</span> d1expitm_app<span class="keyword">,</span> aux_itemlst d0e0<span class="keyword">)</span>
      <span class="comment">// end of [val]
</span><span class="comment">(*
      val () = (
        print "d0exp_tr: aux_item: d1e = "; print_d1exp d1e; print_newline ()
      ) // end of [val]
*)</span>
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d1exp_idextapp_resolve <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm d1e
    <span class="keyword">end</span> <span class="comment">// end of [D0Eapp]
</span>  <span class="keyword">|</span> D0Earrinit <span class="keyword">(</span>s0e_elt<span class="keyword">,</span> od0e_asz<span class="keyword">,</span> d0es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1e_elt <span class="keyword">=</span> s0exp_tr s0e_elt
      <span class="keyword">val</span> od1e_asz <span class="keyword">=</span> d0expopt_tr od0e_asz
      <span class="keyword">val</span> d1es_elt <span class="keyword">=</span> d0explst_tr d0es_elt
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_arrinit <span class="keyword">(</span>loc0<span class="keyword">,</span> s1e_elt<span class="keyword">,</span> od1e_asz<span class="keyword">,</span> d1es_elt<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Earrinit]
</span>  <span class="keyword">|</span> D0Earrsize <span class="keyword">(</span>os0e_elt<span class="keyword">,</span> d0e_elts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> os1e_elt <span class="keyword">=</span> s0expopt_tr os0e_elt
      <span class="keyword">val</span> d1e_elts <span class="keyword">=</span> d0exp_tr <span class="keyword">(</span>d0e_elts<span class="keyword">)</span>
      <span class="keyword">val</span> d1es_elt <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d1e_elts<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> D1Elist <span class="keyword">(</span>_<span class="comment">(*npf*)</span><span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1es <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>d1e_elts<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1explst</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> d1e_arrsize <span class="keyword">=</span> d1exp_arrsize <span class="keyword">(</span>loc0<span class="keyword">,</span> os1e_elt<span class="keyword">,</span> d1es_elt<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1e_arrsize<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Earrsize]
</span>  <span class="keyword">|</span> D0Earrsub <span class="keyword">(</span>qid<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d0ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1e_arr <span class="keyword">=</span>
        d1exp_qid <span class="keyword">(</span>qid<span class="keyword">.</span>arrqi0de_loc<span class="keyword">,</span> qid<span class="keyword">.</span>arrqi0de_qua<span class="keyword">,</span> qid<span class="keyword">.</span>arrqi0de_sym<span class="keyword">)</span>
      <span class="keyword">val</span> d1ess_ind <span class="keyword">=</span> d0explstlst_tr d0ess
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_arrsub <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e_arr<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d1ess_ind<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Earrsub]
</span>  <span class="keyword">|</span> D0Ecaseof <span class="keyword">(</span>hd<span class="keyword">,</span> d0e<span class="keyword">,</span> c0ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> casknd <span class="keyword">=</span> hd<span class="keyword">.</span>casehead_knd
      <span class="keyword">val</span> inv <span class="keyword">=</span> i0nvresstate_tr <span class="keyword">(</span>hd<span class="keyword">.</span>casehead_inv<span class="keyword">)</span>
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d0e
      <span class="keyword">val</span> d1es <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d1e<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> D1Elist <span class="keyword">(</span>_<span class="comment">(*npf*)</span><span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1es <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>d1e<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1explst</span>
      <span class="keyword">val</span> c1ls <span class="keyword">=</span> c0laulst_tr c0ls
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_caseof <span class="keyword">(</span>loc0<span class="keyword">,</span> casknd<span class="keyword">,</span> inv<span class="keyword">,</span> d1es<span class="keyword">,</span> c1ls<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ecaseof]
</span>  <span class="keyword">|</span> D0Echar chr <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_char <span class="keyword">(</span>loc0<span class="keyword">,</span> chr<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Echar]
</span>  <span class="keyword">|</span> D0Ecstsp cst <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_cstsp <span class="keyword">(</span>loc0<span class="keyword">,</span> cst<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ecstsp]
</span>  <span class="keyword">|</span> D0Ecrypt <span class="keyword">(</span>knd<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_crypt <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>crypt_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ecrypt]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D0Edecseq <span class="keyword">(</span>d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_inc <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d1cs <span class="keyword">=</span> d0eclst_tr d0cs
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_dec <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_pop <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_decseq <span class="keyword">(</span>loc0<span class="keyword">,</span> d1cs<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Edecseq]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D0Edelay <span class="keyword">(</span>lin<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span>
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_lazy_delay <span class="keyword">(</span>loc0<span class="keyword">,</span> lin<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>delay_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Edelay]
</span>  <span class="keyword">|</span> D0Edynload <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span>
        <span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">case+</span> d1e<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> D1Estring <span class="keyword">(</span>name<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> fil <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span>
              $Fil<span class="keyword">.</span>filenameopt_make_relative name <span class="keyword">of</span>
              <span class="keyword">|</span> <span class="keyword">~</span>Some_vt fil <span class="keyword">=&gt;</span> fil
              <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                  prerr_loc_error1 d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">;</span>
                  prerr ": the file ["<span class="keyword">;</span> prerr name<span class="keyword">;</span>
                  prerr "] is not available for dynamic loading"<span class="keyword">;</span>
                  prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
                  $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>fil_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
                <span class="keyword">end</span>
            <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">fil_t</span> <span class="comment">// end of [val]
</span>            <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span>
          <span class="keyword">in</span>
            $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_dynload <span class="keyword">(</span>loc0<span class="keyword">,</span> fil<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D1Estring]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error1 d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">;</span>
            prerr ": the dynamic expression must be a string constant"<span class="keyword">;</span>
            prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d1expitm<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>        <span class="comment">// end of [case]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>dynload_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Edynlaod]
</span>  <span class="keyword">|</span> D0Eeffmask <span class="keyword">(</span>effs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_effmask <span class="keyword">(</span>loc0<span class="keyword">,</span> effs<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>delay_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eeffmask]
</span>  <span class="keyword">|</span> D0Eempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_empty loc0<span class="keyword">)</span>
  <span class="keyword">|</span> D0Eexist <span class="keyword">(</span>qualoc<span class="keyword">,</span> s0a<span class="keyword">,</span> d0e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1a <span class="keyword">=</span> s0exparg_tr <span class="keyword">(</span>qualoc<span class="keyword">,</span> s0a<span class="keyword">)</span> <span class="keyword">and</span> d1e <span class="keyword">=</span> d0exp_tr d0e
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_exist <span class="keyword">(</span>loc0<span class="keyword">,</span> s1a<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eexist]
</span>  <span class="keyword">|</span> D0Eextval <span class="keyword">(</span>s0e_typ<span class="keyword">,</span> code <span class="comment">(*string*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1e_typ <span class="keyword">=</span> s0exp_tr s0e_typ
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_extval <span class="keyword">(</span>loc0<span class="keyword">,</span> s1e_typ<span class="keyword">,</span> code<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eextval]
</span>  <span class="keyword">|</span> D0Efix <span class="keyword">(</span>
      knd<span class="keyword">,</span> id<span class="keyword">,</span> args<span class="keyword">,</span> res<span class="keyword">,</span> otags<span class="keyword">,</span> d0e_def
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> oefc<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> otags <span class="keyword">of</span>
        <span class="keyword">|</span> Some tags <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> efc<span class="keyword">)</span> <span class="keyword">=</span> $Eff<span class="keyword">.</span>e0fftaglst_tr <span class="keyword">(</span>tags<span class="keyword">)</span>
          <span class="keyword">in</span>
            <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> Some efc<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>
            None <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">(*ofc*)</span><span class="keyword">,</span> 0 <span class="comment">(*lin*)</span><span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">(*oefc*)</span>
          <span class="keyword">)</span> <span class="comment">// end of [None]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>Option funclo<span class="keyword">,</span> int<span class="keyword">,</span> efcopt<span class="keyword">)</span></span>
      <span class="keyword">val</span> d1e_def <span class="keyword">=</span> d0exp_lams_dyn_tr <span class="keyword">(</span>
        knd<span class="keyword">,</span> Some loc0<span class="keyword">,</span> ofc<span class="keyword">,</span> lin<span class="keyword">,</span> args<span class="keyword">,</span> res<span class="keyword">,</span> oefc<span class="keyword">,</span> d0e_def
      <span class="keyword">)</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>      <span class="keyword">val</span> ismet <span class="keyword">=</span> d1exp_is_metric <span class="keyword">(</span>d1e_def<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> termination_metric_check <span class="keyword">(</span>loc0<span class="keyword">,</span> ismet<span class="keyword">,</span> oefc<span class="keyword">)</span>
<span class="comment">//
</span>      <span class="keyword">val</span> isat <span class="keyword">=</span> lamkind_isat <span class="keyword">(</span>knd<span class="keyword">)</span> <span class="comment">// HX: fixind = lamkind
</span>      <span class="keyword">val</span> knd <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> isat <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> 0 <span class="keyword">else</span> 1<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span>
<span class="comment">//
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_fix <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> id<span class="keyword">,</span> d1e_def<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Efix]
</span>  <span class="keyword">|</span> D0Efloat <span class="keyword">(</span>str <span class="comment">(*float*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_float <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Efloat]
</span>  <span class="keyword">|</span> D0Efloatsp <span class="keyword">(</span>str <span class="comment">(*float*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_floatsp <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Efloatsp]
</span>  <span class="keyword">|</span> D0Efoldat <span class="keyword">(</span>d0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1as <span class="keyword">=</span> s0expdarglst_tr d0es
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_foldat <span class="keyword">(</span>loc0<span class="keyword">,</span> s1as<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>foldat_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Efoldat]
</span>  <span class="keyword">|</span> D0Efor <span class="keyword">(</span>inv<span class="keyword">,</span> loc_inv<span class="keyword">,</span> ini<span class="keyword">,</span> test<span class="keyword">,</span> post<span class="keyword">,</span> body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> inv<span class="keyword">:</span> <span class="staexp">loopi1nv</span> <span class="keyword">=</span> <span class="keyword">case+</span> inv <span class="keyword">of</span>
        <span class="keyword">|</span> Some inv <span class="keyword">=&gt;</span> loopi0nv_tr <span class="keyword">(</span>loc_inv<span class="keyword">,</span> inv<span class="keyword">)</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loopi1nv_nil <span class="keyword">(</span>loc_inv<span class="keyword">)</span>
      <span class="keyword">val</span> ini <span class="keyword">=</span> d0exp_tr ini
      <span class="keyword">val</span> test <span class="keyword">=</span> d0exp_tr test
      <span class="keyword">val</span> post <span class="keyword">=</span> d0exp_tr post
      <span class="keyword">val</span> body <span class="keyword">=</span> d0exp_tr body
    <span class="keyword">in</span> 
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_for <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> ini<span class="keyword">,</span> test<span class="keyword">,</span> post<span class="keyword">,</span> body<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Efor]
</span>  <span class="keyword">|</span> D0Efreeat <span class="keyword">(</span>d0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1as <span class="keyword">=</span> s0expdarglst_tr d0es
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span>
          $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_freeat <span class="keyword">(</span>loc0<span class="keyword">,</span> s1as<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>freeat_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Efreeat]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D0Eide id <span class="keyword">when</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_BACKSLASH <span class="keyword">=&gt;</span> d1expitm_backslash
  <span class="keyword">|</span> D0Eide id <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d1exp_ide <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> the_fxtyenv_find id <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt f <span class="keyword">=&gt;</span> d1exp_make_opr <span class="keyword">(</span>d1e<span class="keyword">,</span> f<span class="keyword">)</span>
      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm d1e
    <span class="keyword">end</span> <span class="comment">// end of [D0Eide]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D0Eidext id <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ns <span class="keyword">=</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">and</span> arglst <span class="keyword">=</span> nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d1exp_idextapp <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">,</span> ns<span class="keyword">,</span> arglst<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> the_fxtyenv_find id <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt f <span class="keyword">=&gt;</span> d1exp_make_opr <span class="keyword">(</span>d1e<span class="keyword">,</span> f<span class="keyword">)</span>
      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm d1e
    <span class="keyword">end</span> <span class="comment">// end of [D0Eide]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D0Eif <span class="keyword">(</span>hd<span class="keyword">,</span> d0e_cond<span class="keyword">,</span> d0e_then<span class="keyword">,</span> od0e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> inv <span class="keyword">=</span> i0nvresstate_tr hd<span class="keyword">.</span>ifhead_inv
      <span class="keyword">val</span> d1e_cond <span class="keyword">=</span> d0exp_tr d0e_cond
      <span class="keyword">val</span> d1e_then <span class="keyword">=</span> d0exp_tr d0e_then
      <span class="keyword">val</span> od1e_else <span class="keyword">=</span> d0expopt_tr od0e_else
      <span class="keyword">val</span> d1e_if <span class="keyword">=</span> d1exp_if <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> d1e_cond<span class="keyword">,</span> d1e_then<span class="keyword">,</span> od1e_else<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1e_if<span class="keyword">)</span>        
    <span class="keyword">end</span> <span class="comment">// end of [D0Eif]
</span>  <span class="keyword">|</span> D0Eint <span class="keyword">(</span>str <span class="comment">(*int*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_int <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eint]
</span>  <span class="keyword">|</span> D0Eintsp <span class="keyword">(</span>str <span class="comment">(*int*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_intsp <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eintsp]
</span>  <span class="keyword">|</span> D0Elam <span class="keyword">(</span>
      knd<span class="keyword">,</span> args<span class="keyword">,</span> res<span class="keyword">,</span> otags<span class="keyword">,</span> body
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> lin0 <span class="keyword">=</span> lamkind_islin <span class="keyword">(</span>knd<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> oefc<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> otags <span class="keyword">of</span>
        <span class="keyword">|</span> Some tags <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> efc<span class="keyword">)</span> <span class="keyword">=</span> $Eff<span class="keyword">.</span>e0fftaglst_tr <span class="keyword">(</span>tags<span class="keyword">)</span>
            <span class="keyword">val</span> lin <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> lin0 <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> 1 <span class="keyword">else</span> lin<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span>
          <span class="keyword">in</span>
            <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> Some efc<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> lin0<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>Option funclo<span class="keyword">,</span> int<span class="keyword">,</span> efcopt<span class="keyword">)</span></span>
      <span class="keyword">val</span> d1e_lam <span class="keyword">=</span> d0exp_lams_dyn_tr
        <span class="keyword">(</span>knd<span class="keyword">,</span> Some loc0<span class="keyword">,</span> ofc<span class="keyword">,</span> lin<span class="keyword">,</span> args<span class="keyword">,</span> res<span class="keyword">,</span> oefc<span class="keyword">,</span> body<span class="keyword">)</span>
      <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1e_lam<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Elam]
</span>  <span class="keyword">|</span> D0Elet <span class="keyword">(</span>d0cs<span class="keyword">,</span> d0e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_inc <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d1cs <span class="keyword">=</span> d0eclst_tr d0cs
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d0e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_dec <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_pop <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_let <span class="keyword">(</span>loc0<span class="keyword">,</span> d1cs<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Elet]
</span>  <span class="keyword">|</span> D0Elist <span class="keyword">(</span>d0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1es <span class="keyword">=</span> d0explst_tr d0es
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_list <span class="keyword">(</span>loc0<span class="keyword">,</span> d1es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Elist]
</span>  <span class="keyword">|</span> D0Elist2 <span class="keyword">(</span>d0es1<span class="keyword">,</span> d0es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1es1 <span class="keyword">=</span> d0explst_tr d0es1 <span class="keyword">and</span> d1es2 <span class="keyword">=</span> d0explst_tr d0es2
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_list2 <span class="keyword">(</span>loc0<span class="keyword">,</span> d1es1<span class="keyword">,</span> d1es2<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Elist2]
</span>  <span class="keyword">|</span> D0Eloopexn <span class="keyword">(</span>i<span class="comment">(*brk/cont*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_loopexn <span class="keyword">(</span>loc0<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> D0Elst <span class="keyword">(</span>lin<span class="keyword">,</span> os0e_elt<span class="keyword">,</span> d0e_elts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> os1e_elt <span class="keyword">=</span> s0expopt_tr os0e_elt
      <span class="keyword">val</span> d1e_elts <span class="keyword">=</span> d0exp_tr <span class="keyword">(</span>d0e_elts<span class="keyword">)</span>
      <span class="keyword">val</span> d1es_elt <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d1e_elts<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> D1Elist <span class="keyword">(</span>_<span class="comment">(*npf*)</span><span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1es <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>d1e_elts<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1explst</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> d1e_lst <span class="keyword">=</span> d1exp_lst <span class="keyword">(</span>loc0<span class="keyword">,</span> lin<span class="keyword">,</span> os1e_elt<span class="keyword">,</span> d1es_elt<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1e_lst<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Elst]
</span>  <span class="keyword">|</span> D0Emacsyn <span class="keyword">(</span>knd<span class="keyword">,</span> d0e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_macsyn <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d0exp_tr d0e<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Emacsyn]
</span>  <span class="keyword">|</span> D0Eopide id <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_ide <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> D0Eptrof <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span>
      <span class="keyword">in</span>
        $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_ptrof <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">(* end of [f] *)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>ptrof_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eptrof]
</span>  <span class="keyword">|</span> D0Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_qid <span class="keyword">(</span>loc0<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> D0Eraise <span class="keyword">(</span>d0e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_raise <span class="keyword">(</span>loc0<span class="keyword">,</span> d0exp_tr d0e<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eraise]
</span>  <span class="keyword">|</span> D0Erec <span class="keyword">(</span>recknd<span class="keyword">,</span> ld0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ld1es <span class="keyword">=</span> labd0explst_tr ld0es
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_rec <span class="keyword">(</span>loc0<span class="keyword">,</span> recknd<span class="keyword">,</span> ld1es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Erec]
</span>  <span class="keyword">|</span> D0Escaseof <span class="keyword">(</span>hd<span class="keyword">,</span> s0e<span class="keyword">,</span> sc0ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="comment">// hd.casehead_knd is always 0
</span>      <span class="keyword">val</span> inv <span class="keyword">=</span> i0nvresstate_tr <span class="keyword">(</span>hd<span class="keyword">.</span>casehead_inv<span class="keyword">)</span>
      <span class="keyword">val</span> s1e <span class="keyword">=</span> s0exp_tr s0e
      <span class="keyword">val</span> sc1ls <span class="keyword">=</span> sc0laulst_tr sc0ls
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_scaseof <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> s1e<span class="keyword">,</span> sc1ls<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Escaseof]
</span>  <span class="keyword">|</span> D0Esel_lab <span class="keyword">(</span>knd<span class="keyword">,</span> lab<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1l <span class="keyword">=</span> d1lab_lab <span class="keyword">(</span>loc0<span class="keyword">,</span> lab<span class="keyword">)</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> loc0<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_sel <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1e<span class="keyword">,</span> d1l<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpos <span class="keyword">(</span>$Fix<span class="keyword">.</span>select_prec<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Esel_lab]
</span>  <span class="keyword">|</span> D0Esel_ind <span class="keyword">(</span>knd<span class="keyword">,</span> ind<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> d0explstlst_tr ind
      <span class="keyword">val</span> d1l <span class="keyword">=</span> d1lab_ind <span class="keyword">(</span>loc0<span class="keyword">,</span> ind<span class="keyword">)</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> loc0<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_sel <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1e<span class="keyword">,</span> d1l<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpos <span class="keyword">(</span>$Fix<span class="keyword">.</span>select_prec<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Esel_ind]
</span>  <span class="keyword">|</span> D0Eseq d0es <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_seq <span class="keyword">(</span>loc0<span class="keyword">,</span> d0explst_tr d0es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eseq]
</span>  <span class="keyword">|</span> D0Esexparg <span class="keyword">(</span>s0a<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1a <span class="keyword">=</span> s0exparg_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> s0a<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_sexparg <span class="keyword">(</span>loc0<span class="keyword">,</span> s1a<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Esexparg]
</span>  <span class="keyword">|</span> D0Esif <span class="keyword">(</span>hd<span class="keyword">,</span> s0e_cond<span class="keyword">,</span> d0e_then<span class="keyword">,</span> d0e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> inv <span class="keyword">=</span> i0nvresstate_tr hd<span class="keyword">.</span>ifhead_inv
      <span class="keyword">val</span> s1e_cond <span class="keyword">=</span> s0exp_tr s0e_cond
      <span class="keyword">val</span> d1e_then <span class="keyword">=</span> d0exp_tr d0e_then
      <span class="keyword">val</span> d1e_else <span class="keyword">=</span> d0exp_tr d0e_else
      <span class="keyword">val</span> d1e_sif <span class="keyword">=</span> d1exp_sif <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> s1e_cond<span class="keyword">,</span> d1e_then<span class="keyword">,</span> d1e_else<span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1e_sif<span class="keyword">)</span>        
    <span class="keyword">end</span> <span class="comment">// end of [D0Esif]
</span>  <span class="keyword">|</span> D0Estring <span class="keyword">(</span>str<span class="keyword">,</span> len<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_string <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">,</span> len<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Estring]
</span>  <span class="keyword">|</span> D0Estruct <span class="keyword">(</span>ld0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ld1es <span class="keyword">=</span> labd0explst_tr ld0es
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_struct <span class="keyword">(</span>loc0<span class="keyword">,</span> ld1es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Estruct]
</span>  <span class="keyword">|</span> D0Etmpid <span class="keyword">(</span>qid<span class="keyword">,</span> ts0ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ts1ess <span class="keyword">=</span> t1mps0explstlst_tr ts0ess
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_tmpid <span class="keyword">(</span>loc0<span class="keyword">,</span> qid<span class="keyword">,</span> ts1ess<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Etmpid]
</span>  <span class="keyword">|</span> D0Etop <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_top loc0<span class="keyword">)</span>
  <span class="keyword">|</span> D0Etrywith <span class="keyword">(</span>hd<span class="keyword">,</span> d0e<span class="keyword">,</span> c0ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> inv <span class="keyword">=</span> i0nvresstate_tr <span class="keyword">(</span>hd<span class="keyword">.</span>tryhead_inv<span class="keyword">)</span>
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d0e
      <span class="keyword">val</span> c1ls <span class="keyword">=</span> c0laulst_tr c0ls
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_trywith <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> d1e<span class="keyword">,</span> c1ls<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Etrywith]
</span>  <span class="keyword">|</span> D0Etup <span class="keyword">(</span>tupknd<span class="keyword">,</span> d0es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1es <span class="keyword">=</span> d0explst_tr d0es
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_tup <span class="keyword">(</span>loc0<span class="keyword">,</span> tupknd<span class="keyword">,</span> d1es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Etup]
</span>  <span class="keyword">|</span> D0Etup2 <span class="keyword">(</span>tupknd<span class="keyword">,</span> d0es1<span class="keyword">,</span> d0es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1es1 <span class="keyword">=</span> d0explst_tr d0es1
      <span class="keyword">val</span> d1es2 <span class="keyword">=</span> d0explst_tr d0es2
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_tup2 <span class="keyword">(</span>loc0<span class="keyword">,</span> tupknd<span class="keyword">,</span> d1es1<span class="keyword">,</span> d1es2<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Etup2]
</span>  <span class="keyword">|</span> D0Eviewat <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">fn</span> f <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp">d1expitm</span> <span class="keyword">=</span>
        <span class="keyword">let</span> <span class="keyword">val</span> loc0 <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_combine <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span> <span class="keyword">in</span>
          $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_viewat <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="comment">// end of [f]
</span>    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMopr <span class="keyword">(</span>$Fix<span class="keyword">.</span>OPERpre <span class="keyword">(</span>$Fix<span class="keyword">.</span>viewat_prec_dyn<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Eviewat]
</span>  <span class="keyword">|</span> D0Ewhere <span class="keyword">(</span>d0e<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="comment">// declarations are translated first!
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_inc <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d1cs <span class="keyword">=</span> d0eclst_tr d0cs
      <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d0e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_dec <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_pop <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_where <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e<span class="keyword">,</span> d1cs<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ewhere]
</span>  <span class="keyword">|</span> D0Ewhile <span class="keyword">(</span>oinv<span class="keyword">,</span> loc_inv<span class="keyword">,</span> d0e_test<span class="keyword">,</span> d0e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> inv <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">case+</span> oinv <span class="keyword">of</span>
        <span class="keyword">|</span> Some inv <span class="keyword">=&gt;</span>
            loopi0nv_tr <span class="keyword">(</span>loc_inv<span class="keyword">,</span> inv<span class="keyword">)</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> loopi1nv_nil <span class="keyword">(</span>loc_inv<span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">loopi1nv</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> d1e_test <span class="keyword">=</span> d0exp_tr d0e_test
      <span class="keyword">val</span> d1e_body <span class="keyword">=</span> d0exp_tr d0e_body
    <span class="keyword">in</span>
      $Fix<span class="keyword">.</span>ITEMatm <span class="keyword">(</span>d1exp_while <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> d1e_test<span class="keyword">,</span> d1e_body<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ewhile]
</span><span class="comment">(*
   | _ =&gt; begin
      prerr_loc_interror d0e0.d0exp_loc;
      prerr ": d0exp_tr: not available yet"; prerr_newline ();
      $Err.abort {d1expitm} ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux_item]
</span><span class="comment">//
</span><span class="keyword">and</span> aux_itemlst <span class="keyword">(</span>d0e0<span class="keyword">:</span> <span class="staexp">d0exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1expitmlst</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>res<span class="keyword">:</span> <span class="staexp">List d1expitm</span><span class="keyword">,</span> d0e0<span class="keyword">:</span> <span class="staexp">d0exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1expitmlst</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> d0e0<span class="keyword">.</span>d0exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> D0Eapp <span class="keyword">(</span>d0e1<span class="keyword">,</span> d0e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> res <span class="keyword">=</span> aux_item d0e2 :: res <span class="keyword">in</span> aux <span class="keyword">(</span>res<span class="keyword">,</span> d0e1<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D0Eapp]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> aux_item d0e0 :: res
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> d0e0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux_itemlst]
</span><span class="comment">//
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> aux_item d0e0 <span class="keyword">of</span>
  <span class="keyword">|</span> $Fix<span class="keyword">.</span>ITEMatm d1e <span class="keyword">=&gt;</span> d1e
  <span class="keyword">|</span> $Fix<span class="keyword">.</span>ITEMopr _ <span class="keyword">=&gt;</span> opr_errmsg <span class="keyword">(</span>d0e0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d0exp_tr]
</span>
<span class="keyword">implement</span>
d0explst_tr <span class="keyword">(</span>d0es<span class="keyword">)</span> <span class="keyword">=</span> 
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>d0es<span class="keyword">,</span> d0exp_tr<span class="keyword">)</span>
<span class="comment">// end of [d0explst_tr]
</span>
<span class="keyword">implement</span>
d0explstlst_tr <span class="keyword">(</span>d0ess<span class="keyword">)</span> <span class="keyword">=</span>
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>d0ess<span class="keyword">,</span> d0explst_tr<span class="keyword">)</span>
<span class="comment">// end of [d0explstlst_tr]
</span>
<span class="keyword">implement</span>
labd0explst_tr <span class="keyword">(</span>ld0es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> ld0es <span class="keyword">of</span>
  <span class="keyword">|</span> LABD0EXPLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> d0e<span class="keyword">,</span> ld0es<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    LABD1EXPLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> d0exp_tr d0e<span class="keyword">,</span> labd0explst_tr ld0es<span class="keyword">)</span>
  <span class="keyword">|</span> LABD0EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABD1EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [labd0explst_tr]
</span>
<span class="keyword">implement</span>
d0expopt_tr <span class="keyword">(</span>od0e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> od0e <span class="keyword">of</span>
  <span class="keyword">|</span> Some d0e <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>d0exp_tr d0e<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [d0expopt_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// translation of declarations
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> v0aldec_tr
  <span class="keyword">(</span>d<span class="keyword">:</span> <span class="staexp">v0aldec</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">v1aldec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> p1t <span class="keyword">=</span> p0at_tr d<span class="keyword">.</span>v0aldec_pat
  <span class="keyword">val</span> d1e <span class="keyword">=</span> d0exp_tr d<span class="keyword">.</span>v0aldec_def
<span class="comment">(*
  val () = begin
    print "v0aldec_tr: d1e = "; print d1e; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> ann <span class="keyword">=</span> witht0ype_tr d<span class="keyword">.</span>v0aldec_ann
<span class="keyword">in</span>
  v1aldec_make <span class="keyword">(</span>d<span class="keyword">.</span>v0aldec_loc<span class="keyword">,</span> p1t<span class="keyword">,</span> d1e<span class="keyword">,</span> ann<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [v0aldec_tr]
</span>
<span class="keyword">fn</span> v0aldeclst_tr
  <span class="keyword">(</span>ds<span class="keyword">:</span> <span class="staexp">v0aldeclst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">v1aldeclst</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>ds<span class="keyword">,</span> v0aldec_tr<span class="keyword">)</span>
<span class="comment">// end of [v0aldeclst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> v0ardec_tr
  <span class="keyword">(</span>d<span class="keyword">:</span> <span class="staexp">v0ardec</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">v1ardec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> d<span class="keyword">.</span>v0ardec_loc
  <span class="keyword">val</span> knd <span class="keyword">=</span> d<span class="keyword">.</span>v0ardec_knd
  <span class="keyword">val</span> os1e <span class="keyword">=</span> s0expopt_tr d<span class="keyword">.</span>v0ardec_typ
  <span class="keyword">val</span> wth <span class="keyword">=</span> d<span class="keyword">.</span>v0ardec_wth <span class="comment">// i0deopt
</span>  <span class="keyword">val</span> od1e <span class="keyword">=</span> d0expopt_tr d<span class="keyword">.</span>v0ardec_ini
<span class="keyword">in</span>
  v1ardec_make <span class="keyword">(</span>
    loc<span class="keyword">,</span> knd<span class="keyword">,</span> d<span class="keyword">.</span>v0ardec_sym<span class="keyword">,</span> d<span class="keyword">.</span>v0ardec_sym_loc<span class="keyword">,</span> os1e<span class="keyword">,</span> wth<span class="keyword">,</span> od1e
  <span class="keyword">)</span> <span class="comment">// end of [v1ardec_make]
</span><span class="keyword">end</span> <span class="comment">// end of [v0ardec_tr]
</span>
<span class="keyword">fn</span> v0ardeclst_tr
  <span class="keyword">(</span>ds<span class="keyword">:</span> <span class="staexp">v0ardeclst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">v1ardeclst</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>ds<span class="keyword">,</span> v0ardec_tr<span class="keyword">)</span>
<span class="comment">// end of [v0ardeclst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> f0undec_tr
  <span class="keyword">(</span>is_prf<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> is_rec<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> d<span class="keyword">:</span> <span class="staexp">f0undec</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">f1undec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> d<span class="keyword">.</span>f0undec_loc
  <span class="keyword">val</span> otags <span class="keyword">=</span> d<span class="keyword">.</span>f0undec_eff
  <span class="keyword">val</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> oefc<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> otags <span class="keyword">of</span>
    <span class="keyword">|</span> Some tags <span class="keyword">=&gt;</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> Some efc<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
        <span class="keyword">val</span> <span class="keyword">(</span>ofc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> efc<span class="keyword">)</span> <span class="keyword">=</span> $Eff<span class="keyword">.</span>e0fftaglst_tr <span class="keyword">(</span>tags<span class="keyword">)</span>
      <span class="keyword">}</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>None<span class="comment">(*ofc*)</span><span class="keyword">,</span> Some efc<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
        <span class="keyword">val</span> efc <span class="keyword">=</span> <span class="keyword">(</span>
          <span class="keyword">if</span> is_prf <span class="keyword">then</span> $Eff<span class="keyword">.</span>EFFCSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> $Eff<span class="keyword">.</span>EFFCSTall <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">efc</span>
      <span class="keyword">}</span> <span class="comment">// end of [None]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">@(</span>Option funclo<span class="keyword">,</span> efcopt<span class="keyword">)</span></span>
<span class="comment">//
</span>  <span class="keyword">val</span> d1e_def <span class="keyword">=</span>
    d0exp_lams_dyn_tr <span class="keyword">(</span>
      LAMKINDifix <span class="keyword">(</span>loc<span class="keyword">)</span>
    <span class="keyword">,</span> None <span class="comment">(*oloc*)</span><span class="keyword">,</span> ofc<span class="keyword">,</span> 0 <span class="comment">(*lin*)</span>
    <span class="keyword">,</span> d<span class="keyword">.</span>f0undec_arg<span class="keyword">,</span> d<span class="keyword">.</span>f0undec_res<span class="keyword">,</span> oefc
    <span class="keyword">,</span> d<span class="keyword">.</span>f0undec_def
    <span class="keyword">)</span> <span class="comment">// end of [d0exp_lams_dyn_tr]
</span>  <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> is_rec <span class="keyword">then</span>
    termination_metric_check <span class="keyword">(</span>loc<span class="keyword">,</span> d1exp_is_metric d1e_def<span class="keyword">,</span> oefc<span class="keyword">)</span>
  <span class="comment">// end of [if]
</span><span class="comment">//
</span>  <span class="keyword">val</span> ann <span class="keyword">=</span> witht0ype_tr d<span class="keyword">.</span>f0undec_ann
<span class="comment">//
</span><span class="keyword">in</span>
  f1undec_make <span class="keyword">(</span>loc<span class="keyword">,</span> d<span class="keyword">.</span>f0undec_sym<span class="keyword">,</span> d<span class="keyword">.</span>f0undec_sym_loc<span class="keyword">,</span> d1e_def<span class="keyword">,</span> ann<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [f0undec_tr]
</span>
<span class="keyword">fun</span> f0undeclst_tr
  <span class="keyword">(</span>fk<span class="keyword">:</span> <span class="staexp">funkind</span><span class="keyword">,</span> ds<span class="keyword">:</span> <span class="staexp">f0undeclst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">f1undeclst</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> is_prf <span class="keyword">=</span> funkind_is_proof fk
  <span class="keyword">and</span> is_rec <span class="keyword">=</span> funkind_is_recursive fk
<span class="keyword">in</span>
  <span class="keyword">case+</span> ds <span class="keyword">of</span>
  <span class="keyword">|</span> d :: ds <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      f0undec_tr <span class="keyword">(</span>is_prf<span class="keyword">,</span> is_rec<span class="keyword">,</span> d<span class="keyword">)</span> :: f0undeclst_tr <span class="keyword">(</span>fk<span class="keyword">,</span> ds<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">(* end of [::] *)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [f0undeclst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> m0acdef_tr
  <span class="keyword">(</span>d<span class="keyword">:</span> <span class="staexp">m0acdef</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">m1acdef</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> def <span class="keyword">=</span> d0exp_tr d<span class="keyword">.</span>m0acdef_def
<span class="keyword">in</span>
  m1acdef_make <span class="keyword">(</span>
    d<span class="keyword">.</span>m0acdef_loc<span class="keyword">,</span> d<span class="keyword">.</span>m0acdef_sym<span class="keyword">,</span> d<span class="keyword">.</span>m0acdef_arg<span class="keyword">,</span> def
  <span class="keyword">)</span> <span class="comment">// end of [m1acdef_make]
</span><span class="keyword">end</span> <span class="comment">// end of [m0acdef_tr]
</span>
<span class="keyword">fn</span> m0acdeflst_tr
  <span class="keyword">(</span>ds<span class="keyword">:</span> <span class="staexp">m0acdeflst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">m1acdeflst</span> <span class="keyword">=</span>
  $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>ds<span class="keyword">,</span> m0acdef_tr<span class="keyword">)</span>
<span class="comment">// end of [m0acdeflst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> i0mpdec_tr
  <span class="keyword">(</span>d<span class="keyword">:</span> <span class="staexp">i0mpdec</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">i1mpdec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> d<span class="keyword">.</span>i0mpdec_loc
  <span class="keyword">val</span> qid <span class="keyword">=</span> d<span class="keyword">.</span>i0mpdec_qid
  <span class="keyword">val</span> tmparg <span class="keyword">=</span> t1mps0explstlst_tr qid<span class="keyword">.</span>impqi0de_arg
  <span class="keyword">val</span> s1ess <span class="keyword">=</span> aux tmparg <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>ts1ess<span class="keyword">:</span> <span class="staexp">tmps1explstlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s1explstlst</span> <span class="keyword">=</span> <span class="keyword">case+</span> ts1ess <span class="keyword">of</span>
      <span class="keyword">|</span> TMPS1EXPLSTLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> s1es<span class="keyword">,</span> ts1ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> list_cons <span class="keyword">(</span>s1es<span class="keyword">,</span> aux ts1ess<span class="keyword">)</span>
      <span class="keyword">|</span> TMPS1EXPLSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
    <span class="comment">// end of [aux]
</span>  <span class="keyword">}</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> def <span class="keyword">=</span>
    d0exp_lams_dyn_tr <span class="keyword">(</span>
      LAMKINDifix <span class="keyword">(</span>loc<span class="keyword">)</span>
    <span class="keyword">,</span> None<span class="comment">(*oloc*)</span><span class="keyword">,</span> None<span class="comment">(*ofc*)</span><span class="keyword">,</span> 0<span class="comment">(*lin*)</span>
    <span class="keyword">,</span> d<span class="keyword">.</span>i0mpdec_arg<span class="keyword">,</span> d<span class="keyword">.</span>i0mpdec_res<span class="keyword">,</span> None<span class="comment">(*oefc*)</span>
    <span class="keyword">,</span> d<span class="keyword">.</span>i0mpdec_def
    <span class="keyword">)</span> <span class="comment">// end of [d0exp_lams_dyn_tr]
</span>  <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  i1mpdec_make <span class="keyword">(</span>d<span class="keyword">.</span>i0mpdec_loc<span class="keyword">,</span> qid<span class="keyword">,</span> s1ess<span class="keyword">,</span> def<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [i0mpdec_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> guad0ec_tr
  <span class="keyword">(</span>knd<span class="keyword">:</span> <span class="staexp">srpifkind</span><span class="keyword">,</span> gd<span class="keyword">:</span> <span class="staexp">guad0ec</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1eclst</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>knd<span class="keyword">:</span> <span class="staexp">srpifkind</span><span class="keyword">,</span> gdn<span class="keyword">:</span> <span class="staexp">guad0ec_node</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1eclst</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> gdn <span class="keyword">of</span>
    <span class="keyword">|</span> GD0Cone <span class="keyword">(</span>e0xp<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval_if <span class="keyword">(</span>knd<span class="keyword">,</span> e0xp_tr e0xp<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> v1al_is_true v1al <span class="keyword">then</span> d0eclst_tr d0cs <span class="keyword">else</span> nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [GD0Cone]
</span>    <span class="keyword">|</span> GD0Ctwo <span class="keyword">(</span>e0xp<span class="keyword">,</span> d0cs_then<span class="keyword">,</span> d0cs_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval_if <span class="keyword">(</span>knd<span class="keyword">,</span> e0xp_tr e0xp<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> v1al_is_true v1al <span class="keyword">then</span> d0eclst_tr d0cs_then
        <span class="keyword">else</span> d0eclst_tr d0cs_else
      <span class="keyword">end</span> <span class="comment">// end of [GD0Ctwo]
</span>    <span class="keyword">|</span> GD0Ccons <span class="keyword">(</span>e0xp<span class="keyword">,</span> d0cs_then<span class="keyword">,</span> knd_elif<span class="keyword">,</span> gdn_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval_if <span class="keyword">(</span>knd<span class="keyword">,</span> e0xp_tr e0xp<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> v1al_is_true v1al <span class="keyword">then</span> d0eclst_tr d0cs_then
        <span class="keyword">else</span> loop <span class="keyword">(</span>knd_elif<span class="keyword">,</span> gdn_else<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [GD0Ccons]
</span>  <span class="comment">// end of [loop]
</span><span class="keyword">in</span>
  loop <span class="keyword">(</span>knd<span class="keyword">,</span> gd<span class="keyword">.</span>guad0ec_node<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [guad0ec_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> the_filenamelst_push_xit
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> filename<span class="keyword">:</span> <span class="staexp">fil_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">extern</span> <span class="keyword">castfn</span> <a name="45380"><span class="dyncstdec">__cast <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">$Loc<span class="keyword">.</span>location_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">$Fil<span class="keyword">.</span>location_t</span></span></a>
<span class="keyword">in</span>
 $Fil<span class="keyword">.</span>the_filenamelst_push_xit <span class="keyword">(</span>__cast loc0<span class="keyword">,</span> filename<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_filenamelst_push_xit]
</span>
<span class="comment">(* ****** ****** *)</span>
    
<span class="keyword">fn</span> i0nclude_tr <span class="keyword">(</span>
  loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> stadyn<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> filename<span class="keyword">:</span> <span class="staexp">fil_t</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1ec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    the_filenamelst_push_xit <span class="keyword">(</span>loc0<span class="keyword">,</span> filename<span class="keyword">)</span>
  <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> fullname <span class="keyword">=</span> $Fil<span class="keyword">.</span>filename_full filename
<span class="comment">(*
  val () = begin
    print "Including ["; print fullname; print "] starts."; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> flag <span class="keyword">=</span> $PM<span class="keyword">.</span>posmark_pause_get <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span><span class="comment">// HX-2010-04-27: prepare for posmarking
</span><span class="comment">//
</span>  <span class="keyword">val</span> pmstropt <span class="keyword">=</span> $PM<span class="keyword">.</span>posmark_xref_testnot_if <span class="keyword">(</span>fullname<span class="keyword">)</span>
  <span class="keyword">val</span> isposmark <span class="keyword">=</span> stropt_is_some pmstropt
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> isposmark <span class="keyword">then</span> <span class="keyword">begin</span>
    $PM<span class="keyword">.</span>posmark_push <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> $PM<span class="keyword">.</span>posmark_enable <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> d0cs <span class="keyword">=</span> $Par<span class="keyword">.</span>parse_from_filename <span class="keyword">(</span>stadyn<span class="keyword">,</span> filename<span class="keyword">)</span>
<span class="comment">//
</span><span class="comment">// HX-2010-04-27: perform for posmarking if needed
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> isposmark <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Syn<span class="keyword">.</span>d0eclst_posmark d0cs
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $PM<span class="keyword">.</span> posmark_file_make_htm <span class="keyword">(</span>fullname<span class="keyword">,</span> pmstropt<span class="keyword">)</span> <span class="keyword">in</span>
    $PM<span class="keyword">.</span>posmark_disable <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> $PM<span class="keyword">.</span>posmark_pop <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $PM<span class="keyword">.</span>posmark_resume_set <span class="keyword">(</span>flag<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "Including ["; print fullname; print "] finishes."; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> d1cs <span class="keyword">=</span> d0eclst_tr d0cs
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Fil<span class="keyword">.</span>the_filenamelst_pop <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// a loop is to be reported if it occurs
</span><span class="keyword">in</span>
  d1ec_include <span class="keyword">(</span>loc0<span class="keyword">,</span> d1cs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [i0nclude_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{^
//
static
ats_bool_type
ats_trans1_string_suffix_is_dats
  (ats_ptr_type s0) {
  char *s = strrchr (s0, '.') ;
  if (!s) return ats_false_bool ;
  if (strcmp (s, ".dats") != 0) return ats_false_bool ;
  return ats_true_bool ;
} // end of [ats_trans1_string_suffix_is_dats]
//
%}</span> <span class="comment">// end of [%{^]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="47148"><span class="dyncstdec">string_suffix_is_dats
  <span class="keyword">(</span>s<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span></a> <span class="keyword">=</span> "ats_trans1_string_suffix_is_dats"
<span class="comment">// end of [string_suffix_is_dats]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> s0taload_tr <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> idopt<span class="keyword">:</span> <span class="staexp">Option sym_t</span><span class="keyword">,</span> fil<span class="keyword">:</span> <span class="staexp">fil_t</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1ec</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> fullname <span class="keyword">=</span> $Fil<span class="keyword">.</span>filename_full fil
  <span class="keyword">val</span> oflagd1cs <span class="keyword">=</span> staload_file_search fullname
  <span class="keyword">var</span> loadflag<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 1
  <span class="keyword">val</span> d1cs <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> oflagd1cs <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>flagd1cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
        val () = begin
          printf ("The file [%s] is already loaded.", @(fullname));
          print_newline ()
        end // end of [val]
*)</span>
      <span class="keyword">in</span>
        loadflag := flagd1cs<span class="keyword">.</span>0<span class="keyword">;</span> flagd1cs<span class="keyword">.</span>1
      <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1cs <span class="keyword">where</span> <span class="keyword">{</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_filenamelst_push_xit <span class="keyword">(</span>loc0<span class="keyword">,</span> fil<span class="keyword">)</span>
        <span class="keyword">val</span> flag <span class="keyword">=</span> <span class="keyword">(</span>
          <span class="keyword">if</span> string_suffix_is_dats fullname <span class="keyword">then</span> 1<span class="comment">(*dyn*)</span> <span class="keyword">else</span> 0<span class="comment">(*sta*)</span>
        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span><span class="comment">// HX-2010-04-27: prepare for posmarking
</span><span class="comment">//
</span>        <span class="keyword">val</span> pmstropt <span class="keyword">=</span> $PM<span class="keyword">.</span>posmark_xref_testnot_if <span class="keyword">(</span>fullname<span class="keyword">)</span>
        <span class="keyword">val</span> isposmark <span class="keyword">=</span> stropt_is_some pmstropt
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> isposmark <span class="keyword">then</span> <span class="keyword">begin</span>
          $PM<span class="keyword">.</span>posmark_push <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> $PM<span class="keyword">.</span>posmark_enable <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>        <span class="keyword">val</span> d0cs <span class="keyword">=</span> $Par<span class="keyword">.</span>parse_from_filename <span class="keyword">(</span>flag<span class="keyword">,</span> fil<span class="keyword">)</span>
<span class="comment">//
</span><span class="comment">// HX-2010-04-27: perform for posmarking if needed
</span><span class="comment">//
</span>        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> isposmark <span class="keyword">then</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Syn<span class="keyword">.</span>d0eclst_posmark d0cs
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $PM<span class="keyword">.</span> posmark_file_make_htm <span class="keyword">(</span>fullname<span class="keyword">,</span> pmstropt<span class="keyword">)</span> <span class="keyword">in</span>
          $PM<span class="keyword">.</span>posmark_disable <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> $PM<span class="keyword">.</span>posmark_pop <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span><span class="comment">(*
        val () = begin
          printf ("Translating [%s] begins.", @(fullname));
          print_newline ()
        end // end of [val]
*)</span>
<span class="comment">//
</span>        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_save <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span>        <span class="keyword">val</span> d1cs <span class="keyword">=</span> d0eclst_tr d0cs
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span>
          the_e1xpenv_find <span class="keyword">(</span>$Sym<span class="keyword">.</span>symbol_ATS_STALOADFLAG<span class="keyword">)</span> <span class="keyword">of</span>
          <span class="keyword">|</span> <span class="keyword">~</span>Some_vt e1xp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval <span class="keyword">(</span>e1xp<span class="keyword">)</span> <span class="keyword">in</span>
            <span class="keyword">if</span> v1al_is_false v1al <span class="keyword">then</span> loadflag := 0
          <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>          <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// the default value
</span>        <span class="comment">// end of [val]
</span><span class="comment">//
</span>        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_restore <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">(*
        val () = begin
          printf ("Translating [%s] ends.", @(fullname));
          print_newline ()
        end // end of [val]
*)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Fil<span class="keyword">.</span>the_filenamelst_pop <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// a loop is to be reported if it occurs
</span>        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> staload_file_insert <span class="keyword">(</span>fullname<span class="keyword">,</span> loadflag<span class="keyword">,</span> d1cs<span class="keyword">)</span>
      <span class="keyword">}</span> <span class="comment">// end of [None_vt]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d1eclst</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  d1ec_staload <span class="keyword">(</span>loc0<span class="keyword">,</span> idopt<span class="keyword">,</span> fil<span class="keyword">,</span> 0<span class="comment">(*loaded*)</span><span class="keyword">,</span> loadflag<span class="keyword">,</span> d1cs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s0taload_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
d0ec_tr d0c0 <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d0c0<span class="keyword">.</span>d0ec_node <span class="keyword">of</span>
  <span class="keyword">|</span> D0Cfixity <span class="keyword">(</span>f0xty<span class="keyword">,</span> ids<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d0ec_fixity_tr <span class="keyword">(</span>f0xty<span class="keyword">,</span> ids<span class="keyword">)</span><span class="keyword">;</span> d1ec_none <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cfixity]
</span>  <span class="keyword">|</span> D0Cnonfix ids <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d0ec_nonfix_tr ids<span class="keyword">;</span> d1ec_none <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cnonfix]
</span>  <span class="keyword">|</span> D0Csymintr ids <span class="keyword">=&gt;</span> d1ec_symintr <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> ids<span class="keyword">)</span>
  <span class="keyword">|</span> D0Ce0xpdef <span class="keyword">(</span>id<span class="keyword">,</span> def<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc <span class="keyword">=</span> d0c0<span class="keyword">.</span>d0ec_loc
      <span class="keyword">val</span> def <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> def <span class="keyword">of</span>
        <span class="keyword">|</span> Some e0xp <span class="keyword">=&gt;</span> e0xp_tr e0xp <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> e1xp_none <span class="keyword">(</span>loc<span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">e1xp</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      the_e1xpenv_add <span class="keyword">(</span>id<span class="keyword">,</span> def<span class="keyword">)</span><span class="keyword">;</span> d1ec_e1xpdef <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">,</span> def<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ce0xpdef]
</span>  <span class="keyword">|</span> D0Ce0xpundef <span class="keyword">(</span>id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc <span class="keyword">=</span> d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">;</span> <span class="keyword">val</span> def <span class="keyword">=</span> e1xp_undef <span class="keyword">(</span>loc<span class="keyword">)</span>
    <span class="keyword">in</span>
      the_e1xpenv_add <span class="keyword">(</span>id<span class="keyword">,</span> def<span class="keyword">)</span><span class="keyword">;</span> d1ec_e1xpdef <span class="keyword">(</span>loc<span class="keyword">,</span> id<span class="keyword">,</span> def<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ce0xpundef]
</span>  <span class="keyword">|</span> D0Ce0xpact <span class="keyword">(</span>actkind<span class="keyword">,</span> e0xp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> e1xp <span class="keyword">=</span> e0xp_tr e0xp
<span class="comment">(*
      val () = begin
        print "d0ec_tr: D0Ce0xpact: e1xp = "; print e1xp; print_newline ()
      end // end of [val]
*)</span>
      <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval e1xp
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> actkind <span class="keyword">of</span>
        <span class="keyword">|</span> E0XPACTassert <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
            do_e0xpact_assert <span class="keyword">(</span>e0xp<span class="keyword">.</span>e0xp_loc<span class="keyword">,</span> v1al<span class="keyword">)</span>
        <span class="keyword">|</span> E0XPACTerror <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
            do_e0xpact_error <span class="keyword">(</span>e0xp<span class="keyword">.</span>e0xp_loc<span class="keyword">,</span> v1al<span class="keyword">)</span>
        <span class="keyword">|</span> E0XPACTprint <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> do_e0xpact_prerr v1al
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      d1ec_none <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Ce0xpact]
</span>  <span class="keyword">|</span> D0Cdatsrts <span class="keyword">(</span>para<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> d0atsrtdec_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> d0atsrtdeclst_tr d0cs
    <span class="keyword">in</span>
      d1ec_datsrts <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> para<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cdatsrts]
</span>  <span class="keyword">|</span> D0Csrtdefs <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> s0rtdef_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> s0rtdeflst_tr d0cs
    <span class="keyword">in</span>
      d1ec_srtdefs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Csrtdefs]
</span>  <span class="keyword">|</span> D0Cstacons <span class="keyword">(</span>impsrt<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> s0tacon_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> s0taconlst_tr d0cs
    <span class="keyword">in</span>
      d1ec_stacons <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> impsrt<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cstacons]
</span>  <span class="keyword">|</span> D0Cstacsts <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> s0tacst_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> s0tacstlst_tr d0cs
    <span class="keyword">in</span>
      d1ec_stacsts <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cstacsts]
</span>  <span class="keyword">|</span> D0Cstavars <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> s0tavar_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> s0tavarlst_tr d0cs
    <span class="keyword">in</span>
      d1ec_stavars <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cstavars]
</span>  <span class="keyword">|</span> D0Csexpdefs <span class="keyword">(</span>os0t<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> os1t <span class="keyword">=</span> s0rtopt_tr os0t
      <span class="keyword">val</span> d1c <span class="keyword">=</span> s0expdef_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> s0expdeflst_tr d0cs
    <span class="keyword">in</span>
      d1ec_sexpdefs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> os1t<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Csexpdefs]
</span>  <span class="keyword">|</span> D0Csaspdec <span class="keyword">(</span>d0c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1ec_saspdec <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> s0aspdec_tr d0c<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Csaspdec]
</span>  <span class="keyword">|</span> D0Cdcstdecs <span class="keyword">(</span>dck<span class="keyword">,</span> s0qss<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> isfun <span class="keyword">=</span> dcstkind_is_fun dck
      <span class="keyword">and</span> isprf <span class="keyword">=</span> dcstkind_is_proof dck
      <span class="keyword">val</span> s1qss <span class="keyword">=</span> s0qualstlst_tr s0qss
      <span class="keyword">val</span> d1c <span class="keyword">=</span> d0cstdec_tr <span class="keyword">(</span>isfun<span class="keyword">,</span> isprf<span class="keyword">,</span> d0c<span class="keyword">)</span>
      <span class="keyword">and</span> d1cs <span class="keyword">=</span> d0cstdeclst_tr <span class="keyword">(</span>isfun<span class="keyword">,</span> isprf<span class="keyword">,</span> d0cs<span class="keyword">)</span>
    <span class="keyword">in</span>
      d1ec_dcstdecs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> dck<span class="keyword">,</span> s1qss<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cdcstdecs]
</span>  <span class="keyword">|</span> D0Cdatdecs <span class="keyword">(</span>dk<span class="keyword">,</span> d0c1<span class="keyword">,</span> d0cs1<span class="keyword">,</span> d0cs2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c1 <span class="keyword">=</span> d0atdec_tr d0c1 <span class="keyword">and</span> d1cs1 <span class="keyword">=</span> d0atdeclst_tr d0cs1
      <span class="keyword">val</span> d1cs2 <span class="keyword">=</span> s0expdeflst_tr d0cs2
    <span class="keyword">in</span>
      d1ec_datdecs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> dk<span class="keyword">,</span> d1c1 :: d1cs1<span class="keyword">,</span> d1cs2<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cdatdecs]
</span>  <span class="keyword">|</span> D0Cexndecs <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> e0xndec_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> e0xndeclst_tr d0cs
    <span class="keyword">in</span>
      d1ec_exndecs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cexndecs]
</span>  <span class="keyword">|</span> D0Cclassdec <span class="keyword">(</span>id<span class="keyword">,</span> sup<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sup <span class="keyword">=</span> s0expopt_tr <span class="keyword">(</span>sup<span class="keyword">)</span> <span class="keyword">in</span>
      d1ec_classdec <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> id<span class="keyword">,</span> sup<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cclassdec]
</span>  <span class="keyword">|</span> D0Coverload <span class="keyword">(</span>id<span class="keyword">,</span> qid<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1ec_overload <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> id<span class="keyword">,</span> qid<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Coverload]
</span>  <span class="keyword">|</span> D0Cextype <span class="keyword">(</span>name<span class="keyword">,</span> s0e_def<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1ec_extype <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> name<span class="keyword">,</span> s0exp_tr s0e_def<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cextype]
</span>  <span class="keyword">|</span> D0Cextval <span class="keyword">(</span>name<span class="keyword">,</span> d0e_def<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1ec_extval <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> name<span class="keyword">,</span> d0exp_tr d0e_def<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cextval]
</span>  <span class="keyword">|</span> D0Cextcode <span class="keyword">(</span>position<span class="keyword">,</span> code<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1ec_extcode <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> position<span class="keyword">,</span> code<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cextcode]
</span>  <span class="keyword">|</span> D0Cvaldecs <span class="keyword">(</span>valknd<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> v0aldec_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> v0aldeclst_tr d0cs
    <span class="keyword">in</span>
      d1ec_valdecs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> valknd<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cvaldecs]
</span>  <span class="keyword">|</span> D0Cvaldecs_par <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> v0aldec_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> v0aldeclst_tr d0cs
    <span class="keyword">in</span>
      d1ec_valdecs_par <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cvaldecs_par]
</span>  <span class="keyword">|</span> D0Cvaldecs_rec <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> v0aldec_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> v0aldeclst_tr d0cs
    <span class="keyword">in</span>
      d1ec_valdecs_rec <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cvaldecs_rec]
</span>  <span class="keyword">|</span> D0Cfundecs <span class="keyword">(</span>funkind<span class="keyword">,</span> s0qss<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s1qss <span class="keyword">=</span> s0qualstlst_tr s0qss
      <span class="keyword">val</span> d1cs <span class="keyword">=</span> f0undeclst_tr <span class="keyword">(</span>funkind<span class="keyword">,</span> d0c :: d0cs<span class="keyword">)</span>
    <span class="keyword">in</span>
      d1ec_fundecs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> funkind<span class="keyword">,</span> s1qss<span class="keyword">,</span> d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cfundecs]
</span>  <span class="keyword">|</span> D0Cvardecs <span class="keyword">(</span>d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1c <span class="keyword">=</span> v0ardec_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> v0ardeclst_tr d0cs
    <span class="keyword">in</span>
      d1ec_vardecs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cvardecs]
</span>  <span class="keyword">|</span> D0Cmacdefs <span class="keyword">(</span>knd<span class="keyword">,</span> d0c<span class="keyword">,</span> d0cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="comment">// knd: 0/1/2 =&gt; short/long/long rec
</span>      <span class="keyword">val</span> d1c <span class="keyword">=</span> m0acdef_tr d0c <span class="keyword">and</span> d1cs <span class="keyword">=</span> m0acdeflst_tr d0cs
    <span class="keyword">in</span>
      d1ec_macdefs <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> knd<span class="keyword">,</span> d1c :: d1cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cmacdefs]
</span>  <span class="keyword">|</span> D0Cimpdec <span class="keyword">(</span>i0mparg<span class="keyword">,</span> d0c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> i1mparg <span class="keyword">=</span> s0arglstlst_tr i0mparg
    <span class="keyword">in</span>
      d1ec_impdec <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> i1mparg<span class="keyword">,</span> i0mpdec_tr d0c<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cimpdec]
</span>  <span class="keyword">|</span> D0Cdynload <span class="keyword">(</span>name<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> filename <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span>
        $Fil<span class="keyword">.</span>filenameopt_make_relative name <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt filename <span class="keyword">=&gt;</span> filename <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error1 d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">;</span>
            prerr ": the file ["<span class="keyword">;</span>
            prerr name<span class="keyword">;</span>
            prerr "] is not available for dynamic loading"<span class="keyword">;</span>
            prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>fil_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">fil_t</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      d1ec_dynload <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> filename<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cdynload]
</span>  <span class="keyword">|</span> D0Cstaload <span class="keyword">(</span>idopt<span class="keyword">,</span> name<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> filename <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span>
        $Fil<span class="keyword">.</span>filenameopt_make_relative name <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt filename <span class="keyword">=&gt;</span> filename
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error1 d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">;</span>
            prerr ": the file ["<span class="keyword">;</span>
            prerr name<span class="keyword">;</span>
            prerr "] is not available for static loading"<span class="keyword">;</span>
            prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>fil_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">fil_t</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      s0taload_tr <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> idopt<span class="keyword">,</span> filename<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cstaload]
</span>  <span class="keyword">|</span> D0Clocal <span class="keyword">(</span>d0cs_head<span class="keyword">,</span> d0cs_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_inc <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d1cs_head <span class="keyword">=</span> d0eclst_tr d0cs_head
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_level_dec <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d1cs_body <span class="keyword">=</span> d0eclst_tr d0cs_body
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans1_env_localjoin <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d1ec_local <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> d1cs_head<span class="keyword">,</span> d1cs_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Clocal]
</span>  <span class="keyword">|</span> D0Cguadec <span class="keyword">(</span>knd<span class="keyword">,</span> gd0c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1ec_list <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> guad0ec_tr <span class="keyword">(</span>knd<span class="keyword">,</span> gd0c<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cguadec]
</span>  <span class="keyword">|</span> D0Cinclude <span class="keyword">(</span>stadyn<span class="keyword">,</span> name<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> filename <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span>
        $Fil<span class="keyword">.</span>filenameopt_make_relative name <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt filename <span class="keyword">=&gt;</span> filename
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error1 d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">;</span>
            prerr ": the file ["<span class="keyword">;</span>
            prerr name<span class="keyword">;</span>
            prerr "] is not available for inclusion"<span class="keyword">;</span>
            prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>fil_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">fil_t</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      i0nclude_tr <span class="keyword">(</span>d0c0<span class="keyword">.</span>d0ec_loc<span class="keyword">,</span> stadyn<span class="keyword">,</span> filename<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D0Cinclude]
</span><span class="comment">(*
  | _ =&gt; begin
      prerr_loc_interror d0c0.d0ec_loc;
      prerr ": not available yet."; prerr_newline ();
      $Err.abort {d1ec} ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [d0ec_tr]
</span>
<span class="comment">// [$Lst.list_map_fun] is tail-recursive!
</span><span class="keyword">implement</span>
d0eclst_tr <span class="keyword">(</span>d0cs<span class="keyword">)</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>d0cs<span class="keyword">,</span> d0ec_tr<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
initialize <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Glo<span class="keyword">.</span>atsopt_dynloadflag_set <span class="keyword">(</span>1<span class="keyword">)</span> <span class="comment">// [1] is the default value
</span><span class="keyword">}</span> <span class="comment">// end of [initialize]
</span>
<span class="keyword">implement</span>
finalize <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux_atsccomp_namespace <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux_atsccomp_namespace <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> the_e1xpenv_find <span class="keyword">(</span>$Sym<span class="keyword">.</span>symbol_ATSCCOMP_NAMESPACE<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt e1xp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval <span class="keyword">(</span>e1xp<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">case+</span> v1al <span class="keyword">of</span>
        <span class="keyword">|</span> V1ALstring s <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> s <span class="keyword">=</span> string1_of_string s <span class="keyword">in</span>
            $Glo<span class="keyword">.</span>atsccomp_namespace_set <span class="keyword">(</span>stropt_some s<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [V1ALstring]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error1 e1xp<span class="keyword">.</span>e1xp_loc<span class="keyword">;</span>
            prerr ": a string definition is required for [ATSCCOMP_NAMESPACE]."<span class="keyword">;</span>
            prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// use the default value
</span>    <span class="keyword">end</span> <span class="comment">// end of [aux_atsccomp_namespace]
</span>  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux_dynloadflag <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux_dynloadflag <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> the_e1xpenv_find <span class="keyword">(</span>$Sym<span class="keyword">.</span>symbol_ATS_DYNLOADFLAG<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt e1xp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval <span class="keyword">(</span>e1xp<span class="keyword">)</span>
        <span class="keyword">val</span> flag <span class="keyword">=</span> <span class="keyword">if</span> v1al_is_true v1al <span class="keyword">then</span> 1 <span class="keyword">else</span> 0
      <span class="keyword">in</span>
        $Glo<span class="keyword">.</span>atsopt_dynloadflag_set <span class="keyword">(</span>flag<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// use the default value
</span>    <span class="keyword">end</span> <span class="comment">// end of [aux_dynloadflag]
</span>  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux_dynloadfun_name <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux_dynloadfun_name <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ans <span class="keyword">=</span> the_e1xpenv_find <span class="keyword">(</span>$Sym<span class="keyword">.</span>symbol_ATS_DYNLOADFUN_NAME<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> ans <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt e1xp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> v1al <span class="keyword">=</span> e1xp_eval <span class="keyword">(</span>e1xp<span class="keyword">)</span> <span class="keyword">in</span> <span class="keyword">case+</span> v1al <span class="keyword">of</span>
          <span class="keyword">|</span> V1ALstring s <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> s <span class="keyword">=</span> string1_of_string s
            <span class="keyword">in</span>
              $Glo<span class="keyword">.</span>atsopt_dynloadfun_name_set <span class="keyword">(</span>stropt_some s<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [V1ALstring]
</span>          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              prerr_loc_error1 e1xp<span class="keyword">.</span>e1xp_loc<span class="keyword">;</span>
              prerr ": a string definition is required for [ATS_DYNLOADFUN_NAME]."<span class="keyword">;</span>
              prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// use the default value
</span>    <span class="keyword">end</span> <span class="comment">// end of [aux_dynloadfun_name]
</span>  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span><span class="keyword">}</span> <span class="comment">// end of [finalize]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_trans1_dyn.dats] *)</span>
</pre>
</body>
</html>
