<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: December 2007
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="comment">(* Mainly for handling dynamic expressions during type-checking *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Deb <span class="keyword">=</span> "ats_debug.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Eff <span class="keyword">=</span> "ats_effect.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Loc <span class="keyword">=</span> "ats_location.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lst <span class="keyword">=</span> "ats_list.sats"</span>
<span class="keyword">staload</span> <span class="staexp">SOL <span class="keyword">=</span> "ats_staexp2_solve.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Syn <span class="keyword">=</span> "ats_syntax.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">MAC <span class="keyword">=</span> "ats_macro2.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_stadyncst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_patcst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp3.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_trans3_env.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_trans3.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">nil list_nil</span>
<span class="keyword">#define</span> <span class="neuexp">cons list_cons</span>
<span class="keyword">#define</span> <span class="neuexp">:: list_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">THISFILENAME "ats_trans3_exp_up.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> $Loc<span class="keyword">.</span>prerr_location</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> prerr_loc_error3 <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
  <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2738"><span class="dyncstuse">$Loc<span class="keyword">.</span>prerr_location</span></a> loc<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">)</span>
<span class="comment">// end of [prerr_loc_error3]
</span>
<span class="keyword">fn</span> prerr_interror <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr "INTERNAL ERROR (ats_trans3_exp_up)"

<span class="keyword">fn</span> prerr_loc_interror <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2738"><span class="dyncstuse">$Loc<span class="keyword">.</span>prerr_location</span></a> loc<span class="keyword">;</span> prerr ": INTERNAL ERROR (ats_trans3_exp_up)"
<span class="keyword">end</span> <span class="comment">// end of [prerr_loc_interror]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// typedef funclo =  $Syn.funclo // declared in [ats_trans3.sats]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> pfarity_check_fun
  <span class="keyword">(</span>loc_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> npf_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">if</span> npf_fun <span class="keyword">=</span> npf <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    prerr_loc_error3 loc_fun<span class="keyword">;</span>
    prerr ": the proof arity of the function is ["<span class="keyword">;</span>
    prerr npf_fun<span class="keyword">;</span>
    prerr "] but it is expected to be ["<span class="keyword">;</span>
    prerr npf<span class="keyword">;</span>
    prerr "]."<span class="keyword">;</span>
    <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="comment">// end of [pfarity_check_fun]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2lab_tr_up <span class="keyword">(</span>d2l<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21252"><span class="stacstuse">d2lab</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11259"><span class="stacstuse">d3lab0</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> d2l<span class="keyword">.</span>d2lab_node <span class="keyword">of</span>
  <span class="keyword">|</span> D2LABind d2ess <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19696"><span class="dyncstuse">d3lab0_ind</span></a> <span class="keyword">(</span>d2l<span class="keyword">.</span>d2lab_loc<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4996"><span class="dyncstuse">d2explstlst_tr_up</span></a> d2ess<span class="keyword">)</span>
  <span class="keyword">|</span> D2LABlab l <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19650"><span class="dyncstuse">d3lab0_lab</span></a> <span class="keyword">(</span>d2l<span class="keyword">.</span>d2lab_loc<span class="keyword">,</span> l<span class="keyword">)</span>
<span class="comment">// end of [d2lab_tr_up]
</span>
<span class="keyword">fun</span> d2lablst_tr_up
  <span class="keyword">(</span>d2ls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21331"><span class="stacstuse">d2lablst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11343"><span class="stacstuse">d3lab0lst</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> d2ls <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>d2l<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      list_cons <span class="keyword">(</span>d2lab_tr_up d2l<span class="keyword">,</span> d2lablst_tr_up d2ls<span class="keyword">)</span>
    <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [d2lablst_tr_up]
</span>
<span class="keyword">fun</span> s2lab0lst_of_d3lab0lst <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>n<span class="keyword">&gt;.</span></span>
  <span class="keyword">(</span>d3ls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21858"><span class="stacstuse">list</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11259"><span class="stacstuse">d3lab0</span></a><span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21858"><span class="stacstuse">list</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1865"><span class="stacstuse">s2lab</span></a><span class="keyword">,</span> n<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d3ls <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>d3l<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2l <span class="keyword">=</span> <span class="keyword">case+</span> d3l<span class="keyword">.</span>d3lab0_node <span class="keyword">of</span>
        <span class="keyword">|</span> D3LAB0ind <span class="keyword">(</span>d3ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> S2LAB0ind <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2943"><span class="dyncstuse">d3explstlst_ind_get</span></a> d3ess<span class="keyword">)</span>
        <span class="keyword">|</span> D3LAB0lab l <span class="keyword">=&gt;</span> S2LAB0lab l
    <span class="keyword">in</span>
      list_cons <span class="keyword">(</span>s2l<span class="keyword">,</span> s2lab0lst_of_d3lab0lst d3ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2lab0lst_of_d3lab0lst]
</span>
<span class="comment">(*
//
// HX-2010-11-01: why is this commented out?
//
fun s2lab1lst_of_d3lab1lst {n:nat} .&lt;n&gt;.
  (d3ls: list (d3lab1, n)): list (s2lab, n) = begin
  case+ d3ls of
  | list_cons (d3l, d3ls) =&gt; let
      val s2l = case+ d3l.d3lab1_node of
        | D3LAB1ind (d3ess, s2e) =&gt; S2LAB1ind (d3explstlst_ind_get d3ess, s2e)
        | D3LAB1lab (l, s2e) =&gt; S2LAB1lab (l, s2e)
    in
      list_cons (s2l, s2lab1lst_of_d3lab1lst d3ls)
    end // end of [cons]
  | list_nil () =&gt; list_nil ()
end // end of [s2lab2lst_of_d3lab1lst]

*)</span>

<span class="keyword">fun</span> d3lab1lst_of_d3lab0lst_s2lablst
  <span class="keyword">(</span>d3ls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11343"><span class="stacstuse">d3lab0lst</span></a></span><span class="keyword">,</span> s2ls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1894"><span class="stacstuse">s2lablst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11456"><span class="stacstuse">d3lab1lst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>d3ls<span class="keyword">,</span> s2ls<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>list_cons <span class="keyword">(</span>d3l<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">,</span> list_cons <span class="keyword">(</span>s2l<span class="keyword">,</span> s2ls<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3l_new <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d3l<span class="keyword">.</span>d3lab0_node <span class="keyword">of</span>
        <span class="keyword">|</span> D3LAB0ind d3ess <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2l <span class="keyword">of</span>
          <span class="keyword">|</span> S2LAB1ind <span class="keyword">(</span>_<span class="keyword">,</span> s2e_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19807"><span class="dyncstuse">d3lab1_ind</span></a> <span class="keyword">(</span>d3l<span class="keyword">.</span>d3lab0_loc<span class="keyword">,</span> d3ess<span class="keyword">,</span> s2e_elt<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [S2LAB1ind]
</span>          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              prerr ": d3lab1lst_of_d3lab0lst_s2lablst: D3LAB0ind"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11372"><span class="stacstuse">d3lab1</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [_]
</span>          <span class="keyword">end</span> <span class="comment">(* end of [D3LAB0ind] *)</span>
        <span class="keyword">|</span> D3LAB0lab l <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2l <span class="keyword">of</span>
          <span class="keyword">|</span> S2LAB1lab <span class="keyword">(</span>l<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19749"><span class="dyncstuse">d3lab1_lab</span></a> <span class="keyword">(</span>d3l<span class="keyword">.</span>d3lab0_loc<span class="keyword">,</span> l<span class="keyword">,</span> s2e<span class="keyword">)</span>
          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              prerr ": d3lab1lst_of_d3lab0lst_s2lablst: D3LAB0lab: s2l = "<span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#25356"><span class="dyncstuse">prerr_s2lab</span></a> s2l<span class="keyword">;</span>
              <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11372"><span class="stacstuse">d3lab1</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [_]
</span>          <span class="keyword">end</span> <span class="comment">(* end of [D3LAB0lab] *)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11372"><span class="stacstuse">d3lab1</span></a></span>
    <span class="keyword">in</span>
      list_cons <span class="keyword">(</span>d3l_new<span class="keyword">,</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls<span class="keyword">,</span> s2ls<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons, cons]
</span>  <span class="keyword">|</span> <span class="keyword">(</span>list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": d3lab1lst_of_d3lab0lst_s2lablst: length mismatch"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_, _]
</span><span class="keyword">end</span> <span class="comment">// end of [d3lab1lst_of_d3lab0lst_s2lablst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d3exp_clo_restore <span class="keyword">(</span>d3e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_loc
  <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_typ
  <span class="keyword">var</span> fc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#15340"><span class="stacstuse">$Syn<span class="keyword">.</span>funclo</span></a></span> <span class="keyword">=</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> s2e_fun_new <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> s2e_fun<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Efun <span class="keyword">(</span>fc<span class="keyword">,</span> lin<span class="keyword">,</span> s2fe<span class="keyword">,</span> npf<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2e_res<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fc0 := fc <span class="keyword">in</span> <span class="keyword">case+</span> lin <span class="keyword">of</span>
        <span class="keyword">|</span> _ <span class="keyword">when</span> lin <span class="keyword">=</span> 1 <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30327"><span class="dyncstuse">s2exp_fun_srt</span></a>
            <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10291"><span class="dyncstuse">s2rt_type</span></a><span class="keyword">,</span> fc<span class="keyword">,</span> ~1<span class="comment">(*topized*)</span><span class="keyword">,</span> s2fe<span class="keyword">,</span> npf<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2e_res<span class="keyword">)</span>
        <span class="keyword">|</span> _ <span class="keyword">when</span> lin <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s2e_fun
        <span class="keyword">|</span> _ <span class="comment">(* lin = ~1 *)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error3 loc<span class="keyword">;</span>
            prerr ": a linear function cannot be applied repeatedly."<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_interror loc<span class="keyword">;</span>
        prerr ": d3exp_clo_restore: s2e_fun = "<span class="keyword">;</span> prerr s2e_fun<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val s2e_fun_new]
</span>  <span class="keyword">val</span> refval <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> fc0 <span class="keyword">of</span>
    <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOclo knd <span class="keyword">=&gt;</span> <span class="keyword">if</span> knd <span class="keyword">=</span> 0 <span class="keyword">then</span> 1 <span class="keyword">else</span> 0 <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> 0
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="comment">// end of [val refval]
</span>  <span class="keyword">val</span> freeknd <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4637"><span class="dyncstuse">d3exp_lval_typ_set_arg</span></a> <span class="keyword">(</span>refval<span class="keyword">,</span> d3e<span class="keyword">,</span> s2e_fun_new<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18145"><span class="dyncstuse">d3exp_refarg</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e_fun_new<span class="keyword">,</span> refval<span class="keyword">,</span> freeknd<span class="keyword">,</span> d3e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d3exp_clo_restore]
</span>
<span class="comment">//
</span>
<span class="keyword">#define</span> <span class="neuexp">CLO 0</span><span class="keyword">;</span> <span class="keyword">#define</span> <span class="neuexp">CLOPTR 1</span><span class="keyword">;</span> <span class="keyword">#define</span> <span class="neuexp">CLOREF ~1</span>

<span class="comment">//
</span>
<span class="keyword">fn</span> d3exp_funclo_restore
  <span class="keyword">(</span>fc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#15340"><span class="stacstuse">$Syn<span class="keyword">.</span>funclo</span></a></span><span class="keyword">,</span> d3e_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> fc <span class="keyword">of</span>
  <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOclo knd <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="comment">// knd: 1/0/~1: ptr/clo/ref
</span>      <span class="keyword">if</span> knd &gt;= CLO <span class="keyword">then</span> d3exp_clo_restore d3e_fun <span class="keyword">else</span> d3e_fun
    <span class="keyword">end</span> <span class="comment">// end of [FUNCLOclo]
</span>  <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d3e_fun
<span class="keyword">end</span> <span class="comment">(* end of [d3exp_funclo_restore] *)</span>

<span class="comment">//
</span>
<span class="keyword">fun</span> d3explst_arg_restore
  <span class="keyword">(</span>d3es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span><span class="keyword">,</span> wths2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8597"><span class="stacstuse">wths2explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> wths2es <span class="keyword">of</span>
  <span class="keyword">|</span> WTHS2EXPLSTcons_some <span class="keyword">(</span>refval<span class="keyword">,</span> s2e_res<span class="keyword">,</span> wths2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = assert_errmsg_bool1 (
        $Lst.list_is_cons d3es, "INTERAL ERROR: ats_trans3_exp: d3explst_arg_restore"
      ) // end of assert_errmsg
*)</span>
      <span class="keyword">val-</span> list_cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=</span> d3es
      <span class="keyword">val</span> loc <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_loc
      <span class="keyword">val</span> s2e_res <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11511"><span class="dyncstuse">s2exp_opnexi_and_add</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e_res<span class="keyword">)</span>
<span class="comment">(*
      val () = begin
        print "d3explst_arg_restore: d3e = "; print d3e; print_newline ();
        print "d3explst_arg_restore: d3e.typ = "; print d3e.d3exp_typ; print_newline ();
        print "d3explst_arg_restore: s2e_res = "; print s2e_res; print_newline ();
      end // end of [val]
*)</span>
      <span class="keyword">val</span> freeknd <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4637"><span class="dyncstuse">d3exp_lval_typ_set_arg</span></a> <span class="keyword">(</span>refval<span class="keyword">,</span> d3e<span class="keyword">,</span> s2e_res<span class="keyword">)</span>
      <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18145"><span class="dyncstuse">d3exp_refarg</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2e_res<span class="keyword">,</span> refval<span class="keyword">,</span> freeknd<span class="keyword">,</span> d3e<span class="keyword">)</span>
    <span class="keyword">in</span>
      list_cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3explst_arg_restore <span class="keyword">(</span>d3es<span class="keyword">,</span> wths2es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [WTHS2EXPLSTcons_some]
</span>  <span class="keyword">|</span> WTHS2EXPLSTcons_none wths2es <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = assert_errmsg_bool1 (
        $Lst.list_is_cons d3es, "INTERAL ERROR: ats_trans3_exp: d3explst_arg_restore"
      ) // end of assert_errmsg
*)</span>
      <span class="keyword">val-</span> list_cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=</span> d3es
    <span class="keyword">in</span>
      list_cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3explst_arg_restore <span class="keyword">(</span>d3es<span class="keyword">,</span> wths2es<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [WTHS2EXPLSTcons_none]
</span>  <span class="keyword">|</span> WTHS2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d3explst_arg_restore]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datatype</span> <span class="staexp"><a name="9154"><span class="stacstdec">d23exp</span></a></span> <span class="keyword">=</span> D23Ed2exp <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span> <span class="keyword">|</span> D23Ed3exp <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="9211"><span class="stacstdec">d23explst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9154"><span class="stacstuse">d23exp</span></a></span></a></span>

<span class="keyword">fun</span> d23explst_tr_up <span class="keyword">(</span>d23es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9211"><span class="stacstuse">d23explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d23es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d23e<span class="keyword">,</span> d23es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3e <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d23e <span class="keyword">of</span>
        <span class="keyword">|</span> D23Ed2exp d2e <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e <span class="keyword">|</span> D23Ed3exp d3e <span class="keyword">=&gt;</span> d3e
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span>
    <span class="keyword">in</span>
      cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d23explst_tr_up d23es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span><span class="keyword">end</span> <span class="comment">// end of [d23explst_tr_up]
</span>
<span class="keyword">fn</span> d23explst_tr_dn <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d23es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9211"><span class="stacstuse">d23explst</span></a></span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1713"><span class="stacstuse">s2explst</span></a> n</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11070"><span class="stacstuse">d3explst</span></a> n</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
    <span class="keyword">(</span>d23es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21858"><span class="stacstuse">list</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9154"><span class="stacstuse">d23exp</span></a><span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1713"><span class="stacstuse">s2explst</span></a> n</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11070"><span class="stacstuse">d3explst</span></a> n</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d23es <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>d23e<span class="keyword">,</span> d23es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val+</span> cons <span class="keyword">(</span>s2e<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=</span> s2es
        <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#31237"><span class="dyncstuse">un_s2exp_refarg_arg</span></a> s2e
        <span class="keyword">val</span> d3e <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d23e <span class="keyword">of</span>
          <span class="keyword">|</span> D23Ed2exp d2e <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e<span class="keyword">,</span> s2e<span class="keyword">)</span>
          <span class="keyword">|</span> D23Ed3exp d3e <span class="keyword">=&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4838"><span class="dyncstuse">d3exp_tr_dn</span></a> <span class="keyword">(</span>d3e<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span> d3e<span class="keyword">)</span>
        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        cons <span class="keyword">(</span>d3e<span class="keyword">,</span> aux <span class="keyword">(</span>d23es<span class="keyword">,</span> s2es<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">(* end of [aux] *)</span>
  <span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">sgn<span class="keyword">:</span>int</span><span class="keyword">]</span> sgn <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#3105"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_length_compare</span></a> <span class="keyword">(</span>d23es<span class="keyword">,</span> s2es<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> sgn &lt;&gt; 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_loc_error3 loc0<span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d23explst_tr_dn"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">if</span> sgn <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> prerr ": arity mismatch: less arguments are needed."<span class="keyword">;</span>
    <span class="keyword">if</span> sgn <span class="keyword">&lt;</span> 0 <span class="keyword">then</span> prerr ": arity mismatch: more arguments are needed."<span class="keyword">;</span>
    <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    assert <span class="keyword">(</span>sgn <span class="keyword">=</span> 0<span class="keyword">)</span> <span class="comment">// deadcode
</span>  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// [sgn = 0] holds!
</span>  <span class="keyword">end</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>sgn<a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#7896"><span class="stacstuse">==</span></a>0<span class="keyword">]</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>d23es<span class="keyword">,</span> s2es<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d23explst_tr_dn]
</span>
<span class="keyword">fun</span> d2explst_arg_tr_up
  <span class="keyword">(</span>d2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9211"><span class="stacstuse">d23explst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d2e<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d23e <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#24644"><span class="dyncstuse">d2exp_is_varlamcst</span></a> d2e <span class="keyword">then</span> D23Ed2exp d2e <span class="keyword">else</span> D23Ed3exp <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e<span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9154"><span class="stacstuse">d23exp</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      cons <span class="keyword">(</span>d23e<span class="keyword">,</span> d2explst_arg_tr_up d2es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span><span class="keyword">end</span> <span class="comment">// end of [d2explst_arg_tr_up]
</span>
<span class="keyword">fun</span> d23explst_open_and_add <span class="keyword">(</span>d23es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9211"><span class="stacstuse">d23explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d23es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d23e<span class="keyword">,</span> d23es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d23e <span class="keyword">of</span>
        <span class="keyword">|</span> D23Ed2exp d2e <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> D23Ed3exp d3e <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      d23explst_open_and_add d23es
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span><span class="keyword">end</span> <span class="comment">(* end of [d23explst_open_and_add] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d23exp_app_tr_up
  <span class="keyword">(</span>d3e_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span> loc_arg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> d23es_arg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#9211"><span class="stacstuse">d23explst</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d23exp_app_tr_up: d3e_fun.d3exp_typ = "; print d3e_fun.d3exp_typ;
    print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> loc_fun <span class="keyword">=</span> d3e_fun<span class="keyword">.</span>d3exp_loc
  <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc_fun<span class="keyword">,</span> d3e_fun<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#12969"><span class="dyncstuse">d3exp_typ_set</span></a> <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> s2e_fun<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "d23exp_app_tr_up: s2e_fun = "; print s2e_fun; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e_fun<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Efun <span class="keyword">(</span>
      fc<span class="keyword">,</span> _<span class="comment">(*lin*)</span><span class="keyword">,</span> s2fe_fun<span class="keyword">,</span> npf_fun<span class="keyword">,</span> s2es_fun_arg<span class="keyword">,</span> s2e_fun_res
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = begin
        print "d23exp_app_tr_up: s2fe_fun = "; print s2fe_fun; print_newline ();
        printf ("d23exp_app_tr_up: npf = %i and npf_fun = %i", @(npf, npf_fun));
        print_newline ()
      end // end of [val]
*)</span>
      <span class="keyword">val</span> loc_app <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2006"><span class="dyncstuse">$Loc<span class="keyword">.</span>location_combine</span></a> <span class="keyword">(</span>loc_fun<span class="keyword">,</span> loc_arg<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pfarity_check_fun <span class="keyword">(</span>loc_fun<span class="keyword">,</span> npf_fun<span class="keyword">,</span> npf<span class="keyword">)</span>
      <span class="keyword">val</span> d3es_arg <span class="keyword">=</span> d23explst_tr_dn <span class="keyword">(</span>loc_arg<span class="keyword">,</span> d23es_arg<span class="keyword">,</span> s2es_fun_arg<span class="keyword">)</span>
      <span class="keyword">val</span> s2e_fun_res <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e_fun_res
      <span class="keyword">var</span> s2e_res<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="keyword">=</span> s2e_fun_res
      <span class="keyword">var</span> wths2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8597"><span class="stacstuse">wths2explst</span></a></span> <span class="keyword">=</span> WTHS2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> iswth <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#27006"><span class="dyncstuse">s2exp_is_wth</span></a> s2e_fun_res
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> iswth <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s2e_fun_res <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11511"><span class="dyncstuse">s2exp_opnexi_and_add</span></a> <span class="keyword">(</span>loc_app<span class="keyword">,</span> s2e_fun_res<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">case+</span> s2e_fun_res<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> S2Ewth <span class="keyword">(</span>s2e<span class="keyword">,</span> wths2es1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>s2e_res := s2e<span class="keyword">;</span> wths2es := wths2es1<span class="keyword">)</span>
        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1939"><span class="dyncstuse">$Err<span class="keyword">.</span>deadcode</span></a> <span class="keyword">(</span>": [ats_trans3_exp_up]: d23exp_app_tr_up: iswth"<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> d3e_fun <span class="keyword">=</span> d3exp_funclo_restore <span class="keyword">(</span>fc<span class="keyword">,</span> d3e_fun<span class="keyword">)</span>
      <span class="keyword">val</span> d3es_arg <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">if</span> iswth <span class="keyword">then</span> d3explst_arg_restore <span class="keyword">(</span>d3es_arg<span class="keyword">,</span> wths2es<span class="keyword">)</span> <span class="keyword">else</span> d3es_arg
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8121"><span class="dyncstuse">the_effect_env_check_seff</span></a> <span class="keyword">(</span>loc_app<span class="keyword">,</span> s2fe_fun<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15077"><span class="dyncstuse">d3exp_app_dyn</span></a> <span class="keyword">(</span>loc_app<span class="keyword">,</span> s2e_res<span class="keyword">,</span> s2fe_fun<span class="keyword">,</span> d3e_fun<span class="keyword">,</span> npf<span class="keyword">,</span> d3es_arg<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>  <span class="keyword">|</span> S2EVar s2V_fun <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3es_arg <span class="keyword">=</span> d23explst_tr_up d23es_arg
      <span class="keyword">val</span> s2es_arg <span class="keyword">=</span> aux <span class="keyword">(</span>npf<span class="keyword">,</span> d3es_arg<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
        <span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> d3es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11070"><span class="stacstuse">d3explst</span></a> n</span><span class="keyword">)</span>
          <span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1713"><span class="stacstuse">s2explst</span></a> n</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d3es <span class="keyword">of</span>
          <span class="keyword">|</span> cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> s2e <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_typ<span class="keyword">;</span> <span class="keyword">val</span> s2t <span class="keyword">=</span> s2e<span class="keyword">.</span>s2exp_srt
              <span class="keyword">val</span> s2t_arg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#4120"><span class="stacstuse">s2rt</span></a></span> <span class="keyword">=</span>
                <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span>
                  <span class="keyword">(</span><span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10875"><span class="dyncstuse">s2rt_is_linear</span></a> s2t <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10334"><span class="dyncstuse">s2rt_view</span></a> <span class="keyword">else</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10270"><span class="dyncstuse">s2rt_prop</span></a><span class="keyword">)</span>
                <span class="keyword">else</span> s2t
              <span class="keyword">val</span> s2e_arg <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc_fun<span class="keyword">,</span> s2t_arg<span class="keyword">)</span>
              <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#3473"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_tyleq_solve</span></a> <span class="keyword">(</span>d3e<span class="keyword">.</span>d3exp_loc<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e_arg<span class="keyword">)</span>
            <span class="keyword">in</span>
              cons <span class="keyword">(</span>s2e_arg<span class="keyword">,</span> aux <span class="keyword">(</span>i-1<span class="keyword">,</span> d3es<span class="keyword">)</span><span class="keyword">)</span>
            <span class="keyword">end</span>
          <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>      <span class="keyword">}</span> <span class="comment">// end of [where]
</span>      <span class="keyword">val</span> s2e_res <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc_fun<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10312"><span class="dyncstuse">s2rt_t0ype</span></a><span class="keyword">)</span>
      <span class="keyword">val</span> s2fe <span class="keyword">=</span> S2EFFall <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30327"><span class="dyncstuse">s2exp_fun_srt</span></a> <span class="keyword">(</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10291"><span class="dyncstuse">s2rt_type</span></a><span class="keyword">,</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> 0<span class="comment">(*lin*)</span><span class="keyword">,</span> s2fe<span class="keyword">,</span> npf<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2e_res
      <span class="keyword">)</span> <span class="comment">// end of [s2exp_fun_srt]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#2718"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_equal_solve</span></a> <span class="keyword">(</span>loc_fun<span class="keyword">,</span> s2e_fun<span class="keyword">,</span> s2e<span class="keyword">)</span>
      <span class="keyword">val</span> loc_app <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2006"><span class="dyncstuse">$Loc<span class="keyword">.</span>location_combine</span></a> <span class="keyword">(</span>loc_fun<span class="keyword">,</span> loc_arg<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15077"><span class="dyncstuse">d3exp_app_dyn</span></a> <span class="keyword">(</span>loc_app<span class="keyword">,</span> s2e_res<span class="keyword">,</span> s2fe<span class="keyword">,</span> d3e_fun<span class="keyword">,</span> npf<span class="keyword">,</span> d3es_arg<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2EVar]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 loc_fun<span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d23exp_app_tr_dn"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic expression is applied but its type is ["<span class="keyword">;</span>
      prerr s2e_fun<span class="keyword">;</span>
      prerr "]."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [d23exp_app_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> d2exp_apps_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span>
  <span class="keyword">case+</span> d2as <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d2a<span class="keyword">,</span> d2as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2a <span class="keyword">of</span>
    <span class="keyword">|</span> D2EXPARGsta <span class="keyword">(</span>s2as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        d2exp_apps_sta_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> s2as<span class="keyword">,</span> d2as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2EXPARGsta]
</span>    <span class="keyword">|</span> D2EXPARGdyn <span class="keyword">(</span>loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> d2es_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        d2exp_apps_dyn_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> d2es_arg<span class="keyword">,</span> d2as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2EXPARGdyn]
</span>    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d3e_fun
<span class="comment">// end of [d2exp_apps_tr_up]
</span>
<span class="keyword">and</span> d2exp_apps_sta_tr_up
  <span class="keyword">(</span>d3e_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span> s2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_fun
  <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> d3e_fun<span class="keyword">.</span>d3exp_typ
  <span class="keyword">val</span> loc_app <span class="keyword">=</span> aux <span class="keyword">(</span>d3e_fun<span class="keyword">.</span>d3exp_loc<span class="keyword">,</span> s2as<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> s2as <span class="keyword">of</span>
      <span class="keyword">|</span> cons <span class="keyword">(</span>s2a<span class="keyword">,</span> s2as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2as <span class="keyword">of</span>
        <span class="keyword">|</span> nil _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2006"><span class="dyncstuse">$Loc<span class="keyword">.</span>location_combine</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> s2a<span class="keyword">.</span>s2exparg_loc<span class="keyword">)</span>
        <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>loc<span class="keyword">,</span> s2as<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> loc
  <span class="keyword">}</span> <span class="comment">// end of where
</span>  <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11217"><span class="dyncstuse">s2exp_uni_instantiate_sexparglst</span></a> <span class="keyword">(</span>loc_app<span class="keyword">,</span> s2e_fun<span class="keyword">,</span> s2as<span class="keyword">)</span>
  <span class="keyword">val</span> d3e_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15020"><span class="dyncstuse">d3exp_app_sta</span></a> <span class="keyword">(</span>loc_app<span class="keyword">,</span> s2e_fun<span class="keyword">,</span> d3e_fun<span class="keyword">)</span>
<span class="keyword">in</span>
  d2exp_apps_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> d2as<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_apps_sta_tr_up]
</span>
<span class="keyword">and</span> d2exp_apps_dyn_tr_up
  <span class="keyword">(</span>d3e_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span>
   loc_arg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> d2es_arg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc_app <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2006"><span class="dyncstuse">$Loc<span class="keyword">.</span>location_combine</span></a> <span class="keyword">(</span>d3e_fun<span class="keyword">.</span>d3exp_loc<span class="keyword">,</span> loc_arg<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_fun<span class="keyword">;</span> <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> d3e_fun<span class="keyword">.</span>d3exp_typ
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e_fun<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
<span class="comment">(*
  | S2EVar s2V_fun =&gt; let
      val d3es_arg = d2explst_tr_up d2es_arg
      val () = d3explst_open_and_add d3es_arg
      val s2es_arg = d3explst_typ_get d3es_arg
      val s2e_res = s2exp_Var_make_srt (loc_app, srt2_t0ype)
      val s2e_fun_new = s2exp_fun_srt
        (s2rt_type, Syn.FUNCLOfun (), S2EFFall (), npf, s2es_arg, s2e_res)
      val () = $SOL.s2exp_tyleq_solve (loc_app, s2e_fun, s2e_fun_new)
      val () = the_effect_env_check_all (loc_app)
      val d3e_fun = d3exp_app_dyn
        (loc_app, s2e_res, S2EFFall (), d3e_fun, npf, d3es_arg)
    in
      d2exp_apps_tr_up (d3e_fun, d2as)
    end
*)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d23es_arg <span class="keyword">=</span> d2explst_arg_tr_up d2es_arg
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> d23explst_open_and_add d23es_arg
      <span class="keyword">val</span> d3e_fun <span class="keyword">=</span> d23exp_app_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> d23es_arg<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_apps_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> d2as<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_apps_dyn_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">datatype</span> <span class="staexp"><a name="17505"><span class="stacstdec">d3exparg</span></a></span> <span class="keyword">=</span> 
  <span class="keyword">|</span> D3EXPARGsta <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span>
  <span class="keyword">|</span> D3EXPARGdyn <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a><span class="comment">(*arg*)</span><span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a><span class="comment">(*npf*)</span><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a><span class="keyword">)</span></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17613"><span class="stacstdec">d3exparglst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17505"><span class="stacstuse">d3exparg</span></a></span></a></span>

<span class="comment">//
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17654"><span class="stacstdec">xyz_t <span class="keyword">=</span> <span class="keyword">@(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#4468"><span class="stacstuse">s2kexp</span></a><span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a><span class="keyword">)</span></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17692"><span class="stacstdec">xyzlst_t <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span></a></span>

<span class="keyword">fn</span> fprint_xyz <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>file_mode<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#10177"><span class="stacstuse">file_mode_lte</span></a> <span class="keyword">(</span>m<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20767"><span class="stacstuse">w</span></a><span class="keyword">)</span></span></span> <span class="keyword">|</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20956"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20956"><span class="stacstuse">FILE</span></a></span></a> m</span><span class="keyword">,</span> xyz<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#8037"><span class="dyncstuse">fprint1_string</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "("<span class="keyword">)</span><span class="keyword">;</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#13191"><span class="dyncstuse">fprint_d3exp</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> xyz<span class="keyword">.</span>0<span class="keyword">)</span><span class="keyword">;</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#8037"><span class="dyncstuse">fprint1_string</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#25636"><span class="dyncstuse">fprint_s2kexp</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> xyz<span class="keyword">.</span>1<span class="keyword">)</span><span class="keyword">;</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#8037"><span class="dyncstuse">fprint1_string</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2finteger_2esats.html#4733"><span class="dyncstuse">fprint1_int</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> xyz<span class="keyword">.</span>2<span class="keyword">)</span><span class="keyword">;</span>
  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#8037"><span class="dyncstuse">fprint1_string</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ")"<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_xyz]
</span>
<span class="keyword">fn</span> print_xyz <span class="keyword">(</span>xyz<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_xyz<span class="keyword">,</span> xyz<span class="keyword">)</span>
<span class="keyword">fn</span> prerr_xyz <span class="keyword">(</span>xyz<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_xyz<span class="keyword">,</span> xyz<span class="keyword">)</span>

<span class="comment">//
</span>
<span class="keyword">fn</span> fprint_xyz_root <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>file_mode<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#10177"><span class="stacstuse">file_mode_lte</span></a> <span class="keyword">(</span>m<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20767"><span class="stacstuse">w</span></a><span class="keyword">)</span></span></span> <span class="keyword">|</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20956"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#20956"><span class="stacstuse">FILE</span></a></span></a> m</span><span class="keyword">,</span> xyz<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>d3e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> d3e<span class="keyword">.</span>d3exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> D3Eapp_dyn <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> _<span class="comment">(*npf*)</span><span class="keyword">,</span> _<span class="comment">(*d3es_arg*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>d3e_fun<span class="keyword">)</span>
    <span class="keyword">|</span> D3Eapp_sta <span class="keyword">(</span>d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>d3e<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d3e
  <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> d3e <span class="keyword">=</span> aux <span class="keyword">(</span>xyz<span class="keyword">.</span>0<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> d3e<span class="keyword">.</span>d3exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D3Ecst d2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5592"><span class="dyncstuse">fprint_d2cst</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Ecst]
</span>  <span class="keyword">|</span> D3Evar d2v <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#8549"><span class="dyncstuse">fprint_d2var</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Evar]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#8037"><span class="dyncstuse">fprint1_string</span></a> <span class="keyword">(</span>
        <span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "INTERNAL ERROR (ats_trans3_exp_up): fprint_xyz_root: d3e = "
      <span class="keyword">)</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#13191"><span class="dyncstuse">fprint_d3exp</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="comment">// end of [case]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_xyz_root]
</span>
<span class="keyword">fn</span> print_xyz_root <span class="keyword">(</span>xyz<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_xyz_root<span class="keyword">,</span> xyz<span class="keyword">)</span>
<span class="keyword">fn</span> prerr_xyz_root <span class="keyword">(</span>xyz<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_xyz_root<span class="keyword">,</span> xyz<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_item_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3423"><span class="stacstuse">d2item</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d2i <span class="keyword">of</span>
  <span class="keyword">|</span> D2ITEMcst d2c <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5049"><span class="dyncstuse">d2exp_cst_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span>
  <span class="keyword">|</span> D2ITEMvar d2v <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5111"><span class="dyncstuse">d2exp_var_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 loc0<span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d2exp_item_tr_up"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic expression needs to be a constant or a variable."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_item_tr_up]
</span>
<span class="keyword">fun</span> s2kexplst_make_d3explst <span class="keyword">(</span>d3es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9167"><span class="stacstuse">s2kexplst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d3es <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> list_cons
      <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#32810"><span class="dyncstuse">s2kexp_make_s2exp</span></a> d3e<span class="keyword">.</span>d3exp_typ<span class="keyword">,</span> s2kexplst_make_d3explst d3es<span class="keyword">)</span>
    <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2kexplst_make_d3explst]
</span>
<span class="keyword">fun</span> aux_filter
  <span class="keyword">(</span>xyzs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17692"><span class="stacstuse">xyzlst_t</span></a></span><span class="keyword">,</span> s2kes<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9167"><span class="stacstuse">s2kexplst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17692"><span class="stacstuse">xyzlst_t</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> xyzs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>xyz<span class="keyword">,</span> xyzs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = begin
        print "aux_filter: xyz = "; print_xyz xyz; print_newline ()
      end // end of [val]
*)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33194"><span class="dyncstuse">s2kexp_match_fun_arg</span></a> <span class="keyword">(</span>xyz<span class="keyword">.</span>1<span class="keyword">,</span> s2kes<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2keapprox <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> approx <span class="keyword">=</span> xyz<span class="keyword">.</span>2 + s2keapprox<span class="keyword">.</span>1
          <span class="keyword">val</span> xyz_new <span class="keyword">=</span> <span class="keyword">@(</span>xyz<span class="keyword">.</span>0<span class="keyword">,</span> s2keapprox<span class="keyword">.</span>0<span class="keyword">,</span> approx<span class="keyword">)</span>
<span class="comment">(*
          val () = begin
            print "aux_filter: xyz_new = "; print_xyz xyz_new; print_newline ()
          end // end of [val]
*)</span>
        <span class="keyword">in</span>
          xyz_new :: aux_filter <span class="keyword">(</span>xyzs<span class="keyword">,</span> s2kes<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux_filter <span class="keyword">(</span>xyzs<span class="keyword">,</span> s2kes<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux_filter]
</span>
<span class="keyword">fun</span> aux_select0 <span class="keyword">(</span>xyzs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17692"><span class="stacstuse">xyzlst_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17692"><span class="stacstuse">xyzlst_t</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xyzs <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>xyz<span class="keyword">,</span> xyzs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> xyz<span class="keyword">.</span>2 <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> aux_select0 xyzs <span class="keyword">else</span> cons <span class="keyword">(</span>xyz<span class="keyword">,</span> aux_select0 xyzs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span><span class="keyword">end</span> <span class="comment">// end of [aux_select0]
</span>
<span class="keyword">fun</span> aux1
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d3e_fun<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span> d3as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17613"><span class="stacstuse">d3exparglst</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d3as <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>d3a<span class="keyword">,</span> d3as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d3a <span class="keyword">of</span>
    <span class="keyword">|</span> D3EXPARGsta s2as <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11217"><span class="dyncstuse">s2exp_uni_instantiate_sexparglst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e_fun<span class="keyword">.</span>d3exp_typ<span class="keyword">,</span> s2as<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span>        <span class="keyword">val</span> d3e_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15020"><span class="dyncstuse">d3exp_app_sta</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_fun<span class="keyword">,</span> d3e_fun<span class="keyword">)</span>
      <span class="keyword">in</span>
        aux1 <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e_fun<span class="keyword">,</span> d3as<span class="keyword">,</span> d2as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D3EXPARGsta]
</span>    <span class="keyword">|</span> D3EXPARGdyn <span class="keyword">(</span>loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> d3es_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2872"><span class="dyncstuse">d3explst_open_and_add</span></a> d3es_arg
        <span class="keyword">val</span> s2es_arg <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#13051"><span class="dyncstuse">d3explst_typ_get</span></a> d3es_arg
        <span class="keyword">val</span> s2e_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e_fun<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#12969"><span class="dyncstuse">d3exp_typ_set</span></a> <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> s2e_fun<span class="keyword">)</span>
<span class="comment">(*
        val () = begin
          print "d2exp_apps_sym_tr_up: aux1: s2e_fun = "; print s2e_fun;
          print_newline ()
        end // end of [val]
        val () = begin
          print "d2exp_apps_sym_tr_up: aux1: s2es_arg = "; print s2es_arg;
          print_newline ()
        end // end of [val]
*)</span>
      <span class="keyword">in</span>
        <span class="keyword">case+</span> s2e_fun<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> S2Efun <span class="keyword">(</span>fc<span class="keyword">,</span> _<span class="comment">(*lin*)</span><span class="keyword">,</span> s2fe_fun<span class="keyword">,</span> npf_fun<span class="keyword">,</span> s2es_fun_arg<span class="keyword">,</span> s2e_fun_res<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pfarity_check_fun <span class="keyword">(</span>loc0<span class="keyword">,</span> npf_fun<span class="keyword">,</span> npf<span class="keyword">)</span>
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#3532"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2explst_arg_tyleq_solve</span></a> <span class="keyword">(</span>loc_arg<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2es_fun_arg<span class="keyword">)</span>
            <span class="keyword">var</span> s2e_res<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="keyword">=</span> s2e_fun_res
            <span class="keyword">var</span> wths2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8597"><span class="stacstuse">wths2explst</span></a></span> <span class="keyword">=</span> WTHS2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">val</span> iswth <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#27006"><span class="dyncstuse">s2exp_is_wth</span></a> s2e_fun_res
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
              <span class="keyword">if</span> iswth <span class="keyword">then</span> <span class="keyword">let</span>
                <span class="keyword">val</span> s2e_fun_res <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11511"><span class="dyncstuse">s2exp_opnexi_and_add</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_fun_res<span class="keyword">)</span>
              <span class="keyword">in</span>
                <span class="keyword">case+</span> s2e_fun_res<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
                <span class="keyword">|</span> S2Ewth <span class="keyword">(</span>s2e<span class="keyword">,</span> wths2es1<span class="keyword">)</span> <span class="keyword">=&gt;</span>
                    <span class="keyword">(</span>s2e_res := s2e<span class="keyword">;</span> wths2es := wths2es1<span class="keyword">)</span>
                <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1939"><span class="dyncstuse">$Err<span class="keyword">.</span>deadcode</span></a> <span class="keyword">(</span>
                    ": [ats_trans3_exp_up]: d2exp_apps_sym_tr_up: aux1: iswth"
                  <span class="keyword">)</span> <span class="comment">// end of [_]
</span>              <span class="keyword">end</span>
            <span class="keyword">val</span> d3e_fun <span class="keyword">=</span> d3exp_funclo_restore <span class="keyword">(</span>fc<span class="keyword">,</span> d3e_fun<span class="keyword">)</span>
            <span class="keyword">val</span> d3es_arg <span class="keyword">=</span> <span class="keyword">(</span>
              <span class="keyword">if</span> iswth <span class="keyword">then</span> d3explst_arg_restore <span class="keyword">(</span>d3es_arg<span class="keyword">,</span> wths2es<span class="keyword">)</span> <span class="keyword">else</span> d3es_arg
            <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span>
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8121"><span class="dyncstuse">the_effect_env_check_seff</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2fe_fun<span class="keyword">)</span>
            <span class="keyword">val</span> d3e_fun <span class="keyword">=</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15077"><span class="dyncstuse">d3exp_app_dyn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_res<span class="keyword">,</span> s2fe_fun<span class="keyword">,</span> d3e_fun<span class="keyword">,</span> npf<span class="keyword">,</span> d3es_arg<span class="keyword">)</span>
          <span class="keyword">in</span>
            aux1 <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e_fun<span class="keyword">,</span> d3as<span class="keyword">,</span> d2as<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error3 loc0<span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d2exp_apps_sym_tr_up: aux1"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
            prerr ": the dynamic expression is applied but its type is ["<span class="keyword">;</span>
            prerr s2e_fun<span class="keyword">;</span>
            prerr "]."<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [D3EXPARGdyn]
</span>    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_apps_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> d2as<span class="keyword">)</span> <span class="comment">// end of [list_nil]
</span><span class="keyword">end</span> <span class="comment">// end of [aux1]
</span>
<span class="keyword">fun</span> aux2
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2s<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3769"><span class="stacstuse">d2sym</span></a></span><span class="keyword">,</span> d3as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17613"><span class="stacstuse">d3exparglst</span></a></span><span class="keyword">,</span>
   xyzs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17692"><span class="stacstuse">xyzlst_t</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> err_nil <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2s<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3769"><span class="stacstuse">d2sym</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
     prerr_loc_error3 loc0<span class="keyword">;</span>
     <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d2exp_apps_sym_tr_up: aux2"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
     prerr ": the symbol ["<span class="keyword">;</span>
     prerr d2s<span class="keyword">;</span>
     prerr "] cannot be resolved: there is no match."<span class="keyword">;</span>
     <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
     <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [err_nil]
</span>  <span class="keyword">fn</span> err_cons_cons
     <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2s<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3769"><span class="stacstuse">d2sym</span></a></span><span class="keyword">,</span> xyz1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">,</span> xyz2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17654"><span class="stacstuse">xyz_t</span></a></span><span class="keyword">)</span>
     <span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
     prerr_loc_error3 loc0<span class="keyword">;</span>
     <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d2exp_apps_sym_tr_up: aux2"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
     prerr ": the symbol ["<span class="keyword">;</span>
     prerr d2s<span class="keyword">;</span>
     prerr "] cannot be resolved: there are too many matches: "<span class="keyword">;</span>
     prerr_xyz_root xyz1<span class="keyword">;</span>
     prerr ", "<span class="keyword">;</span>
     prerr_xyz_root xyz2<span class="keyword">;</span>
     prerr ", ..."<span class="keyword">;</span>
     <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
     <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [err_cons_cons]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> xyzs <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>xyz<span class="keyword">,</span> xyzs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xyzs1 <span class="keyword">of</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        aux1 <span class="keyword">(</span>loc0<span class="keyword">,</span> xyz<span class="keyword">.</span>0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#2934"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_reverse</span></a> d3as<span class="keyword">,</span> d2as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>    <span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2as <span class="keyword">of</span>
      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> xyzs <span class="keyword">=</span> aux_select0 xyzs <span class="keyword">in</span>
          <span class="keyword">case+</span> xyzs <span class="keyword">of</span>
          <span class="keyword">|</span> cons <span class="keyword">(</span>xyz<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> 
              aux1 <span class="keyword">(</span>loc0<span class="keyword">,</span> xyz<span class="keyword">.</span>0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#2934"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_reverse</span></a> d3as<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [cons (nil)]
</span>          <span class="keyword">|</span> nil _ <span class="keyword">=&gt;</span> err_nil <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">)</span>
          <span class="keyword">|</span> cons <span class="keyword">(</span>xyz1<span class="keyword">,</span> cons <span class="keyword">(</span>xyz2<span class="keyword">,</span> _<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              err_cons_cons <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">,</span> xyz1<span class="keyword">,</span> xyz2<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [cons (cons)]
</span>        <span class="keyword">end</span> <span class="comment">// end of [let]
</span>      <span class="keyword">|</span> list_cons <span class="keyword">(</span>d2a<span class="keyword">,</span> d2as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2a <span class="keyword">of</span>
        <span class="keyword">|</span> D2EXPARGsta s2as <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> d3a <span class="keyword">=</span> D3EXPARGsta s2as <span class="keyword">in</span>
            aux2 <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">,</span> d3a :: d3as<span class="keyword">,</span> xyzs<span class="keyword">,</span> d2as<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2EXPARGsta]
</span>        <span class="keyword">|</span> D2EXPARGdyn <span class="keyword">(</span>loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> d3es <span class="keyword">=</span> d23explst_tr_up <span class="keyword">(</span>d2explst_arg_tr_up d2es<span class="keyword">)</span>
<span class="comment">(*
            val () = begin
              print "d2exp_apps_sym_tr_up: aux2: s2es = ";
              print (d3explst_typ_get d3es); print_newline ()
            end // end of [val]
*)</span>
            <span class="keyword">val</span> d3a <span class="keyword">=</span> D3EXPARGdyn <span class="keyword">(</span>loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> d3es<span class="keyword">)</span>
            <span class="keyword">val</span> xyzs <span class="keyword">=</span> aux_filter <span class="keyword">(</span>xyzs<span class="keyword">,</span> s2kexplst_make_d3explst d3es<span class="keyword">)</span>
          <span class="keyword">in</span>
            aux2 <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">,</span> d3a :: d3as<span class="keyword">,</span> xyzs<span class="keyword">,</span> d2as<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2EXPARGdyn]
</span>        <span class="keyword">end</span> <span class="comment">// end of [list_cons (d2a, d2as)]
</span>      <span class="keyword">end</span> <span class="comment">// end of [list_cons _]
</span>    <span class="keyword">end</span> <span class="comment">// end of [list_cons (xyz, xyzs1)]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> err_nil <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux2]
</span>
<span class="keyword">fn*</span> aux3 <span class="keyword">(</span>d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d2as <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>d2a<span class="keyword">,</span> d2as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2a <span class="keyword">of</span>
    <span class="keyword">|</span> D2EXPARGdyn <span class="keyword">(</span>_<span class="comment">(*loc*)</span><span class="keyword">,</span> npf<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux3_app <span class="keyword">(</span>npf<span class="keyword">,</span> d2es<span class="keyword">,</span> d2as<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">|</span> D2EXPARGsta _ <span class="keyword">=&gt;</span> aux3 <span class="keyword">(</span>d2as<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4327"><span class="dyncstuse">true</span></a>
<span class="keyword">end</span> <span class="comment">// end of [aux3]
</span>
<span class="keyword">and</span> aux3_app
  <span class="keyword">(</span>npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> d2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> <span class="keyword">(</span>s2e<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Efun <span class="keyword">(</span>_<span class="comment">(*fc*)</span><span class="keyword">,</span> _<span class="comment">(*lin*)</span><span class="keyword">,</span> _<span class="comment">(*eff*)</span><span class="keyword">,</span> npf1<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2e_res<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> <span class="keyword">(</span>npf <span class="keyword">=</span> npf1<span class="keyword">)</span> <span class="keyword">then</span>
        <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#3105"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_length_compare</span></a> <span class="keyword">(</span>d2es<span class="keyword">,</span> s2es_arg<span class="keyword">)</span> <span class="keyword">=</span> 0 <span class="keyword">then</span> aux3 <span class="keyword">(</span>d2as<span class="keyword">,</span> s2e_res<span class="keyword">)</span>
        <span class="keyword">else</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a>
      <span class="keyword">else</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a>
    <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>  <span class="keyword">|</span> S2Eexi <span class="keyword">(</span>_<span class="comment">(*s2vs*)</span><span class="keyword">,</span> _<span class="comment">(*s2ps*)</span><span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux3_app <span class="keyword">(</span>npf<span class="keyword">,</span> d2es<span class="keyword">,</span> d2as<span class="keyword">,</span> s2e<span class="keyword">)</span>
  <span class="keyword">|</span> S2Euni <span class="keyword">(</span>_<span class="comment">(*s2vs*)</span><span class="keyword">,</span> _<span class="comment">(*s2ps*)</span><span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux3_app <span class="keyword">(</span>npf<span class="keyword">,</span> d2es<span class="keyword">,</span> d2as<span class="keyword">,</span> s2e<span class="keyword">)</span>
  <span class="keyword">|</span> S2Emetfn <span class="keyword">(</span>_<span class="comment">(*stamp*)</span><span class="keyword">,</span> _<span class="comment">(*met*)</span><span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux3_app <span class="keyword">(</span>npf<span class="keyword">,</span> d2es<span class="keyword">,</span> d2as<span class="keyword">,</span> s2e<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [aux3_app]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">fn</span> d2exp_apps_sym_tr_up <span class="keyword">(</span>
  loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2s<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3769"><span class="stacstuse">d2sym</span></a></span><span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2exp_apps_sym_tr_up: d2s = "; print d2s;
    print_newline ()
  end // end of [val]
  val () = begin
    print "d2exp_apps_sym_tr_up: d2s.d2sym_itm = "; print d2s.d2sym_itm;
    print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> xyzs <span class="keyword">=</span> aux <span class="keyword">(</span>
      loc0<span class="keyword">,</span> d2as<span class="keyword">,</span> d2s<span class="keyword">.</span>d2sym_itm<span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">viewtypedef</span> <span class="staexp"><a name="27958"><span class="stacstdec">d2itemlstlst_vt <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3671"><span class="stacstuse">d2itemlst</span></a><span class="keyword">)</span></span></a></span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>
        loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span>
      <span class="keyword">,</span> d2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21198"><span class="stacstuse">d2exparglst</span></a></span><span class="keyword">,</span> d2is<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#3671"><span class="stacstuse">d2itemlst</span></a></span><span class="keyword">,</span> d2iss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#27958"><span class="stacstuse">d2itemlstlst_vt</span></a></span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#17692"><span class="stacstuse">xyzlst_t</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2is <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>d2i<span class="keyword">,</span> d2is<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
        <span class="keyword">|</span> D2ITEMsymdef <span class="keyword">(</span>d2is_new<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            aux <span class="keyword">(</span>loc0<span class="keyword">,</span> d2as<span class="keyword">,</span> d2is_new<span class="keyword">,</span> list_vt_cons <span class="keyword">(</span>d2is<span class="keyword">,</span> d2iss<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2ITEMsymdef]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> d3e <span class="keyword">=</span> d2exp_item_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2i<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> s2e <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_typ
          <span class="keyword">in</span>
            <span class="keyword">if</span> aux3 <span class="keyword">(</span>d2as<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">let</span>
              <span class="keyword">val</span> s2ke <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#32810"><span class="dyncstuse">s2kexp_make_s2exp</span></a> <span class="keyword">(</span>s2e<span class="keyword">)</span>
            <span class="keyword">in</span>
              <span class="keyword">@(</span>d3e<span class="keyword">,</span> s2ke<span class="keyword">,</span> 0<span class="keyword">)</span> :: aux <span class="keyword">(</span>loc0<span class="keyword">,</span> d2as<span class="keyword">,</span> d2is<span class="keyword">,</span> d2iss<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
              aux <span class="keyword">(</span>loc0<span class="keyword">,</span> d2as<span class="keyword">,</span> d2is<span class="keyword">,</span> d2iss<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [if]
</span>          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">(* end of [list_cons] *)</span>
      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2iss <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>d2is<span class="keyword">,</span> d2iss<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> d2as<span class="keyword">,</span> d2is<span class="keyword">,</span> d2iss<span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [nil]
</span>      <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="keyword">in</span>
  aux2 <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> xyzs<span class="keyword">,</span> d2as<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_apps_sym_tr_up]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="29144"><span class="dyncstdec">d2exp_viewat_assgn_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e_l<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">,</span> d2e_r<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span></span></a>
<span class="comment">// end of [d2exp_viewat_assgn_tr_up]
</span>
<span class="keyword">fn</span> d2exp_assgn_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e_l<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">,</span> d2e_r<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> l2val <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#35671"><span class="dyncstuse">l2val_make_d2exp</span></a> d2e_l
<span class="keyword">in</span>
  <span class="keyword">case+</span> l2val <span class="keyword">of</span>
  <span class="keyword">|</span> L2VALarrsub <span class="keyword">(</span>
      d2s_brackets<span class="keyword">,</span> d2e_arr<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d2ess_ind
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> d2ess_ind <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>d2es_ind<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> loc_arg <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2006"><span class="dyncstuse">$Loc<span class="keyword">.</span>location_combine</span></a> <span class="keyword">(</span>d2e_arr<span class="keyword">.</span>d2exp_loc<span class="keyword">,</span> d2e_r<span class="keyword">.</span>d2exp_loc<span class="keyword">)</span>
        <span class="keyword">val</span> d2es_arg <span class="keyword">=</span> cons <span class="keyword">(</span>d2e_arr<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#1854"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_extend</span></a> <span class="keyword">(</span>d2es_ind<span class="keyword">,</span> d2e_r<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">val</span> d2a <span class="keyword">=</span> D2EXPARGdyn <span class="keyword">(</span>loc_arg<span class="keyword">,</span> 0<span class="keyword">,</span> d2es_arg<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_apps_sym_tr_up <span class="keyword">(</span>loc_arg<span class="keyword">,</span> d2s_brackets<span class="keyword">,</span> <span class="keyword">'[</span>d2a<span class="keyword">]</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons (nil)]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the format for array subscripts ["<span class="keyword">;</span> prerr d2ess_ind<span class="keyword">;</span>
        prerr "] is not supported."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [L2VALarrsub]
</span>  <span class="keyword">|</span> L2VALptr <span class="keyword">(</span>d2e0<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = begin
        print "d2exp_assgn_tr_up: L2VALptr: d2e0 = "; print d2e0; print_newline ()
      end // end of [val]
*)</span>
      <span class="keyword">val</span> d3e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e0
      <span class="keyword">val</span> s2e0 <span class="keyword">=</span> d3e0<span class="keyword">.</span>d3exp_typ
<span class="comment">(*
      val () = begin
        print "d2exp_assgn_tr_up: L2VALptr: s2e0 = "; print s2e0; print_newline ()
      end // end of [val]
*)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7866"><span class="dyncstuse">un_s2exp_ptr_addr_type</span></a> s2e0 <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_addr <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
          <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
          <span class="keyword">val</span> d3e_r <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_r
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_r
          <span class="keyword">val</span> s2e_r <span class="keyword">=</span> d3e_r<span class="keyword">.</span>d3exp_typ
          <span class="keyword">val</span> s2ls <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3465"><span class="dyncstuse">s2exp_addr_slablst_assgn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> s2e_r<span class="keyword">)</span>
<span class="comment">(*
          val sgn = $Lst.list_length_compare (s2ls, s2ls_nt)
          val () = if (sgn &lt;&gt; 0) then begin
            prerr_interror ();
            prerr ": d2exp_assgn_tr_up: list length mismatch!"; prerr_newline ();
            $Err.abort {void} ()
          end // end of [val]
*)</span>
          <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15351"><span class="dyncstuse">d3exp_assgn_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e0<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2ls <span class="keyword">of</span>
        <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7933"><span class="dyncstuse">un_s2exp_ref_viewt0ype_type</span></a> s2e0 <span class="keyword">of</span>
          <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_elt <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7956"><span class="dyncstuse">the_effect_env_check_ref</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span> <span class="comment">// write to a reference is effectful
</span>              <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// linearity checking
</span>                <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26720"><span class="dyncstuse">s2exp_is_linear</span></a> s2e_elt <span class="keyword">then</span> <span class="keyword">begin</span>
                  prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
                  prerr ": a reference to a linear value cannot be updated directly."<span class="keyword">;</span>
                  <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
                  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
                <span class="keyword">end</span>
              <span class="keyword">val</span> d3e_r <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e_r<span class="keyword">,</span> s2e_elt<span class="keyword">)</span>
            <span class="keyword">in</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15351"><span class="dyncstuse">d3exp_assgn_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e0<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> d3e_r<span class="keyword">)</span>
            <span class="keyword">end</span>
          <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
              prerr ": the dynamic expression is expected to be a pointer or reference"<span class="keyword">;</span>
              prerr ", but it is assigned the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span> prerr "]"<span class="keyword">;</span>
              <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>          <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>        <span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
            prerr ": the dynamic expression is expected to be a pointer"<span class="keyword">;</span>
            prerr ", but it is assigned the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span> prerr "]"<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>        <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>      <span class="comment">// end of [case]
</span>    <span class="keyword">end</span>
  <span class="keyword">|</span> L2VALvar_lin <span class="keyword">(</span>d2v<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> d3e_r <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_r
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_r
      <span class="keyword">val</span> s2e_r <span class="keyword">=</span> d3e_r<span class="keyword">.</span>d3exp_typ
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26640"><span class="dyncstuse">s2exp_is_proof</span></a> s2e_r <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">begin</span>
        prerr_loc_error3 d2e_l<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
        prerr ": the linear dynamic variable ["<span class="keyword">;</span> prerr d2v<span class="keyword">;</span>
        prerr "] can support proof assignment but not value assignment."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>      <span class="keyword">val</span> s2ls <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3689"><span class="dyncstuse">d2var_lin_slablst_assgn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> s2e_r<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [s2ls]
</span>      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15441"><span class="dyncstuse">d3exp_assgn_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_lin]
</span>  <span class="keyword">|</span> L2VALvar_mut <span class="keyword">(</span>d2v<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> d3e_r <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_r
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_r
      <span class="keyword">val</span> s2ls <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3577"><span class="dyncstuse">d2var_mut_slablst_assgn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> d3e_r<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15441"><span class="dyncstuse">d3exp_assgn_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_mut]
</span>  <span class="keyword">|</span> L2VALnone d2e_l <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2e_l<span class="keyword">.</span>d2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> D2Eviewat d2e1_l <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#29144"><span class="dyncstuse">d2exp_viewat_assgn_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e1_l<span class="keyword">,</span> d2e_r<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr loc0<span class="keyword">;</span>
        prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
        prerr ", but it is not."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [L2VALnone]
</span>  <span class="comment">// end of [case]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_assgn_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d3exp_s2exp_lazy_force_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d3e0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span> s2e0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9711"><span class="dyncstuse">un_s2exp_lazy_t0ype_type</span></a> s2e0 <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2e_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17396"><span class="dyncstuse">d3exp_lazy_force</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> 0<span class="comment">(*lin*)</span><span class="keyword">,</span> d3e0<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9777"><span class="dyncstuse">un_s2exp_lazy_viewt0ype_viewtype</span></a> s2e0 <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>s2e_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17396"><span class="dyncstuse">d3exp_lazy_force</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> 1<span class="comment">(*lin*)</span><span class="keyword">,</span> d3e0<span class="keyword">)</span>
    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 d3e0<span class="keyword">.</span>d3exp_loc<span class="keyword">;</span>
        prerr ": the dynamic expression is assigned the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span>
        prerr "], but a pointer, reference, or delayed computation is expected."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="comment">// end of [d3exp_s2exp_lazy_force_tr_up]
</span>
<span class="keyword">fn</span> d2exp_deref_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">,</span> d2ls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21331"><span class="stacstuse">d2lablst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2exp_deref_tr_up: d2e0 = "; print d2e0; print_newline ();
    print "d2exp_deref_tr_up: d2ls = "; print_d2lablst d2ls; print_newline ();    
  end // end of [val]
*)</span>
  <span class="keyword">val</span> d3e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e0
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> d3e0<span class="keyword">.</span>d3exp_typ
<span class="comment">(*
  val () = begin
    print "d2exp_deref_tr_up: s2e0 = "; print s2e0; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7866"><span class="dyncstuse">un_s2exp_ptr_addr_type</span></a> s2e0 <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_addr <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> <span class="keyword">(</span>s2e_elt<span class="keyword">,</span> s2ls<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3866"><span class="dyncstuse">s2exp_addr_slablst_deref</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">)</span>
<span class="comment">(*
      val () = begin
        print "d2exp_deref_tr_up: s2e_elt = "; print s2e_elt; print_newline ();
        print "d2exp_deref_tr_up: s2ls = "; print_s2lablst s2ls; print_newline ();
      end // end of [val]
*)</span>
<span class="comment">//
</span><span class="comment">(*
      val [sgn:int] sgn = $Lst.list_length_compare (s2ls, s2ls_nt)
      val () = if (sgn &lt;&gt; 0) then begin
        prerr_interror ();
        prerr ": d2exp_deref_tr_up: list length mismatch!"; prerr_newline ();
        $Err.abort {void} ();
        assert (sgn = 0) // deadcode
      end else begin
        () // [sgn = 0] holds!
      end : [sgn==0] void // end of [if]
*)</span>
      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18379"><span class="dyncstuse">d3exp_sel_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> d3e0<span class="keyword">,</span> d3ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2ls <span class="keyword">of</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7933"><span class="dyncstuse">un_s2exp_ref_viewt0ype_type</span></a> s2e0 <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_elt <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7956"><span class="dyncstuse">the_effect_env_check_ref</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span> <span class="comment">// read from a reference is effectful
</span>          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// linearity checking
</span>            <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26720"><span class="dyncstuse">s2exp_is_linear</span></a> s2e_elt <span class="keyword">then</span> <span class="keyword">begin</span>
              prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
              prerr ": a reference to a linear value cannot be accessed directly."<span class="keyword">;</span>
              <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [if]
</span>        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18379"><span class="dyncstuse">d3exp_sel_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> d3e0<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d3exp_s2exp_lazy_force_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e0<span class="keyword">,</span> s2e0<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [nil]
</span>    <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
        prerr ": the dynamic expression is expected to be a pointer"<span class="keyword">;</span>
        prerr ", but it is assigned the type ["<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span> prerr "]"<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>  <span class="comment">// end of [case]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_deref_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_con_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2560"><span class="stacstuse">d2con_t</span></a></span><span class="keyword">,</span> s2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> d2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d23es <span class="keyword">=</span> d2explst_arg_tr_up d2es
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> d23explst_open_and_add d23es
  <span class="keyword">val</span> s2e_d2c <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#22626"><span class="dyncstuse">d2con_typ_get</span></a> d2c
  <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11217"><span class="dyncstuse">s2exp_uni_instantiate_sexparglst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_d2c<span class="keyword">,</span> s2as<span class="keyword">)</span>
  <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Efun <span class="keyword">(</span>
      _<span class="comment">(*fc*)</span><span class="keyword">,</span> _<span class="comment">(*lin*)</span><span class="keyword">,</span> _<span class="comment">(*s2fe*)</span><span class="keyword">,</span> npf_fun<span class="keyword">,</span> s2es_fun_arg<span class="keyword">,</span> s2e_fun_res
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pfarity_check_fun <span class="keyword">(</span>loc0<span class="keyword">,</span> npf_fun<span class="keyword">,</span> npf<span class="keyword">)</span>
      <span class="keyword">val</span> d3es <span class="keyword">=</span> d23explst_tr_dn <span class="keyword">(</span>loc0<span class="keyword">,</span> d23es<span class="keyword">,</span> s2es_fun_arg<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15755"><span class="dyncstuse">d3exp_con</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_fun_res<span class="keyword">,</span> d2c<span class="keyword">,</span> npf<span class="keyword">,</span> d3es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 loc0<span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d2exp_con_tr_up"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic constructor ["<span class="keyword">;</span>
      prerr d2c<span class="keyword">;</span>
      prerr "] is applied but its type ["<span class="keyword">;</span>
      prerr s2e_d2c<span class="keyword">;</span>
      prerr "] indicates that it should not be."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end [d2exp_con_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_decrypt_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
  <span class="keyword">val</span> s2e_crypt <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_typ
  <span class="keyword">val</span> s2e <span class="keyword">=</span> <span class="keyword">case+</span> s2e_crypt<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Ecrypt s2e <span class="keyword">=&gt;</span> s2e <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": the dynamic expression is expected to be crypted"<span class="keyword">;</span>
        prerr ", but it is assigned the type ["<span class="keyword">;</span> prerr s2e_crypt<span class="keyword">;</span> prerr "]."<span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15971"><span class="dyncstuse">d3exp_crypt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> ~1<span class="comment">(*decrypt*)</span><span class="keyword">,</span> d3e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_decrypt_tr_up]
</span>
<span class="keyword">fn</span> d2exp_encrypt_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
  <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#29826"><span class="dyncstuse">s2exp_crypt</span></a> d3e<span class="keyword">.</span>d3exp_typ
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15971"><span class="dyncstuse">d3exp_crypt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span>  1<span class="comment">(*encrypt*)</span><span class="keyword">,</span> d3e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_encrypt_tr_up]
</span>
<span class="keyword">fn</span> d2exp_crypt_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> knd<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> knd <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    d2exp_encrypt_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    d2exp_decrypt_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_crypt_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_foldat_freeat_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> isfold<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#14977"><span class="stacstuse">bool</span></a></span><span class="keyword">,</span> s2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> aux <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2e_addr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12972"><span class="dyncstuse">the_d2varset_env_find_viewat</span></a> <span class="keyword">(</span>s2e_addr<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt ans <span class="keyword">=&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>ans<span class="keyword">.</span>0<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span> ans<span class="keyword">.</span>1<span class="keyword">)</span>
    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr loc0<span class="keyword">;</span>
        prerr ": Internal Error: d2exp_foldat_freeat_tr_up: no view at ["<span class="keyword">;</span>
        prerr s2e_addr<span class="keyword">;</span> prerr "]."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>  <span class="comment">// end of [aux]
</span>  <span class="keyword">fun</span> auxlst <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2es_addr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1760"><span class="stacstuse">s2explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1760"><span class="stacstuse">s2explst</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s2es_addr <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>s2e_addr<span class="keyword">,</span> s2es_addr<span class="keyword">)</span> <span class="keyword">=&gt;</span>
        cons <span class="keyword">(</span>aux <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">)</span><span class="keyword">,</span> auxlst <span class="keyword">(</span>loc0<span class="keyword">,</span> s2es_addr<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [auxlst]
</span>  <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e
  <span class="keyword">val</span> s2e <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_typ
  <span class="keyword">var</span> s2es_addr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1760"><span class="stacstuse">s2explst</span></a></span> <span class="keyword">=</span> nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> d2c <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> s2e<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Edatconptr <span class="keyword">(</span>d2c<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>s2es_addr := s2es<span class="keyword">;</span> d2c<span class="keyword">)</span> <span class="comment">// *_unfold
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error3 d2e<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
        <span class="keyword">if</span> isfold <span class="keyword">then</span> <span class="keyword">begin</span>
          prerr ": the dynamic expression cannot be folded as its type is ["
        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
          prerr ": the dynamic expression cannot be freed as its type is ["
        <span class="keyword">end</span><span class="keyword">;</span> <span class="comment">// end of [if]
</span>        prerr s2e<span class="keyword">;</span> prerr "]."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2560"><span class="stacstuse">d2con_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2560"><span class="stacstuse">d2con_t</span></a></span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> s2es_arg <span class="keyword">=</span> auxlst <span class="keyword">(</span>loc0<span class="keyword">,</span> s2es_addr<span class="keyword">)</span>
  <span class="keyword">val</span> s2e_d2c <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#22626"><span class="dyncstuse">d2con_typ_get</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span>
  <span class="keyword">val</span> s2e_d2c <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11217"><span class="dyncstuse">s2exp_uni_instantiate_sexparglst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_d2c<span class="keyword">,</span> s2as<span class="keyword">)</span>
  <span class="keyword">val</span> s2e_d2c <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#10934"><span class="dyncstuse">s2exp_uni_instantiate_all</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_d2c<span class="keyword">)</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> s2e_d2c<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Efun <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> s2es_fun_arg<span class="keyword">,</span> s2e_fun_res<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s2es_fun_arg <span class="keyword">=</span> <span class="keyword">(</span>
          <span class="keyword">if</span> isfold <span class="keyword">then</span> s2es_fun_arg <span class="keyword">else</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#2567"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_map_fun</span></a> <span class="keyword">(</span>s2es_fun_arg<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35177"><span class="dyncstuse">s2exp_topize_0</span></a><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [if]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1760"><span class="stacstuse">s2explst</span></a></span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#3711"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2explst_tyleq_solve_err</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2es_fun_arg<span class="keyword">,</span> err<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">(*
        val () = if isfold then begin // debugging
          print "d2exp_foldat_tr_up: s2es_fun_arg = ";
          print s2es_fun_arg;
          print_newline ();
          print "d2exp_foldat_tr_up: s2es_arg = ";
          print s2es_arg;
          print_newline ();
        end else begin
          print "d2exp_freeat_tr_up: s2es_fun_arg = ";
          print s2es_fun_arg;
          print_newline ();
          print "d2exp_freeat_tr_up: s2es_arg = ";
          print s2es_arg;
          print_newline ();
        end // end of [if]
*)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// error checking
</span>          <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
            prerr_loc_error3 loc0<span class="keyword">;</span>
            <span class="keyword">if</span> isfold <span class="keyword">then</span> <span class="keyword">begin</span>
              prerr ": argument type mismatch for folding"
            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
              prerr ": argument type mismatch for freeing"
            <span class="keyword">end</span><span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> isfold <span class="keyword">then</span> <span class="keyword">let</span>
          <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4494"><span class="dyncstuse">d3exp_lval_typ_set</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="comment">(*refval*)</span><span class="keyword">,</span> d3e<span class="keyword">,</span> s2e_fun_res<span class="keyword">,</span> err<span class="keyword">)</span>
        <span class="keyword">in</span>
          <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
            prerr_loc_error3 loc0<span class="keyword">;</span>
            prerr ": the dynamic expression needs to be a left-value for folding"<span class="keyword">;</span>
            prerr ", but it is not."<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [if]
</span>        <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_interror loc0<span class="keyword">;</span>
        prerr ": d2exp_foldat_freeat_tr_up"<span class="keyword">;</span>
        prerr ": s2e_d2c = "<span class="keyword">;</span> prerr s2e_d2c<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">if</span> isfold <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16429"><span class="dyncstuse">d3exp_foldat</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">else</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16475"><span class="dyncstuse">d3exp_freeat</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_foldat_freeat_tr_up]
</span>
<span class="keyword">fn</span> d2exp_foldat_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span>
  d2exp_foldat_freeat_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4327"><span class="dyncstuse">true</span></a><span class="comment">(*isfold*)</span><span class="keyword">,</span> s2as<span class="keyword">,</span> d2e<span class="keyword">)</span>
<span class="comment">// end of [d2exp_foldat_tr_up]
</span>
<span class="keyword">fn</span> d2exp_freeat_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> s2as<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#9932"><span class="stacstuse">s2exparglst</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span>
  d2exp_foldat_freeat_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#4371"><span class="dyncstuse">false</span></a><span class="comment">(*isfold*)</span><span class="keyword">,</span> s2as<span class="keyword">,</span> d2e<span class="keyword">)</span>
<span class="comment">// end of [d2exp_freeat_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_arg_body_tr_up <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span>
  <span class="keyword">,</span> fc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#15340"><span class="stacstuse">$Syn<span class="keyword">.</span>funclo</span></a></span>
  <span class="keyword">,</span> lin<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span>
  <span class="keyword">,</span> p2ts_arg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2105"><span class="stacstuse">p2atlst</span></a></span><span class="keyword">,</span> d2e_body<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">@(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#2925"><span class="stacstuse">p3atlst</span></a><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2exp_arg_body_tr_up: p2ts_arg = "; print p2ts_arg; print_newline ();
    print "d2exp_arg_body_tr_up: d2e_body = "; print d2e_body; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">var</span> fc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1596"><span class="stacstuse">funclo</span></a></span> <span class="keyword">=</span> fc0
  <span class="keyword">val</span> d2e_body <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2518"><span class="dyncstuse">d2exp_funclo_of_d2exp</span></a> <span class="keyword">(</span>d2e_body<span class="keyword">,</span> fc<span class="keyword">)</span>
  <span class="keyword">var</span> s2fe<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1836"><span class="stacstuse">s2eff</span></a></span> <span class="comment">// uninitialized
</span>  <span class="keyword">val</span> d2e_body <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2582"><span class="dyncstuse">d2exp_s2eff_of_d2exp</span></a> <span class="keyword">(</span>d2e_body<span class="keyword">,</span> s2fe<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7567"><span class="dyncstuse">the_effect_env_push_lam</span></a> <span class="keyword">(</span>s2fe<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12208"><span class="dyncstuse">the_d2varset_env_push_lam</span></a> <span class="keyword">(</span>lin<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "d2exp_tr_up: D2Elam_dyn: d2varset = ";
    the_d2varset_env_print_ld2vs; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11928"><span class="dyncstuse">the_d2varset_env_add_p2atlst</span></a> p2ts_arg
<span class="comment">(*
  val () = begin
    print "d2exp_tr_up: D2Elam_dyn: d2varset = ";
    the_d2varset_env_print_ld2vs; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2es_arg <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#35982"><span class="dyncstuse">p2atlst_typ_syn</span></a> p2ts_arg

  <span class="comment">// checking for pattern match exhaustiveness
</span>  <span class="keyword">val</span> p2tcss <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#3923"><span class="dyncstuse">p2atcstlst_complement</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fpatcst2_2esats.html#2674"><span class="dyncstuse">p2atcstlst_of_p2atlst</span></a> p2ts_arg<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "d2exp_tr_up: D2Elam_dyn: p2tcss = "; print p2tcss; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> cmplt <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> p2tcss <span class="keyword">of</span> cons _ <span class="keyword">=&gt;</span> 0<span class="comment">(*incomplete*)</span> <span class="keyword">|</span> nil _ <span class="keyword">=&gt;</span> 1
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> cmplt <span class="keyword">=</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9864"><span class="dyncstuse">trans3_env_add_p2atcstlstlst_false</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> 1<span class="comment">(*casknd*)</span><span class="keyword">,</span> p2tcss<span class="keyword">,</span> s2es_arg<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> p3ts_arg <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3249"><span class="dyncstuse">p2atlst_arg_tr_up</span></a> <span class="keyword">(</span>npf<span class="keyword">,</span> p2ts_arg<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_lamloop</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15232"><span class="dyncstuse">the_lamloop_env_push_lam</span></a> <span class="keyword">(</span>p3ts_arg<span class="keyword">)</span>
  <span class="keyword">val</span> d3e_body <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_body
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12671"><span class="dyncstuse">the_d2varset_env_check</span></a> loc0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> lin <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12718"><span class="dyncstuse">the_d2varset_env_check_llam</span></a> loc0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15166"><span class="dyncstuse">the_lamloop_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_lamloop</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12137"><span class="dyncstuse">the_d2varset_env_pop_lam</span></a> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> s2e_res <span class="keyword">=</span> d3e_body<span class="keyword">.</span>d3exp_typ
  <span class="keyword">val</span> isprf <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26640"><span class="dyncstuse">s2exp_is_proof</span></a> s2e_res
  <span class="keyword">val</span> s2t_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#11515"><span class="dyncstuse">s2rt_prf_lin_fc</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> isprf<span class="keyword">,</span> lin <span class="keyword">&gt;</span> 0<span class="keyword">,</span> fc<span class="keyword">)</span>
  <span class="keyword">val</span> s2e_fun <span class="keyword">=</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#30327"><span class="dyncstuse">s2exp_fun_srt</span></a> <span class="keyword">(</span>s2t_fun<span class="keyword">,</span> fc<span class="keyword">,</span> lin<span class="keyword">,</span> s2fe<span class="keyword">,</span> npf<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2e_res<span class="keyword">)</span>
  <span class="comment">// end of [val]
</span><span class="comment">(*
  val () = begin
    print "d2exp_tr_up: D2Elam: s2e_fun = "; print s2e_fun; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">@(</span>s2e_fun<span class="keyword">,</span> p3ts_arg<span class="keyword">,</span> d3e_body<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_arg_body_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_lazy_delay_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e_eval<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d3e_eval <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_eval
  <span class="keyword">val</span> s2e_eval <span class="keyword">=</span> d3e_eval<span class="keyword">.</span>d3exp_typ
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26720"><span class="dyncstuse">s2exp_is_linear</span></a> s2e_eval <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">// linearity checking
</span>    prerr_loc_error3 loc0<span class="keyword">;</span>
    prerr ": the keyword [$delay_vt] is needed to form a linear lazy value."<span class="keyword">;</span>
    <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> s2e_lazy <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9614"><span class="dyncstuse">s2exp_lazy_t0ype_type</span></a> s2e_eval
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17264"><span class="dyncstuse">d3exp_lazy_delay</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_lazy<span class="keyword">,</span> d3e_eval<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_lazy_delay_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_lazy_delay_vt_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e_eval<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">,</span> d2e_free<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> sbis <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13313"><span class="dyncstuse">the_d2varset_env_stbefitemlst_save</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> sac <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13916"><span class="dyncstuse">staftscstr_initialize</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#32406"><span class="dyncstuse">i2nvresstate_nil</span></a><span class="keyword">,</span> sbis<span class="keyword">)</span>

  <span class="keyword">val</span> d3e_eval <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> d3e_eval <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> <span class="keyword">(</span>d2e_eval<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#14011"><span class="dyncstuse">staftscstr_stbefitemlst_merge</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> sac<span class="keyword">,</span> sbis<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>d2e_eval<span class="keyword">.</span>d2exp_loc<span class="keyword">)</span>
  <span class="keyword">in</span>
    d3e_eval
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#13484"><span class="dyncstuse">stbefitemlst_restore_lin_typ</span></a> <span class="keyword">(</span>sbis<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> d3e_free <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> d3e_free <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e_free<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7511"><span class="dyncstuse">s2exp_void_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#14011"><span class="dyncstuse">staftscstr_stbefitemlst_merge</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> sac<span class="keyword">,</span> sbis<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>d2e_free<span class="keyword">.</span>d2exp_loc<span class="keyword">)</span>
  <span class="keyword">in</span>
    d3e_free
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#14470"><span class="dyncstuse">staftscstr_stbefitemlst_check</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> sac<span class="keyword">,</span> sbis<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#14578"><span class="dyncstuse">staftscstr_stbefitemlst_update</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> sac<span class="keyword">,</span> sbis<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> s2e_lazy_vt <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9658"><span class="dyncstuse">s2exp_lazy_viewt0ype_viewtype</span></a> <span class="keyword">(</span>d3e_eval<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17323"><span class="dyncstuse">d3exp_lazy_vt_delay</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_lazy_vt<span class="keyword">,</span> d3e_eval<span class="keyword">,</span> d3e_free<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_lazy_delay_vt_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_ptrof_tr_up <span class="keyword">(</span>
   loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2exp_ptrof_tr_up: d2e0 = "; print_d2exp d2e0; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> l2v0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#35671"><span class="dyncstuse">l2val_make_d2exp</span></a> d2e0
<span class="comment">(*
  val () = begin
    print "d2exp_ptrof_tr_up: l2v0 = "; print_l2val l2v0; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> l2v0 <span class="keyword">of</span>
  <span class="keyword">|</span> L2VALptr <span class="keyword">(</span>d2e_ptr<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3e_ptr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_ptr
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_ptr
      <span class="keyword">val</span> s2e_ptr <span class="keyword">=</span> d3e_ptr<span class="keyword">.</span>d3exp_typ
      <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7866"><span class="dyncstuse">un_s2exp_ptr_addr_type</span></a> s2e_ptr <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e <span class="keyword">=&gt;</span> s2e <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error3 d2e_ptr<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
            prerr ": the dynamic expression is expected to be a pointer"<span class="keyword">;</span>
            prerr ", but it is assigned the type ["<span class="keyword">;</span> prerr s2e_ptr<span class="keyword">;</span> prerr "]."<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <span class="keyword">case+</span> d2ls <span class="keyword">of</span>
      <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
          <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
          <span class="keyword">val</span> s2ls <span class="keyword">=</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4025"><span class="dyncstuse">s2exp_addr_viewat_slablst_try</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [val]
</span>          <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
          <span class="keyword">val</span> s2e_prj_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#34908"><span class="dyncstuse">s2exp_projlst</span></a> <span class="keyword">(</span>s2e_addr<span class="keyword">,</span> s2ls<span class="keyword">)</span>
          <span class="keyword">val</span> s2e_prj_ptr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7343"><span class="dyncstuse">s2exp_ptr_addr_type</span></a> <span class="keyword">(</span>s2e_prj_addr<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17834"><span class="dyncstuse">d3exp_ptrof_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_prj_ptr<span class="keyword">,</span> d3e_ptr<span class="keyword">,</span> d3ls<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>      <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17834"><span class="dyncstuse">d3exp_ptrof_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_ptr<span class="keyword">,</span> d3e_ptr<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="comment">// end of [case]
</span>    <span class="keyword">end</span> <span class="comment">// end of [L2VALptr]
</span>  <span class="keyword">|</span> L2VALvar_mut <span class="keyword">(</span>d2v<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> d2ls <span class="keyword">of</span>
      <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
          <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
          <span class="keyword">val</span> s2ls <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4025"><span class="dyncstuse">s2exp_addr_viewat_slablst_try</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">)</span>
          <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
          <span class="keyword">val</span> s2e_prj_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#34908"><span class="dyncstuse">s2exp_projlst</span></a> <span class="keyword">(</span>s2e_addr<span class="keyword">,</span> s2ls<span class="keyword">)</span>
          <span class="keyword">val</span> s2e_prj_ptr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7343"><span class="dyncstuse">s2exp_ptr_addr_type</span></a> <span class="keyword">(</span>s2e_prj_addr<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17919"><span class="dyncstuse">d3exp_ptrof_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_prj_ptr<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>      <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
          <span class="keyword">val</span> s2e_ptr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7343"><span class="dyncstuse">s2exp_ptr_addr_type</span></a> <span class="keyword">(</span>s2e_addr<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17919"><span class="dyncstuse">d3exp_ptrof_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_ptr<span class="keyword">,</span> d2v<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [nil]
</span>      <span class="comment">// end of [case]
</span>    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_mut]
</span>  <span class="keyword">|</span> L2VALarrsub _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": array subscription is not supported for address-of operation."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALarrsub]
</span>  <span class="keyword">|</span> L2VALvar_lin <span class="keyword">(</span>d2v<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
      prerr ", but it is not as ["<span class="keyword">;</span> prerr d2v<span class="keyword">;</span> prerr "] is not mutable."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_lin]
</span>  <span class="keyword">|</span> L2VALnone _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
      prerr ", but it is not."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALnone]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_ptrof_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d3exp_nonlin_check
  <span class="keyword">(</span>d3e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#26720"><span class="dyncstuse">s2exp_is_linear</span></a> <span class="keyword">(</span>d3e<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_loc_error3 d3e<span class="keyword">.</span>d3exp_loc<span class="keyword">;</span>
    prerr ": the dynamic expression is linear but it should not be."<span class="keyword">;</span>
    <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="comment">// end of [d3exp_sort_check]
</span>
<span class="keyword">fun</span> labd3explst_nonlin_check <span class="keyword">(</span>ld3es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10564"><span class="stacstuse">labd3explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> ld3es <span class="keyword">of</span>
  <span class="keyword">|</span> LABD3EXPLSTcons <span class="keyword">(</span>_<span class="comment">(*lab*)</span><span class="keyword">,</span> d3e<span class="keyword">,</span> ld3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d3exp_nonlin_check <span class="keyword">(</span>d3e<span class="keyword">)</span><span class="keyword">;</span> labd3explst_nonlin_check <span class="keyword">(</span>ld3es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [LABD3EXPLSTcons]
</span>  <span class="keyword">|</span> LABD3EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [labd3explst_nonlin_check]
</span>
<span class="keyword">fn</span> d2exp_rec_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> recknd<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> ld2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#20604"><span class="stacstuse">labd2explst</span></a></span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "labd2explst_tr_up: ld2es = "; print ld2es; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>ld2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#20604"><span class="stacstuse">labd2explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10564"><span class="stacstuse">labd3explst</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> ld2es <span class="keyword">of</span>
    <span class="keyword">|</span> LABD2EXPLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> d2e<span class="keyword">,</span> ld2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        LABD3EXPLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e<span class="keyword">,</span> aux ld2es<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> LABD2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABD3EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> ld3es <span class="keyword">=</span> aux ld2es
<span class="comment">(*
  val () = begin
    print "labd2explst_tr_up: ls2es = "; print ls2es; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> recknd <span class="keyword">=</span> 2 <span class="keyword">then</span> labd3explst_nonlin_check <span class="keyword">(</span>ld3es<span class="keyword">)</span>
  <span class="keyword">val</span> ls2es <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#13111"><span class="dyncstuse">labd3explst_typ_get</span></a> ld3es
  <span class="keyword">val</span> s2e_rec <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#31680"><span class="dyncstuse">s2exp_tyrec</span></a> <span class="keyword">(</span>recknd<span class="keyword">,</span> npf<span class="keyword">,</span> ls2es<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18061"><span class="dyncstuse">d3exp_rec</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_rec<span class="keyword">,</span> recknd<span class="keyword">,</span> npf<span class="keyword">,</span> ld3es<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_rec_tr_up]  
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d3exp_sel_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d3e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span><span class="keyword">,</span> d3ls_nt<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11343"><span class="stacstuse">d3lab0lst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d3ls_nt <span class="keyword">of</span>
  <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">var</span> restlin<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0 <span class="keyword">and</span> cstr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1760"><span class="stacstuse">s2explst</span></a></span> <span class="keyword">=</span> nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">@(</span>s2e_prj<span class="keyword">,</span> s2ls<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#36430"><span class="dyncstuse">s2exp_slablst_get_restlin_cstr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e<span class="keyword">.</span>d3exp_typ<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> restlin<span class="keyword">,</span> cstr<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> restlin <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">// restlin check
</span>        prerr_loc_error3 loc0<span class="keyword">;</span>
        prerr ": a linear component is abandoned by label selection."<span class="keyword">;</span>
        <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstuse">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> cstr<span class="keyword">)</span>
      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18306"><span class="dyncstuse">d3exp_sel</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_prj<span class="keyword">,</span> d3e<span class="keyword">,</span> d3ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d3e
<span class="keyword">end</span> <span class="comment">(* end of [d3exp_sel_tr_up] *)</span>

<span class="keyword">fn</span> d2exp_sel_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">,</span> d2ls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#21331"><span class="stacstuse">d2lablst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2exp_sel_tr_up: d2e0 = "; print d2e0; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> d2e0<span class="keyword">.</span>d2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D2Evar d2v <span class="keyword">when</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9165"><span class="dyncstuse">d2var_is_mutable</span></a> d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = begin
        print "d2exp_sel_tr_up: D2Evar(mut): d2v = "; print_d2var d2v; print_newline ()
      end // end of [val]
*)</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span>s2e_elt<span class="keyword">,</span> s2ls<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3866"><span class="dyncstuse">s2exp_addr_slablst_deref</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">)</span>
<span class="comment">(*
      val () = begin
        print "d2exp_sel_tr_up: s2e_elt = "; print s2e_elt; print_newline ()
      end // end of [val]
      val [sgn:int] sgn = $Lst.list_length_compare (s2ls, s2ls_nt)
      val () = (if (sgn &lt;&gt; 0) then begin
        prerr_interror ();
        prerr ": d2exp_sel_tr_up: list length mismatch!"; prerr_newline ();
        $Err.abort {void} ();
        assert (sgn = 0) // deadcode
      end else begin
        () // [sgn = 0] holds!
      end) : [sgn==0] void // end of [val]
*)</span>
      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18457"><span class="dyncstuse">d3exp_sel_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Evar when d2var_is_mutable]
</span>  <span class="keyword">|</span> D2Evar d2v <span class="keyword">when</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9124"><span class="dyncstuse">d2var_is_linear</span></a> d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = begin
        print "d2exp_sel_tr_up: D2Evar(lin): d2v = "; print_d2var d2v; print_newline ()
      end // end of [val]
*)</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> s2e_d2v <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7839"><span class="dyncstuse">d2var_typ_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
      <span class="keyword">var</span> cstr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1760"><span class="stacstuse">s2explst</span></a></span> <span class="keyword">=</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span>s2e_prj<span class="keyword">,</span> s2e_d2v<span class="keyword">,</span> s2ls<span class="keyword">)</span> <span class="keyword">=</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#37370"><span class="dyncstuse">s2exp_slablst_linget_cstr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_d2v<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> cstr<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8716"><span class="dyncstuse">trans3_env_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> cstr<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> Some s2e_d2v<span class="keyword">)</span>
      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18457"><span class="dyncstuse">d3exp_sel_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_prj<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Evar when d2var_is_linear]
</span>  <span class="keyword">|</span> D2Ederef d2e <span class="keyword">=&gt;</span> d2exp_deref_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> d2ls<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
     <span class="keyword">val</span> d3e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e0
     <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
   <span class="keyword">in</span>
     d3exp_sel_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e0<span class="keyword">,</span> d3ls_nt<span class="keyword">)</span>
   <span class="keyword">end</span> <span class="comment">// end of [D2Ederef]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_sel_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_seq_tr_up
   <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
   <span class="keyword">fun</span> aux <span class="keyword">(</span>
      d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span>
    <span class="keyword">,</span> d2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span>
    <span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span><span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a>?<span class="keyword">)</span> &gt;&gt; <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span>
    <span class="keyword">,</span> s2e_void<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> <span class="keyword">:</span><span class="keyword">(</span>s2e<span class="keyword">:</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2es <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>d2e1<span class="keyword">,</span> d2es1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e<span class="keyword">,</span> s2e_void<span class="keyword">)</span>
      <span class="keyword">in</span>
        cons <span class="keyword">(</span>d3e<span class="keyword">,</span> aux <span class="keyword">(</span>d2e1<span class="keyword">,</span> d2es1<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e_void<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> <span class="keyword">(</span>d2e<span class="keyword">)</span>
      <span class="keyword">in</span>
        s2e := d3e<span class="keyword">.</span>d3exp_typ<span class="keyword">;</span> cons <span class="keyword">(</span>d3e<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> s2e_void <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7511"><span class="dyncstuse">s2exp_void_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> d2es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d2e<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">var</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// uninitialized
</span>      <span class="keyword">val</span> d3es <span class="keyword">=</span> aux <span class="keyword">(</span>d2e<span class="keyword">,</span> d2es<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e_void<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18538"><span class="dyncstuse">d3exp_seq</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> d3es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16164"><span class="dyncstuse">d3exp_empty</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_void<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_seq_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_tmpid_tr_up <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">,</span> ts2ess<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#8466"><span class="stacstuse">tmps2explstlst</span></a></span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>subs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1795"><span class="stacstuse">s2explstlst</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> subs <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>sub<span class="keyword">,</span> subs<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33604"><span class="dyncstuse">stasub_codomain_get_whnf</span></a> sub<span class="keyword">,</span> aux subs<span class="keyword">)</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> d2e<span class="keyword">.</span>d2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D2Ecst d2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_d2c <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#4635"><span class="dyncstuse">d2cst_typ_get</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span>
      <span class="keyword">val</span> s2vpss <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#4538"><span class="dyncstuse">d2cst_decarg_get</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span>subs<span class="keyword">,</span> s2e_tmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11320"><span class="dyncstuse">s2exp_template_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss<span class="keyword">,</span> ts2ess<span class="keyword">,</span> s2e_d2c<span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val</span> s2ess <span class="keyword">=</span> aux subs
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18808"><span class="dyncstuse">d3exp_tmpcst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_tmp<span class="keyword">,</span> d2c<span class="keyword">,</span> s2ess<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Ecst]
</span>  <span class="keyword">|</span> D2Evar d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_d2v <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7839"><span class="dyncstuse">d2var_typ_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
      <span class="keyword">val</span> s2vpss <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7151"><span class="dyncstuse">d2var_decarg_get</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span>subs<span class="keyword">,</span> s2e_tmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11320"><span class="dyncstuse">s2exp_template_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss<span class="keyword">,</span> ts2ess<span class="keyword">,</span> s2e_d2v<span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val</span> s2ess <span class="keyword">=</span> aux subs
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18889"><span class="dyncstuse">d3exp_tmpvar</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_tmp<span class="keyword">,</span> d2v<span class="keyword">,</span> s2ess<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Evar]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 loc0<span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdebug_2esats.html#1975"><span class="dyncstuse">$Deb<span class="keyword">.</span>debug_prerrf</span></a> <span class="keyword">(</span>": %s: d2exp_tmpid_tr_up"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a constant or a variable."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">(* end of [d2exp_tmpid_tr_up] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="58547"><span class="dyncstdec">d2exp_viewat_tr_up
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2e0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span></span></a>

<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#58547"><span class="dyncstimp">d2exp_viewat_tr_up</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> l2v0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#35671"><span class="dyncstuse">l2val_make_d2exp</span></a> d2e0
<span class="keyword">in</span>
  <span class="keyword">case+</span> l2v0 <span class="keyword">of</span>
  <span class="keyword">|</span> L2VALptr <span class="keyword">(</span>d2e_ptr<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3e_ptr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_ptr
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_ptr
      <span class="keyword">val</span> s2e_ptr <span class="keyword">=</span> d3e_ptr<span class="keyword">.</span>d3exp_typ
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
    <span class="keyword">in</span>
      <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7866"><span class="dyncstuse">un_s2exp_ptr_addr_type</span></a> s2e_ptr <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_addr <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span>s2e_at<span class="keyword">,</span> s2ls<span class="keyword">,</span> d2v_view<span class="keyword">,</span> s2ls_view<span class="keyword">)</span> <span class="keyword">=</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4128"><span class="dyncstuse">s2exp_addr_viewat_slablst_get</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">)</span>
          <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19132"><span class="dyncstuse">d3exp_viewat_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_at<span class="keyword">,</span> d3e_ptr<span class="keyword">,</span> d3ls<span class="keyword">,</span> d2v_view<span class="keyword">,</span> s2ls_view<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          prerr_loc_error3 d2e_ptr<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
          prerr ": the dynamic expression is expected to be a pointer"<span class="keyword">;</span>
          prerr ", but it is given the type ["<span class="keyword">;</span> prerr s2e_ptr<span class="keyword">;</span> prerr "]."<span class="keyword">;</span>
          <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
<span class="comment">(*
          prerr "d2e_ptr = "; prerr d2e_ptr; prerr_newline ();
*)</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="comment">// end of [case]
</span>    <span class="keyword">end</span> <span class="comment">// end of [L2VALptr]
</span>  <span class="keyword">|</span> L2VALvar_mut <span class="keyword">(</span>d2v<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">@(</span>s2e_at<span class="keyword">,</span> s2ls<span class="keyword">,</span> d2v_view<span class="keyword">,</span> s2ls_view<span class="keyword">)</span> <span class="keyword">=</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4128"><span class="dyncstuse">s2exp_addr_viewat_slablst_get</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">)</span>
      <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19254"><span class="dyncstuse">d3exp_viewat_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_at<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">,</span> d2v_view<span class="keyword">,</span> s2ls_view<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_mul]
</span>  <span class="keyword">|</span> L2VALarrsub _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": error(3)"<span class="keyword">;</span>
      prerr ": array subscription is not supported for view extraction."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALarrsub]
</span>  <span class="keyword">|</span> L2VALvar_lin <span class="keyword">(</span>d2v<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
      prerr ", but it is not as ["<span class="keyword">;</span> prerr d2v<span class="keyword">;</span> prerr "] is not mutable."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar]
</span>  <span class="keyword">|</span> L2VALnone _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e0<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
      prerr ", but it is not."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALnone]
</span><span class="keyword">end</span> <span class="comment">(* end of [d2exp_viewat_tr_up] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// the function is declared above
</span><span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#29144"><span class="dyncstimp">d2exp_viewat_assgn_tr_up</span></a>
  <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_l<span class="keyword">,</span> d2e_r<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> l2v <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#35671"><span class="dyncstuse">l2val_make_d2exp</span></a> d2e_l
<span class="keyword">in</span>
  <span class="keyword">case+</span> l2v <span class="keyword">of</span>
  <span class="keyword">|</span> L2VALptr <span class="keyword">(</span>d2e_ptr<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3e_ptr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_ptr
      <span class="keyword">val</span> s2e_ptr <span class="keyword">=</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_ptr<span class="keyword">;</span> d3e_ptr<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> d3e_r <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_r
      <span class="keyword">val</span> s2e_r <span class="keyword">=</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_r<span class="keyword">;</span> d3e_r<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7866"><span class="dyncstuse">un_s2exp_ptr_addr_type</span></a> s2e_ptr <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2e_addr <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> s2ls <span class="keyword">=</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4350"><span class="dyncstuse">s2exp_addr_viewat_slablst_set</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> s2e_r<span class="keyword">)</span>
          <span class="keyword">end</span>
          <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19378"><span class="dyncstuse">d3exp_viewat_assgn_ptr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e_ptr<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          prerr_loc_error3 d2e_ptr<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
          prerr ": the dynamic expression is expected to be a pointer"<span class="keyword">;</span>
          prerr ", but it is given the type ["<span class="keyword">;</span> prerr s2e_ptr<span class="keyword">;</span> prerr "]."<span class="keyword">;</span>
          <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALptr]
</span>  <span class="keyword">|</span> L2VALvar_mut <span class="keyword">(</span>d2v<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3ls_nt <span class="keyword">=</span> d2lablst_tr_up d2ls
      <span class="keyword">val</span> s2ls_nt <span class="keyword">=</span> s2lab0lst_of_d3lab0lst d3ls_nt
      <span class="keyword">val</span> d3e_r <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_r
      <span class="keyword">val</span> s2e_r <span class="keyword">=</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_r<span class="keyword">;</span> d3e_r<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> d2ls <span class="keyword">of</span>
      <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
          <span class="keyword">val</span> s2ls <span class="keyword">=</span> <span class="keyword">begin</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4350"><span class="dyncstuse">s2exp_addr_viewat_slablst_set</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> s2ls_nt<span class="keyword">,</span> s2e_r<span class="keyword">)</span>
          <span class="keyword">end</span>
          <span class="keyword">val</span> d3ls <span class="keyword">=</span> d3lab1lst_of_d3lab0lst_s2lablst <span class="keyword">(</span>d3ls_nt<span class="keyword">,</span> s2ls<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19472"><span class="dyncstuse">d3exp_viewat_assgn_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>      <span class="keyword">|</span> nil _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d2v_view <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#8002"><span class="dyncstuse">d2var_view_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7527"><span class="dyncstuse">d2var_typ_get</span></a> <span class="keyword">(</span>d2v_view<span class="keyword">)</span> <span class="keyword">of</span>
            <span class="keyword">|</span> Some s2e_at <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_5fsolve_2esats.html#2633"><span class="dyncstuse">$SOL<span class="keyword">.</span>s2exp_out_void_solve_at</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_at<span class="keyword">)</span>
            <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v_view<span class="keyword">,</span> Some s2e_r<span class="keyword">)</span>
        <span class="keyword">in</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19472"><span class="dyncstuse">d3exp_viewat_assgn_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> d3e_r<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [nil]
</span>      <span class="comment">// end of [case]
</span>    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_mul]
</span>  <span class="keyword">|</span> L2VALarrsub _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e_l<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": array subscription is not supported for view assignment."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALarrsub]
</span>  <span class="keyword">|</span> L2VALvar_lin <span class="keyword">(</span>d2v<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e_l<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
      prerr ", but it is not as ["<span class="keyword">;</span> prerr d2v<span class="keyword">;</span> prerr "] is not mutable."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALvar_lin]
</span>  <span class="keyword">|</span> L2VALnone _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 d2e_l<span class="keyword">.</span>d2exp_loc<span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be a left-value"<span class="keyword">;</span>
      prerr ", but it is not."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [L2VALnone]
</span>  <span class="comment">// end of [case]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_view_assgn_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> d2explst_elt_tr_dn <span class="keyword">(</span>d2es<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2214"><span class="stacstuse">d2explst</span></a></span><span class="keyword">,</span> s2e<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#11109"><span class="stacstuse">d3explst</span></a></span> <span class="keyword">=</span> 
  <span class="keyword">case+</span> d2es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d2e<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">,</span> d2explst_elt_tr_dn <span class="keyword">(</span>d2es<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span><span class="comment">// end of [d2explst_elt_tr_dn]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstimp">d2exp_tr_up</span></a> <span class="keyword">(</span>d2e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span><span class="comment">(*
val () = begin
  print "d2exp_tr_up: loc0 = ";
  $Loc.print_location d2e0.d2exp_loc; print_newline ()
end // end of [val]
val () = begin
  print "d2exp_tr_up: d2e0 = "; print d2e0; print_newline ()
end // end of [val]
*)</span>
<span class="comment">//
</span><span class="keyword">extern</span> <span class="keyword">fun</span> <a name="64722"><span class="dyncstdec">floatkind_eval
  <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#37502"><span class="stacstuse">$Syn<span class="keyword">.</span>floatkind</span></a></span></span></a> <span class="keyword">=</span> "ats_trans3_floatkind_eval"
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="64808"><span class="dyncstdec">intkind_eval
  <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#37644"><span class="stacstuse">$Syn<span class="keyword">.</span>intkind</span></a></span></span></a> <span class="keyword">=</span> "ats_trans3_intkind_eval"
<span class="comment">//
</span><span class="keyword">val</span> loc0 <span class="keyword">=</span> d2e0<span class="keyword">.</span>d2exp_loc
<span class="keyword">val</span> d3e0 <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d2e0<span class="keyword">.</span>d2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D2Eann_type <span class="keyword">(</span>d2e<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#35358"><span class="dyncstuse">s2exp_whnf</span></a> s2e<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#14962"><span class="dyncstuse">d3exp_ann_type</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Eann_type]
</span>  <span class="keyword">|</span> D2Eapps <span class="keyword">(</span>d2e_fun<span class="keyword">,</span> d2as_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> d2e_fun<span class="keyword">.</span>d2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> D2Emac d2m <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2e0 <span class="keyword">=</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmacro2_2esats.html#1872"><span class="dyncstuse">$MAC<span class="keyword">.</span>macro_eval_app_short</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2m<span class="keyword">,</span> d2as_arg<span class="keyword">)</span>
        <span class="comment">// end of [val]
</span><span class="comment">(*
        val () = begin
          print "d2exp_tr_up: D2Eapps: D2Emac: d2e0 = "; print_d2exp d2e0; print_newline ()
        end // end of [val]
*)</span>
      <span class="keyword">in</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e0
      <span class="keyword">end</span> <span class="comment">// end of [D2Emac]
</span>    <span class="keyword">|</span> D2Esym d2s <span class="keyword">=&gt;</span> d2exp_apps_sym_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">,</span> d2as_arg<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d3e_fun <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_fun
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2830"><span class="dyncstuse">d3exp_open_and_add</span></a> d3e_fun
      <span class="keyword">in</span>
        d2exp_apps_tr_up <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> d2as_arg<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D2Eapps]
</span>  <span class="keyword">|</span> D2Earrsize <span class="keyword">(</span>os2e_elt<span class="keyword">,</span> d2es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sz <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#2308"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_length</span></a> d2es_elt
      <span class="keyword">val</span> s2e_elt <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> os2e_elt <span class="keyword">of</span>
        <span class="keyword">|</span> Some s2e <span class="keyword">=&gt;</span> s2e <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> s2t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10312"><span class="dyncstuse">s2rt_t0ype</span></a> <span class="keyword">in</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2t<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> d3es_elt <span class="keyword">=</span> d2explst_elt_tr_dn <span class="keyword">(</span>d2es_elt<span class="keyword">,</span> s2e_elt<span class="keyword">)</span>
      <span class="keyword">val</span> s2e_arrsz <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9062"><span class="dyncstuse">s2exp_arraysize_viewt0ype_int_viewt0ype</span></a> <span class="keyword">(</span>s2e_elt<span class="keyword">,</span> sz<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15272"><span class="dyncstuse">d3exp_arrsize</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_arrsz<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> d3es_elt<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Earrsize]
</span>  <span class="keyword">|</span> D2Earrsub <span class="keyword">(</span>d2s_brackets<span class="keyword">,</span> d2e_arr<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d2ess_ind<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#24686"><span class="dyncstuse">d2exp_var_cst_is_ptr</span></a> d2e_arr <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2l <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#32281"><span class="dyncstuse">d2lab_ind</span></a> <span class="keyword">(</span>loc_ind<span class="keyword">,</span> d2ess_ind<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_deref_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_arr<span class="keyword">,</span> <span class="keyword">'[</span>d2l<span class="keyword">]</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2ess_ind <span class="keyword">of</span>
        <span class="keyword">|</span> cons <span class="keyword">(</span>d2es_ind<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> d2a <span class="keyword">=</span> D2EXPARGdyn <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="keyword">,</span> cons <span class="keyword">(</span>d2e_arr<span class="keyword">,</span> d2es_ind<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">in</span>
            d2exp_apps_sym_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s_brackets<span class="keyword">,</span> <span class="keyword">'[</span>d2a<span class="keyword">]</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_error3 loc_ind<span class="keyword">;</span>
            prerr ": the format for array subscripts ["<span class="keyword">;</span> prerr d2ess_ind<span class="keyword">;</span>
            prerr "] is not supported."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D2Earrsub]
</span>  <span class="keyword">|</span> D2Eassgn <span class="keyword">(</span>d2e_l<span class="keyword">,</span> d2e_r<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_assgn_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_l<span class="keyword">,</span> d2e_r<span class="keyword">)</span>
  <span class="keyword">|</span> D2Ebool b <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#6975"><span class="dyncstuse">s2exp_bool_bool_t0ype</span></a> b <span class="keyword">in</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15525"><span class="dyncstuse">d3exp_bool</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> b<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Ebool]
</span>  <span class="keyword">|</span> D2Ecaseof <span class="keyword">(</span>casknd<span class="keyword">,</span> res<span class="keyword">,</span> n<span class="keyword">,</span> d2es<span class="keyword">,</span> c2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_cas <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10312"><span class="dyncstuse">s2rt_t0ype</span></a><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5834"><span class="dyncstuse">d2exp_caseof_tr_dn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> casknd<span class="keyword">,</span> res<span class="keyword">,</span> n<span class="keyword">,</span> d2es<span class="keyword">,</span> c2ls<span class="keyword">,</span> s2e_cas<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Ecaseof]
</span>  <span class="keyword">|</span> D2Echar c<span class="comment">(*char*)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7049"><span class="dyncstuse">s2exp_char_char_t0ype</span></a> c <span class="keyword">in</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15702"><span class="dyncstuse">d3exp_char</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> c<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Echar]
</span>  <span class="keyword">|</span> D2Econ <span class="keyword">(</span>d2c<span class="keyword">,</span> s2as<span class="keyword">,</span> npf<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_con_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">,</span> s2as<span class="keyword">,</span> npf<span class="keyword">,</span> d2es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Econ]
</span>  <span class="keyword">|</span> D2Ecrypt <span class="keyword">(</span>knd<span class="keyword">,</span> d2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_crypt_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d2e<span class="keyword">)</span>
  <span class="keyword">|</span> D2Ecst d2c <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5049"><span class="dyncstuse">d2exp_cst_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span>
  <span class="keyword">|</span> D2Ecstsp cst <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2713"><span class="dyncstuse">d2exp_cstsp_typ_syn</span></a> <span class="keyword">(</span>cst<span class="keyword">)</span> <span class="keyword">in</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15909"><span class="dyncstuse">d3exp_cstsp</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> cst<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Ecstsp]
</span>  <span class="keyword">|</span> D2Ederef d2e <span class="keyword">=&gt;</span> d2exp_deref_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> D2Edynload fil <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16036"><span class="dyncstuse">d3exp_dynload</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> fil<span class="keyword">)</span>
  <span class="keyword">|</span> D2Eeffmask <span class="keyword">(</span>effs<span class="keyword">,</span> d2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7772"><span class="dyncstuse">the_effect_env_push_effmask</span></a> <span class="keyword">(</span>effs<span class="keyword">)</span>
      <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16093"><span class="dyncstuse">d3exp_effmask</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> effs<span class="keyword">,</span> d3e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Eeffmask]
</span>  <span class="keyword">|</span> D2Eempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16164"><span class="dyncstuse">d3exp_empty</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7511"><span class="dyncstuse">s2exp_void_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> D2Eextval <span class="keyword">(</span>s2e<span class="keyword">,</span> code<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16521"><span class="dyncstuse">d3exp_extval</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> code<span class="keyword">)</span>
  <span class="keyword">|</span> D2Efix <span class="keyword">(</span>knd<span class="keyword">,</span> d2v<span class="keyword">,</span> d2e_def<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_def <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#36037"><span class="dyncstuse">d2exp_typ_syn</span></a> <span class="keyword">(</span>d2e_def<span class="keyword">)</span>
      <span class="keyword">val</span> os2e_def <span class="keyword">=</span> Some <span class="keyword">(</span>s2e_def<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7662"><span class="dyncstuse">d2var_mastyp_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> os2e_def<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> os2e_def<span class="keyword">)</span>
      <span class="keyword">val</span> d3e_def <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> <span class="keyword">(</span>d2e_def<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16209"><span class="dyncstuse">d3exp_fix</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_def<span class="keyword">,</span> knd<span class="keyword">,</span> d2v<span class="keyword">,</span> d3e_def<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Efix]
</span>  <span class="keyword">|</span> D2Efoldat <span class="keyword">(</span>s2as<span class="keyword">,</span> d2e_at<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_foldat_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> s2as<span class="keyword">,</span> d2e_at<span class="keyword">)</span>
  <span class="keyword">|</span> D2Efor <span class="keyword">(</span>
      lpi2nv<span class="keyword">,</span> d2e_init<span class="keyword">,</span> d2e_test<span class="keyword">,</span> d2e_post<span class="keyword">,</span> d2e_body
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5258"><span class="dyncstuse">d2exp_loop_tr_up</span></a> <span class="keyword">(</span>
      loc0<span class="keyword">,</span> lpi2nv<span class="keyword">,</span> Some d2e_init<span class="keyword">,</span> d2e_test<span class="keyword">,</span> Some d2e_post<span class="keyword">,</span> d2e_body
    <span class="keyword">)</span> <span class="comment">// end of [D2Efor]
</span>  <span class="keyword">|</span> D2Efreeat <span class="keyword">(</span>s2as<span class="keyword">,</span> d2e_at<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_freeat_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> s2as<span class="keyword">,</span> d2e_at<span class="keyword">)</span>
  <span class="keyword">|</span> D2Eif <span class="keyword">(</span>res<span class="keyword">,</span> d2e_cond<span class="keyword">,</span> d2e_then<span class="keyword">,</span> od2e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_if <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> od2e_else <span class="keyword">of</span>
        <span class="keyword">|</span> Some _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10312"><span class="dyncstuse">s2rt_t0ype</span></a><span class="keyword">)</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7511"><span class="dyncstuse">s2exp_void_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5652"><span class="dyncstuse">d2exp_if_tr_dn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> res<span class="keyword">,</span> d2e_cond<span class="keyword">,</span> d2e_then<span class="keyword">,</span> od2e_else<span class="keyword">,</span> s2e_if<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Eif]
</span>  <span class="keyword">|</span> D2Efloat <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7092"><span class="dyncstuse">s2exp_double_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">in</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16316"><span class="dyncstuse">d3exp_float</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> str<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Efloat]
</span>  <span class="keyword">|</span> D2Efloatsp <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#64722"><span class="dyncstuse">floatkind_eval</span></a> <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>FLOATKINDfloat <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7163"><span class="dyncstuse">s2exp_float_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>FLOATKINDdouble <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7092"><span class="dyncstuse">s2exp_double_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>FLOATKINDdouble_long <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7125"><span class="dyncstuse">s2exp_double_long_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>FLOATKINDnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr loc0<span class="keyword">;</span>
            prerr "Internal Error: d2exp_tr: D2Efloatsp: FLOATKINDnone"<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16371"><span class="dyncstuse">d3exp_floatsp</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> str<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Efloatsp]
</span>  <span class="keyword">|</span> D2Eint <span class="keyword">(</span>str<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7265"><span class="dyncstuse">s2exp_int_intinf_t0ype</span></a> int
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16688"><span class="dyncstuse">d3exp_int</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> str<span class="keyword">,</span> int<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Eint]
</span>  <span class="keyword">|</span> D2Eintsp <span class="keyword">(</span>str<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#64808"><span class="dyncstuse">intkind_eval</span></a> <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>INTKINDuint <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7614"><span class="dyncstuse">s2exp_uint_intinf_t0ype</span></a> <span class="keyword">(</span>int<span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>INTKINDlint <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8178"><span class="dyncstuse">s2exp_lint_intinf_t0ype</span></a> <span class="keyword">(</span>int<span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>INTKINDulint <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8260"><span class="dyncstuse">s2exp_ulint_intinf_t0ype</span></a> <span class="keyword">(</span>int<span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>INTKINDllint <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8311"><span class="dyncstuse">s2exp_llint_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>INTKINDullint <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8343"><span class="dyncstuse">s2exp_ullint_t0ype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr_loc_interror loc0<span class="keyword">;</span>
            prerr ": d2exp_tr: D2Eintsp"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16758"><span class="dyncstuse">d3exp_intsp</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> str<span class="keyword">,</span> int<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Eintsp]
</span>  <span class="keyword">|</span> D2Elam_dyn <span class="keyword">(</span>lin<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> fc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#15340"><span class="stacstuse">$Syn<span class="keyword">.</span>funclo</span></a></span> <span class="keyword">=</span> $Syn<span class="keyword">.</span>FUNCLOfun <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// default
</span>      <span class="keyword">val</span> <span class="keyword">@(</span>s2e_fun<span class="keyword">,</span> p3ts_arg<span class="keyword">,</span> d3e_body<span class="keyword">)</span> <span class="keyword">=</span>
        d2exp_arg_body_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> fc0<span class="keyword">,</span> lin<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span>
      <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16852"><span class="dyncstuse">d3exp_lam_dyn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_fun<span class="keyword">,</span> lin<span class="keyword">,</span> npf<span class="keyword">,</span> p3ts_arg<span class="keyword">,</span> d3e_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Elam_dyn]
</span>  <span class="keyword">|</span> D2Elaminit_dyn <span class="keyword">(</span>lin<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> fc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fsyntax_2esats.html#15340"><span class="stacstuse">$Syn<span class="keyword">.</span>funclo</span></a></span> <span class="keyword">=</span> $Syn<span class="keyword">.</span>FUNCLOclo 0<span class="comment">(*unboxed*)</span> <span class="comment">// default
</span>      <span class="keyword">val</span> <span class="keyword">@(</span>s2e_fun<span class="keyword">,</span> p3ts_arg<span class="keyword">,</span> d3e_body<span class="keyword">)</span> <span class="keyword">=</span>
        d2exp_arg_body_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> fc0<span class="keyword">,</span> lin<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span>
      <span class="keyword">var</span> err <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> s2e_fun<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> S2Efun <span class="keyword">(</span>fc<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> fc <span class="keyword">of</span>
          <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOclo 0 <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOclo _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> err := err + 1 <span class="keyword">in</span>
              prerr_loc_error3 loc0<span class="keyword">;</span>
              prerr ": a flat closure is needed."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span>
          <span class="keyword">|</span> $Syn<span class="keyword">.</span>FUNCLOfun _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> err := err + 1 <span class="keyword">in</span>
              prerr_loc_error3 loc0<span class="keyword">;</span>
              prerr ": a flat closure is needed."<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span>
            <span class="keyword">end</span>
          <span class="keyword">end</span> <span class="comment">// end of [S2Efun]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// HX: deadcode
</span>      <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> <span class="keyword">(</span>err <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#16953"><span class="dyncstuse">d3exp_laminit_dyn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_fun<span class="keyword">,</span> lin<span class="keyword">,</span> npf<span class="keyword">,</span> p3ts_arg<span class="keyword">,</span> d3e_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Elaminit_dyn]
</span>  <span class="keyword">|</span> D2Elam_met <span class="keyword">(</span>r_d2vs<span class="keyword">,</span> s2es_met<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#6979"><span class="dyncstuse">metric_nat_check</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2es_met<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_metric</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7141"><span class="dyncstuse">metric_env_push</span></a> <span class="keyword">(</span><span class="keyword">!</span>r_d2vs<span class="keyword">,</span> s2es_met<span class="keyword">)</span>
      <span class="keyword">val</span> d3e_body <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_body
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7082"><span class="dyncstuse">metric_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_metric</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17079"><span class="dyncstuse">d3exp_lam_met</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2es_met<span class="keyword">,</span> d3e_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Elam_met]
</span>  <span class="keyword">|</span> D2Elam_sta <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#8419"><span class="dyncstuse">trans3_env_add_svarlst</span></a> s2vs
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9072"><span class="dyncstuse">trans3_env_hypo_add_proplst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2ps<span class="keyword">)</span>
      <span class="keyword">val</span> d3e_body <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_body
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span>
      <span class="keyword">val</span> s2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#31832"><span class="dyncstuse">s2exp_uni</span></a> <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> d3e_body<span class="keyword">.</span>d3exp_typ<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17145"><span class="dyncstuse">d3exp_lam_sta</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> d3e_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Elam_sta]
</span>  <span class="keyword">|</span> D2Elazy_delay <span class="keyword">(</span>d2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span> <span class="comment">// as if checking [llam () =&lt;~ref&gt; d2e]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect1</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7772"><span class="dyncstuse">the_effect_env_push_effmask</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5feffect_2esats.html#1870"><span class="dyncstuse">$Eff<span class="keyword">.</span>effectlst_all</span></a><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect2</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7634"><span class="dyncstuse">the_effect_env_push_delay</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12208"><span class="dyncstuse">the_d2varset_env_push_lam</span></a> <span class="keyword">(</span>1<span class="comment">(*linear*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_lamloop</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15232"><span class="dyncstuse">the_lamloop_env_push_lam</span></a> <span class="keyword">(</span>nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">val</span> d3e_lazy <span class="keyword">=</span> d2exp_lazy_delay_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12671"><span class="dyncstuse">the_d2varset_env_check</span></a> loc0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12718"><span class="dyncstuse">the_d2varset_env_check_llam</span></a> loc0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15166"><span class="dyncstuse">the_lamloop_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_lamloop</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12137"><span class="dyncstuse">the_d2varset_env_pop_lam</span></a> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect2</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect1</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span>
    <span class="keyword">in</span>
      d3e_lazy
    <span class="keyword">end</span> <span class="comment">// end of [D2Elazy_delay]
</span>  <span class="keyword">|</span> D2Elazy_vt_delay <span class="keyword">(</span>d2e_eval<span class="keyword">,</span> d2e_free<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="comment">// as if checking [llam (b) =&lt;~ref&gt; if b then d2e_eval else d2e_free]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15826"><span class="dyncstuse">trans3_env_push_sta</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect1</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7772"><span class="dyncstuse">the_effect_env_push_effmask</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5feffect_2esats.html#1870"><span class="dyncstuse">$Eff<span class="keyword">.</span>effectlst_all</span></a><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect2</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7634"><span class="dyncstuse">the_effect_env_push_delay</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12208"><span class="dyncstuse">the_d2varset_env_push_lam</span></a> <span class="keyword">(</span>1<span class="comment">(*linear*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_lamloop</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15232"><span class="dyncstuse">the_lamloop_env_push_lam</span></a> <span class="keyword">(</span>nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">val</span> d3e_lazy_vt <span class="keyword">=</span> d2exp_lazy_delay_vt_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_eval<span class="keyword">,</span> d2e_free<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12671"><span class="dyncstuse">the_d2varset_env_check</span></a> loc0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12718"><span class="dyncstuse">the_d2varset_env_check_llam</span></a> loc0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15166"><span class="dyncstuse">the_lamloop_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_lamloop</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12137"><span class="dyncstuse">the_d2varset_env_pop_lam</span></a> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect2</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect1</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#15732"><span class="dyncstuse">trans3_env_pop_sta_and_add_none</span></a> <span class="keyword">(</span>loc0<span class="keyword">)</span>
    <span class="keyword">in</span>
      d3e_lazy_vt
    <span class="keyword">end</span> <span class="comment">// end of [D2Elazy_vt_delay]
</span>  <span class="keyword">|</span> D2Elet <span class="keyword">(</span>d2cs<span class="keyword">,</span> d2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7513"><span class="dyncstuse">the_effect_env_push</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2cstlst</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5890"><span class="dyncstuse">the_s2cstlst_env_push</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12350"><span class="dyncstuse">the_d2varset_env_push_let</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d3cs <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#7115"><span class="dyncstuse">d2eclst_tr</span></a> d2cs<span class="keyword">;</span> <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12671"><span class="dyncstuse">the_d2varset_env_check</span></a> loc0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12279"><span class="dyncstuse">the_d2varset_env_pop_let</span></a> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5812"><span class="dyncstuse">the_s2cstlst_env_pop_and_unbind</span></a> <span class="keyword">(</span><span class="prfexp">pf_s2cstlst</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17487"><span class="dyncstuse">d3exp_let</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3cs<span class="keyword">,</span> d3e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Elet]
</span>  <span class="keyword">|</span> D2Eloopexn i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5197"><span class="dyncstuse">d2exp_loopexn_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> i<span class="keyword">)</span> <span class="comment">// 0/1: break/continue
</span>    <span class="keyword">end</span> <span class="comment">// end of [D2Eloopexn]
</span>  <span class="keyword">|</span> D2Elst <span class="keyword">(</span>lin<span class="keyword">,</span> os2e_elt<span class="keyword">,</span> d2es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_elt <span class="keyword">=</span> <span class="keyword">case+</span> os2e_elt <span class="keyword">of</span>
        <span class="keyword">|</span> Some s2e_elt <span class="keyword">=&gt;</span> s2e_elt
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> s2t <span class="keyword">=</span> <span class="keyword">if</span> lin <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10380"><span class="dyncstuse">s2rt_viewt0ype</span></a> <span class="keyword">else</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10312"><span class="dyncstuse">s2rt_t0ype</span></a>
          <span class="keyword">in</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2t<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [None]
</span>      <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#2308"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_length</span></a> d2es_elt
      <span class="keyword">val</span> d3es_elt <span class="keyword">=</span> d2explst_elt_tr_dn <span class="keyword">(</span>d2es_elt<span class="keyword">,</span> s2e_elt<span class="keyword">)</span>
      <span class="keyword">val</span> s2e_lst <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">if</span> lin <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9216"><span class="dyncstuse">s2exp_list_viewt0ype_int_viewtype</span></a> <span class="keyword">(</span>s2e_elt<span class="keyword">,</span> n<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
          <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#9157"><span class="dyncstuse">s2exp_list_t0ype_int_type</span></a> <span class="keyword">(</span>s2e_elt<span class="keyword">,</span> n<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1684"><span class="stacstuse">s2exp</span></a></span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#17748"><span class="dyncstuse">d3exp_lst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_lst<span class="keyword">,</span> lin<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> d3es_elt<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Elst]
</span>  <span class="keyword">|</span> D2Emac d2m <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2as <span class="keyword">=</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// no arguments for [d2m]
</span><span class="comment">(*
      val () = begin
        print "d2exp_tr_up: D2Emac: loc0 = ";
        $Loc.print_location loc0; print_newline ()
      end // end of [val]
*)</span>
      <span class="keyword">val</span> d2e0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmacro2_2esats.html#1872"><span class="dyncstuse">$MAC<span class="keyword">.</span>macro_eval_app_short</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2m<span class="keyword">,</span> d2as<span class="keyword">)</span>
<span class="comment">(*
      val () = begin
        print "d2exp_tr_up: D2Emac: d2e0.d2exp_loc = ";
        $Loc.print_location d2e0.d2exp_loc; print_newline ()
      end // end of [val]
*)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> <span class="keyword">(</span>d2e0<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Emac]
</span>  <span class="keyword">|</span> D2Emacsyn <span class="keyword">(</span>knd<span class="keyword">,</span> d2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e_mac <span class="keyword">where</span> <span class="keyword">{</span>
<span class="comment">(*
      val () = begin
        print "d2exp_tr_up: D2Emacsyn: knd = "; print knd; print_newline ();
        print "d2exp_tr_up: D2Emacsyn: d2e = "; print d2e; print_newline ();
      end // end of [val]
*)</span>
      <span class="keyword">val</span> d2e_mac <span class="keyword">=</span> <span class="keyword">case+</span> knd <span class="keyword">of</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>MACSYNKINDcross <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmacro2_2esats.html#1722"><span class="dyncstuse">$MAC<span class="keyword">.</span>macro_eval_cross</span></a> <span class="keyword">(</span>d2e<span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>MACSYNKINDdecode <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmacro2_2esats.html#1777"><span class="dyncstuse">$MAC<span class="keyword">.</span>macro_eval_decode</span></a> <span class="keyword">(</span>d2e<span class="keyword">)</span>
        <span class="keyword">|</span> $Syn<span class="keyword">.</span>MACSYNKINDencode <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            prerr loc0<span class="keyword">;</span> prerr ": error(macro)"<span class="keyword">;</span>
            prerr ": the macro syntax `(...) is incorrectly used at this location."<span class="keyword">;</span>
            <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2138"><span class="stacstuse">d2exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [MACSYNKINDencode]
</span>      <span class="comment">// end of [val]
</span><span class="comment">(*
      val () = begin
        print "d2exp_tr_up: D2Emacsyn: d2e_mac = "; print d2e_mac; print_newline ()
      end // end of [val]
*)</span>
    <span class="keyword">}</span> <span class="comment">// end of [D2Emacsyn]
</span>  <span class="keyword">|</span> D2Eptrof d2e <span class="keyword">=&gt;</span>  d2exp_ptrof_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">)</span>
  <span class="keyword">|</span> D2Eraise d2e_exn <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_exn <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8686"><span class="dyncstuse">s2exp_exception_viewtype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d3e_exn <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5558"><span class="dyncstuse">d2exp_tr_dn</span></a> <span class="keyword">(</span>d2e_exn<span class="keyword">,</span> s2e_exn<span class="keyword">)</span>
      <span class="keyword">val</span> s2e_raise <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8644"><span class="dyncstuse">s2exp_bottom_viewt0ype_uni</span></a> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18006"><span class="dyncstuse">d3exp_raise</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_raise<span class="keyword">,</span> d3e_exn<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Eraise]
</span>  <span class="keyword">|</span> D2Erec <span class="keyword">(</span>recknd<span class="keyword">,</span> npf<span class="keyword">,</span> ld2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_rec_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> recknd<span class="keyword">,</span> npf<span class="keyword">,</span> ld2es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Erec]
</span>  <span class="keyword">|</span> D2Escaseof <span class="keyword">(</span>res<span class="keyword">,</span> s2e_val<span class="keyword">,</span> sc2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_scase <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10270"><span class="dyncstuse">s2rt_prop</span></a><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#6225"><span class="dyncstuse">d2exp_scaseof_tr_dn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> res<span class="keyword">,</span> s2e_val<span class="keyword">,</span> sc2ls<span class="keyword">,</span> s2e_scase<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Escaseof]
</span>  <span class="keyword">|</span> D2Esel <span class="keyword">(</span>d2e<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_sel_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> d2ls<span class="keyword">)</span>
  <span class="keyword">|</span> D2Eseq d2es <span class="keyword">=&gt;</span> d2exp_seq_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2es<span class="keyword">)</span>
  <span class="keyword">|</span> D2Esif <span class="keyword">(</span>r2es<span class="keyword">,</span> s2p_cond<span class="keyword">,</span> d2e_then<span class="keyword">,</span> d2e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_sif <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#9998"><span class="dyncstuse">s2exp_Var_make_srt</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#10270"><span class="dyncstuse">s2rt_prop</span></a><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#6045"><span class="dyncstuse">d2exp_sif_tr_dn</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> r2es<span class="keyword">,</span> s2p_cond<span class="keyword">,</span> d2e_then<span class="keyword">,</span> d2e_else<span class="keyword">,</span> s2e_sif<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Esif]
</span>  <span class="keyword">|</span> D2Estring <span class="keyword">(</span>str<span class="keyword">,</span> len<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#14455"><span class="dyncstuse">string0_length</span></a> str
      <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fsizetype_2esats.html#5947"><span class="dyncstuse">size1_of_size</span></a> <span class="keyword">(</span>n<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fsizetype_2esats.html#6020"><span class="dyncstuse">int1_of_size1</span></a> <span class="keyword">(</span>n<span class="keyword">)</span>
      <span class="keyword">val</span> s2e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#7469"><span class="dyncstuse">s2exp_string_int_type</span></a> <span class="keyword">(</span>n<span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18681"><span class="dyncstuse">d3exp_string</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> str<span class="keyword">,</span> len<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Estring]
</span>  <span class="keyword">|</span> D2Etmpid <span class="keyword">(</span>d2e<span class="keyword">,</span> ts2ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_tmpid_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> ts2ess<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Etmpid]
</span>  <span class="keyword">|</span> D2Etop <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error3 loc0<span class="keyword">;</span>
      prerr ": the type of [?] cannot be synthesized."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Etop]
</span>  <span class="keyword">|</span> D2Etrywith <span class="keyword">(</span>r2es<span class="keyword">,</span> d2e<span class="keyword">,</span> c2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      // [r2es] is not in use; it is always [in2vresstate_nil]
      val r2es = i2nvresstate_update (r2es) // each var is replaced with its view
*)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12484"><span class="dyncstuse">the_d2varset_env_push_try</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
      <span class="keyword">val</span> s2e <span class="keyword">=</span> d3e<span class="keyword">.</span>d3exp_typ
      <span class="keyword">val</span> s2e_pat <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstadyncst2_2esats.html#8686"><span class="dyncstuse">s2exp_exception_viewtype</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">var</span> cmplt<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
      <span class="keyword">val</span> c3ls <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#6813"><span class="dyncstuse">c2laulst_tr_dn</span></a> <span class="keyword">(</span>
        loc0<span class="keyword">,</span> cmplt<span class="keyword">,</span> ~1<span class="comment">(*knd*)</span><span class="keyword">,</span> r2es<span class="keyword">,</span> c2ls<span class="keyword">,</span> <span class="keyword">'[</span>d3e<span class="keyword">]</span><span class="keyword">,</span> 1<span class="keyword">,</span> <span class="keyword">'[</span>s2e_pat<span class="keyword">]</span><span class="keyword">,</span> s2e
      <span class="keyword">)</span> <span class="comment">// end of [c2laulst_tr_dn]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12413"><span class="dyncstuse">the_d2varset_env_pop_try</span></a> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19013"><span class="dyncstuse">d3exp_trywith</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e<span class="keyword">,</span> c3ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Etrywith]
</span>  <span class="keyword">|</span> D2Evar d2v <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5111"><span class="dyncstuse">d2exp_var_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">|</span> D2Eviewat <span class="keyword">(</span>d2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fexp_5fup_2edats.html#58547"><span class="dyncstuse">d2exp_viewat_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">)</span>
  <span class="keyword">|</span> D2Ewhere <span class="keyword">(</span>d2e<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7513"><span class="dyncstuse">the_effect_env_push</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2cstlst</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5890"><span class="dyncstuse">the_s2cstlst_env_push</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12350"><span class="dyncstuse">the_d2varset_env_push_let</span></a> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d3cs <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#7115"><span class="dyncstuse">d2eclst_tr</span></a> d2cs<span class="keyword">;</span> <span class="keyword">val</span> d3e <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12671"><span class="dyncstuse">the_d2varset_env_check</span></a> loc0
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12279"><span class="dyncstuse">the_d2varset_env_pop_let</span></a> <span class="keyword">(</span><span class="prfexp">pf_d2varset</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#5812"><span class="dyncstuse">the_s2cstlst_env_pop_and_unbind</span></a> <span class="keyword">(</span><span class="prfexp">pf_s2cstlst</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#7449"><span class="dyncstuse">the_effect_env_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf_effect</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19572"><span class="dyncstuse">d3exp_where</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d3e<span class="keyword">,</span> d3cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D2Ewhere]
</span>  <span class="keyword">|</span> D2Ewhile <span class="keyword">(</span>lpi2nv<span class="keyword">,</span> d2e_test<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5258"><span class="dyncstuse">d2exp_loop_tr_up</span></a>
      <span class="keyword">(</span>loc0<span class="keyword">,</span> lpi2nv<span class="keyword">,</span> None<span class="comment">(*init*)</span><span class="keyword">,</span> d2e_test<span class="keyword">,</span> None<span class="comment">(*post*)</span><span class="keyword">,</span> d2e_body<span class="keyword">)</span>
    <span class="comment">// end of [D2Ewhile]
</span><span class="comment">//
</span><span class="comment">// HX: what kind of errors can occur at this point?
</span><span class="comment">//
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flocation_2esats.html#2738"><span class="dyncstuse">$Loc<span class="keyword">.</span>prerr_location</span></a> loc0<span class="keyword">;</span>
      prerr ": d2exp_tr_up: not implemented yet: d2e0 = "<span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#25893"><span class="dyncstuse">prerr_d2exp</span></a> d2e0<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="comment">// end of [val]
</span><span class="comment">(*
val () = begin
  print "d2exp_tr_up: d3e0 = "; print d3e0; print_newline ()
end
val s2e0 = d3e0.d3exp_type
val () = begin
  print "d2exp_tr_up: s2e0 = "; print s2e0; print_newline ()
end
*)</span>

<span class="keyword">in</span> <span class="comment">// in of [let]
</span> 
d3e0 <span class="comment">(* the return value *)</span>

<span class="keyword">end</span> <span class="comment">// end of [d2exp_tr_up]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4941"><span class="dyncstimp">d2explst_tr_up</span></a> d2es <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d2e<span class="keyword">,</span> d2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4907"><span class="dyncstuse">d2exp_tr_up</span></a> d2e<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4941"><span class="dyncstuse">d2explst_tr_up</span></a> d2es<span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2explst_tr_up]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4996"><span class="dyncstimp">d2explstlst_tr_up</span></a> d2ess <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2ess <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d2es<span class="keyword">,</span> d2ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4941"><span class="dyncstuse">d2explst_tr_up</span></a> d2es<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#4996"><span class="dyncstuse">d2explstlst_tr_up</span></a> d2ess<span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2explstlst_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5049"><span class="dyncstimp">d2exp_cst_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e_d2c <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#4635"><span class="dyncstuse">d2cst_typ_get</span></a> d2c
<span class="keyword">in</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#4538"><span class="dyncstuse">d2cst_decarg_get</span></a> d2c <span class="keyword">of</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#15863"><span class="dyncstuse">d3exp_cst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span>
  <span class="keyword">|</span> s2vpss <span class="comment">(* as cons _ *)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span>subs<span class="keyword">,</span> s2e_tmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11320"><span class="dyncstuse">s2exp_template_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss<span class="keyword">,</span> TMPS2EXPLSTLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> s2e_d2c<span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val</span> s2ess <span class="keyword">=</span> aux subs <span class="keyword">where</span> <span class="keyword">{</span>
        <span class="keyword">fun</span> aux <span class="keyword">(</span>subs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1795"><span class="stacstuse">s2explstlst</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> subs <span class="keyword">of</span>
          <span class="keyword">|</span> cons <span class="keyword">(</span>sub<span class="keyword">,</span> subs<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33604"><span class="dyncstuse">stasub_codomain_get_whnf</span></a> sub<span class="keyword">,</span> aux subs<span class="keyword">)</span>
          <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">}</span> <span class="comment">// end of [where]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18808"><span class="dyncstuse">d3exp_tmpcst</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_tmp<span class="keyword">,</span> d2c<span class="keyword">,</span> s2ess<span class="keyword">)</span>
    <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_cst_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2exp_var_mut_tr_up <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2000"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "d2exp_var_mut_tr_up: d2v = "; print d2v; print_newline ();
    print "d2exp_var_mut_tr_up: d2varset = ";
    the_d2varset_env_print_ld2vs (); print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2e_addr <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7948"><span class="dyncstuse">d2var_addr_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span>s2e<span class="keyword">,</span> _<span class="comment">(*nil*)</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#3866"><span class="dyncstuse">s2exp_addr_slablst_deref</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_addr<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19073"><span class="dyncstuse">d3exp_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_var_mut_tr_up]
</span>
<span class="keyword">fn</span> d2exp_var_nonmut_tr_up <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#1783"><span class="stacstuse">loc_t</span></a></span><span class="keyword">,</span> d2v<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#2000"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#10952"><span class="stacstuse">d3exp</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> lin_d2v <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7033"><span class="dyncstuse">d2var_lin_get</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span>
  <span class="keyword">val</span> s2e_d2v <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7839"><span class="dyncstuse">d2var_typ_get_some</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "d2exp_var_nonmut_tr_up: d2v = "; print d2v; print_newline ();
    print "d2exp_var_nonmut_tr_up: lin_d2v = "; print lin_d2v; print_newline ();
    print "d2exp_var_nonmut_tr_up: d2varset = ";
    the_d2varset_env_print_ld2vs (); print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> lin_d2v &gt;= 0 <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">val</span> is_llam_local <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#12608"><span class="dyncstuse">the_d2varset_env_d2var_is_llam_local</span></a> d2v
  <span class="keyword">in</span>
    <span class="keyword">if</span> is_llam_local <span class="keyword">then</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7106"><span class="dyncstuse">d2var_lin_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> 1+lin_d2v<span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7568"><span class="dyncstuse">d2var_typ_set</span></a> <span class="keyword">(</span>d2v<span class="keyword">,</span> None <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
      prerr_loc_error3 loc0<span class="keyword">;</span>
      prerr ": the linear dynamic variable ["<span class="keyword">;</span>
      prerr d2v<span class="keyword">;</span>
      prerr "] is expected to be local but it is not."<span class="keyword">;</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="comment">(* end of [val] *)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#7151"><span class="dyncstuse">d2var_decarg_get</span></a> d2v <span class="keyword">of</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#19073"><span class="dyncstuse">d3exp_var</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_d2v<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">|</span> s2vpss <span class="comment">(* as cons _ *)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span>subs<span class="keyword">,</span> s2e_tmp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_5fenv_2esats.html#11320"><span class="dyncstuse">s2exp_template_instantiate</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vpss<span class="keyword">,</span> TMPS2EXPLSTLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> s2e_d2v<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> s2ess <span class="keyword">=</span> aux subs <span class="keyword">where</span> <span class="keyword">{</span>
        <span class="keyword">fun</span> aux <span class="keyword">(</span>subs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#21893"><span class="stacstuse">List</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33374"><span class="stacstuse">stasub_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#1795"><span class="stacstuse">s2explstlst</span></a></span> <span class="keyword">=</span> <span class="keyword">case+</span> subs <span class="keyword">of</span>
          <span class="keyword">|</span> cons <span class="keyword">(</span>sub<span class="keyword">,</span> subs<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#33604"><span class="dyncstuse">stasub_codomain_get_whnf</span></a> sub<span class="keyword">,</span> aux subs<span class="keyword">)</span>
          <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">}</span> <span class="comment">// end of [where]
</span>    <span class="keyword">in</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp3_2esats.html#18889"><span class="dyncstuse">d3exp_tmpvar</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_tmp<span class="keyword">,</span> d2v<span class="keyword">,</span> s2ess<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span><span class="keyword">end</span> <span class="comment">// end of [d2exp_var_nonmut_tr_up]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans3_2esats.html#5111"><span class="dyncstimp">d2exp_var_tr_up</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2v <span class="keyword">of</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#9165"><span class="dyncstuse">d2var_is_mutable</span></a> d2v <span class="keyword">=&gt;</span> d2exp_var_mut_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d2exp_var_nonmut_tr_up <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2exp_var_tr_up]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_trans3_exp_up.dats] *)</span>
</pre>
</body>
</html>
