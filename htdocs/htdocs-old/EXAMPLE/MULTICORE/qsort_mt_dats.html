<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">//
</span><span class="comment">// A parallelized implementation of mergesort
</span><span class="comment">//
</span><span class="comment">// Time: March 2008
</span><span class="comment">// Author: Hongwei Xi (* hwxi AT cs DOT bu DOT edu *)
</span><span class="comment">//
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">undefined <span class="keyword">(</span>ARG_QUICKSORT_MT_DATS<span class="keyword">)</span></span> <span class="keyword">#then</span>

<span class="keyword">absviewt@ype</span> <span class="staexp"><a name="209"><span class="stacstdec">T</span></a></span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="223"><span class="dyncstdec">lte_T_T <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14296"><span class="stacstuse">bool</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="265"><span class="dyncstdec">compare_T_T <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#16231"><span class="stacstuse">Sgn</span></a></span></span></a>

<span class="neuexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_T_T</span>
<span class="neuexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> lte_T_T</span>

<span class="keyword">#endif</span> <span class="comment">// end of [undefined (ARG_QUICKSORT_MT_DATS)]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> insert_one <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7452"><span class="stacstuse"><span class="keyword">&lt;</span></span></a> n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>ofs<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="prfexp">pf_mul<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farith_2esats.html#1673"><span class="stacstuse">MUL</span></a> <span class="keyword">(</span>i<span class="keyword">,</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#13888"><span class="stacstuse">sizeof</span></a> <a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">,</span> ofs<span class="keyword">)</span></span></span>
  <span class="keyword">,</span> <span class="prfexp">pf1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">,</span> i<span class="keyword">,</span> A<span class="keyword">)</span></span></span>
  <span class="keyword">,</span> <span class="prfexp">pf21<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a>? <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#9531"><span class="stacstuse">@</span></a> <span class="keyword">(</span>A<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7842"><span class="stacstuse">+</span></a>ofs<span class="keyword">)</span></span></span>
  <span class="keyword">,</span> <span class="prfexp">pf22<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">,</span> n<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4847"><span class="stacstuse">-</span></a>i<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4847"><span class="stacstuse">-</span></a>1<span class="keyword">,</span> A<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7842"><span class="stacstuse">+</span></a>ofs<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7842"><span class="stacstuse">+</span></a><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#13888"><span class="stacstuse">sizeof</span></a> <a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">)</span></span></span>
  <span class="keyword">|</span> x<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> <span class="keyword">(</span>A<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7842"><span class="stacstuse">+</span></a>ofs<span class="keyword">)</span></span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> i</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span> <span class="keyword">|</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15547"><span class="stacstuse">void</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> i <span class="keyword">of</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">pf1_mul <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farith_2esats.html#2048"><span class="dyncstuse">mul_add_const</span></a> <span class="staexp"><span class="keyword">{</span>~1<span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#8070"><span class="dyncstuse">array_v_unextend</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">,</span> pf1<span class="keyword">)</span></span>
      <span class="keyword">val</span> p1 <span class="keyword">=</span> p - <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span>
      <span class="keyword">val</span> x1 <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fpointer_2esats.html#7341"><span class="dyncstuse">ptr_get_vt&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf12</span> <span class="keyword">|</span> p1<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> x1 &lt;= x <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fpointer_2esats.html#7468"><span class="dyncstuse">ptr_set_vt&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf12</span> <span class="keyword">|</span> p1<span class="keyword">,</span> x1<span class="keyword">)</span>
        <span class="keyword">prval</span> <span class="prfexp">pf1 <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#7892"><span class="dyncstuse">array_v_extend</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf1_mul<span class="keyword">,</span> pf11<span class="keyword">,</span> pf12<span class="keyword">)</span></span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x
        <span class="keyword">prval</span> <span class="prfexp">pf2 <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3129"><span class="dyncstuse">array_v_cons</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span></span>
        <span class="keyword">prval</span> <span class="prfexp">pf <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#7639"><span class="dyncstuse">array_v_unsplit</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">,</span> pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x1
        <span class="keyword">prval</span> <span class="prfexp">pf2 <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3129"><span class="dyncstuse">array_v_cons</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span></span>
      <span class="keyword">in</span>
        insert_one <span class="keyword">(</span><span class="prfexp">pf1_mul</span><span class="keyword">,</span> <span class="prfexp">pf11</span><span class="keyword">,</span> <span class="prfexp">pf12</span><span class="keyword">,</span> <span class="prfexp">pf2</span> <span class="keyword">|</span> x<span class="keyword">,</span> p1<span class="keyword">,</span> i-1<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>i <span class="keyword">=</span> 0<span class="keyword">)</span>
      <span class="keyword">prval</span> <span class="prfexp">MULbas <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf_mul</span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3051"><span class="dyncstuse">array_v_unnil</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf1<span class="keyword">)</span></span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := x
      <span class="keyword">prval</span> <span class="prfexp">pf <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3129"><span class="dyncstuse">array_v_cons</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [insert]
</span>
<span class="comment">(* ****** ****** *)</span>
  
<span class="keyword">fun</span> insert_all <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>ofs<span class="keyword">:</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="prfexp">pf_mul<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farith_2esats.html#1673"><span class="stacstuse">MUL</span></a> <span class="keyword">(</span>i<span class="keyword">,</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#13888"><span class="stacstuse">sizeof</span></a> <a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">,</span> ofs<span class="keyword">)</span></span></span>
  <span class="keyword">,</span> <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span>
  <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> <span class="keyword">(</span>A<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7842"><span class="stacstuse">+</span></a>ofs<span class="keyword">)</span></span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> i</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> n</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15547"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> i <span class="keyword">&lt;</span> n <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#7390"><span class="dyncstuse">array_v_split</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">,</span> pf<span class="keyword">)</span></span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3249"><span class="dyncstuse">array_v_uncons</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf2<span class="keyword">)</span></span>
    <span class="keyword">val</span> x <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fpointer_2esats.html#7341"><span class="dyncstuse">ptr_get_vt&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf21</span> <span class="keyword">|</span> p<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_new</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> insert_one <span class="keyword">(</span><span class="prfexp">pf_mul</span><span class="keyword">,</span> <span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">pf21</span><span class="keyword">,</span> <span class="prfexp">pf22</span> <span class="keyword">|</span> x<span class="keyword">,</span> p<span class="keyword">,</span> i<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := pf_new</span>
  <span class="keyword">in</span>
    insert_all <span class="keyword">(</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farith_2esats.html#2048"><span class="dyncstuse"><span class="prfexp">mul_add_const</span></a> <span class="staexp"><span class="keyword">{</span>1<span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">)</span></span><span class="keyword">,</span> <span class="prfexp">pf</span> <span class="keyword">|</span> p+<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">,</span> i+1<span class="keyword">,</span> n<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    <span class="comment">// empty
</span>  <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [insert_all]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> insort <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15547"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> n &gt;= 2 <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp">pf_mul <span class="keyword">=</span> MULind <span class="keyword">(</span>MULbas <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    insert_all <span class="keyword">(</span><span class="prfexp">pf_mul</span><span class="keyword">,</span> <span class="prfexp">pf</span> <span class="keyword">|</span> A+<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">,</span> 1<span class="keyword">,</span> n<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    <span class="comment">// empty
</span>  <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [insort]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">macdef</span> <span class="neuexp">size <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fsizetype_2esats.html#6250"><span class="dyncstuse">size1_of_int1</span></span></a>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> exch <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>i1<span class="keyword">,</span>i2<span class="keyword">:</span>nat <span class="keyword">|</span> i1 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7452"><span class="stacstuse"><span class="keyword">&lt;</span></span></a> n<span class="keyword">;</span> i2 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7452"><span class="stacstuse"><span class="keyword">&lt;</span></span></a> n<span class="keyword">;</span> i1 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7664"><span class="stacstuse">&lt;&gt;</span></a> i2<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> i1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> i1</span><span class="keyword">,</span> i2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> i2</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15547"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">@(</span><span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">pf2</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p1<span class="keyword">,</span> p2<span class="keyword">)</span> <span class="keyword">=</span>
    <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#11074"><span class="dyncstuse">array_ptr_takeout2_tsz</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> <span class="keyword">(</span>size<span class="keyword">)</span>i1<span class="keyword">,</span> <span class="keyword">(</span>size<span class="keyword">)</span>i2<span class="keyword">,</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">)</span>
  <span class="keyword">val</span> tmp <span class="keyword">=</span> <span class="keyword">!</span>p1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p1 := <span class="keyword">!</span>p2<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p2 := tmp
<span class="keyword">in</span>
  pf := fpf <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [exch]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> innerLoop_l <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>l<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> 0 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> l<span class="keyword">;</span> l <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> r<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4762"><span class="stacstuse">+</span></a>1<span class="keyword">;</span> r <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7452"><span class="stacstuse"><span class="keyword">&lt;</span></span></a> n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>n<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4847"><span class="stacstuse">-</span></a>l<span class="keyword">&gt;.</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> pivot<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">,</span> l<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> r</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#16129"><span class="stacstuse">natLte</span></a> <span class="keyword">(</span>r<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4762"><span class="stacstuse">+</span></a>1<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> l &lt;= r <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p1<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#10364"><span class="dyncstuse">array_ptr_takeout_tsz</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> <span class="keyword">(</span>size<span class="keyword">)</span>l<span class="keyword">,</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> <span class="keyword">!</span>p1 &lt;= pivot <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := fpf <span class="keyword">(</span>pf1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      innerLoop_l <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> pivot<span class="keyword">,</span> l+1<span class="keyword">,</span> r<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
      pf := fpf <span class="keyword">(</span>pf1<span class="keyword">)</span><span class="keyword">;</span> l
    <span class="keyword">end</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    l <span class="comment">// return value
</span>  <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [innerLoop_l]
</span>
<span class="keyword">fun</span> innerLoop_r <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>l<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> 0 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> l<span class="keyword">;</span> l <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> r<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4762"><span class="stacstuse">+</span></a>1<span class="keyword">;</span> r <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7452"><span class="stacstuse"><span class="keyword">&lt;</span></span></a> n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>r<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4762"><span class="stacstuse">+</span></a>1<span class="keyword">&gt;.</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> pivot<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">,</span> l<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> r</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15971"><span class="stacstuse">intBtw</span></a> <span class="keyword">(</span>l<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4847"><span class="stacstuse">-</span></a>1<span class="keyword">,</span> n<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> l &lt;= r <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf1</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p1<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#10364"><span class="dyncstuse">array_ptr_takeout_tsz</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> <span class="keyword">(</span>size<span class="keyword">)</span>r<span class="keyword">,</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> pivot &lt;= <span class="keyword">!</span>p1 <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := fpf <span class="keyword">(</span>pf1<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      innerLoop_r <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> pivot<span class="keyword">,</span> l<span class="keyword">,</span> r-1<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
      pf := fpf <span class="keyword">(</span>pf1<span class="keyword">)</span><span class="keyword">;</span> r
    <span class="keyword">end</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    r <span class="comment">// return value
</span>  <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [innerLoop_r]
</span>
<span class="keyword">fun</span> outerLoop <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>l<span class="keyword">,</span>r<span class="keyword">:</span>int <span class="keyword">|</span> 0 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> l<span class="keyword">;</span> l <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7522"><span class="stacstuse">&lt;=</span></a> r<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#4762"><span class="stacstuse">+</span></a>1<span class="keyword">;</span> r <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7452"><span class="stacstuse"><span class="keyword">&lt;</span></span></a> n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> pivot<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a></span><span class="keyword">,</span> l<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> l</span><span class="keyword">,</span> r<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> r</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#16129"><span class="stacstuse">natLte</span></a> n</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> l <span class="keyword">=</span> innerLoop_l <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> pivot<span class="keyword">,</span> l<span class="keyword">,</span> r<span class="keyword">)</span>
  <span class="keyword">val</span> r <span class="keyword">=</span> innerLoop_r <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> pivot<span class="keyword">,</span> l<span class="keyword">,</span> r<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> l <span class="keyword">&lt;</span> r <span class="keyword">then</span> <span class="keyword">begin</span>
    exch <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> l<span class="keyword">,</span> r<span class="keyword">)</span><span class="keyword">;</span> outerLoop <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> pivot<span class="keyword">,</span> l+1<span class="keyword">,</span> r-1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    l <span class="comment">// the pivot
</span>  <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [outerLoop]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> partition <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat <span class="keyword">|</span> n <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#7381"><span class="stacstuse">&gt;=</span></a> 2<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#16076"><span class="stacstuse">natLt</span></a> n</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_mul</span> <span class="keyword">|</span> ofs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>size<span class="keyword">)</span>n szmul2 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span>
  <span class="keyword">prval</span> <span class="prfexp">pf1_mul <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farith_2esats.html#2048"><span class="dyncstuse">mul_add_const</span></a> <span class="staexp"><span class="keyword">{</span>~1<span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">)</span></span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">@(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#8070"><span class="dyncstuse">array_v_unextend</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">,</span> pf<span class="keyword">)</span></span>
  <span class="keyword">val</span> pivot <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fpointer_2esats.html#7341"><span class="dyncstuse">ptr_get_vt&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> A + ofs - <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">)</span>
  <span class="keyword">val</span> i_pivot <span class="keyword">=</span> outerLoop <span class="keyword">(</span><span class="prfexp">pf1</span> <span class="keyword">|</span> A<span class="keyword">,</span> pivot<span class="keyword">,</span> 0<span class="keyword">,</span> n-2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">if</span> i_pivot <span class="keyword">&lt;</span> n - 1 <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf11</span><span class="keyword">,</span> <span class="prfexp">fpf1</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#10364"><span class="dyncstuse">array_ptr_takeout_tsz</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf1</span> <span class="keyword">|</span> A<span class="keyword">,</span> <span class="keyword">(</span>size<span class="keyword">)</span>i_pivot<span class="keyword">,</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fpointer_2esats.html#7468"><span class="dyncstuse">ptr_set_vt&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> A + ofs - <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := pivot<span class="keyword">;</span> <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf1 := fpf1 <span class="keyword">(</span>pf11<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
      <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2fpointer_2esats.html#7468"><span class="dyncstuse">ptr_set_vt&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="prfexp">pf2</span> <span class="keyword">|</span> A + ofs - <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">,</span> pivot<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#7892"><span class="dyncstuse">array_v_extend</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf1_mul<span class="keyword">,</span> pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
<span class="keyword">in</span>
  i_pivot
<span class="keyword">end</span> <span class="comment">// end of [partition]
</span>
<span class="keyword">#define</span> <span class="neuexp">THRESHOLD 16</span>

<span class="keyword">fun</span> qsort_main <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> n</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15547"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">if</span> n &gt;= THRESHOLD <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">val</span> i_pivot <span class="keyword">=</span> partition <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> n<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_mul</span> <span class="keyword">|</span> ofs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>size<span class="keyword">)</span>i_pivot szmul2 <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#7390"><span class="dyncstuse">array_v_split</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">,</span> pf<span class="keyword">)</span></span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3249"><span class="dyncstuse">array_v_uncons</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf2<span class="keyword">)</span></span>
    <span class="keyword">prval</span> <span class="prfexp">pf1_mul <span class="keyword">=</span> <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farith_2esats.html#2048"><span class="dyncstuse">mul_add_const</span></a> <span class="staexp"><span class="keyword">{</span>1<span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">)</span></span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> qsort_main <span class="keyword">(</span><span class="prfexp">pf1</span> <span class="keyword">|</span> A<span class="keyword">,</span> i_pivot<span class="keyword">)</span>
    <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> qsort_main <span class="keyword">(</span><span class="prfexp">pf22</span> <span class="keyword">|</span> A+ofs+<a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fdyn_2esats.html#3997"><span class="dyncstuse">sizeof&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span><span class="keyword">&gt;</span><span class="keyword">,</span> n-i_pivot-1<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf2 := <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#3129"><span class="dyncstuse">array_v_cons</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span></span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf := <a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#7639"><span class="dyncstuse">array_v_unsplit</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>pf_mul<span class="keyword">,</span> pf1<span class="keyword">,</span> pf2<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="comment">// empty
</span>  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    <span class="comment">// empty
</span>  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="comment">// end of [qsort]
</span>
<span class="keyword">fun</span> qsort <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fSATS_2farray_2esats.html#2918"><span class="stacstuse">array_v</span></a></span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse"><a href="XREF/_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fdoc_2fEXAMPLE_2fMULTICORE_2fqsort_5fmt_2edats.html#209"><span class="stacstuse">T</span></a></span></a><span class="keyword">,</span> n<span class="keyword">,</span> A<span class="keyword">)</span></span></span> <span class="keyword">|</span> A<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15037"><span class="stacstuse">ptr</span></a> A</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#14651"><span class="stacstuse">int</span></a> n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2ftrunk1_2fprelude_2fbasics_5fsta_2esats.html#15547"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  qsort_main <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">;</span> insort <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> A<span class="keyword">,</span> n<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [qsort]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [qsort_mt.dats] *)</span>
</pre>
</body>
</html>
