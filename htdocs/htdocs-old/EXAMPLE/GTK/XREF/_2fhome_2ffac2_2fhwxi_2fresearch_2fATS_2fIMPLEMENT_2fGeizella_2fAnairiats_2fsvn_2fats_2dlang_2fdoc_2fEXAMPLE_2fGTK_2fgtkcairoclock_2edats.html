<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(*
**
** A simple GTK/CAIRO example: a clock @ home
** The part of clock drawing is largely taken from
** a cairo example I did in December 2009
**
** Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
** Time: April, 2010
**
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/reference.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"libc/SATS/math.sats"</span>
<span class="keyword">macdef</span> <span class="neuexp">PI <span class="keyword">=</span> M_PI</span>
<span class="keyword">macdef</span> <span class="neuexp">PI2 <span class="keyword">=</span> PI/2</span>

<span class="keyword">staload</span> <span class="staexp">"libc/SATS/time.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"contrib/cairo/SATS/cairo.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="506"><span class="stacstdec">dbl <span class="keyword">=</span> double</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="526"><span class="stacstdec">cr <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> cairo_ref l</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> draw_hand <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span>
  <span class="keyword">(</span>cr<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>cr l</span><span class="keyword">,</span> bot<span class="keyword">:</span> <span class="staexp">dbl</span><span class="keyword">,</span> top<span class="keyword">:</span><span class="staexp">dbl</span><span class="keyword">,</span> len<span class="keyword">:</span> <span class="staexp">dbl</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_move_to <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> bot/2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_line_to <span class="keyword">(</span>cr<span class="keyword">,</span> len<span class="keyword">,</span> top/2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_line_to <span class="keyword">(</span>cr<span class="keyword">,</span> len<span class="keyword">,</span> <span class="keyword">~</span>top/2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_line_to <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> <span class="keyword">~</span>bot/2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_close_path <span class="keyword">(</span>cr<span class="keyword">)</span>
<span class="keyword">in</span>
  cairo_fill <span class="keyword">(</span>cr<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [draw_hand]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> theLastSec <span class="keyword">=</span> ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>~1<span class="keyword">)</span>

<span class="keyword">fn</span> draw_clock <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span> <span class="keyword">(</span>
    cr<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>cr l</span>
  <span class="keyword">,</span> h<span class="keyword">:</span> <span class="staexp">natLt 24</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp">natLt 60</span><span class="keyword">,</span> s<span class="keyword">:</span> <span class="staexp">natLt 60</span> <span class="comment">// hour and minute
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span>  <span class="keyword">val</span> dim <span class="keyword">=</span> 100.0 <span class="comment">// please scale it!
</span>  <span class="keyword">val</span> rad <span class="keyword">=</span> 0.375 * dim
<span class="comment">//
</span>  <span class="keyword">val</span> h <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> h &gt;= 12 <span class="keyword">then</span> h - 12 <span class="keyword">else</span> h<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">natLt 12</span>
  <span class="keyword">val</span> s_ang <span class="keyword">=</span> s * <span class="keyword">(</span>PI / 30<span class="keyword">)</span> - PI2
  <span class="comment">// val m_ang = m * (PI / 30) + s * (PI / 1800) - PI2
</span>  <span class="keyword">val</span> m_ang <span class="keyword">=</span> m * <span class="keyword">(</span>PI / 30<span class="keyword">)</span> - PI2
  <span class="keyword">val</span> h_ang <span class="keyword">=</span> h * <span class="keyword">(</span>PI / 6<span class="keyword">)</span> + m * <span class="keyword">(</span>PI / 360<span class="keyword">)</span> - PI2
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc
    <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> rad<span class="keyword">,</span> 0.0<span class="keyword">,</span> 2 * PI<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 1.0<span class="keyword">,</span> 1.0<span class="keyword">,</span> 1.0<span class="keyword">)</span>
<span class="comment">(*
  val () = cairo_set_source_rgb (cr, 1.0, 0.50, 0.50)
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_fill <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc
    <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> rad<span class="keyword">,</span> 0.0<span class="keyword">,</span> 2 * PI<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 1.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
<span class="comment">(*
  val () = cairo_set_source_rgb (cr, 1.0, 0.0, 1.0)
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_line_width <span class="keyword">(</span>cr<span class="keyword">,</span> 4.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_stroke <span class="keyword">(</span>cr<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> rad1 <span class="keyword">=</span> 0.90 * rad
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc <span class="keyword">(</span>cr<span class="keyword">,</span> <span class="keyword">~</span>rad1<span class="keyword">,</span> <span class="keyword">~</span>rad1<span class="keyword">,</span> rad1<span class="keyword">,</span>  0.0<span class="keyword">,</span> PI2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc <span class="keyword">(</span>cr<span class="keyword">,</span> <span class="keyword">~</span>rad1<span class="keyword">,</span>  rad1<span class="keyword">,</span> rad1<span class="keyword">,</span> <span class="keyword">~</span>PI2<span class="keyword">,</span>  0.<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc <span class="keyword">(</span>cr<span class="keyword">,</span>  rad1<span class="keyword">,</span>  rad1<span class="keyword">,</span> rad1<span class="keyword">,</span> <span class="keyword">~</span>PI<span class="keyword">,</span> <span class="keyword">~</span>PI2<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc <span class="keyword">(</span>cr<span class="keyword">,</span>  rad1<span class="keyword">,</span> <span class="keyword">~</span>rad1<span class="keyword">,</span> rad1<span class="keyword">,</span>  PI2<span class="keyword">,</span>  PI<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_fill <span class="keyword">(</span>cr<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> h_l <span class="keyword">=</span> 0.60 * rad
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_rotate <span class="keyword">(</span>cr<span class="keyword">,</span> h_ang<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_hand <span class="keyword">(</span>cr<span class="keyword">,</span> 3.0<span class="keyword">,</span> 1.5<span class="keyword">,</span> h_l<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_rotate <span class="keyword">(</span>cr<span class="keyword">,</span> h_ang+PI<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_hand <span class="keyword">(</span>cr<span class="keyword">,</span> 3.0<span class="keyword">,</span> 1.5<span class="keyword">,</span> h_l/4<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> m_l <span class="keyword">=</span> 0.85 * rad
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_rotate <span class="keyword">(</span>cr<span class="keyword">,</span> m_ang<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_hand <span class="keyword">(</span>cr<span class="keyword">,</span> 2.0<span class="keyword">,</span> 1.0<span class="keyword">,</span> m_l<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_rotate <span class="keyword">(</span>cr<span class="keyword">,</span> m_ang+PI<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_hand <span class="keyword">(</span>cr<span class="keyword">,</span> 2.0<span class="keyword">,</span> 1.0<span class="keyword">,</span> h_l/4<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> s_l <span class="keyword">=</span> 0.85 * rad
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 1.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_rotate <span class="keyword">(</span>cr<span class="keyword">,</span> s_ang<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_hand <span class="keyword">(</span>cr<span class="keyword">,</span> 1.0<span class="keyword">,</span> 0.5<span class="keyword">,</span> m_l<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 1.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_rotate <span class="keyword">(</span>cr<span class="keyword">,</span> s_ang+PI<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_hand <span class="keyword">(</span>cr<span class="keyword">,</span> 1.0<span class="keyword">,</span> 0.5<span class="keyword">,</span> h_l/4<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_set_source_rgb <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_new_sub_path <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_arc <span class="keyword">(</span>cr<span class="keyword">,</span> 0.0<span class="keyword">,</span> 0.0<span class="keyword">,</span> 2.5<span class="keyword">,</span> 0.0<span class="keyword">,</span> 2 * PI<span class="keyword">)</span>  
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_fill <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="comment">// nothing
</span><span class="keyword">end</span> <span class="comment">// end of [draw_clock]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="3692"><span class="dyncstdec">draw_main <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span>
  <span class="keyword">(</span>cr<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>cairo_ref l</span><span class="keyword">,</span> width<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> height<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a>
<span class="keyword">implement</span> draw_main
  <span class="keyword">(</span>cr<span class="keyword">,</span> width<span class="keyword">,</span> height<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">val</span> w <span class="keyword">=</span> <span class="keyword">(</span>double_of<span class="keyword">)</span>width
  <span class="keyword">val</span> h <span class="keyword">=</span> <span class="keyword">(</span>double_of<span class="keyword">)</span>height
  <span class="keyword">val</span> mn <span class="keyword">=</span> min <span class="keyword">(</span>w<span class="keyword">,</span> h<span class="keyword">)</span>
  <span class="keyword">val</span> xc <span class="keyword">=</span> w / 2 <span class="keyword">and</span> yc <span class="keyword">=</span> h / 2
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf0</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_save <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_translate <span class="keyword">(</span>cr<span class="keyword">,</span> xc<span class="keyword">,</span> yc<span class="keyword">)</span>
  <span class="keyword">val</span> alpha <span class="keyword">=</span> mn / 100
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_scale <span class="keyword">(</span>cr<span class="keyword">,</span> alpha<span class="keyword">,</span> alpha<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">var</span> t<span class="keyword">:</span> <span class="staexp">time_t</span> <span class="comment">// unintialized
</span>  <span class="keyword">val</span> yn <span class="keyword">=</span> time_get_and_set <span class="keyword">(</span>t<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert_errmsg <span class="keyword">(</span>yn<span class="keyword">,</span> <span class="keyword">#LOCATION</span><span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome <span class="staexp"><span class="keyword">{</span>time_t<span class="keyword">}</span></span> <span class="keyword">(</span>t<span class="keyword">)</span></span>
  <span class="keyword">var</span> tm<span class="keyword">:</span> <span class="staexp">tm_struct</span> <span class="comment">// unintialized
</span>  <span class="keyword">val</span> _ptr <span class="keyword">=</span> localtime_r <span class="keyword">(</span>t<span class="keyword">,</span> tm<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert_errmsg <span class="keyword">(</span>_ptr <span class="keyword">&gt;</span> null<span class="keyword">,</span> <span class="keyword">#LOCATION</span><span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome <span class="staexp"><span class="keyword">{</span>tm_struct<span class="keyword">}</span></span> <span class="keyword">(</span>tm<span class="keyword">)</span></span>
  <span class="keyword">val</span> hr <span class="keyword">=</span> tm<span class="keyword">.</span>tm_hour <span class="keyword">and</span> mt <span class="keyword">=</span> tm<span class="keyword">.</span>tm_min <span class="keyword">and</span> sd <span class="keyword">=</span> tm<span class="keyword">.</span>tm_sec
  <span class="keyword">val</span> hr <span class="keyword">=</span> int1_of_int <span class="keyword">(</span>hr<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>0 &lt;= hr &amp;&amp; hr <span class="keyword">&lt;</span> 24<span class="keyword">)</span>
  <span class="keyword">val</span> mt <span class="keyword">=</span> int1_of_int <span class="keyword">(</span>mt<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>0 &lt;= mt &amp;&amp; mt <span class="keyword">&lt;</span> 60<span class="keyword">)</span>
  <span class="keyword">val</span> sd <span class="keyword">=</span> int1_of_int <span class="keyword">(</span>sd<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>0 &lt;= sd &amp;&amp; sd <span class="keyword">&lt;</span> 60<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_clock <span class="keyword">(</span>cr<span class="keyword">,</span> hr<span class="keyword">,</span> mt<span class="keyword">,</span> sd<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_restore <span class="keyword">(</span><span class="prfexp">pf0</span> <span class="keyword">|</span> cr<span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [draw_main]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"contrib/glib/SATS/glib.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"contrib/glib/SATS/glib-object.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"contrib/GTK/SATS/gdk.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"contrib/GTK/SATS/gtkclassdec.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"contrib/GTK/SATS/gtk.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{^
extern
ats_void_type mainats (ats_int_type argc, ats_ptr_type argv) ;
%}</span> <span class="comment">// end of [%{^]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{^
GtkWidget *the_drawingarea = NULL;
ats_ptr_type
the_drawingarea_get () {
  if (the_drawingarea == NULL) {
    fprintf (stderr, "exit(the_drawingarea_get): not initialized yet\n"); exit(1);
  } // end of [if]
  return the_drawingarea ;
} // end of [the_drawingarea_get]
ats_void_type
the_drawingarea_initset (ats_ptr_type x) {
  static int the_drawingarea_initset_flag = 0 ;
  if (the_drawingarea_initset_flag) {
    fprintf (stderr, "exit(the_drawingarea_initset): already initialized\n"); exit(1);
  } // end of [if]
  the_drawingarea_initset_flag = 1 ; the_drawingarea = x ; return ;
} // end of [the_drawingarea_initset]
%}</span> <span class="comment">// end of [%{^] 
</span><span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="5773"><span class="dyncstdec">the_drawingarea_get <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span>
  <span class="keyword">(</span>gobjref <span class="keyword">(</span>GtkDrawingArea<span class="keyword">,</span> l<span class="keyword">)</span> <span class="keyword">-&lt;</span>lin<span class="keyword">,</span>prf<span class="keyword">&gt;</span> void <span class="keyword">|</span> gobjref <span class="keyword">(</span>GtkDrawingArea<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">)</span></span></span></a>
  <span class="keyword">=</span> "the_drawingarea_get"
<span class="comment">// end of [the_drawingarea_get]
</span><span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="5952"><span class="dyncstdec">the_drawingarea_initset
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">GtkDrawingArea_ref1</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> <span class="keyword">=</span> "the_drawingarea_initset"
<span class="comment">// end of [the_drawingarea_initset]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> draw_drawingarea
  <span class="staexp"><span class="keyword">{</span>c<span class="keyword">:</span>cls <span class="keyword">|</span> c &lt;= GtkDrawingArea<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span>
  <span class="keyword">(</span>darea<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>gobjref <span class="keyword">(</span>c<span class="keyword">,</span> l<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span>  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> clstrans <span class="staexp"><span class="keyword">{</span>c<span class="keyword">,</span>GtkDrawingArea<span class="keyword">,</span>GtkWidget<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_win</span> <span class="keyword">|</span> win<span class="keyword">)</span> <span class="keyword">=</span> gtk_widget_get_window <span class="keyword">(</span>darea<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> g_object_isnot_null <span class="keyword">(</span>win<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">val</span> cr <span class="keyword">=</span> gdk_cairo_create <span class="keyword">(</span>win<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> minus_addback <span class="keyword">(</span><span class="prfexp">fpf_win</span><span class="keyword">,</span> <span class="prfexp">win</span> <span class="keyword">|</span> darea<span class="keyword">)</span></span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> gtk_widget_getref_allocation <span class="keyword">(</span>darea<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> draw_main <span class="keyword">(</span>cr<span class="keyword">,</span> <span class="keyword">(</span>int_of<span class="keyword">)</span>p<span class="keyword">-&gt;</span>width<span class="keyword">,</span> <span class="keyword">(</span>int_of<span class="keyword">)</span>p<span class="keyword">-&gt;</span>height<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> minus_addback <span class="keyword">(</span><span class="prfexp">fpf</span><span class="keyword">,</span> <span class="prfexp">pf</span> <span class="keyword">|</span> darea<span class="keyword">)</span></span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> cairo_destroy <span class="keyword">(</span>cr<span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="comment">// nothing
</span>  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> minus_addback <span class="keyword">(</span><span class="prfexp">fpf_win</span><span class="keyword">,</span> <span class="prfexp">win</span> <span class="keyword">|</span> darea<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="comment">// nothing
</span>  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="comment">// end of [draw_drawingarea]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> fexpose <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">gboolean</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_darea</span> <span class="keyword">|</span> darea<span class="keyword">)</span> <span class="keyword">=</span> the_drawingarea_get <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> _ <span class="keyword">=</span> draw_drawingarea <span class="keyword">(</span>darea<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_darea <span class="keyword">(</span>darea<span class="keyword">)</span></span>
<span class="keyword">in</span>
  GFALSE
<span class="keyword">end</span> <span class="comment">// end of [fexpose]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> sec_changed
  <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> t<span class="keyword">:</span> <span class="staexp">time_t</span> <span class="comment">// unintialized
</span>  <span class="keyword">val</span> yn <span class="keyword">=</span> time_get_and_set <span class="keyword">(</span>t<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert_errmsg <span class="keyword">(</span>yn<span class="keyword">,</span> <span class="keyword">#LOCATION</span><span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome <span class="staexp"><span class="keyword">{</span>time_t<span class="keyword">}</span></span> <span class="keyword">(</span>t<span class="keyword">)</span></span>
  <span class="keyword">var</span> tm<span class="keyword">:</span> <span class="staexp">tm_struct</span> <span class="comment">// unintialized
</span>  <span class="keyword">val</span> _ptr <span class="keyword">=</span> localtime_r <span class="keyword">(</span>t<span class="keyword">,</span> tm<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert_errmsg <span class="keyword">(</span>_ptr <span class="keyword">&gt;</span> null<span class="keyword">,</span> <span class="keyword">#LOCATION</span><span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome <span class="staexp"><span class="keyword">{</span>tm_struct<span class="keyword">}</span></span> <span class="keyword">(</span>tm<span class="keyword">)</span></span>
  <span class="keyword">val</span> sd <span class="keyword">=</span> tm<span class="keyword">.</span>tm_sec
  <span class="keyword">val</span> sd_old <span class="keyword">=</span> <span class="keyword">!</span>theLastSec
<span class="keyword">in</span>
  sd &lt;&gt; sd_old
<span class="keyword">end</span> <span class="comment">// end of [sec_changed]
</span>
<span class="keyword">fun</span> ftimeout
  <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">gpointer</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">gboolean</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_darea</span> <span class="keyword">|</span> darea<span class="keyword">)</span> <span class="keyword">=</span> the_drawingarea_get <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_win</span> <span class="keyword">|</span> win<span class="keyword">)</span> <span class="keyword">=</span> gtk_widget_get_window <span class="keyword">(</span>darea<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> g_object_isnot_null <span class="keyword">(</span>win<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> minus_addback <span class="keyword">(</span><span class="prfexp">fpf_win</span><span class="keyword">,</span> <span class="prfexp">win</span> <span class="keyword">|</span> darea<span class="keyword">)</span></span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf</span><span class="keyword">,</span> <span class="prfexp">fpf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> gtk_widget_getref_allocation <span class="keyword">(</span>darea<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> sec_changed <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">then</span>
      gtk_widget_queue_draw_area <span class="keyword">(</span>darea<span class="keyword">,</span> <span class="keyword">(</span>gint<span class="keyword">)</span>0<span class="keyword">,</span> <span class="keyword">(</span>gint<span class="keyword">)</span>0<span class="keyword">,</span> p<span class="keyword">-&gt;</span>width<span class="keyword">,</span> p<span class="keyword">-&gt;</span>height<span class="keyword">)</span>
    <span class="comment">// end of [val]
</span>    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> minus_addback <span class="keyword">(</span><span class="prfexp">fpf</span><span class="keyword">,</span> <span class="prfexp">pf</span> <span class="keyword">|</span> darea<span class="keyword">)</span></span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_darea <span class="keyword">(</span>darea<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    GTRUE
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> minus_addback <span class="keyword">(</span><span class="prfexp">fpf_win</span><span class="keyword">,</span> <span class="prfexp">win</span> <span class="keyword">|</span> darea<span class="keyword">)</span></span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_darea <span class="keyword">(</span>darea<span class="keyword">)</span></span>
  <span class="keyword">in</span>
    GFALSE <span class="comment">// HX: terminating the timer
</span>  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [ftimeout]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8228"><span class="dyncstdec">main1 <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> <span class="keyword">=</span> "main1"

<span class="keyword">implement</span> main1 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">val</span> window <span class="keyword">=</span> gtk_window_new <span class="keyword">(</span>GTK_WINDOW_TOPLEVEL<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gtk_window_set_default_size <span class="keyword">(</span>window<span class="keyword">,</span> <span class="keyword">(</span>gint<span class="keyword">)</span>400<span class="keyword">,</span> <span class="keyword">(</span>gint<span class="keyword">)</span>400<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_x</span> <span class="keyword">|</span> x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>gstring_of_string<span class="keyword">)</span>"ATS: gtkcairoclock"
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gtk_window_set_title <span class="keyword">(</span>window<span class="keyword">,</span> x<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_x <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="comment">//
</span>  <span class="keyword">val</span> darea <span class="keyword">=</span> gtk_drawing_area_new <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gtk_container_add <span class="keyword">(</span>window<span class="keyword">,</span> darea<span class="keyword">)</span>
  <span class="keyword">val</span> _sid <span class="keyword">=</span> g_signal_connect
    <span class="keyword">(</span>darea<span class="keyword">,</span> <span class="keyword">(</span>gsignal<span class="keyword">)</span>"expose-event"<span class="keyword">,</span> G_CALLBACK <span class="keyword">(</span>fexpose<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span>gpointer<span class="keyword">)</span>null<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_drawingarea_initset <span class="keyword">(</span>darea<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_window</span> <span class="keyword">|</span> window_<span class="keyword">)</span> <span class="keyword">=</span> g_object_vref <span class="keyword">(</span>window<span class="keyword">)</span>
  <span class="keyword">val</span> _sid <span class="keyword">=</span> g_signal_connect0
    <span class="keyword">(</span>window_<span class="keyword">,</span> <span class="keyword">(</span>gsignal<span class="keyword">)</span>"delete-event"<span class="keyword">,</span> G_CALLBACK <span class="keyword">(</span>gtk_main_quit<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span>gpointer<span class="keyword">)</span>null<span class="keyword">)</span>
  <span class="keyword">val</span> _sid <span class="keyword">=</span> g_signal_connect1
    <span class="keyword">(</span>window<span class="keyword">,</span> <span class="keyword">(</span>gsignal<span class="keyword">)</span>"destroy-event"<span class="keyword">,</span> G_CALLBACK <span class="keyword">(</span>gtk_widget_destroy<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">(</span>gpointer<span class="keyword">)</span>null<span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> _rid <span class="keyword">=</span> gtk_timeout_add <span class="keyword">(</span><span class="keyword">(</span>guint32<span class="keyword">)</span>100U<span class="keyword">,</span> ftimeout<span class="keyword">,</span> <span class="keyword">(</span>gpointer<span class="keyword">)</span>null<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gtk_widget_show_all <span class="keyword">(</span>window<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_window <span class="keyword">(</span>window<span class="keyword">)</span></span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> gtk_main <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [main1]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> main_dummy <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{$
ats_void_type
mainats (
  ats_int_type argc, ats_ptr_type argv
) {
  gtk_init ((int*)&amp;argc, (char***)&amp;argv) ; main1 () ; return ;
} // end of [mainats]
%}</span> <span class="comment">// end of [%{$]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [gtkcairolock.dats] *)</span>
</pre>
</body>
</html>
