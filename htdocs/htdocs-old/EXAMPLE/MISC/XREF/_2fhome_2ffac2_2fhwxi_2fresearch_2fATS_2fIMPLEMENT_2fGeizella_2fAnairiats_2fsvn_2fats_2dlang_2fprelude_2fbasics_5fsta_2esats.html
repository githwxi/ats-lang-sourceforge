<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2010 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of the GNU LESSER GENERAL PUBLIC LICENSE as published by the
** Free Software Foundation; either version 2.1, or (at your option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// Author of the file: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Start Time: 2007
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">#include</span> <span class="neuexp">"prelude/params.hats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="keyword">#print</span> <span class="neuexp">"Loading [basic_sta.sats] starts!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* some integer constants *)</span>

<span class="keyword">#define</span> <span class="neuexp">power_2_4 0x10</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_5 0x20</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_6 0x40</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_7 0x80</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_8 0x100</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_10 0x400</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_15 0x8000</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_16 0x10000</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_20 0x100000</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_31 0x80000000</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_32 0x100000000</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_63 0x8000000000000000</span>
<span class="keyword">#define</span> <span class="neuexp">power_2_64 0x10000000000000000</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// some unindexed types
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="2168"><span class="stacstdec">bool_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_bool_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="2213"><span class="stacstdec">byte_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_byte_type"</span></a></span> <span class="comment">// sizeof (byte) = 1
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="2301"><span class="stacstdec">char_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_char_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="2346"><span class="stacstdec">schar_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_schar_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="2393"><span class="stacstdec">uchar_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uchar_type"</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abstype</span> <span class="staexp"><a name="2461"><span class="stacstdec">clo_t0ype</span></a></span> <span class="comment">// ats_clo_type // unnamed
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="2529"><span class="stacstdec">double_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_double_type"</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">absviewtype</span> <span class="staexp"><a name="2603"><span class="stacstdec">exception_viewtype</span></a></span> <span class="comment">// boxed type // unamed
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="2679"><span class="stacstdec">int_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_int_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="2722"><span class="stacstdec">uint_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uint_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="2770"><span class="stacstdec">int_short_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_sint_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="2820"><span class="stacstdec">uint_short_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_usint_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="2875"><span class="stacstdec">int_short_short_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_sint_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="2931"><span class="stacstdec">uint_short_short_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ussint_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="2993"><span class="stacstdec">int_long_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_lint_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3042"><span class="stacstdec">uint_long_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ulint_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3096"><span class="stacstdec">int_long_long_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_llint_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3151"><span class="stacstdec">uint_long_long_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ullint_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3211"><span class="stacstdec">intmax_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_intmax_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3260"><span class="stacstdec">uintmax_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uintmax_type"</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: integer types guaranteed to be of one word size
</span><span class="comment">//
</span><span class="keyword">abstype</span> <span class="staexp"><a name="3371"><span class="stacstdec">intptr_type <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_intptr_type"</span></a></span> <span class="comment">// named
</span><span class="keyword">abstype</span> <span class="staexp"><a name="3427"><span class="stacstdec">uintptr_type <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uintptr_type"</span></a></span> <span class="comment">// named
</span><span class="comment">//
</span><span class="comment">// HX: integer types with fixed size
</span><span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3529"><span class="stacstdec">int8_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_int8_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3574"><span class="stacstdec">uint8_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uint8_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3624"><span class="stacstdec">int16_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_int16_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3671"><span class="stacstdec">uint16_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uint16_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3723"><span class="stacstdec">int32_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_int32_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3770"><span class="stacstdec">uint32_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uint32_type"</span></a></span>
<span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3822"><span class="stacstdec">int64_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_int64_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="3869"><span class="stacstdec">uint64_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_uint64_type"</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: integer types for sizes
</span><span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="3955"><span class="stacstdec">size_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_size_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="4000"><span class="stacstdec">ssize_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ssize_type"</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="4047"><span class="stacstdec">ptrdiff_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ptrdiff_type"</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: unindexed type for pointers
</span><span class="comment">//
</span><span class="keyword">abstype</span> <span class="staexp"><a name="4161"><span class="stacstdec">ptr_type <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ptr_type"</span></a></span> <span class="comment">// unnamed
</span><span class="keyword">abstype</span> <span class="staexp"><a name="4213"><span class="stacstdec">ptrself_type <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_ptrself_type"</span></a></span> <span class="comment">// named
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">abstype</span> <span class="staexp"><a name="4295"><span class="stacstdec">string_type</span></a></span> <span class="comment">// boxed type // unnamed
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="4341"><span class="stacstdec">strbuf_t0ype</span></a></span> <span class="comment">// a type of variable size
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX-2010-10-23:
</span><span class="comment">// sizeof (void) is undefined in the standard but GCC sets it to 1
</span><span class="comment">// For instance, try to compile with the flags: '-ansi' and '-pedantic'
</span><span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="4574"><span class="stacstdec">void_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_void_type"</span></a></span>
<span class="comment">//
</span><span class="comment">// HX-2010-10-23: [ats_empty_type] is a struct of no fields
</span><span class="comment">//
</span><span class="keyword">abst@ype</span> <span class="staexp"><a name="4685"><span class="stacstdec">empty_t0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_empty_type"</span></a></span> <span class="comment">// sizeof(empty) = 0
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some built-in static constants for integer operations
</span><span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">neg_int_int <span class="keyword">:</span> int <span class="keyword">-&gt;</span> int</span> <span class="comment">(* integer negation *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="4891"><span class="stacstdec"><span class="keyword">~</span> <span class="keyword">=</span> neg_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">add_int_int_int <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="comment">(* addition *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="4972"><span class="stacstdec">+ <span class="keyword">=</span> add_int_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">sub_int_int_int<span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="comment">(* subtraction *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5059"><span class="stacstdec">- <span class="keyword">=</span> sub_int_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">nsub_int_int_int<span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="comment">(* subtraction on nats *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5155"><span class="stacstdec">nsub <span class="keyword">=</span> nsub_int_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">mul_int_int_int <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="comment">(* multiplication *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5250"><span class="stacstdec">* <span class="keyword">=</span> mul_int_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">div_int_int_int <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span> <span class="comment">(* division *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5335"><span class="stacstdec">/ <span class="keyword">=</span> div_int_int_int</span></a></span>
<span class="comment">//
</span><span class="comment">(*
sta mod_int_int_int : (int, int) -&gt; int (* modulo operation *)
stadef mod = mod_int_int_int
*)</span>
<span class="comment">// [y] is required to be a constant
</span><span class="keyword">stadef</span> <span class="staexp"><a name="5499"><span class="stacstdec">mod <span class="keyword">(</span>x<span class="keyword">:</span>int<span class="keyword">,</span> y<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> x - y * <span class="keyword">(</span>x / y<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">abs_int_int <span class="keyword">:</span> int <span class="keyword">-&gt;</span> int</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5575"><span class="stacstdec">abs <span class="keyword">=</span> abs_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">max_int_int_int <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5643"><span class="stacstdec">max <span class="keyword">=</span> max_int_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">min_int_int_int <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5715"><span class="stacstdec">min <span class="keyword">=</span> min_int_int_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">int_of_bool <span class="keyword">:</span> bool <span class="keyword">-&gt;</span> int <span class="keyword">and</span> bool_of_int <span class="keyword">:</span> int <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">sta</span> <span class="staexp">int_of_char <span class="keyword">:</span> char <span class="keyword">-&gt;</span> int <span class="keyword">and</span> char_of_int <span class="keyword">:</span> int <span class="keyword">-&gt;</span> char</span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some built-in boolean constants
</span><span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">true_bool <span class="keyword">:</span> bool <span class="keyword">and</span> false_bool <span class="keyword">:</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="5978"><span class="stacstdec">true <span class="keyword">=</span> true_bool</span></a></span> <span class="keyword">and</span> <span class="staexp"><a name="5999"><span class="stacstdec">false <span class="keyword">=</span> false_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: some built-in static constants for boolean operations
</span><span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">neg_bool_bool <span class="keyword">:</span> bool <span class="keyword">-&gt;</span> bool</span> <span class="comment">(* boolean negation *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6148"><span class="stacstdec"><span class="keyword">~</span> <span class="keyword">=</span> neg_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">mul_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="comment">(* conjunction *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6240"><span class="stacstdec">&amp;&amp; <span class="keyword">=</span> mul_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">add_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span> <span class="comment">(* disjunction *)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6338"><span class="stacstdec">|| <span class="keyword">=</span> add_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gt_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6417"><span class="stacstdec"><span class="keyword">&gt;</span> <span class="keyword">=</span> gt_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gte_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6495"><span class="stacstdec">&gt;= <span class="keyword">=</span> gte_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lt_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6574"><span class="stacstdec"><span class="keyword">&lt;</span> <span class="keyword">=</span> lt_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lte_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6652"><span class="stacstdec">&lt;= <span class="keyword">=</span> lte_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">eq_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6731"><span class="stacstdec">== <span class="keyword">=</span> eq_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">neq_bool_bool_bool <span class="keyword">:</span> <span class="keyword">(</span>bool<span class="keyword">,</span> bool<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6810"><span class="stacstdec">&lt;&gt; <span class="keyword">=</span> neq_bool_bool_bool</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some built-in static constants for char comparisons
</span><span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">sub_char_char_int <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="6973"><span class="stacstdec">- <span class="keyword">=</span> sub_char_char_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gt_char_char_bool <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7050"><span class="stacstdec"><span class="keyword">&gt;</span> <span class="keyword">=</span> gt_char_char_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gte_char_char_bool <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7128"><span class="stacstdec">&gt;= <span class="keyword">=</span> gte_char_char_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lt_char_char_bool <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7207"><span class="stacstdec"><span class="keyword">&lt;</span> <span class="keyword">=</span> lt_char_char_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lte_char_char_bool <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7285"><span class="stacstdec">&lt;= <span class="keyword">=</span> lte_char_char_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">eq_char_char_bool <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7364"><span class="stacstdec">== <span class="keyword">=</span> eq_char_char_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">neq_char_char_bool <span class="keyword">:</span> <span class="keyword">(</span>char<span class="keyword">,</span> char<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7443"><span class="stacstdec">&lt;&gt; <span class="keyword">=</span> neq_char_char_bool</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some built-in static constants for integer comparisons
</span><span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gt_int_int_bool <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7606"><span class="stacstdec"><span class="keyword">&gt;</span> <span class="keyword">=</span> gt_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gte_int_int_bool <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7678"><span class="stacstdec">&gt;= <span class="keyword">=</span> gte_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lt_int_int_bool <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7751"><span class="stacstdec"><span class="keyword">&lt;</span> <span class="keyword">=</span> lt_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lte_int_int_bool <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7823"><span class="stacstdec">&lt;= <span class="keyword">=</span> lte_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">eq_int_int_bool <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7896"><span class="stacstdec">== <span class="keyword">=</span> eq_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">neq_int_int_bool <span class="keyword">:</span> <span class="keyword">(</span>int<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="7969"><span class="stacstdec">&lt;&gt; <span class="keyword">=</span> neq_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: some built-in static constants for pointer arithmetic
</span><span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">null_addr <span class="keyword">:</span> addr</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8086"><span class="stacstdec">null <span class="keyword">=</span> null_addr</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">add_addr_int_addr <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> addr</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8157"><span class="stacstdec">+ <span class="keyword">=</span> add_addr_int_addr</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">sub_addr_int_addr <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">-&gt;</span> addr</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8233"><span class="stacstdec">- <span class="keyword">=</span> sub_addr_int_addr</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">sub_addr_addr_int <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> int</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8309"><span class="stacstdec">- <span class="keyword">=</span> sub_addr_addr_int</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gt_addr_addr_bool <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8386"><span class="stacstdec"><span class="keyword">&gt;</span> <span class="keyword">=</span> gt_addr_addr_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">gte_addr_addr_bool <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8464"><span class="stacstdec">&gt;= <span class="keyword">=</span> gte_addr_addr_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lt_addr_addr_bool <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8543"><span class="stacstdec"><span class="keyword">&lt;</span> <span class="keyword">=</span> lt_addr_addr_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">lte_addr_addr_bool <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8621"><span class="stacstdec">&lt;= <span class="keyword">=</span> lte_addr_addr_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">eq_addr_addr_bool <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8700"><span class="stacstdec">== <span class="keyword">=</span> eq_addr_addr_bool</span></a></span>
<span class="comment">//
</span><span class="keyword">sta</span> <span class="staexp">neq_addr_addr_bool <span class="keyword">:</span> <span class="keyword">(</span>addr<span class="keyword">,</span> addr<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8779"><span class="stacstdec">&lt;&gt; <span class="keyword">=</span> neq_addr_addr_bool</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** subclass relation
*)</span>
<span class="keyword">sta</span> <span class="staexp">lte_cls_cls_bool <span class="keyword">:</span> <span class="keyword">(</span>cls<span class="keyword">,</span> cls<span class="keyword">)</span> <span class="keyword">-&gt;</span> bool</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="8903"><span class="stacstdec">&lt;= <span class="keyword">=</span> lte_cls_cls_bool</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX:
// some built-in static constants for rationals
// not yet supported and may never be supported
//
sta ~ : rat -&gt; rat (* rational negation *)
sta + : (rat, rat) -&gt; rat (* addition *)
and - : (rat, rat) -&gt; rat (* subtraction *)
and * : (rat, rat) -&gt; rat (* multiplication *)
and / : (rat, int) -&gt; rat (* division *)
and / : (rat, rat) -&gt; rat (* division *)
//
sta &gt; : (rat, rat) -&gt; bool
sta &gt; : (rat, int) -&gt; bool
and &gt;= : (rat, rat) -&gt; bool
and &lt; : (rat, rat) -&gt; bool
and &lt;= : (rat, rat) -&gt; bool
and &lt;&gt; : (rat, rat) -&gt; bool
and == : (rat, rat) -&gt; bool
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="keyword">viewtypedef</span> <span class="staexp"><a name="9554"><span class="stacstdec">bottom_t0ype_uni <span class="keyword">=</span> <span class="keyword">{</span>a<span class="keyword">:</span>t@ype<span class="keyword">}</span> a</span></a></span>
<span class="keyword">viewtypedef</span> <span class="staexp"><a name="9597"><span class="stacstdec">bottom_t0ype_exi <span class="keyword">=</span> <span class="keyword">[</span>a<span class="keyword">:</span>t@ype <span class="keyword">|</span> false<span class="keyword">]</span> a</span></a></span>
<span class="comment">//
</span><span class="keyword">viewtypedef</span> <span class="staexp"><a name="9651"><span class="stacstdec">bottom_viewt0ype_uni <span class="keyword">=</span> <span class="keyword">{</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">}</span> a</span></a></span>
<span class="keyword">viewtypedef</span> <span class="staexp"><a name="9702"><span class="stacstdec">bottom_viewt0ype_exi <span class="keyword">=</span> <span class="keyword">[</span>a<span class="keyword">:</span>viewt@ype <span class="keyword">|</span> false<span class="keyword">]</span> a</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some built-in type/viewtype/prop/view constructors
</span><span class="comment">//
</span><span class="keyword">absview</span> <span class="staexp"><a name="9844"><span class="stacstdec">at_viewt0ype_addr_view</span></a></span> <span class="keyword">(</span>viewt@ype+<span class="keyword">,</span> addr<span class="keyword">)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="9893"><span class="stacstdec">@ <span class="keyword">=</span> at_viewt0ype_addr_view</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abstype</span>
<span class="staexp"><a name="9950"><span class="stacstdec">ref_viewt0ype_type</span></a></span>
  <span class="keyword">(</span>viewt@ype<span class="keyword">)</span> <span class="comment">// boxed type // unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="10015"><span class="stacstdec">ref <span class="keyword">=</span> ref_viewt0ype_type</span></a></span>

<span class="keyword">abstype</span>
<span class="staexp"><a name="10049"><span class="stacstdec">refconst_t0ype_type</span></a></span> <span class="keyword">(</span>t@ype<span class="keyword">)</span> <span class="comment">// boxed type // unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="10109"><span class="stacstdec">refconst <span class="keyword">=</span> refconst_t0ype_type</span></a></span>

<span class="comment">(*
//
// HX-2009: should this be added?
//
abstype
refopt_viewt0ype_bool_type (viewt@ype, bool) // unnamed
stadef refopt = refopt_viewt0ype_bool_type
//
typedef Refopt (a: viewt@ype) = [b:bool] refopt (a, b)
//
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: for taking out a component in a record
</span><span class="keyword">abst@ype</span>
<span class="staexp"><a name="10434"><span class="stacstdec">without_viewt0ype_t0ype</span></a></span> <span class="keyword">(</span>viewt@ype<span class="keyword">)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="10477"><span class="stacstdec">without <span class="keyword">=</span> without_viewt0ype_t0ype</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: sta vbox_view_prop : view -&gt; prop
</span><span class="comment">//
</span><span class="keyword">absprop</span> <span class="staexp"><a name="10566"><span class="stacstdec">vbox_view_prop</span></a></span> <span class="keyword">(</span>view<span class="keyword">)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="10595"><span class="stacstdec">vbox <span class="keyword">=</span> vbox_view_prop</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
//
// HX: support for union type may be removed
//
absviewt@ype opt_viewt0ype_int_viewt0ype
  (a:viewt@ype+, i:int) = union (i) { value= a }
stadef opt = value_viewt0ype_int_viewt0ype
*)</span>

<span class="keyword">absviewt@ype</span>
<span class="staexp"><a name="10845"><span class="stacstdec">opt_viewt0ype_bool_viewt0ype <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> opt<span class="keyword">:</span>bool<span class="keyword">)</span> <span class="keyword">=</span> a</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="10910"><span class="stacstdec">opt <span class="keyword">=</span> opt_viewt0ype_bool_viewt0ype</span></a></span>

<span class="comment">//
</span><span class="comment">// HX-2010-03-23: resulting in incorrect erasure
</span><span class="comment">// stadef Opt (a:viewt@ype) = [b:bool] opt (a, b)
</span><span class="comment">//
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
// HX-2008:
// this is not yet supported and may never be
datasort stamp = (* abstract *) // be supported
// sta vfrac : (stamp, view, rat) -&gt; view
absview vfrac (stamp, view, rat)
// sta vtfrac : (stamp, viewtype, rat) -&gt; viewtype
absviewtype vtfrac (stamp, viewtype, rat)
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: build-in dependent type constructors
</span><span class="comment">//
</span><span class="keyword">abstype</span>
<span class="staexp"><a name="11432"><span class="stacstdec">array0_viewt0ype_type</span></a></span> <span class="keyword">(</span>elt<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">abstype</span>
<span class="staexp"><a name="11489"><span class="stacstdec">array_viewt0ype_int_type</span></a></span> <span class="keyword">(</span>elt<span class="keyword">:</span>viewt@ype<span class="keyword">,</span> sz<span class="keyword">:</span>int<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="comment">//
</span><span class="keyword">abstype</span>
<span class="staexp"><a name="11560"><span class="stacstdec">matrix0_viewt0ype_type</span></a></span> <span class="keyword">(</span>elt<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">abstype</span>
<span class="staexp"><a name="11618"><span class="stacstdec">matrix_viewt0ype_int_int_type</span></a></span> <span class="keyword">(</span>elt<span class="keyword">:</span>viewt@ype<span class="keyword">,</span> nrow<span class="keyword">:</span>int<span class="keyword">,</span> ncol<span class="keyword">:</span>int<span class="keyword">)</span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="11717"><span class="stacstdec">bool_bool_t0ype <span class="keyword">(</span>bool<span class="keyword">)</span> <span class="keyword">=</span> bool_t0ype</span></a></span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="11763"><span class="stacstdec">char_char_t0ype <span class="keyword">(</span>char<span class="keyword">)</span> <span class="keyword">=</span> char_t0ype</span></a></span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="11809"><span class="stacstdec">int_int_t0ype <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=</span> int_t0ype</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="11850"><span class="stacstdec">uint_int_t0ype <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=</span> uint_t0ype</span></a></span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="11894"><span class="stacstdec">lint_int_t0ype <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=</span> int_long_t0ype</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="11941"><span class="stacstdec">ulint_int_t0ype <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=</span> uint_long_t0ype</span></a></span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="11991"><span class="stacstdec">llint_int_t0ype <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=</span> int_long_long_t0ype</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="12044"><span class="stacstdec">ullint_int_t0ype <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=</span> uint_long_long_t0ype</span></a></span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="12100"><span class="stacstdec">size_int_t0ype <span class="keyword">(</span>i<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> size_t0ype</span></a></span>
<span class="keyword">abst@ype</span> <span class="staexp"><a name="12145"><span class="stacstdec">ssize_int_t0ype <span class="keyword">(</span>i<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> ssize_t0ype</span></a></span>

<span class="keyword">abst@ype</span> <span class="staexp"><a name="12193"><span class="stacstdec">ptrdiff_int_t0ype <span class="keyword">(</span>i<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> ptrdiff_t0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abstype</span> <span class="staexp"><a name="12265"><span class="stacstdec">ptr_addr_type <span class="keyword">(</span>addr<span class="keyword">)</span> <span class="keyword">=</span> ptr_type</span></a></span> <span class="comment">// named
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">abstype</span> <span class="staexp"><a name="12336"><span class="stacstdec">string_int_type</span></a></span> <span class="keyword">(</span>int<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">abstype</span> <span class="staexp"><a name="12377"><span class="stacstdec">stropt_int_type</span></a></span> <span class="keyword">(</span>int<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">abst@ype</span>
<span class="staexp"><a name="12419"><span class="stacstdec">strbuf_int_int_t0ype</span></a></span> <span class="keyword">(</span>bsz<span class="keyword">:</span> int<span class="keyword">,</span> len<span class="keyword">:</span> int<span class="keyword">)</span> <span class="comment">// of variable size
</span><span class="keyword">absviewtype</span>
<span class="staexp"><a name="12493"><span class="stacstdec">strptr_addr_int_viewtype</span></a></span> <span class="keyword">(</span>addr<span class="keyword">,</span> int<span class="keyword">)</span> <span class="comment">// for linear strings
</span><span class="keyword">absviewtype</span> <span class="staexp"><a name="12564"><span class="stacstdec">strptr_addr_viewtype</span></a></span> <span class="keyword">(</span>addr<span class="keyword">)</span> <span class="comment">// for linear strings
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: The following definitions are needed in the ATS constraint solver
</span><span class="comment">//
</span><span class="comment">// absolute value function relation
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="12760"><span class="stacstdec">abs_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> v<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>x &gt;= 0 &amp;&amp; x == v<span class="keyword">)</span> || <span class="keyword">(</span>x &lt;= 0 &amp;&amp; <span class="keyword">~</span>x == v<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="12853"><span class="stacstdec">abs_r <span class="keyword">=</span> abs_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: in-between relation
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="12918"><span class="stacstdec">btw_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> z<span class="keyword">:</span>int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>x &lt;= y &amp;&amp; y <span class="keyword">&lt;</span> z<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">// HX: int_of_bool conversion
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="13034"><span class="stacstdec">int_of_bool_bool <span class="keyword">(</span>b<span class="keyword">:</span> bool<span class="keyword">,</span> v<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>b &amp;&amp; v == 1<span class="keyword">)</span> || <span class="keyword">(</span><span class="keyword">~</span>b &amp;&amp; v == 0<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">// HX: subtraction relation on natural numbers
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="13171"><span class="stacstdec">nsub_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> v<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>x &gt;= y &amp;&amp; v == x - y<span class="keyword">)</span> || <span class="keyword">(</span>x &lt;= y &amp;&amp; v == 0<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="13280"><span class="stacstdec">nsub_r <span class="keyword">=</span> nsub_int_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: maximum function relation
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="13357"><span class="stacstdec">max_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> v<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>x &gt;= y &amp;&amp; x == v<span class="keyword">)</span> || <span class="keyword">(</span>x &lt;= y &amp;&amp; y == v<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="13461"><span class="stacstdec">max_r <span class="keyword">=</span> max_int_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: minimum function relation
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="13536"><span class="stacstdec">min_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> v<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>x &gt;= y &amp;&amp; y == v<span class="keyword">)</span> || <span class="keyword">(</span>x &lt;= y &amp;&amp; x == v<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="13640"><span class="stacstdec">min_r <span class="keyword">=</span> min_int_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: sign function relation
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="13712"><span class="stacstdec">sgn_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> v<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>x <span class="keyword">&gt;</span> 0 &amp;&amp; v == 1<span class="keyword">)</span> || <span class="keyword">(</span>x == 0 &amp;&amp; v == 0<span class="keyword">)</span> || <span class="keyword">(</span>x <span class="keyword">&lt;</span> 0 &amp;&amp; v == ~1<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="13825"><span class="stacstdec">sgn_r <span class="keyword">=</span> sgn_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: division relation (nat)
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="13894"><span class="stacstdec">ndiv_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> q<span class="keyword">:</span> int<span class="keyword">)</span><span class="keyword">:</span> bool <span class="keyword">=</span>
  <span class="keyword">(</span>q * y &lt;= x &amp;&amp; x <span class="keyword">&lt;</span> q * y + y<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="13988"><span class="stacstdec">ndiv_r <span class="keyword">=</span> ndiv_int_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: division relation (int)
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="14063"><span class="stacstdec">div_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">:</span> int<span class="keyword">,</span> y<span class="keyword">:</span> int<span class="keyword">,</span> q<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">(</span>x &gt;= 0 &amp;&amp; y <span class="keyword">&gt;</span> 0 &amp;&amp; ndiv_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">,</span> q<span class="keyword">)</span><span class="keyword">)</span> ||
  <span class="keyword">(</span>x &gt;= 0 &amp;&amp; y <span class="keyword">&lt;</span> 0 &amp;&amp; ndiv_int_int_int_bool <span class="keyword">(</span>x<span class="keyword">,</span> <span class="keyword">~</span>y<span class="keyword">,</span> <span class="keyword">~</span>q<span class="keyword">)</span><span class="keyword">)</span> ||
  <span class="keyword">(</span>x &lt;= 0 &amp;&amp; y <span class="keyword">&gt;</span> 0 &amp;&amp; ndiv_int_int_int_bool <span class="keyword">(</span><span class="keyword">~</span>x<span class="keyword">,</span> y<span class="keyword">,</span> <span class="keyword">~</span>q<span class="keyword">)</span><span class="keyword">)</span> ||
  <span class="keyword">(</span>x &lt;= 0 &amp;&amp; y <span class="keyword">&lt;</span> 0 &amp;&amp; ndiv_int_int_int_bool <span class="keyword">(</span><span class="keyword">~</span>x<span class="keyword">,</span> <span class="keyword">~</span>y<span class="keyword">,</span> q<span class="keyword">)</span><span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="14353"><span class="stacstdec">div_r <span class="keyword">=</span> div_int_int_int_bool</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: modulo relation // not handled yet
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="14458"><span class="stacstdec">size_int_int_bool <span class="keyword">(</span>sz<span class="keyword">:</span> int<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> n &gt;= 0</span></a></span>

<span class="keyword">sta</span> <span class="staexp">sizeof_viewt0ype_int <span class="keyword">:</span> viewt@ype <span class="keyword">-&gt;</span> int</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="14554"><span class="stacstdec">sizeof <span class="keyword">=</span> sizeof_viewt0ype_int</span></a></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: introduce some short names
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="14652"><span class="stacstdec">array0 <span class="keyword">=</span> array0_viewt0ype_type</span></a></span> <span class="comment">// with dynamic size
</span><span class="keyword">stadef</span> <span class="staexp"><a name="14711"><span class="stacstdec">array <span class="keyword">=</span> array_viewt0ype_int_type</span></a></span> <span class="comment">// without dynamic size
</span><span class="keyword">stadef</span> <span class="staexp"><a name="14775"><span class="stacstdec">matrix0 <span class="keyword">=</span> matrix0_viewt0ype_type</span></a></span> <span class="comment">// with dynamic size
</span><span class="keyword">stadef</span> <span class="staexp"><a name="14836"><span class="stacstdec">matrix <span class="keyword">=</span> matrix_viewt0ype_int_int_type</span></a></span> <span class="comment">// without dynamic size
</span>
<span class="comment">(*
** HX: this order is significant!
*)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="14947"><span class="stacstdec">bool <span class="keyword">=</span> bool_bool_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="14977"><span class="stacstdec">bool <span class="keyword">=</span> bool_t0ype</span></a></span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15003"><span class="stacstdec">byte <span class="keyword">=</span> byte_t0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: this order is significant!
*)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15090"><span class="stacstdec">char <span class="keyword">=</span> char_char_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15120"><span class="stacstdec">char <span class="keyword">=</span> char_t0ype</span></a></span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15146"><span class="stacstdec">schar <span class="keyword">=</span> schar_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15173"><span class="stacstdec">uchar <span class="keyword">=</span> uchar_t0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15222"><span class="stacstdec">double <span class="keyword">=</span> double_t0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15273"><span class="stacstdec">exn <span class="keyword">=</span> exception_viewtype</span></a></span> <span class="comment">// a boxed type
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
** HX: this order is significant!
*)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15383"><span class="stacstdec">int <span class="keyword">=</span> int_int_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15410"><span class="stacstdec">int <span class="keyword">=</span> int_t0ype</span></a></span>

<span class="comment">(*
** HX: this order is significant!
*)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15474"><span class="stacstdec">uint <span class="keyword">=</span> uint_int_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15503"><span class="stacstdec">uint <span class="keyword">=</span> uint_t0ype</span></a></span>

<span class="comment">(*
** HX: this order is significant!
*)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15569"><span class="stacstdec">size_t <span class="keyword">=</span> size_int_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15600"><span class="stacstdec">size_t <span class="keyword">=</span> size_t0ype</span></a></span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15628"><span class="stacstdec">ssize_t <span class="keyword">=</span> ssize_int_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15661"><span class="stacstdec">ssize_t <span class="keyword">=</span> ssize_t0ype</span></a></span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15691"><span class="stacstdec">ptrdiff_t <span class="keyword">=</span> ptrdiff_int_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15728"><span class="stacstdec">ptrdiff_t <span class="keyword">=</span> ptrdiff_t0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15783"><span class="stacstdec">ptr <span class="keyword">=</span> ptr_addr_type</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15810"><span class="stacstdec">ptr <span class="keyword">=</span> ptr_type</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15854"><span class="stacstdec">strbuf <span class="keyword">=</span> strbuf_int_int_t0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15891"><span class="stacstdec">strbuf <span class="keyword">(</span>bsz<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>len<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= len<span class="keyword">]</span> strbuf <span class="keyword">(</span>bsz<span class="keyword">,</span> len<span class="keyword">)</span></span></a></span>

<span class="keyword">stadef</span> <span class="staexp"><a name="15957"><span class="stacstdec">string <span class="keyword">=</span> string_int_type</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="15989"><span class="stacstdec">string <span class="keyword">=</span> string_type</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="16017"><span class="stacstdec">stropt <span class="keyword">=</span> stropt_int_type</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="16049"><span class="stacstdec">strptr <span class="keyword">=</span> strptr_addr_viewtype</span></a></span> <span class="comment">// for linear strings
</span><span class="keyword">stadef</span> <span class="staexp"><a name="16108"><span class="stacstdec">strptr0 <span class="keyword">=</span> <span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span> strptr <span class="keyword">(</span>l<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="16145"><span class="stacstdec">strptr1 <span class="keyword">=</span> <span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span> strptr <span class="keyword">(</span>l<span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="16193"><span class="stacstdec">strptrlen <span class="keyword">=</span> strptr_addr_int_viewtype</span></a></span> <span class="comment">// for linear strings with length
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="16293"><span class="stacstdec">void <span class="keyword">=</span> void_t0ype</span></a></span> <span class="comment">// sizeof(void) = 1
</span><span class="keyword">stadef</span> <span class="staexp"><a name="16338"><span class="stacstdec">empty <span class="keyword">=</span> empty_t0ype</span></a></span> <span class="comment">// sizeof(empty) = 0
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datatype</span> <span class="staexp"><a name="16410"><span class="stacstdec">unit</span></a></span> <span class="keyword">=</span> unit <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><span class="keyword">)</span></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="16437"><span class="stacstdec">Bool <span class="keyword">=</span> <span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span> bool b</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="16469"><span class="stacstdec">Char <span class="keyword">=</span> <span class="keyword">[</span>c<span class="keyword">:</span>char<span class="keyword">]</span> char c</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="16501"><span class="stacstdec">Int <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16529"><span class="stacstdec">intLt <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16575"><span class="stacstdec">intLte <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &lt;= n<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16623"><span class="stacstdec">intGt <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&gt;</span> n<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16669"><span class="stacstdec">intGte <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= n<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16717"><span class="stacstdec">intBtw <span class="keyword">(</span>lb<span class="keyword">:</span>int<span class="keyword">,</span> ub<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> ub<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16784"><span class="stacstdec">intBtwe <span class="keyword">(</span>lb<span class="keyword">:</span>int<span class="keyword">,</span> ub<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i &lt;= ub<span class="keyword">]</span> int i</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="16854"><span class="stacstdec">Nat <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span> int n</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16891"><span class="stacstdec">natLt <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;=i<span class="keyword">;</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span> int i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="16944"><span class="stacstdec">natLte <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= i<span class="keyword">;</span> i &lt;= n<span class="keyword">]</span> int i</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17001"><span class="stacstdec">Pos <span class="keyword">=</span> intGt 0</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17023"><span class="stacstdec">Neg <span class="keyword">=</span> intLt 0</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17046"><span class="stacstdec">Sgn <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> ~1 &lt;= i<span class="keyword">;</span> i &lt;= 1<span class="keyword">]</span> int i</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17093"><span class="stacstdec">Ptr <span class="keyword">=</span> <span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span> ptr <span class="keyword">(</span>l<span class="keyword">)</span></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17124"><span class="stacstdec">Ptr1 <span class="keyword">=</span> <span class="keyword">[</span>l<span class="keyword">:</span>addr <span class="keyword">|</span> l <span class="keyword">&gt;</span> null<span class="keyword">]</span> ptr <span class="keyword">(</span>l<span class="keyword">)</span></span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17168"><span class="stacstdec">String <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span> string n</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17211"><span class="stacstdec">Stropt <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int<span class="keyword">]</span> stropt n</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17246"><span class="stacstdec">uInt <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;=0<span class="keyword">]</span> uint n</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17306"><span class="stacstdec">sizeof_t
  <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> size_int_t0ype <span class="keyword">(</span>sizeof_viewt0ype_int a<span class="keyword">)</span></span></a></span>
<span class="comment">// end of [sizeof_t]
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17403"><span class="stacstdec">Size <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= 0<span class="keyword">]</span> size_t i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17444"><span class="stacstdec">sizeLt <span class="keyword">(</span>n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> n<span class="keyword">]</span> size_t <span class="keyword">(</span>i<span class="keyword">)</span></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17505"><span class="stacstdec">sizeLte <span class="keyword">(</span>n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> 0 &lt;= i<span class="keyword">;</span> i &lt;= n<span class="keyword">]</span> size_t <span class="keyword">(</span>i<span class="keyword">)</span></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17568"><span class="stacstdec">sizeGt <span class="keyword">(</span>n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i <span class="keyword">&gt;</span> n<span class="keyword">]</span> size_t <span class="keyword">(</span>i<span class="keyword">)</span></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17621"><span class="stacstdec">sizeGte <span class="keyword">(</span>n<span class="keyword">:</span> int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int <span class="keyword">|</span> i &gt;= n<span class="keyword">]</span> size_t <span class="keyword">(</span>i<span class="keyword">)</span></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17676"><span class="stacstdec">sizeBtw <span class="keyword">(</span>lb<span class="keyword">:</span>int<span class="keyword">,</span> ub<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> ub<span class="keyword">]</span> size_t i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17747"><span class="stacstdec">sizeBtwe <span class="keyword">(</span>lb<span class="keyword">:</span>int<span class="keyword">,</span> ub<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i &lt;= ub<span class="keyword">]</span> size_t i</span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17821"><span class="stacstdec">SSize <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span> ssize_t i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17855"><span class="stacstdec">ssizeBtw <span class="keyword">(</span>lb<span class="keyword">:</span>int<span class="keyword">,</span> ub<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i <span class="keyword">&lt;</span> ub<span class="keyword">]</span> ssize_t i</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="17928"><span class="stacstdec">ssizeBtwe <span class="keyword">(</span>lb<span class="keyword">:</span>int<span class="keyword">,</span> ub<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>i<span class="keyword">:</span> int <span class="keyword">|</span> lb &lt;= i<span class="keyword">;</span> i &lt;= ub<span class="keyword">]</span> ssize_t i</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// for memory deallocation (with/without GC)
</span>
<span class="keyword">absview</span> <span class="staexp"><a name="18071"><span class="stacstdec">free_gc_addr_view</span></a></span> <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span>
<span class="keyword">absview</span> <span class="staexp"><a name="18106"><span class="stacstdec">free_ngc_addr_view</span></a></span> <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="18141"><span class="stacstdec">free_gc_v <span class="keyword">=</span> free_gc_addr_view</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="18178"><span class="stacstdec">free_ngc_v <span class="keyword">=</span> free_ngc_addr_view</span></a></span>

<span class="comment">//
</span>
<span class="keyword">absview</span> <span class="staexp"><a name="18223"><span class="stacstdec">free_gc_viewt0ype_addr_view</span></a></span> <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span>
<span class="keyword">absview</span> <span class="staexp"><a name="18282"><span class="stacstdec">free_ngc_viewt0ype_addr_view</span></a></span> <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="18341"><span class="stacstdec">free_gc_v <span class="keyword">=</span> free_gc_viewt0ype_addr_view</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="18388"><span class="stacstdec">free_ngc_v <span class="keyword">=</span> free_ngc_viewt0ype_addr_view</span></a></span>

<span class="comment">//
</span>
<span class="keyword">absview</span> <span class="staexp"><a name="18443"><span class="stacstdec">free_gc_viewt0ype_addr_int_view</span></a></span> <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span>
<span class="keyword">absview</span> <span class="staexp"><a name="18513"><span class="stacstdec">free_ngc_viewt0ype_addr_int_view</span></a></span> <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">,</span> l<span class="keyword">:</span> addr<span class="keyword">)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="18584"><span class="stacstdec">free_gc_v <span class="keyword">=</span> free_gc_viewt0ype_addr_int_view</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="18635"><span class="stacstdec">free_ngc_v <span class="keyword">=</span> free_ngc_viewt0ype_addr_int_view</span></a></span>

<span class="comment">//
</span>
<span class="keyword">viewdef</span> <span class="staexp"><a name="18694"><span class="stacstdec">free_gc_v <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> free_gc_v <span class="keyword">(</span>byte<span class="keyword">,</span> n<span class="keyword">,</span> l<span class="keyword">)</span></span></a></span>
<span class="keyword">viewdef</span> <span class="staexp"><a name="18753"><span class="stacstdec">free_ngc_v <span class="keyword">(</span>n<span class="keyword">:</span>int<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> free_ngc_v <span class="keyword">(</span>byte<span class="keyword">,</span> n<span class="keyword">,</span> l<span class="keyword">)</span></span></a></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX:
</span><span class="comment">// values of viewtype [junkptr] need to be freed by calling [free];
</span><span class="comment">// note that the viewtype [junkptr] may be just defined as follows:
</span><span class="comment">// [a:viewt@ype; l:addr] (free_gc_v (a, 1, l), a? @ l | ptr l)
</span><span class="comment">//
</span><span class="keyword">absviewtype</span> <span class="staexp"><a name="19051"><span class="stacstdec">junkptr_viewtype</span></a></span> <span class="comment">// unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="19086"><span class="stacstdec">junkptr <span class="keyword">=</span> junkptr_viewtype</span></a></span> <span class="comment">// shorthand
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: This definition should not be changed!
</span><span class="comment">//
</span><span class="keyword">viewtypedef</span>
<span class="staexp"><a name="19211"><span class="stacstdec">arraysize_viewt0ype_int_viewt0ype <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">,</span> n<span class="keyword">:</span>int<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">[</span>l<span class="keyword">:</span>addr<span class="keyword">]</span> <span class="keyword">(</span>free_gc_v <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">,</span> <span class="keyword">@[</span>a<span class="keyword">]</span><span class="keyword">[</span>n<span class="keyword">]</span> @ l <span class="keyword">|</span> ptr l<span class="keyword">,</span> size_t n<span class="keyword">)</span></span></a></span>
<span class="comment">// end of [viewtypedef]
</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="19364"><span class="stacstdec">arraysize <span class="keyword">=</span> arraysize_viewt0ype_int_viewt0ype</span></a></span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="19423"><span class="stacstdec">Arraysize
  <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span> arraysize <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">)</span></span></a></span>
<span class="comment">// end of [Arraysize]
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: closure, closure pointer and closure reference
</span><span class="comment">//
</span><span class="keyword">absviewt@ype</span>
<span class="staexp"><a name="19601"><span class="stacstdec">clo_viewt0ype_viewt0ype</span></a></span> <span class="keyword">(</span>_fun<span class="keyword">:</span> viewt@ype+<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="19662"><span class="stacstdec">clo <span class="keyword">=</span> clo_viewt0ype_viewt0ype</span></a></span>

<span class="keyword">absviewtype</span>
<span class="staexp"><a name="19705"><span class="stacstdec">cloptr_viewt0ype_viewtype</span></a></span> <span class="keyword">(</span>_fun<span class="keyword">:</span> viewt@ype+<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="19768"><span class="stacstdec">cloptr <span class="keyword">=</span> cloptr_viewt0ype_viewtype</span></a></span>

<span class="keyword">abstype</span>
<span class="staexp"><a name="19812"><span class="stacstdec">cloref_t0ype_type</span></a></span> <span class="keyword">(</span>_fun<span class="keyword">:</span> t@ype<span class="keyword">)</span> <span class="comment">// unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="19862"><span class="stacstdec">cloref <span class="keyword">=</span> cloref_t0ype_type</span></a></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: for handling read-only data
</span><span class="comment">//
</span><span class="comment">(*
absviewt@ype
READ_viewt0ype_viewt0ype (a: viewt@ype+) = a
*)</span>
<span class="keyword">viewtypedef</span>
<span class="staexp"><a name="20027"><span class="stacstdec">READ_viewt0ype_viewt0ype <span class="keyword">(</span>a<span class="keyword">:</span> viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> a</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="20078"><span class="stacstdec">READ <span class="keyword">=</span> READ_viewt0ype_viewt0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: for print-format strings
</span><span class="comment">//
</span><span class="keyword">abstype</span>
<span class="staexp"><a name="20177"><span class="stacstdec">printf_c_types_type</span></a></span> <span class="keyword">(</span>types<span class="keyword">)</span> <span class="comment">// boxed type: string
</span><span class="keyword">stadef</span> <span class="staexp"><a name="20234"><span class="stacstdec">printf_c <span class="keyword">=</span> printf_c_types_type</span></a></span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: for handling variadic functions
</span><span class="comment">//
</span><span class="keyword">absviewt@ype</span>
<span class="staexp"><a name="20344"><span class="stacstdec">va_list_viewt0ype <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_va_list_viewtype"</span></a></span>
<span class="keyword">absviewt@ype</span>
<span class="staexp"><a name="20407"><span class="stacstdec">va_list_types_viewt0ype <span class="keyword">(</span>types<span class="keyword">)</span> <span class="keyword">=</span> va_list_viewt0ype</span></a></span>

<span class="comment">(*
** HX: this order is significant!
*)</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="20507"><span class="stacstdec">va_list <span class="keyword">=</span> va_list_types_viewt0ype</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="20548"><span class="stacstdec">va_list <span class="keyword">=</span> va_list_viewt0ype</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datasort</span> <span class="staexp">file_mode <span class="keyword">=</span>
  <span class="keyword">|</span> file_mode_r <span class="comment">(* read *)</span>
  <span class="keyword">|</span> file_mode_w <span class="comment">(* write *)</span>
  <span class="keyword">|</span> file_mode_rw</span> <span class="comment">(* read and write *)</span>
<span class="comment">// end of [file_mode]
</span><span class="comment">//
</span><span class="keyword">stadef</span> <span class="staexp"><a name="20744"><span class="stacstdec">r <span class="keyword">=</span> file_mode_r <span class="keyword">(</span><span class="keyword">)</span></span></a></span> <span class="keyword">and</span> <span class="staexp"><a name="20767"><span class="stacstdec">w <span class="keyword">=</span> file_mode_w <span class="keyword">(</span><span class="keyword">)</span></span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="20793"><span class="stacstdec">rw <span class="keyword">=</span> file_mode_rw <span class="keyword">(</span><span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">// [ats_FILE_viewtype] is defined in [libc/CATS/stdio.cats]
</span><span class="comment">//
</span><span class="keyword">absviewt@ype</span>
<span class="staexp"><a name="20893"><span class="stacstdec">FILE_viewt0ype <span class="keyword">(</span>file_mode<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$extype</span>"ats_FILE_viewtype"</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="20956"><span class="stacstdec">FILE <span class="keyword">=</span> FILE_viewt0ype</span></a></span>
<span class="comment">//
</span><span class="comment">// HX-2010-05-02:
</span><span class="comment">// this is easy to use but unsafe and should probably be DEPRECATED?
</span><span class="comment">//
</span><span class="comment">// [FILEref_type] is [ref (FILE m)] for some [m]
</span><span class="comment">//
</span><span class="keyword">abstype</span> <span class="staexp"><a name="21131"><span class="stacstdec">FILEref_type</span></a></span> <span class="comment">// unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="21162"><span class="stacstdec">FILEref <span class="keyword">=</span> FILEref_type</span></a></span> <span class="comment">// shorthand
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some common datatypes
</span><span class="comment">//
</span><span class="keyword">datatype</span>
<span class="staexp"><a name="21265"><span class="stacstdec">box_t0ype_type <span class="keyword">(</span>a<span class="keyword">:</span>t@ype+<span class="keyword">)</span></span></a></span> <span class="keyword">=</span> box <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">a</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="21313"><span class="stacstdec">box <span class="keyword">=</span> box_t0ype_type</span></a></span>
<span class="comment">//
</span><span class="keyword">dataviewtype</span>
<span class="staexp"><a name="21350"><span class="stacstdec">box_viewt0ype_viewtype <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">)</span></span></a></span> <span class="keyword">=</span> box_vt <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">a</span>
<span class="keyword">stadef</span> <span class="staexp"><a name="21413"><span class="stacstdec">box_vt <span class="keyword">=</span> box_viewt0ype_viewtype</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: [list0_t0ype_type] is co-variant
</span><span class="comment">//
</span><span class="keyword">datatype</span> <span class="staexp"><a name="21500"><span class="stacstdec">list0_t0ype_type <span class="keyword">(</span>a<span class="keyword">:</span> t@ype+<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> list0_cons <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> list0_t0ype_type a<span class="keyword">)</span></span> <span class="keyword">|</span> list0_nil <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [list0_t0ype_type]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="21635"><span class="stacstdec">list0 <span class="keyword">=</span> list0_t0ype_type</span></a></span>
<span class="comment">//
</span><span class="keyword">datatype</span> <span class="comment">// t@ype+: covariant
</span><span class="staexp"><a name="21693"><span class="stacstdec">list_t0ype_int_type <span class="keyword">(</span>a<span class="keyword">:</span>t@ype+<span class="keyword">,</span> int<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="keyword">{</span><span class="staexp">n<span class="keyword">:</span>int</span> <span class="keyword">|</span> <span class="staexp">n &gt;= 0</span><span class="keyword">}</span>
    list_cons <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> n+1<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> list_t0ype_int_type <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> list_nil <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> 0<span class="keyword">)</span></span>
<span class="comment">// end of [datatype]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="21858"><span class="stacstdec">list <span class="keyword">=</span> list_t0ype_int_type</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="21893"><span class="stacstdec">List <span class="keyword">(</span>a<span class="keyword">:</span>t@ype<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;= 0<span class="keyword">]</span> list <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">// HX: [option0_t0ype_type] is co-variant
</span><span class="comment">//
</span><span class="keyword">datatype</span> <span class="staexp"><a name="21996"><span class="stacstdec">option0_t0ype_type <span class="keyword">(</span>a<span class="keyword">:</span> t@ype<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> option0_some <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">|</span> option0_none <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [datatype]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="22109"><span class="stacstdec">option0 <span class="keyword">=</span> option0_t0ype_type</span></a></span>
<span class="comment">//
</span><span class="keyword">datatype</span> <span class="comment">// t@ype+: covariant
</span><span class="staexp"><a name="22171"><span class="stacstdec">option_t0ype_bool_type <span class="keyword">(</span>a<span class="keyword">:</span>t@ype+<span class="keyword">,</span> bool<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> None <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> false<span class="keyword">)</span></span> <span class="keyword">|</span> Some <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> true<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">a</span>
<span class="comment">// end of [datatype]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="22283"><span class="stacstdec">option <span class="keyword">=</span> option_t0ype_bool_type</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="22323"><span class="stacstdec">Option <span class="keyword">(</span>a<span class="keyword">:</span>t@ype<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span> option <span class="keyword">(</span>a<span class="keyword">,</span> b<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some common dataviewtypes
</span><span class="comment">//
</span><span class="keyword">dataviewtype</span> <span class="comment">// viewt@ype+: covariant
</span><span class="staexp"><a name="22465"><span class="stacstdec">list_viewt0ype_int_viewtype <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> int<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="keyword">{</span><span class="staexp">n<span class="keyword">:</span>int</span> <span class="keyword">|</span> <span class="staexp">n &gt;= 0</span><span class="keyword">}</span>
    list_vt_cons <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> n+1<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> list_viewt0ype_int_viewtype <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> list_vt_nil <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> 0<span class="keyword">)</span></span>
<span class="comment">// end of [list_viewt0ype_int_viewtype]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="22675"><span class="stacstdec">list_vt <span class="keyword">=</span> list_viewt0ype_int_viewtype</span></a></span>
<span class="keyword">viewtypedef</span> <span class="staexp"><a name="22725"><span class="stacstdec">List_vt <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">:</span>int <span class="keyword">|</span> n &gt;=0<span class="keyword">]</span> list_vt <span class="keyword">(</span>a<span class="keyword">,</span> n<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="keyword">dataviewtype</span> <span class="comment">// viewt@ype+: covariant
</span><span class="staexp"><a name="22821"><span class="stacstdec">option_viewt0ype_bool_viewtype <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">,</span> bool<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> None_vt <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> false<span class="keyword">)</span></span> <span class="keyword">|</span> Some_vt <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> true<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">a</span>
<span class="comment">// end of [option_viewt0ype_bool_viewtype]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="22973"><span class="stacstdec">option_vt <span class="keyword">=</span> option_viewt0ype_bool_viewtype</span></a></span>
<span class="keyword">viewtypedef</span> <span class="staexp"><a name="23028"><span class="stacstdec">Option_vt <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span> option_vt <span class="keyword">(</span>a<span class="keyword">,</span> b<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: some useful props and views
</span><span class="comment">//
</span><span class="keyword">dataprop</span> <span class="prfexp"><span class="staexp"><a name="23153"><span class="stacstdec">unit_p</span></a></span> <span class="keyword">=</span> unit_p <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="keyword">dataview</span> <span class="prfexp"><span class="staexp"><a name="23184"><span class="stacstdec">unit_v</span></a></span> <span class="keyword">=</span> unit_v <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><span class="keyword">)</span></span></span>
<span class="comment">//
</span><span class="keyword">dataview</span>
<span class="prfexp"><span class="staexp"><a name="23218"><span class="stacstdec">option_view_bool_view
  <span class="keyword">(</span>a<span class="keyword">:</span>view+<span class="keyword">,</span> bool<span class="keyword">)</span></span></a></span> <span class="keyword">=</span> Some_v <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> true<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">a</span> <span class="keyword">|</span> None_v <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> false<span class="keyword">)</span></span></span>
<span class="comment">// end of [option_view_bool_view]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="23343"><span class="stacstdec">option_v <span class="keyword">=</span> option_view_bool_view</span></a></span>
<span class="keyword">viewdef</span> <span class="staexp"><a name="23384"><span class="stacstdec">optvar_v <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">,</span> l<span class="keyword">:</span>addr<span class="keyword">)</span> <span class="keyword">=</span> option_v <span class="keyword">(</span>a @ l<span class="keyword">,</span> l <span class="keyword">&gt;</span> null<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="keyword">dataview</span>
<span class="prfexp"><span class="staexp"><a name="23456"><span class="stacstdec">disj_view_view_int_view
  <span class="keyword">(</span>v0<span class="keyword">:</span> view<span class="keyword">,</span> v1<span class="keyword">:</span> view<span class="keyword">,</span> int<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> InsLeft_v <span class="staexp"><span class="keyword">(</span>v0<span class="keyword">,</span> v1<span class="keyword">,</span> 0<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">v0</span> <span class="keyword">|</span> InsRight_v <span class="staexp"><span class="keyword">(</span>v0<span class="keyword">,</span> v1<span class="keyword">,</span> 1<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp">v1</span></span>
<span class="comment">// end of [dataview or_view_view_int_view]
</span><span class="keyword">stadef</span> <span class="staexp"><a name="23623"><span class="stacstdec">disj_v <span class="keyword">=</span> disj_view_view_int_view</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: subview relation that only allows *reading*
</span><span class="comment">//
</span><span class="keyword">absprop</span> <span class="staexp"><a name="23721"><span class="stacstdec">vsubr_p</span></a></span> <span class="keyword">(</span>v1<span class="keyword">:</span>view+<span class="keyword">,</span> v2<span class="keyword">:</span> view-<span class="keyword">)</span> <span class="comment">// v2 -&lt;prf&gt; [v:iew] @(v1, v)
</span><span class="keyword">stadef</span> <span class="staexp"><a name="23788"><span class="stacstdec">&lt;= <span class="keyword">(</span>v1<span class="keyword">:</span>view<span class="keyword">,</span> v2<span class="keyword">:</span>view<span class="keyword">)</span> <span class="keyword">=</span> vsubr_p <span class="keyword">(</span>v1<span class="keyword">,</span> v2<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">// HX: subview relation that allows *reading* and *writing*
</span><span class="comment">//
</span><span class="keyword">absprop</span> <span class="staexp"><a name="23903"><span class="stacstdec">vsubw_p</span></a></span> <span class="keyword">(</span>v1<span class="keyword">:</span>view<span class="keyword">,</span> v2<span class="keyword">:</span> view<span class="keyword">)</span> <span class="comment">// v2 -&lt;prf&gt; @(v1, v1 -&lt;lin,prf&gt; v2)
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="keyword">absviewt@ype</span>
<span class="staexp"><a name="24007"><span class="stacstdec">crypt_viewt0ype_viewt0ype <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> a</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="24058"><span class="stacstdec">crypt <span class="keyword">=</span> crypt_viewt0ype_viewt0ype</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX:
</span><span class="comment">// [lazy(T)] : suspended computation with a value of type T
</span><span class="comment">//
</span><span class="keyword">abstype</span>
<span class="staexp"><a name="24196"><span class="stacstdec">lazy_t0ype_type</span></a></span> <span class="keyword">(</span>t@ype+<span class="keyword">)</span> <span class="comment">// boxed type // unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="24253"><span class="stacstdec">lazy <span class="keyword">=</span> lazy_t0ype_type</span></a></span>
<span class="comment">//
</span><span class="comment">// HX: [lazy_vt(VT)] :
</span><span class="comment">// suspended computation with a linear value of viewtype VT
</span><span class="comment">//
</span><span class="keyword">absviewtype</span>
<span class="staexp"><a name="24377"><span class="stacstdec">lazy_viewt0ype_viewtype</span></a></span>
  <span class="keyword">(</span>viewt@ype+<span class="keyword">)</span> <span class="comment">// boxed linear type // unnamed
</span><span class="keyword">stadef</span> <span class="staexp"><a name="24455"><span class="stacstdec">lazy_vt <span class="keyword">=</span> lazy_viewt0ype_viewtype</span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// HX: lazy streams
</span><span class="comment">//
</span><span class="keyword">datatype</span> <span class="staexp"><a name="24547"><span class="stacstdec">stream_con <span class="keyword">(</span>a<span class="keyword">:</span>t@ype+<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> stream_nil <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">|</span> stream_cons <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> stream a<span class="keyword">)</span></span>
<span class="keyword">where</span> <span class="staexp"><a name="24631"><span class="stacstdec">stream <span class="keyword">(</span>a<span class="keyword">:</span>t@ype<span class="keyword">)</span> <span class="keyword">=</span> lazy <span class="keyword">(</span>stream_con a<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">// HX: lazy linear streams
</span><span class="comment">//
</span><span class="keyword">dataviewtype</span> <span class="staexp"><a name="24716"><span class="stacstdec">stream_vt_con <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype+<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> stream_vt_nil <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">|</span> stream_vt_cons <span class="staexp"><span class="keyword">(</span>a<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>a<span class="keyword">,</span> stream_vt a<span class="keyword">)</span></span>
<span class="keyword">where</span> <span class="staexp"><a name="24816"><span class="stacstdec">stream_vt <span class="keyword">(</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">)</span> <span class="keyword">=</span> lazy_vt <span class="keyword">(</span>stream_vt_con a<span class="keyword">)</span></span></a></span>
<span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">#if</span> <span class="neuexp">VERBOSE_PRELUDE</span> <span class="keyword">#then</span>
<span class="keyword">#print</span> <span class="neuexp">"Loading [basic_sta.sats] finishes!\n"</span>
<span class="keyword">#endif</span> <span class="comment">// end of [VERBOSE_PRELUDE]
</span>
<span class="comment">(* end of [basics_sta.sats] *)</span>
</pre>
</body>
</html>
