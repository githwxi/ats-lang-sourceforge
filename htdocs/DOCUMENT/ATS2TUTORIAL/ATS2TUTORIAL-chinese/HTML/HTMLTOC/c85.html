<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>词缀声明</TITLE
><META
CHARSET="UTF-8"
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="A Tutorial on Programming Features in ATS"
HREF="book1.html"><LINK
REL="UP"
TITLE="基础教程部分"
HREF="p33.html"><LINK
REL="PREVIOUS"
TITLE="ATS代码中的文件包含"
HREF="c75.html"><LINK
REL="NEXT"
TITLE="静态加载"
HREF="c149.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./assets/ATS2TUTORIAL-BOOK.css"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>A Tutorial on Programming Features in ATS: </TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c75.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c149.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="fixity"
></A
>Chapter 4. 词缀声明</H1
><P
>&#13;给定一个函数<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>f</I
></SPAN
>，函数<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>f</I
></SPAN
>被应用到一个参数
<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>v</I
></SPAN
>的标准语法是<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>f(v)</I
></SPAN
>；对于2个参数
<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>v1</I
></SPAN
>和<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>v2</I
></SPAN
>，则语法为<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>f(v1,v2)</I
></SPAN
>。同
时，在ATS中，允许对一个二元函数应用使用中缀注释，对一个一元函数应用使用
前缀/后缀注释。
</P
><P
>&#13;在ATS中，每个标识符都会被分配前缀(<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>prefix</I
></SPAN
>)、中缀
(<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>infix</I
></SPAN
>)和后缀(<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>postfix</I
></SPAN
>)三者之一的固边界。大
多数常用的标识符的固定性声明能在prelude/fixity.ats中找到。通常，名字
<SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>operator</I
></SPAN
>用于引用一个分配了固定性的标识符。例如，下面的语
法声明<FONT
COLOR="RED"
>+</FONT
>和<FONT
COLOR="RED"
>-</FONT
>是优先级值为50的中缀操作符。

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN102"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="neuexp"><span class="keyword">infixl</span> 50 + -</span></p></PRE
><P
></P
></DIV
>


在整个声明作出之后，我们可以编写一个表达式如<FONT
COLOR="RED"
>1+2-3</FONT
>，我们用
标准语法函数可以将其解析为<FONT
COLOR="RED"
>-(+(1,2),3)</FONT
>。
</P
><P
>&#13;关键字<FONT
COLOR="RED"
>infixl</FONT
>表明了所声明的中缀操作符是左结合的。对于右结合
和非结合的中缀操作符，请分别使用关键字<FONT
COLOR="RED"
>infixr</FONT
>和
<FONT
COLOR="RED"
>infix</FONT
>。如果在固定性声明中省略了优先级值，我们则认为它为0。
</P
><P
>&#13;我们也可以用下面的语法来声明<FONT
COLOR="RED"
>iadd</FONT
>、<FONT
COLOR="RED"
>fadd</FONT
>、
<FONT
COLOR="RED"
>padd</FONT
>和<FONT
COLOR="RED"
>uadd</FONT
>是左结合的中缀操作符，并且他们的优
先级值等于操作符<FONT
COLOR="RED"
>+</FONT
>：

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN116"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="neuexp"><span class="keyword">infixl</span> <span class="keyword">(</span>+<span class="keyword">)</span> iadd fadd padd uadd</span>
</p></PRE
><P
></P
></DIV
>


这是非常有用的因为在实际情况中很难去记住所声明过的（大量的）操作符的优先级值。有
时候，我们有可能要相对于另外一个操作符来指定某个操作符的优先级值。例如：下面的语
法声明<FONT
COLOR="RED"
>opr2</FONT
>是一个左结合的中缀操作符，它的优先级值是<FONT
COLOR="RED"
>opr1</FONT
>的优先级值加10：
<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN120"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="neuexp"><span class="keyword">infixl</span> <span class="keyword">(</span>opr1 + 10<span class="keyword">)</span> opr2</span>
</p></PRE
><P
></P
></DIV
>

如果把加号（+）变为减号（-），则<FONT
COLOR="RED"
>opr2</FONT
>的优先级值为<FONT
COLOR="RED"
>opr1</FONT
>的减去10。

</P
><P
>&#13;我们也可以通过将反斜杠（<FONT
COLOR="RED"
></FONT
>）置于一个标识符之前将这个标识
符<FONT
COLOR="RED"
>opr</FONT
>变为一个非结合类型的中缀操作符（优先级值为0）。例如：
表达式<FONT
COLOR="RED"
>exp1 opr exp2</FONT
>表示的是<FONT
COLOR="RED"
>opr (exp1, exp2)</FONT
>，
其中<FONT
COLOR="RED"
>exp1</FONT
>和<FONT
COLOR="RED"
>exp2</FONT
>指的是一些动态或者静态的表达式。
</P
><P
>&#13;声明（一元）前缀或者后缀操作符的语法是类似的。例如：下面的语法声明了<FONT
COLOR="RED"
>~</FONT
>和<FONT
COLOR="RED"
>?</FONT
>分别为
前缀和后缀操作符，它们的优先级值分别为61和69：

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN134"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="neuexp"><span class="keyword">prefix</span> 61 <span class="keyword">~</span></span>
<span class="neuexp"><span class="keyword">postfix</span> 69 ?</span>
</p></PRE
><P
></P
></DIV
>


举一个例子，下面的3行程序中包含一个后缀操作符：

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN136"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="neuexp"><span class="keyword">postfix</span> <span class="keyword">(</span>imul + 10<span class="keyword">)</span> !!</span>
<span class="keyword">extern</span> <span class="dynexp"><span class="keyword">fun</span> !! <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span></span>
<span class="dynexp"><span class="keyword">implement</span> !! <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> x &gt;= <span class="dynexp">2</span> <span class="keyword">then</span> x * <span class="keyword">(</span>x - <span class="dynexp">2</span><span class="keyword">)</span>!! <span class="keyword">else</span> <span class="dynexp">1</span></span>
</p></PRE
><P
></P
></DIV
>


对于一个给定的操作符，我们可以通过将关键字<FONT
COLOR="RED"
>op</FONT
>置于它之前来剥夺指定给它的不变性状态。
例如：<FONT
COLOR="RED"
>1+2-3</FONT
>也可以写成<FONT
COLOR="RED"
>op-(op+(1,2),3)</FONT
>。也可以（永久的）剥夺指定给一个操作符的不变性
状态。例如，下面的语法是针对操作符<FONT
COLOR="RED"
>iadd</FONT
>、<FONT
COLOR="RED"
>fadd</FONT
>、<FONT
COLOR="RED"
>padd</FONT
>和<FONT
COLOR="RED"
>uadd</FONT
>的：

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN145"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"> 
<span class="neuexp"><span class="keyword">nonfix</span> iadd fadd padd uadd</span>
</p></PRE
><P
></P
></DIV
>


注意<FONT
COLOR="RED"
>nonfix</FONT
>是ATS中的关键字。
</P
><P
>&#13;最后注意，每个固定性声明只在自己的合法范围内生效。

</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c75.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c149.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ATS代码中的文件包含</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="p33.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>静态加载</TD
></TR
></TABLE
></DIV
><SCRIPT SRC="./assets/ATS2TUTORIAL-BOOK.js"></SCRIPT></BODY
></HTML
>