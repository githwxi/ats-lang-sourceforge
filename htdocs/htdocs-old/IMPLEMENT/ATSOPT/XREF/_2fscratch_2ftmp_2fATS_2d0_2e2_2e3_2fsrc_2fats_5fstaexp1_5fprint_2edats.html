<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: August 2007
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Eff <span class="keyword">=</span> "ats_effect.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lab <span class="keyword">=</span> "ats_label.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Sym <span class="keyword">=</span> "ats_symbol.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Syn <span class="keyword">=</span> "ats_syntax.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp1.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">nil list_nil</span>
<span class="keyword">#define</span> <span class="neuexp">:: list_cons</span>
<span class="keyword">#define</span> <span class="neuexp">cons list_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="1809"><span class="stacstdec">lab_t <span class="keyword">=</span> $Lab<span class="keyword">.</span>label_t</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="1838"><span class="stacstdec">sym_t <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_t</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">macdef</span> <span class="neuexp">fprint_label <span class="keyword">=</span> $Lab<span class="keyword">.</span>fprint_label</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_e1xp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> e0<span class="keyword">.</span>e1xp_node <span class="keyword">of</span>
  <span class="keyword">|</span> E1XPapp <span class="keyword">(</span>e<span class="keyword">,</span> _<span class="comment">(*loc_arg*)</span><span class="keyword">,</span> es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "E1XPapp("<span class="keyword">;</span>
      fprint_e1xp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_e1xplst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [E1XPapp]
</span>  <span class="keyword">|</span> E1XPchar <span class="keyword">(</span>c<span class="keyword">:</span> <span class="staexp">char</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "E1XPchar("<span class="keyword">;</span> fprint1_char <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [E1XPchar]
</span>  <span class="keyword">|</span> E1XPfloat <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "E1XPfloat("<span class="keyword">;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [E1XPfloat]
</span>  <span class="keyword">|</span> E1XPide <span class="keyword">(</span>id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Sym<span class="keyword">.</span>fprint_symbol <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> id<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [E1XPide]
</span>  <span class="keyword">|</span> E1XPint <span class="keyword">(</span>int<span class="comment">(*string*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "E1XPint("<span class="keyword">;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> int<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [E1XPint]
</span>  <span class="keyword">|</span> E1XPlist es <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "E1XPlist("<span class="keyword">;</span> fprint_e1xplst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> es<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [E1XPlist]
</span>  <span class="keyword">|</span> E1XPnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "E1XPnone()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [E1XPnone]
</span>  <span class="keyword">|</span> E1XPstring <span class="keyword">(</span>str<span class="keyword">,</span> len<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "E1XPstring("<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> len<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [E1XPstring]
</span>  <span class="keyword">|</span> E1XPundef <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "E1XPundef()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [E1XPundef]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_e1xp]
</span>
<span class="keyword">implement</span> fprint_e1xplst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> es0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> es<span class="keyword">:</span> <span class="staexp">e1xplst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> es <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>e<span class="keyword">,</span> es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span>
      <span class="keyword">in</span>
        fprint_e1xp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> e<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> es0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_e1xplst]
</span>
<span class="keyword">implement</span> print_e1xp <span class="keyword">(</span>e<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_e1xp<span class="keyword">,</span> e<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_e1xp <span class="keyword">(</span>e<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_e1xp<span class="keyword">,</span> e<span class="keyword">)</span>

<span class="keyword">implement</span> print_e1xplst <span class="keyword">(</span>es<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_e1xplst<span class="keyword">,</span> es<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_e1xplst <span class="keyword">(</span>es<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_e1xplst<span class="keyword">,</span> es<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s1t0<span class="keyword">.</span>s1rt_node <span class="keyword">of</span>
  <span class="keyword">|</span> S1RTapp <span class="keyword">(</span>s1t<span class="keyword">,</span> s1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1RTapp("<span class="keyword">;</span>
      fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1rtlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1ts<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1RTapp]
</span>  <span class="keyword">|</span> S1RTlist s1ts <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1RTlist("<span class="keyword">;</span> fprint_s1rtlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1ts<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1RTlist]
</span>  <span class="keyword">|</span> S1RTqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1RTqid("<span class="keyword">;</span>
      $Syn<span class="keyword">.</span>fprint_s0rtq <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> q<span class="keyword">)</span><span class="keyword">;</span>
      $Sym<span class="keyword">.</span>fprint_symbol <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1RTqid]
</span>  <span class="keyword">|</span> S1RTtup s1ts <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1RTtup("<span class="keyword">;</span>
      fprint_s1rtlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1ts<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1RTtup]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_s1rt]
</span>
<span class="keyword">implement</span> fprint_s1rtlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1ts0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> s1ts<span class="keyword">:</span> <span class="staexp">s1rtlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s1ts <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>s1t<span class="keyword">,</span> s1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span>
      <span class="keyword">in</span>
        fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> s1ts<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> s1ts0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1rtlst]
</span>
<span class="keyword">implement</span> fprint_s1rtopt
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> os1t<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> os1t <span class="keyword">of</span>
  <span class="keyword">|</span> Some s1t <span class="keyword">=&gt;</span> fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [fprint_s1rtopt]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_s1rt <span class="keyword">(</span>s1t<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_s1rt<span class="keyword">,</span> s1t<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_s1rt <span class="keyword">(</span>s1t<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_s1rt<span class="keyword">,</span> s1t<span class="keyword">)</span>

<span class="keyword">implement</span> print_s1rtlst <span class="keyword">(</span>s1ts<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_s1rtlst<span class="keyword">,</span> s1ts<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_s1rtlst <span class="keyword">(</span>s1ts<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_s1rtlst<span class="keyword">,</span> s1ts<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> fprint_s1arg <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>file_mode<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">file_mode_lte <span class="keyword">(</span>m<span class="keyword">,</span> w<span class="keyword">)</span></span></span> <span class="keyword">|</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> s1a<span class="keyword">:</span> <span class="staexp">s1arg</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Sym<span class="keyword">.</span>fprint_symbol <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1a<span class="keyword">.</span>s1arg_sym<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s1a<span class="keyword">.</span>s1arg_srt <span class="keyword">of</span>
  <span class="keyword">|</span> Some s1t <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ": "<span class="keyword">)</span><span class="keyword">;</span> fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>  <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [None]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_s1arg]
</span>
<span class="keyword">fun</span> fprint_s1arglst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>file_mode<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">file_mode_lte <span class="keyword">(</span>m<span class="keyword">,</span> w<span class="keyword">)</span></span></span> <span class="keyword">|</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> s1as<span class="keyword">:</span> <span class="staexp">s1arglst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> s1as<span class="keyword">:</span> <span class="staexp">s1arglst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s1as <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>s1a<span class="keyword">,</span> s1as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span> 
        fprint_s1arg <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1a<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> s1as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> s1as<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1qualst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> fprint_s1qua <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>file_mode<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">file_mode_lte <span class="keyword">(</span>m<span class="keyword">,</span> w<span class="keyword">)</span></span></span> <span class="keyword">|</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> s1q<span class="keyword">:</span> <span class="staexp">s1qua</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s1q<span class="keyword">.</span>s1qua_node <span class="keyword">of</span>
  <span class="keyword">|</span> S1Qprop s1e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Qprop("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Qprop]
</span>  <span class="keyword">|</span> S1Qvars <span class="keyword">(</span>ids<span class="keyword">,</span> s1te<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Qvars("<span class="keyword">;</span>
      $Syn<span class="keyword">.</span>fprint_i0delst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ids<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1rtext <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1te<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Qvars]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_s1qua]
</span>
<span class="keyword">fun</span> fprint_s1qualst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">:</span>file_mode<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">file_mode_lte <span class="keyword">(</span>m<span class="keyword">,</span> w<span class="keyword">)</span></span></span> <span class="keyword">|</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> s1qs0<span class="keyword">:</span> <span class="staexp">s1qualst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> s1qs<span class="keyword">:</span> <span class="staexp">s1qualst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s1qs <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>s1q<span class="keyword">,</span> s1qs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span> 
        fprint_s1qua <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1q<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> s1qs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> s1qs0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1qualst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s1e0<span class="keyword">.</span>s1exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S1Eann <span class="keyword">(</span>s1e<span class="keyword">,</span> s1t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eann("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> S1Eany <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "S1Eany()"<span class="keyword">)</span>
  <span class="keyword">|</span> S1Eapp <span class="keyword">(</span>s1e_fun<span class="keyword">,</span> _<span class="comment">(*loc_arg*)</span><span class="keyword">,</span> s1es_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eapp("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e_fun<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es_arg<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eapp]
</span>  <span class="keyword">|</span> S1Echar c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Echar("<span class="keyword">;</span> fprint1_char <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Echar]
</span>  <span class="keyword">|</span> S1Eexi <span class="keyword">(</span>knd<span class="comment">(*funres*)</span><span class="keyword">,</span> s1qs<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eexi("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1qualst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1qs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eexi]
</span>  <span class="keyword">|</span> S1Eextype <span class="keyword">(</span>name<span class="keyword">,</span> arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eextype("<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> name<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explstlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> arg<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eextype]
</span>  <span class="keyword">|</span> S1Eimp <span class="keyword">(</span>fc<span class="keyword">,</span> lin<span class="keyword">,</span> prf<span class="keyword">,</span> oefc<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eimp("<span class="keyword">;</span>
      $Syn<span class="keyword">.</span>fprint_funclo <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fc<span class="keyword">)</span><span class="keyword">;</span> prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lin<span class="keyword">)</span><span class="keyword">;</span> prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> prf<span class="keyword">)</span><span class="keyword">;</span> prstr "; "<span class="keyword">;</span>
      <span class="keyword">begin</span> <span class="keyword">case+</span> oefc <span class="keyword">of</span>
      <span class="keyword">|</span> Some efc <span class="keyword">=&gt;</span> $Eff<span class="keyword">.</span>fprint_effcst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> efc<span class="keyword">)</span>
      <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eimp]
</span>  <span class="keyword">|</span> S1Eint str <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eint("<span class="keyword">;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> str<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eint]
</span>  <span class="keyword">|</span> S1Einvar <span class="keyword">(</span>refval<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Einvar("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> refval<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Einvar]
</span>  <span class="keyword">|</span> S1Elam _ <span class="keyword">=&gt;</span> prstr "S1Elam(...)"
  <span class="keyword">|</span> S1Elist <span class="keyword">(</span>npf<span class="keyword">,</span> s1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Elist("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Elist]
</span><span class="comment">(*
// HX-2010-12-04: simplification
  | S1Emod _ =&gt; begin
      prstr "S1Emod(";
      fprint1_string (pf | out, "...");
      prstr ")"
    end // end of [S1Emod]
*)</span>
<span class="comment">(*
// HX-2010-12-04: inadequate design
  | S1Enamed (name, s1e) =&gt; begin
      prstr "S1Enamed(";
      $Sym.fprint_symbol (pf | out, name);
      prstr ", ";
      fprint_s1exp (pf | out, s1e);
      prstr ")"
    end // end of [S1Enamed]
*)</span>
  <span class="keyword">|</span> S1Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Syn<span class="keyword">.</span>fprint_s0taq <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> q<span class="keyword">)</span><span class="keyword">;</span>
      $Sym<span class="keyword">.</span>fprint_symbol <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> id<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S1Eqid]
</span>  <span class="keyword">|</span> S1Eread <span class="keyword">(</span>s1e1<span class="keyword">,</span> s1e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eread("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e1<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e2<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eread]
</span><span class="comment">(*
// HX-2010-11-01: simplification
  | S1Estruct ls1es =&gt; begin
      prstr "S1Estruct(";
      fprint_labs1explst (pf | out, ls1es);
      prstr ")"
    end // end of [S1Estruct]
*)</span>
  <span class="keyword">|</span> S1Etop <span class="keyword">(</span>knd<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Etop("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Etop]
</span>  <span class="keyword">|</span> S1Etrans <span class="keyword">(</span>s1e1<span class="keyword">,</span> s1e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Etrans("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e1<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e2<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Etrans]
</span>  <span class="keyword">|</span> S1Etyarr <span class="keyword">(</span>s1e_elt<span class="keyword">,</span> s1ess_dim<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Earray("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e_elt<span class="keyword">)</span><span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", ..."<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end pf [S1Etyarr]
</span>  <span class="keyword">|</span> S1Etyrec <span class="keyword">(</span>knd<span class="keyword">,</span> ls1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Etyrec("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_labs1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ls1es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Etyrec]
</span>  <span class="keyword">|</span> S1Etyrec_ext <span class="keyword">(</span>name<span class="keyword">,</span> ls1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Etyrec_ext("<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> name<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_labs1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ls1es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Etyrec]
</span>  <span class="keyword">|</span> S1Etytup <span class="keyword">(</span>flat<span class="keyword">,</span> s1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Etytup("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> flat<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Etytup]
</span>  <span class="keyword">|</span> S1Etytup2 <span class="keyword">(</span>flat<span class="keyword">,</span> s1es1<span class="keyword">,</span> s1es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Etytup2("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> flat<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es1<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es2<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Etytup2]
</span>  <span class="keyword">|</span> S1Euni <span class="keyword">(</span>s1qs<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Euni("<span class="keyword">;</span>
      fprint_s1qualst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1qs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Euni]
</span>  <span class="keyword">|</span> S1Eunion <span class="keyword">(</span>s1e<span class="keyword">,</span> ls1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1Eunion("<span class="keyword">;</span>
      fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_labs1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ls1es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1Eunion]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_s1exp]
</span>
<span class="keyword">implement</span> fprint_s1explst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> s1es<span class="keyword">:</span> <span class="staexp">s1explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s1es <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>s1e<span class="keyword">,</span> s1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span>
      <span class="keyword">in</span>
        fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> s1es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> s1es0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1explst]
</span>
<span class="keyword">implement</span> fprint_s1expopt <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> os1e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> os1e <span class="keyword">of</span> Some s1e <span class="keyword">=&gt;</span> fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1expopt]
</span>
<span class="keyword">implement</span> fprint_s1explstlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1ess0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> s1ess<span class="keyword">:</span> <span class="staexp">s1explstlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> s1ess <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>s1es<span class="keyword">,</span> s1ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "; "<span class="keyword">)</span>
      <span class="keyword">in</span>
        fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> s1ess<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> s1ess0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1explstlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_labs1explst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ls1es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ls1es<span class="keyword">:</span> <span class="staexp">labs1explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> ls1es <span class="keyword">of</span>
    <span class="keyword">|</span> LABS1EXPLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> s1e<span class="keyword">,</span> ls1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> prstr ", "<span class="keyword">;</span>
        fprint_label <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">;</span> prstr "="<span class="keyword">;</span>
        fprint_s1exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1e<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i + 1<span class="keyword">,</span> ls1es<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> LABS1EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> ls1es<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_labs1explst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_tmps1explstlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ts1ess0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ts1ess<span class="keyword">:</span> <span class="staexp">tmps1explstlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> ts1ess <span class="keyword">of</span>
    <span class="keyword">|</span> TMPS1EXPLSTLSTcons <span class="keyword">(</span>_<span class="comment">(*loc*)</span><span class="keyword">,</span> s1es<span class="keyword">,</span> ts1ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "; "<span class="keyword">)</span>
      <span class="keyword">in</span>
        fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i + 1<span class="keyword">,</span> ts1ess<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [TMPS1EXPLSTLSTcons]
</span>    <span class="keyword">|</span> TMPS1EXPLSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> ts1ess0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_s1explstlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_s1rtext <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1te<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s1te<span class="keyword">.</span>s1rtext_node <span class="keyword">of</span>
  <span class="keyword">|</span> S1TEsrt s1t <span class="keyword">=&gt;</span> fprint_s1rt <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1t<span class="keyword">)</span>
  <span class="keyword">|</span> S1TEsub <span class="keyword">(</span>sym<span class="keyword">,</span> s1te<span class="keyword">,</span> s1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "S1TEsub("<span class="keyword">;</span>
      $Sym<span class="keyword">.</span>fprint_symbol <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> sym<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1rtext <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1te<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s1explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s1es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [S1TEsub]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_s1rtext]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_s1exp <span class="keyword">(</span>s1e<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_s1exp<span class="keyword">,</span> s1e<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_s1exp <span class="keyword">(</span>s1e<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_s1exp<span class="keyword">,</span> s1e<span class="keyword">)</span>

<span class="keyword">implement</span> print_s1explst <span class="keyword">(</span>s1es<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_s1explst<span class="keyword">,</span> s1es<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_s1explst <span class="keyword">(</span>s1es<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_s1explst<span class="keyword">,</span> s1es<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_staexp1_print.dats] *)</span>
</pre>
</body>
</html>
