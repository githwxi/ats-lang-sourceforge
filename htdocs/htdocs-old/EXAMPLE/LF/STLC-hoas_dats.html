<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">// A formalization of simply typed call-by-value lambda-calculus with
</FONT><FONT COLOR="#787878">// products and fixed-points that makes use of an encoding that combines
</FONT><FONT COLOR="#787878">// higher-order abstract syntax with first-order abstract syntax.
</FONT>
<FONT COLOR="#787878">// May 2005:
</FONT><FONT COLOR="#787878">// it is completed by Kevin Donnelly and Hongwei Xi
</FONT>
<FONT COLOR="#787878">// January 2007:
</FONT><FONT COLOR="#787878">// It is ported to ATS/Geizella by Hongwei Xi
</FONT>
<FONT COLOR="#787878">// July 2008
</FONT><FONT COLOR="#787878">// Ported to ATS/Anairiats by Hongwei Xi
</FONT><FONT COLOR="#787878">// (* some cases are still missing *)
</FONT>
<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tm <FONT COLOR="#000000">=</FONT> TMunit
            <FONT COLOR="#000000">|</FONT> TMtup <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">|</FONT> TMfst <FONT COLOR="#000000">of</FONT> tm
            <FONT COLOR="#000000">|</FONT> TMsnd <FONT COLOR="#000000">of</FONT> tm
            <FONT COLOR="#000000">|</FONT> TMlam <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm <FONT COLOR="#000000">-&gt;</FONT> tm<FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">|</FONT> TMapp <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tm<FONT COLOR="#000000">)</FONT>
            <FONT COLOR="#000000">|</FONT> TMfix <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm <FONT COLOR="#000000">-&gt;</FONT> tm<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tms <FONT COLOR="#000000">=</FONT> TMSnil <FONT COLOR="#000000">|</FONT> TMScons <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tms<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">tp <FONT COLOR="#000000">=</FONT> TPfun <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> TPtup <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tp<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> TPunit</FONT>

<FONT COLOR="#000000">datasort</FONT> <FONT COLOR="#0000FF">ctx <FONT COLOR="#000000">=</FONT> CTXnil <FONT COLOR="#000000">|</FONT> CTXcons <FONT COLOR="#000000">of</FONT> <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT> tp<FONT COLOR="#000000">,</FONT> ctx<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">INCTX <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">,</FONT>ctx<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> 
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> INCTXone<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      INCTXshi<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">INCTX<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">,</FONT>tm<FONT COLOR="#000000">,</FONT>tp<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> DERvar<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">INCTX<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> DERunit<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMunit<FONT COLOR="#000000">,</FONT>TPunit<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERtup <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMtup<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TPtup <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERfst <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMfst t<FONT COLOR="#000000">,</FONT> T1<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> TPtup <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERsnd <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMsnd t<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> TPtup <FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TPfun<FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> DER <FONT COLOR="#000000">(</FONT>CTXcons <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> TMapp<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T2<FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t1<FONT COLOR="#000000">,</FONT> TPfun<FONT COLOR="#000000">(</FONT>T1<FONT COLOR="#000000">,</FONT>T2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>T1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      DERfix<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>TMfix f<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> DER <FONT COLOR="#000000">(</FONT>CTXcons <FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">IN <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT>tms<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> INone<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>TMScons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> INshi<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> TMScons <FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">IN<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">TERM <FONT COLOR="#000000">(</FONT>tms<FONT COLOR="#000000">,</FONT>tm<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> TERMvar <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>IN <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>ts<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> int n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> TERMunit <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMunit<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      TERMtup <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMtup<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TERM <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t1<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TERM <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> TERMfst <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMfst t<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">TERM <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> TERMsnd <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMsnd t<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">TERM <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT> tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      TERMlam <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMlam f<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> TERM<FONT COLOR="#000000">(</FONT>TMScons<FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT> 
      TERMapp <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMapp<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TERM<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>TERM<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      TERMfix <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> TMfix f<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">{</FONT>x<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> TERM<FONT COLOR="#000000">(</FONT>TMScons<FONT COLOR="#000000">(</FONT>x<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f x<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">TERM0 <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> TERM<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">EVAL<FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT>tm<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> EVALunit<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMunit<FONT COLOR="#000000">,</FONT>TMunit<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALtup <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMtup<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> TMtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>EVAL<FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALfst <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMfst t<FONT COLOR="#000000">,</FONT> v1<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> TMtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALsnd <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMsnd t<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> TMtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> EVALlam<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT> TMlam f<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>t1'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">v<FONT COLOR="#000000">,</FONT>v'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">,</FONT>p<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALapp<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMapp<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>v'<FONT COLOR="#000000">,</FONT>m+n+p+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>TMlam f<FONT COLOR="#000000">,</FONT>m<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL<FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> EVAL<FONT COLOR="#000000">(</FONT>f v<FONT COLOR="#000000">,</FONT>v'<FONT COLOR="#000000">,</FONT>p<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">;</FONT> <FONT COLOR="#0000FF">v<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      EVALfix<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMfix f<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>EVAL<FONT COLOR="#000000">(</FONT>f <FONT COLOR="#000000">(</FONT>TMfix f<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">EVAL0<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> EVAL<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">ISVAL<FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> ISVALunit<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMunit<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
       ISVALtup<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMtup<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n1+n2+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ISVAL<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>ISVAL<FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT> tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> ISVALlam<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">propdef</FONT> <FONT COLOR="#0000FF">ISVAL0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> ISVAL<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">lemma00 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ISVAL0 v</FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> EVALunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> ISVALunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> EVALtup<FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT>pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> ISVALtup<FONT COLOR="#000000">(</FONT>lemma00 pf1<FONT COLOR="#000000">,</FONT> lemma00 pf2<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> EVALfst pf <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">ISVALtup <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> lemma00 pf</FONT> <FONT COLOR="#000000">in</FONT> pf1 <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> EVALsnd pf <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">ISVALtup <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> lemma00 pf</FONT> <FONT COLOR="#000000">in</FONT> pf2 <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> EVALlam <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> ISVALlam<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> EVALapp <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">,</FONT> pf3<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> lemma00 pf3
    <FONT COLOR="#000000">|</FONT> EVALfix pf <FONT COLOR="#000000">=&gt;</FONT> lemma00 pf</FONT>

<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">lemma01 <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n<FONT COLOR="#000000">&gt;.</FONT></FONT> <FONT COLOR="#000000">(</FONT>pf<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ISVAL<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">EVAL <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> ISVALlam<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EVALlam<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> ISVALunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EVALunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> ISVALtup<FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT>pf2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> EVALtup<FONT COLOR="#000000">(</FONT>lemma01 pf1<FONT COLOR="#000000">,</FONT> lemma01 pf2<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">datatype</FONT> <FONT COLOR="#0000FF">VAL <FONT COLOR="#000000">(</FONT>tm<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> VALunit<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMunit<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> VALtup<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMtup<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">,</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>VAL<FONT COLOR="#000000">(</FONT>t1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>VAL<FONT COLOR="#000000">(</FONT>t2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">m<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
       VALclo <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMlam f<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ENV <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> TERM <FONT COLOR="#000000">(</FONT>TMScons <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">and</FONT> <FONT COLOR="#0000FF">ENV <FONT COLOR="#000000">(</FONT>tms<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> ENVnil <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMSnil<FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      ENVlamcons <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMScons <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ISVAL0 t <FONT COLOR="#000000">|</FONT>  ENV <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> VAL <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">ts<FONT COLOR="#000000">:</FONT>tms</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      ENVfixcons <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>TMScons <FONT COLOR="#000000">(</FONT>TMfix f<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>ENV<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">(</FONT>TERM0 <FONT COLOR="#000000">(</FONT>TMScons <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> f t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>


<FONT COLOR="#000000">typedef</FONT> <FONT COLOR="#0000FF">ENV0 <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">[</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">]</FONT> ENV<FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">FLIPCTX<FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">,</FONT>ctx<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT>
      FLIPCTXone <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t'<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      FLIPCTXshi <FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">FLIPCTX<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT></FONT>

<FONT COLOR="#000000">dataprop</FONT> <FONT COLOR="#009000"><FONT COLOR="#0000FF">ADDCTX<FONT COLOR="#000000">(</FONT>ctx<FONT COLOR="#000000">,</FONT>ctx<FONT COLOR="#000000">,</FONT>int<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> ADDCTXone<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>0<FONT COLOR="#000000">)</FONT></FONT>
  <FONT COLOR="#000000">|</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">:</FONT>ctx</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">t<FONT COLOR="#000000">:</FONT>tm</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">T<FONT COLOR="#000000">:</FONT>tp</FONT><FONT COLOR="#000000">}</FONT> <FONT COLOR="#000000">{</FONT><FONT COLOR="#0000FF">n<FONT COLOR="#000000">:</FONT>nat</FONT><FONT COLOR="#000000">}</FONT>
      ADDCTXshi<FONT COLOR="#0000FF"><FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>n+1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">of</FONT> <FONT COLOR="#0000FF">ADDCTX<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">)</FONT></FONT></FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">weaken <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">ADDCTX<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G'<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">$effmask_exn</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case</FONT> der <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
      <FONT COLOR="#000000">|</FONT> ADDCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERvar<FONT COLOR="#000000">(</FONT>INCTXshi i<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">|</FONT> ADDCTXshi<FONT COLOR="#000000">(</FONT>pf'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#000000">|</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERvar<FONT COLOR="#000000">(</FONT>INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">|</FONT> INCTXshi i' <FONT COLOR="#000000">=&gt;</FONT> weaken <FONT COLOR="#000000">(</FONT>weaken <FONT COLOR="#000000">(</FONT>DERvar i'<FONT COLOR="#000000">,</FONT> pf'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> ADDCTXone<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERtup<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERtup <FONT COLOR="#000000">(</FONT>weaken <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>weaken <FONT COLOR="#000000">(</FONT>der2<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERfst der <FONT COLOR="#000000">=&gt;</FONT> DERfst <FONT COLOR="#000000">(</FONT>weaken <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERsnd der <FONT COLOR="#000000">=&gt;</FONT> DERsnd <FONT COLOR="#000000">(</FONT>weaken <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#787878">(*
  | DERlam(derf) =&gt; DERlam (lam {x:tm} =&gt; weaken (derf{x}, ADDCTXshi pf))
*)</FONT>
  <FONT COLOR="#000000">|</FONT> DERapp<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERapp <FONT COLOR="#000000">(</FONT>weaken <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> weaken <FONT COLOR="#000000">(</FONT>der2<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#787878">(*
  | DERfix(derf) =&gt; DERfix (lam {x:tm} =&gt; weaken (derf{x}, ADDCTXshi pf))
*)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [weaken]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">exch <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">&gt;.</FONT></FONT>
  <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">FLIPCTX <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>G'<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>G'<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">$effmask_exn</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case</FONT> der <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> pf <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> FLIPCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT>
      <FONT COLOR="#000000">|</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERvar<FONT COLOR="#000000">(</FONT>INCTXshi<FONT COLOR="#000000">(</FONT>INCTXone<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">|</FONT> INCTXshi<FONT COLOR="#000000">(</FONT>i'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> i' <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#000000">|</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERvar<FONT COLOR="#000000">(</FONT>INCTXone<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">|</FONT> INCTXshi i'' <FONT COLOR="#000000">=&gt;</FONT> DERvar<FONT COLOR="#000000">(</FONT>INCTXshi<FONT COLOR="#000000">(</FONT>INCTXshi i''<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">end</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> FLIPCTXshi<FONT COLOR="#000000">(</FONT>pf'<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT>
      <FONT COLOR="#000000">|</FONT> INCTXone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERvar <FONT COLOR="#000000">(</FONT>INCTXone<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">|</FONT> INCTXshi i <FONT COLOR="#000000">=&gt;</FONT> weaken <FONT COLOR="#000000">(</FONT>exch <FONT COLOR="#000000">(</FONT>DERvar i<FONT COLOR="#000000">,</FONT> pf'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> ADDCTXone<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> DERunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERunit
  <FONT COLOR="#000000">|</FONT> DERtup<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERtup <FONT COLOR="#000000">(</FONT>exch <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> exch <FONT COLOR="#000000">(</FONT>der2<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERfst der <FONT COLOR="#000000">=&gt;</FONT> DERfst <FONT COLOR="#000000">(</FONT>exch <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERsnd der <FONT COLOR="#000000">=&gt;</FONT> DERsnd <FONT COLOR="#000000">(</FONT>exch <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">,</FONT> pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#787878">(*
  | DERlam(derf) =&gt; DERlam(lam {x:tm} =&gt; exch (derf{x}, FLIPCTXshi pf))
*)</FONT>
  <FONT COLOR="#000000">|</FONT> DERapp<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERapp <FONT COLOR="#000000">(</FONT>exch <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> exch <FONT COLOR="#000000">(</FONT>der2<FONT COLOR="#000000">,</FONT>pf<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#787878">(*
  | DERfix(derf) =&gt; DERfix(lam {x:tm} =&gt; exch (derf{x}, FLIPCTXshi pf))
*)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [exch]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfun</FONT> <FONT COLOR="#009000">subst <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>G<FONT COLOR="#000000">:</FONT>ctx<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n1<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">.&lt;</FONT>n1<FONT COLOR="#000000">&gt;.</FONT></FONT> 
  <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>CTXcons<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>G<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">,</FONT>n1<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">DER <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">,</FONT>n2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> 
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>G<FONT COLOR="#000000">,</FONT>t'<FONT COLOR="#000000">,</FONT>T'<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">$effmask_exn</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case</FONT> der1 <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> der2 <FONT COLOR="#000000">|</FONT> INCTXshi i' <FONT COLOR="#000000">=&gt;</FONT> DERvar i'<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERtup<FONT COLOR="#000000">(</FONT>der11<FONT COLOR="#000000">,</FONT>der12<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERtup <FONT COLOR="#000000">(</FONT>subst <FONT COLOR="#000000">(</FONT>der11<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> subst <FONT COLOR="#000000">(</FONT>der12<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERfst der1 <FONT COLOR="#000000">=&gt;</FONT> DERfst <FONT COLOR="#000000">(</FONT>subst <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> DERsnd der1 <FONT COLOR="#000000">=&gt;</FONT> DERsnd <FONT COLOR="#000000">(</FONT>subst <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#787878">(*
  | DERlam derf =&gt;
      DERlam(lampara {x:tm} =&gt; subst(exch(derf{x},FLIPCTXone()),weaken(der2,ADDCTXone)))
*)</FONT>
  <FONT COLOR="#000000">|</FONT> DERapp <FONT COLOR="#000000">(</FONT>der11<FONT COLOR="#000000">,</FONT>der12<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> DERapp<FONT COLOR="#000000">(</FONT>subst<FONT COLOR="#000000">(</FONT>der11<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT>subst<FONT COLOR="#000000">(</FONT>der12<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#787878">(*
  | DERfix derf =&gt;
      DERfix(lampara {x:tm} =&gt; subst(exch(derf{x},FLIPCTXone()),weaken(der2,ADDCTXone)))
*)</FONT>
<FONT COLOR="#000000">end</FONT></FONT> <FONT COLOR="#787878">// end of [subst]
</FONT>
<FONT COLOR="#787878">//
</FONT>
<FONT COLOR="#000000">prfn</FONT> <FONT COLOR="#009000">fixLemma <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">-&gt;</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>m<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
     <FONT COLOR="#000000">(</FONT>der<FONT COLOR="#000000">:</FONT><FONT COLOR="#0000FF">DER<FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT>TMfix f<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">,</FONT> m<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0<FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT>f<FONT COLOR="#000000">(</FONT>TMfix f<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> DERfix <FONT COLOR="#000000">(</FONT>derf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> subst <FONT COLOR="#000000">(</FONT>derf <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>TMfix f<FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">,</FONT> der<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">|</FONT> DERvar <FONT COLOR="#000000">(</FONT>inctx<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> inctx <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT></FONT>

<FONT COLOR="#000000">fun</FONT> evalVar <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>n0<FONT COLOR="#000000">,</FONT>n<FONT COLOR="#000000">:</FONT>nat<FONT COLOR="#000000">}</FONT></FONT>
   <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">IN <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> ts<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT></FONT></FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0<FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT>  env<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ENV <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>n0<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int n</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>v<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>EVAL0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER0<FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">,</FONT> T<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAL v<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  <FONT COLOR="#000000">if</FONT> n ieq 0 <FONT COLOR="#000000">then</FONT>
    <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">INone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> i</FONT> <FONT COLOR="#000000">in</FONT> 
       <FONT COLOR="#000000">case+</FONT> env <FONT COLOR="#000000">of</FONT>
         <FONT COLOR="#000000">|</FONT> ENVlamcons<FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT> <FONT COLOR="#000000">|</FONT> _<FONT COLOR="#000000">,</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">lemma01 pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> 
         <FONT COLOR="#000000">|</FONT> ENVfixcons<FONT COLOR="#000000">(</FONT>env'<FONT COLOR="#000000">,</FONT> tf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> 
           <FONT COLOR="#000000">let</FONT>
              <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">INone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> i</FONT>
              <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">der <FONT COLOR="#000000">=</FONT> fixLemma der</FONT>
              <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> tf<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
	   <FONT COLOR="#000000">in</FONT>
              <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALfix pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
           <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">else</FONT>
    <FONT COLOR="#000000">let</FONT> <FONT COLOR="#000000">prval</FONT> <FONT COLOR="#009000">INshi i <FONT COLOR="#000000">=</FONT> i</FONT>  <FONT COLOR="#000000">in</FONT> 
       <FONT COLOR="#000000">case+</FONT> env <FONT COLOR="#000000">of</FONT>
         <FONT COLOR="#000000">|</FONT> ENVlamcons<FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">_</FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> evalVar <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> n isub 1<FONT COLOR="#000000">)</FONT>
         <FONT COLOR="#000000">|</FONT> ENVfixcons<FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> termf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> evalVar <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> n isub 1<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>

<FONT COLOR="#000000">and</FONT> eval <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>ts<FONT COLOR="#000000">:</FONT>tms<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT>
  <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT> e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TERM0 <FONT COLOR="#000000">(</FONT>ts<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">ENV0 ts</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>v<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>EVAL0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER0 <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAL v<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  <FONT COLOR="#000000">case</FONT> e <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> TERMvar <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">i</FONT> <FONT COLOR="#000000">|</FONT> n<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
      <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">(</FONT>evalVar <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">i</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> env<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">in</FONT>
       <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> 
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [TERMvar]
</FONT>
  <FONT COLOR="#000000">|</FONT> TERMunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> VALunit<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>

  <FONT COLOR="#000000">|</FONT> TERMtup <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT>e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> DERtup<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der1</FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der1</FONT> <FONT COLOR="#000000">|</FONT> e1<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
        <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der2</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der2</FONT> <FONT COLOR="#000000">|</FONT> e2<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">in</FONT>
        <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALtup<FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT>pf2<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">DERtup<FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT>der2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> VALtup<FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT>v2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [TERMtup]
</FONT>
  <FONT COLOR="#000000">|</FONT> TERMfst e <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> DERfst der <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> e<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">in</FONT>
        <FONT COLOR="#000000">case+</FONT> v <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#000000">|</FONT> VALtup <FONT COLOR="#000000">(</FONT>v1<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERtup <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> _<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALfst pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der1</FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">|</FONT> VALclo _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERlam _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">|</FONT> VALunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [TERMfst]
</FONT>
  <FONT COLOR="#000000">|</FONT> TERMsnd e <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> DERsnd der <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> e<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">in</FONT>
        <FONT COLOR="#000000">case+</FONT> v <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#000000">|</FONT> VALtup <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERtup <FONT COLOR="#000000">(</FONT>_<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALsnd pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der2</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">|</FONT> VALclo _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERlam _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">|</FONT> VALunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [TERMsnd]
</FONT>
  <FONT COLOR="#000000">|</FONT> TERMlam ef <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALlam</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT>  <FONT COLOR="#000000">|</FONT> VALclo <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> ef<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">|</FONT> TERMapp <FONT COLOR="#000000">(</FONT>e1<FONT COLOR="#000000">,</FONT> e2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> DERapp <FONT COLOR="#000000">(</FONT>der1<FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf1</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der1</FONT> <FONT COLOR="#000000">|</FONT> v1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der1</FONT> <FONT COLOR="#000000">|</FONT> e1<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">in</FONT>
        <FONT COLOR="#000000">case+</FONT> v1 <FONT COLOR="#000000">of</FONT>
        <FONT COLOR="#000000">|</FONT> VALclo <FONT COLOR="#000000">(</FONT>env0<FONT COLOR="#000000">,</FONT> ef1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
            <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf2</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der2</FONT> <FONT COLOR="#000000">|</FONT> v2<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der2</FONT> <FONT COLOR="#000000">|</FONT> e2<FONT COLOR="#000000">,</FONT> env<FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">in</FONT>
            <FONT COLOR="#000000">case+</FONT> der1 <FONT COLOR="#000000">of</FONT>
            <FONT COLOR="#000000">|</FONT> DERlam<FONT COLOR="#000000">(</FONT>derf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
                <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf3</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval <FONT COLOR="#000000">(</FONT>
                  <FONT COLOR="#009000">subst <FONT COLOR="#000000">(</FONT>derf<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">,</FONT> der2<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">|</FONT> ef1<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">,</FONT> ENVlamcons <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">lemma00 pf2</FONT> <FONT COLOR="#000000">|</FONT> env0<FONT COLOR="#000000">,</FONT> v2<FONT COLOR="#000000">)</FONT>
                <FONT COLOR="#000000">)</FONT>
              <FONT COLOR="#000000">in</FONT>
                <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALapp <FONT COLOR="#000000">(</FONT>pf1<FONT COLOR="#000000">,</FONT> pf2<FONT COLOR="#000000">,</FONT> pf3<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
              <FONT COLOR="#000000">end</FONT>
            <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">|</FONT> VALtup _ <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der1 <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERtup _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
        <FONT COLOR="#000000">|</FONT> VALunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der1 <FONT COLOR="#000000">of</FONT>
          <FONT COLOR="#000000">|</FONT> DERunit <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">|</FONT> DERvar i <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
          <FONT COLOR="#000000">end</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [TERMapp]
</FONT>  <FONT COLOR="#000000">|</FONT> TERMfix <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> ef <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT> <FONT COLOR="#000000">case+</FONT> der <FONT COLOR="#000000">of</FONT>
    <FONT COLOR="#000000">|</FONT> DERfix <FONT COLOR="#000000">(</FONT>derf<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">let</FONT>
        <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> eval
          <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">fixLemma der</FONT> <FONT COLOR="#000000">|</FONT> ef<FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT><FONT COLOR="#000000">,</FONT> ENVfixcons <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">..</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>f<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT><FONT COLOR="#000000">...</FONT><FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT>env<FONT COLOR="#000000">,</FONT> ef<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">in</FONT>
        <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">EVALfix pf</FONT><FONT COLOR="#000000">,</FONT> <FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> v<FONT COLOR="#000000">)</FONT>
      <FONT COLOR="#000000">end</FONT>
    <FONT COLOR="#000000">|</FONT> DERvar<FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=/=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">case+</FONT> i <FONT COLOR="#000000">of</FONT> INCTXone<FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> INCTXshi _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [TERMfix]
</FONT><FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [eval]
</FONT>
<FONT COLOR="#787878">// Voila! Isn't this nice :)
</FONT>
<FONT COLOR="#000000">fun</FONT> evaluate <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>t<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">{</FONT>T<FONT COLOR="#000000">:</FONT>tp<FONT COLOR="#000000">}</FONT></FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">DER0 <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT></FONT></FONT> <FONT COLOR="#000000">|</FONT> e<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">TERM0 <FONT COLOR="#000000">(</FONT>TMSnil<FONT COLOR="#000000">,</FONT>t<FONT COLOR="#000000">)</FONT></FONT><FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">[</FONT>v<FONT COLOR="#000000">:</FONT>tm<FONT COLOR="#000000">]</FONT> <FONT COLOR="#000000">(</FONT>EVAL0<FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">,</FONT> DER0 <FONT COLOR="#000000">(</FONT>CTXnil<FONT COLOR="#000000">,</FONT>v<FONT COLOR="#000000">,</FONT>T<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">|</FONT> VAL v<FONT COLOR="#000000">)</FONT></FONT> <FONT COLOR="#000000">=</FONT>
  eval <FONT COLOR="#000000">(</FONT><FONT COLOR="#009000">der</FONT> <FONT COLOR="#000000">|</FONT> e<FONT COLOR="#000000">,</FONT> ENVnil<FONT COLOR="#000000">)</FONT>

<FONT COLOR="#787878">(* ****** ****** *)</FONT>

<FONT COLOR="#787878">(* end of [STLC-hoas.dats] *)</FONT>
</PRE></BODY>
