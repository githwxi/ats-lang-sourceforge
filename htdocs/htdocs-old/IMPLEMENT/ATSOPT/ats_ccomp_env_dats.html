<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: April 2008
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Deb <span class="keyword">=</span> "ats_debug.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Glo <span class="keyword">=</span> "ats_global.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lst <span class="keyword">=</span> "ats_list.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Map <span class="keyword">=</span> "ats_map_lin.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Set <span class="keyword">=</span> "ats_set_fun.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_hiexp.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_trans4.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_ccomp.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_ccomp_env.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_reference.sats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_reference.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_map_lin.dats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_set_fun.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> prerr_interror <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr "INTERNAL ERROR (ats_ccomp_env)"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="2232"><span class="dyncstdec">compare_strlst_strlst
  <span class="keyword">(</span>ss1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23772"><span class="stacstuse">strlst</span></a></span><span class="keyword">,</span> ss2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23772"><span class="stacstuse">strlst</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#17046"><span class="stacstuse">Sgn</span></a></span></span></a>
<span class="neuexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_strlst_strlst</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#2232"><span class="dyncstimp">compare_strlst_strlst</span></a> <span class="keyword">(</span>ss1<span class="keyword">,</span> ss2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>ss1<span class="keyword">,</span> ss2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>list_cons <span class="keyword">(</span>s1<span class="keyword">,</span> ss1<span class="keyword">)</span><span class="keyword">,</span> list_cons <span class="keyword">(</span>s2<span class="keyword">,</span> ss2<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sgn <span class="keyword">=</span> compare <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> sgn &lt;&gt; 0 <span class="keyword">then</span> sgn <span class="keyword">else</span> compare <span class="keyword">(</span>ss1<span class="keyword">,</span> ss2<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons, list_cons]
</span>  <span class="keyword">|</span> <span class="keyword">(</span>list_cons _<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>  1
  <span class="keyword">|</span> <span class="keyword">(</span>list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> list_cons _<span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1
  <span class="keyword">|</span> <span class="keyword">(</span>list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>  0
<span class="keyword">end</span> <span class="comment">// end [compare_strlst_strlst]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="2752"><span class="dyncstdec">compare_labstrlst_labstrlst
  <span class="keyword">(</span>lss1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23803"><span class="stacstuse">labstrlst</span></a></span><span class="keyword">,</span> lss2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23803"><span class="stacstuse">labstrlst</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#17046"><span class="stacstuse">Sgn</span></a></span></span></a>
<span class="neuexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_labstrlst_labstrlst</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#2752"><span class="dyncstimp">compare_labstrlst_labstrlst</span></a>
  <span class="keyword">(</span>lss1<span class="keyword">,</span> lss2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> <span class="keyword">(</span>lss1<span class="keyword">,</span> lss2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>LABSTRLSTcons <span class="keyword">(</span>l1<span class="keyword">,</span> s1<span class="keyword">,</span> lss1<span class="keyword">)</span><span class="keyword">,</span>
     LABSTRLSTcons <span class="keyword">(</span>l2<span class="keyword">,</span> s2<span class="keyword">,</span> lss2<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sgn <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flabel_2esats.html#2444"><span class="dyncstuse">$Lab<span class="keyword">.</span>compare_label_label</span></a> <span class="keyword">(</span>l1<span class="keyword">,</span> l2<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> sgn &lt;&gt; 0 <span class="keyword">then</span> sgn <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sgn <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#7483"><span class="dyncstuse">compare_string_string</span></a> <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> sgn &lt;&gt; 0 <span class="keyword">then</span> sgn <span class="keyword">else</span> compare <span class="keyword">(</span>lss1<span class="keyword">,</span> lss2<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> <span class="keyword">(</span>LABSTRLSTcons _<span class="keyword">,</span> LABSTRLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>  1
  <span class="keyword">|</span> <span class="keyword">(</span>LABSTRLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> LABSTRLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>  0
  <span class="keyword">|</span> <span class="keyword">(</span>LABSTRLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> LABSTRLSTcons _<span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1
<span class="keyword">end</span> <span class="comment">// end [compare_labstrlst_labstrlst]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="3447"><span class="dyncstdec">compare_typkey_typkey
  <span class="keyword">(</span>tk1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a></span><span class="keyword">,</span> tk2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#17046"><span class="stacstuse">Sgn</span></a></span></span></a>
<span class="neuexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> compare_typkey_typkey</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#3447"><span class="dyncstimp">compare_typkey_typkey</span></a> <span class="keyword">(</span>tk1<span class="keyword">,</span> tk2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>tk1<span class="keyword">,</span> tk2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYrec lss1<span class="keyword">,</span> TYPKEYrec lss2<span class="keyword">)</span> <span class="keyword">=&gt;</span> compare <span class="keyword">(</span>lss1<span class="keyword">,</span> lss2<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYrec _<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYsum <span class="keyword">(</span>i1<span class="keyword">,</span> ss1<span class="keyword">)</span><span class="keyword">,</span> TYPKEYsum <span class="keyword">(</span>i2<span class="keyword">,</span> ss2<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">let</span> <span class="keyword">val</span> sgn <span class="keyword">=</span> compare <span class="keyword">(</span>i1<span class="keyword">,</span> i2<span class="keyword">)</span> <span class="keyword">in</span>
        <span class="keyword">if</span> sgn &lt;&gt; 0 <span class="keyword">then</span> sgn <span class="keyword">else</span> compare <span class="keyword">(</span>ss1<span class="keyword">,</span> ss2<span class="keyword">)</span>
      <span class="keyword">end</span>
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYsum _<span class="keyword">,</span> TYPKEYrec _<span class="keyword">)</span> <span class="keyword">=&gt;</span>  1
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYsum _<span class="keyword">,</span> TYPKEYuni _<span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYuni lss1<span class="keyword">,</span> TYPKEYuni lss2<span class="keyword">)</span> <span class="keyword">=&gt;</span> compare <span class="keyword">(</span>lss1<span class="keyword">,</span> lss2<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>TYPKEYuni _<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span>  1
<span class="keyword">end</span> <span class="comment">// end of [compare_typkey_typkey]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_typdef_base <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>"anairiats"<span class="keyword">)</span>
<span class="keyword">val</span> the_typdef_count <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>0<span class="keyword">)</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="4228"><span class="dyncstdec">typdef_base_get <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="4266"><span class="dyncstdec">typdef_base_set <span class="keyword">(</span>base<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span></span></a>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4228"><span class="dyncstimp">typdef_base_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_typdef_base
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4266"><span class="dyncstimp">typdef_base_set</span></a> <span class="keyword">(</span>base<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_typdef_base := base

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="4424"><span class="dyncstdec">typdef_count_get_and_inc <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span></span></a>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4424"><span class="dyncstimp">typdef_count_get_and_inc</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">(</span><span class="keyword">!</span>the_typdef_count := n+1<span class="keyword">;</span> n<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span> <span class="keyword">val</span> n <span class="keyword">=</span> <span class="keyword">!</span>the_typdef_count <span class="keyword">}</span>
<span class="keyword">end</span> <span class="comment">// end of [typdef_count_get]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_typdeflst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1882"><span class="stacstuse">typdeflst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>TYPDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">fn</span> typdeflst_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1882"><span class="stacstuse">typdeflst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1882"><span class="stacstuse">typdeflst</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1882"><span class="stacstuse">typdeflst</span></a></span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1882"><span class="stacstuse">typdeflst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1882"><span class="stacstuse">typdeflst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> TYPDEFLSTcons <span class="keyword">(</span>_<span class="comment">(*tk*)</span><span class="keyword">,</span> _<span class="comment">(*name*)</span><span class="keyword">,</span> <span class="keyword">!</span>xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1_v <span class="keyword">=</span> <span class="keyword">!</span>xs1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>xs1 := ys<span class="keyword">;</span> fold@ <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>xs1_v<span class="keyword">,</span> xs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [TYPDEFLSTcons]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>TYPDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> TYPDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [typdeflst_reverse]
</span>
<span class="keyword">in</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="5168"><span class="dyncstdec">typdeflst_add <span class="keyword">(</span>tk<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a></span><span class="keyword">,</span> name<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span></span></a>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5168"><span class="dyncstimp">typdeflst_add</span></a> <span class="keyword">(</span>tk<span class="keyword">,</span> name<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_typdeflst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := TYPDEFLSTcons <span class="keyword">(</span>tk<span class="keyword">,</span> name<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2001"><span class="dyncstimp">typdeflst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_typdeflst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
    <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := TYPDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> res
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  typdeflst_reverse <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [typdeflst_get]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="5725"><span class="stacstdec">typdefmap <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1634"><span class="stacstuse">$Map<span class="keyword">.</span>map_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a><span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a><span class="keyword">)</span></span></a></span>

<span class="keyword">fn</span> typdefmap_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1706"><span class="dyncstuse">$Map<span class="keyword">.</span>map_make</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#3447"><span class="dyncstuse">compare_typkey_typkey</span></a><span class="keyword">)</span>
<span class="keyword">val</span> the_typdefmap <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5725"><span class="stacstuse">typdefmap</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>typdefmap_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5927"><span class="dyncstdec">typdefmap_add_rec <span class="keyword">(</span>tk<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5977"><span class="dyncstdec">typdefmap_add_sum <span class="keyword">(</span>tk<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="6027"><span class="dyncstdec">typdefmap_add_uni <span class="keyword">(</span>tk<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23910"><span class="stacstuse">typkey</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span></span></a>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5927"><span class="dyncstimp">typdefmap_add_rec</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> base <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4228"><span class="dyncstuse">typdef_base_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4424"><span class="dyncstuse">typdef_count_get_and_inc</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> name_rec <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> prfx <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fglobal_2esats.html#1589"><span class="dyncstuse">$Glo<span class="keyword">.</span>atsccomp_namespace_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#19079"><span class="dyncstuse">stropt_is_some</span></a> prfx <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">val</span> prfx <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#18904"><span class="dyncstuse">stropt_unsome</span></a> prfx
      <span class="keyword">val</span> name <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fprintf_2esats.html#3327"><span class="dyncstuse">tostringf</span></a> <span class="keyword">(</span>"%s%s_rec_%i"<span class="keyword">,</span> <span class="keyword">@(</span>prfx<span class="keyword">,</span> base<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">in</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#20637"><span class="dyncstuse">string_of_strptr</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="keyword">val</span> name <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fprintf_2esats.html#3327"><span class="dyncstuse">tostringf</span></a> <span class="keyword">(</span>"%s_rec_%i"<span class="keyword">,</span> <span class="keyword">@(</span>base<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">in</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#20637"><span class="dyncstuse">string_of_strptr</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_typdefmap<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2066"><span class="dyncstuse">$Map<span class="keyword">.</span>map_insert</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> tk<span class="keyword">,</span> name_rec<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  name_rec
<span class="keyword">end</span> <span class="comment">// end of [typdefmap_add_rec]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5977"><span class="dyncstimp">typdefmap_add_sum</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> base <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4228"><span class="dyncstuse">typdef_base_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4424"><span class="dyncstuse">typdef_count_get_and_inc</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> name_sum <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> prfx <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fglobal_2esats.html#1589"><span class="dyncstuse">$Glo<span class="keyword">.</span>atsccomp_namespace_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#19079"><span class="dyncstuse">stropt_is_some</span></a> prfx <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">val</span> prfx <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#18904"><span class="dyncstuse">stropt_unsome</span></a> prfx
      <span class="keyword">val</span> name <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fprintf_2esats.html#3327"><span class="dyncstuse">tostringf</span></a> <span class="keyword">(</span>"%s%s_sum_%i"<span class="keyword">,</span> <span class="keyword">@(</span>prfx<span class="keyword">,</span> base<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">in</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#20637"><span class="dyncstuse">string_of_strptr</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="keyword">val</span> name <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fprintf_2esats.html#3327"><span class="dyncstuse">tostringf</span></a> <span class="keyword">(</span>"%s_sum_%i"<span class="keyword">,</span> <span class="keyword">@(</span>base<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">in</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#20637"><span class="dyncstuse">string_of_strptr</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_typdefmap<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2066"><span class="dyncstuse">$Map<span class="keyword">.</span>map_insert</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> tk<span class="keyword">,</span> name_sum<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  name_sum
<span class="keyword">end</span> <span class="comment">// end of [typdefmap_add_sum]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#6027"><span class="dyncstimp">typdefmap_add_uni</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> base <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4228"><span class="dyncstuse">typdef_base_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> n <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#4424"><span class="dyncstuse">typdef_count_get_and_inc</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> name_uni <span class="keyword">=</span> <span class="keyword">let</span> <span class="comment">// union
</span>    <span class="keyword">val</span> prfx <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fglobal_2esats.html#1589"><span class="dyncstuse">$Glo<span class="keyword">.</span>atsccomp_namespace_get</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">if</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#19079"><span class="dyncstuse">stropt_is_some</span></a> prfx <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">val</span> prfx <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#18904"><span class="dyncstuse">stropt_unsome</span></a> prfx
      <span class="keyword">val</span> name <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fprintf_2esats.html#3327"><span class="dyncstuse">tostringf</span></a> <span class="keyword">(</span>"%s%s_uni_%i"<span class="keyword">,</span> <span class="keyword">@(</span>prfx<span class="keyword">,</span> base<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">in</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#20637"><span class="dyncstuse">string_of_strptr</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
      <span class="keyword">val</span> name <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fprintf_2esats.html#3327"><span class="dyncstuse">tostringf</span></a> <span class="keyword">(</span>"%s_uni_%i"<span class="keyword">,</span> <span class="keyword">@(</span>base<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">in</span>
      <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fSATS_2fstring_2esats.html#20637"><span class="dyncstuse">string_of_strptr</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_typdefmap<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2066"><span class="dyncstuse">$Map<span class="keyword">.</span>map_insert</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> tk<span class="keyword">,</span> name_uni<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  name_uni
<span class="keyword">end</span> <span class="comment">// end of [typdefmap_add_uni]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#24093"><span class="dyncstimp">typdefmap_find</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> oname <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_typdefmap<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2271"><span class="dyncstuse">$Map<span class="keyword">.</span>map_search</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> tk<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> oname <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt name <span class="keyword">=&gt;</span> name
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> name <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> tk <span class="keyword">of</span>
        <span class="keyword">|</span> TYPKEYrec _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5927"><span class="dyncstuse">typdefmap_add_rec</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span>
        <span class="keyword">|</span> TYPKEYsum _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5977"><span class="dyncstuse">typdefmap_add_sum</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span>
        <span class="keyword">|</span> TYPKEYuni _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#6027"><span class="dyncstuse">typdefmap_add_uni</span></a> <span class="keyword">(</span>tk<span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15989"><span class="stacstuse">string</span></a></span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#5168"><span class="dyncstuse">typdeflst_add</span></a> <span class="keyword">(</span>tk<span class="keyword">,</span> name<span class="keyword">)</span>
    <span class="keyword">in</span>
      name
    <span class="keyword">end</span> <span class="comment">// end of [None]
</span><span class="keyword">end</span> <span class="comment">// end of [typdefmap_find]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_datcstlst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2064"><span class="stacstuse">datcstlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>DATCSTLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">fn</span> datcstlst_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2064"><span class="stacstuse">datcstlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2064"><span class="stacstuse">datcstlst</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2064"><span class="stacstuse">datcstlst</span></a></span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2064"><span class="stacstuse">datcstlst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2064"><span class="stacstuse">datcstlst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> DATCSTLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> <span class="keyword">!</span>xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1_v <span class="keyword">=</span> <span class="keyword">!</span>xs1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>xs1 := ys<span class="keyword">;</span> fold@ <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>xs1_v<span class="keyword">,</span> xs<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> <span class="keyword">~</span>DATCSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> DATCSTLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [datcstlst_reverse]
</span>
<span class="keyword">in</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2166"><span class="dyncstimp">datcstlst_free</span></a> <span class="keyword">(</span>s2cs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2cs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>DATCSTLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> s2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2166"><span class="dyncstuse">datcstlst_free</span></a> s2cs
  <span class="keyword">|</span> <span class="keyword">~</span>DATCSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [datcstlst_free]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2210"><span class="dyncstimp">the_datcstlst_add</span></a> <span class="keyword">(</span>s2c<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_datcstlst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
 <span class="keyword">!</span>p := DATCSTLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_datcstlst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2253"><span class="dyncstimp">the_datcstlst_adds</span></a> <span class="keyword">(</span>s2cs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2cs <span class="keyword">of</span>
  <span class="keyword">|</span> S2CSTLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2210"><span class="dyncstuse">the_datcstlst_add</span></a> s2c<span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2253"><span class="dyncstuse">the_datcstlst_adds</span></a> s2cs
    <span class="keyword">end</span>
  <span class="keyword">|</span> S2CSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_datcstlst_adds]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2299"><span class="dyncstimp">the_datcstlst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2cs <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_datcstlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
    <span class="keyword">val</span> s2cs <span class="keyword">=</span> <span class="keyword">!</span>p
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := DATCSTLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> s2cs
  <span class="keyword">end</span>
<span class="keyword">in</span>
  datcstlst_reverse <span class="keyword">(</span>s2cs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_datcstlst_get]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_exnconlst <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2366"><span class="stacstuse">exnconlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>EXNCONLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [val]
</span>
<span class="keyword">fn</span> exnconlst_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2366"><span class="stacstuse">exnconlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2366"><span class="stacstuse">exnconlst</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2366"><span class="stacstuse">exnconlst</span></a></span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2366"><span class="stacstuse">exnconlst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2366"><span class="stacstuse">exnconlst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> EXNCONLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> <span class="keyword">!</span>xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1_v <span class="keyword">=</span> <span class="keyword">!</span>xs1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>xs1 := ys<span class="keyword">;</span> fold@ <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>xs1_v<span class="keyword">,</span> xs<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> <span class="keyword">~</span>EXNCONLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> EXNCONLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [exnconlst_reverse]
</span>
<span class="keyword">in</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2468"><span class="dyncstimp">exnconlst_free</span></a> <span class="keyword">(</span>d2cs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>EXNCONLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2468"><span class="dyncstuse">exnconlst_free</span></a> d2cs
  <span class="keyword">|</span> <span class="keyword">~</span>EXNCONLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [exnconlst_free]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2512"><span class="dyncstimp">the_exnconlst_add</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_exnconlst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
 <span class="keyword">!</span>p := EXNCONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_exnconlst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2555"><span class="dyncstimp">the_exnconlst_adds</span></a> <span class="keyword">(</span>d2cs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
  <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2512"><span class="dyncstuse">the_exnconlst_add</span></a> d2c<span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2555"><span class="dyncstuse">the_exnconlst_adds</span></a> d2cs
    <span class="keyword">end</span>
  <span class="keyword">|</span> D2CONLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_exnconlst_adds]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#2601"><span class="dyncstimp">the_exnconlst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d2cs <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_exnconlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
    <span class="keyword">val</span> d2cs <span class="keyword">=</span> <span class="keyword">!</span>p
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := EXNCONLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> d2cs
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  exnconlst_reverse <span class="keyword">(</span>d2cs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_exnconlst_get]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="11562"><span class="stacstdec">vartypsetlst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a><span class="keyword">)</span></span></a></span>

<span class="keyword">val</span> the_vartypset <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a><span class="keyword">)</span>
<span class="comment">// end of [val]
</span>
<span class="keyword">val</span> the_vartypsetlst <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#11562"><span class="stacstuse">vartypsetlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [val]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3464"><span class="dyncstimp">the_vartypset_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> x0 <span class="keyword">=</span> <span class="keyword">!</span>the_vartypset
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_vartypsetlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><span class="keyword">!</span>the_vartypset := x<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span>p := <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#11562"><span class="stacstuse">vartypsetlst</span></a></span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]
</span>    <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">// error reporting
</span>    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": the_vartypset_pop"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">in</span>
  x0
<span class="keyword">end</span> <span class="comment">// end of [the_vartypset_pop]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3500"><span class="dyncstimp">the_vartypset_push</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> vts <span class="keyword">=</span> <span class="keyword">!</span>the_vartypset
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_vartypsetlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>vts<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">!</span>the_vartypset := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a>
<span class="keyword">end</span> <span class="comment">// end of [the_vartypset_push]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3420"><span class="dyncstimp">the_vartypset_add</span></a> <span class="keyword">(</span>vtp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> _new <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1697"><span class="dyncstuse">$Set<span class="keyword">.</span>set_insert&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23198"><span class="stacstuse">vartyp_t</span></a></span><span class="keyword">&gt;</span>
    <span class="keyword">(</span><span class="keyword">!</span>the_vartypset<span class="keyword">,</span> vtp<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23465"><span class="dyncstuse">compare_vartyp_vartyp</span></a><span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>the_vartypset := _new
<span class="keyword">end</span> <span class="comment">// end of [the_vartypset_add]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3533"><span class="dyncstimp">vartypset_d2varlst_make</span></a> <span class="keyword">(</span>vtps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">viewtypedef</span> <span class="staexp"><a name="12978"><span class="stacstdec">d2varlst_vt <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span></a></span>
  <span class="keyword">var</span> d2vs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#12978"><span class="stacstuse">d2varlst_vt</span></a></span> <span class="keyword">=</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">viewdef</span> <span class="staexp"><a name="13059"><span class="stacstdec">V <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#12978"><span class="stacstuse">d2varlst_vt</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> d2vs</span></a></span><span class="keyword">;</span> <span class="keyword">viewtypedef</span> <span class="staexp"><a name="13095"><span class="stacstdec">VT <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> d2vs</span></a></span>
  <span class="keyword">fn</span> f <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#13059"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#13059"><span class="stacstuse">V</span></a></span></a></span></span> <span class="keyword">|</span> vtp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23198"><span class="stacstuse">vartyp_t</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#13095"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#13095"><span class="stacstuse">VT</span></a></span></a></span><span class="keyword">)</span>
    <span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">!</span>env := list_vt_cons <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23328"><span class="dyncstuse">vartyp_var_get</span></a> vtp<span class="keyword">,</span> <span class="keyword">!</span>env<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [fn]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3593"><span class="dyncstuse">vartypset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#13059"><span class="stacstuse">V</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#13095"><span class="stacstuse">VT</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">view@ d2vs</span> <span class="keyword">|</span> vtps<span class="keyword">,</span> f<span class="keyword">,</span> <span class="keyword">&amp;</span>d2vs<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#4322"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_reverse</span></a> <span class="keyword">(</span>d2vs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [vartypset_d2varlst_make]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3787"><span class="dyncstimp">vartypset_union</span></a> <span class="keyword">(</span>vtps1<span class="keyword">,</span> vtps2<span class="keyword">)</span> <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1889"><span class="dyncstuse">$Set<span class="keyword">.</span>set_union</span></a> <span class="keyword">(</span>vtps1<span class="keyword">,</span> vtps2<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23465"><span class="dyncstuse">compare_vartyp_vartyp</span></a><span class="keyword">)</span>

<span class="comment">//
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3593"><span class="dyncstimp">vartypset_foreach_main</span></a>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> vtps<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1978"><span class="dyncstuse">$Set<span class="keyword">.</span>set_foreach_main</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> vtps<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="comment">// end of [vartypset_foreach_main]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3857"><span class="dyncstimp">vartypset_foreach_cloptr</span></a>
  <span class="keyword">(</span>vtps<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#2112"><span class="dyncstuse">$Set<span class="keyword">.</span>set_foreach_cloptr</span></a> <span class="keyword">(</span>vtps<span class="keyword">,</span> f<span class="keyword">)</span>
<span class="comment">// end of [vartypset_foreach_cloptr]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3955"><span class="dyncstimp">print_vartypset</span></a> <span class="keyword">(</span>vtps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">fn</span> f <span class="keyword">(</span>
      <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a></span></a> i</span></span>
    <span class="keyword">|</span> vtp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23198"><span class="stacstuse">vartyp_t</span></a></span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a></span></a> i</span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
    <span class="keyword">let</span> <span class="keyword">val</span> i <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := i + 1 <span class="keyword">in</span>
      <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> print <span class="keyword">(</span>", "<span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23668"><span class="dyncstuse">print_vartyp</span></a> vtp
    <span class="keyword">end</span>
  <span class="comment">// end of [fn f]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3593"><span class="dyncstuse">vartypset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> i<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> i<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">view@ i</span> <span class="keyword">|</span> vtps<span class="keyword">,</span> f<span class="keyword">,</span> <span class="keyword">&amp;</span>i<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="comment">// empty
</span><span class="keyword">end</span> <span class="comment">// end of [print_vartypset]
</span>
<span class="comment">(*
// not used
implement prerr_vartypset (vtps) = let
  var i: int = 0
  fn f (pf: !int @ i | vtp: vartyp_t, p: !ptr i): void =
    let val i = !p; val () = !p := i + 1 in
      if i &gt; 0 then prerr (", "); prerr_vartyp vtp
    end
  val () = begin
    vartypset_foreach_main {int @ i} {ptr i} (view@ i | vtps, f, &amp;i)
  end // end of [val]
in
  // empty
end // end of [prerr_vartypset]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="14595"><span class="stacstdec">funlabsetlst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4069"><span class="stacstuse">funlabset</span></a><span class="keyword">)</span></span></a></span>

<span class="keyword">val</span> the_funlabset <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4069"><span class="stacstuse">funlabset</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a><span class="keyword">)</span>
<span class="keyword">val</span> the_funlabsetlst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#14595"><span class="stacstuse">funlabsetlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4194"><span class="dyncstimp">the_funlabset_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> x0 <span class="keyword">=</span> <span class="keyword">!</span>the_funlabset
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlabsetlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><span class="keyword">!</span>the_funlabset := x<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">!</span>p := <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#14595"><span class="stacstuse">funlabsetlst</span></a></span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]
</span>    <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">// error reporting
</span>    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": the_funlabset_pop"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  x0
<span class="keyword">end</span> <span class="comment">// end of [the_funlabset_pop]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4230"><span class="dyncstimp">the_funlabset_push</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> fls <span class="keyword">=</span> <span class="keyword">!</span>the_funlabset
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlabsetlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>fls<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">!</span>the_funlabset := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a>
<span class="keyword">end</span> <span class="comment">// end of [the_funlabset_push]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4108"><span class="dyncstimp">the_funlabset_add</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> _new <span class="keyword">=</span> <span class="keyword">begin</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1697"><span class="dyncstuse">$Set<span class="keyword">.</span>set_insert&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>the_funlabset<span class="keyword">,</span> fl<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#3063"><span class="dyncstuse">compare_funlab_funlab</span></a><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">!</span>the_funlabset := _new
<span class="keyword">end</span> <span class="comment">// end of [the_funlabset_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4151"><span class="dyncstimp">the_funlabset_mem</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1637"><span class="dyncstuse">$Set<span class="keyword">.</span>set_member&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>the_funlabset<span class="keyword">,</span> fl<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#3063"><span class="dyncstuse">compare_funlab_funlab</span></a><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_funlabset_mem]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4263"><span class="dyncstimp">funlabset_foreach_main</span></a>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> fls<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1978"><span class="dyncstuse">$Set<span class="keyword">.</span>set_foreach_main</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> fls<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="comment">// end of [funlabset_foreach_main]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4456"><span class="dyncstimp">funlabset_foreach_cloptr</span></a> <span class="keyword">(</span>fls<span class="keyword">,</span> f<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#2112"><span class="dyncstuse">$Set<span class="keyword">.</span>set_foreach_cloptr</span></a> <span class="keyword">(</span>fls<span class="keyword">,</span> f<span class="keyword">)</span>

<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4553"><span class="dyncstimp">print_funlabset</span></a> <span class="keyword">(</span>fls<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">fn</span> f <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a></span></a> i</span></span> <span class="keyword">|</span> fl<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a></span></a> i</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
    <span class="keyword">let</span> <span class="keyword">val</span> i <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := i + 1 <span class="keyword">in</span>
      <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> print <span class="keyword">(</span>", "<span class="keyword">)</span><span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2521"><span class="dyncstuse">print_funlab</span></a> fl
    <span class="keyword">end</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4263"><span class="dyncstuse">funlabset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> i<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> i<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">view@ i</span> <span class="keyword">|</span> fls<span class="keyword">,</span> f<span class="keyword">,</span> <span class="keyword">&amp;</span>i<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="comment">// empty
</span><span class="keyword">end</span> <span class="comment">// end of [print_funlabset]
</span>
<span class="comment">(*
// not used
implement prerr_funlabset (fls) = let
  var i: int = 0
  fn f (pf: !int @ i | fl: funlab_t, p: !ptr i): void =
    let val i = !p; val () = !p := i + 1 in
      if i &gt; 0 then prerr (", "); prerr_funlab fl
    end
  // end of [fn f]
  val () = begin
    funlabset_foreach_main {int @ i} {ptr i} (view@ i | fls, f, &amp;i)
  end // end of [val]
in
  // empty
end // end of [prerr_funlabset]
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17108"><span class="stacstdec">dynconset <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1525"><span class="stacstuse">$Set<span class="keyword">.</span>set_t</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2560"><span class="stacstuse">d2con_t</span></a><span class="keyword">)</span></span></a></span>
<span class="keyword">assume</span> <span class="staexp">dynconset_t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17108"><span class="stacstuse">dynconset</span></a></span>

<span class="keyword">val</span> the_dynconset <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17108"><span class="stacstuse">dynconset</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a><span class="keyword">)</span> 

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4710"><span class="dyncstimp">dynconset_foreach_main</span></a>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> d2cs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1978"><span class="dyncstuse">$Set<span class="keyword">.</span>set_foreach_main</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> d2cs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="comment">// end of [dynconset_foreach_main]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4943"><span class="dyncstimp">the_dynconset_add</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> _new <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1697"><span class="dyncstuse">$Set<span class="keyword">.</span>set_insert&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#2560"><span class="stacstuse">d2con_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>the_dynconset<span class="keyword">,</span> d2c<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fstaexp2_2esats.html#23126"><span class="dyncstuse">compare_d2con_d2con</span></a><span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>the_dynconset := _new
<span class="keyword">end</span> <span class="comment">// end of [the_dynconset_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4905"><span class="dyncstimp">the_dynconset_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_dynconset

<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="17682"><span class="stacstdec">dyncstset <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1525"><span class="stacstuse">$Set<span class="keyword">.</span>set_t</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2635"><span class="stacstuse">d2cst_t</span></a><span class="keyword">)</span></span></a></span>
<span class="keyword">assume</span> <span class="staexp">dyncstset_t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17682"><span class="stacstuse">dyncstset</span></a></span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="17759"><span class="stacstdec">dyncstsetlst <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#22725"><span class="stacstuse">List_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17682"><span class="stacstuse">dyncstset</span></a><span class="keyword">)</span></span></a></span>

<span class="keyword">val</span> the_dyncstset <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17682"><span class="stacstuse">dyncstset</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a><span class="keyword">)</span> 
<span class="keyword">val</span> the_dyncstsetlst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17759"><span class="stacstuse">dyncstsetlst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">fn</span> dyncstset_add
  <span class="keyword">(</span>d2cset_ref<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#10015"><span class="stacstuse">ref</span></a> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17682"><span class="stacstuse">dyncstset</span></a></span><span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2635"><span class="stacstuse">d2cst_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#4333"><span class="dyncstuse">d2cst_loc_get</span></a> d2c
  <span class="keyword">val</span> hit0 <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5462"><span class="dyncstuse">d2cst_is_proof</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span>
    <span class="keyword">then</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#3695"><span class="dyncstuse">hityp_proof</span></a> <span class="keyword">else</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ftrans4_2esats.html#1642"><span class="dyncstuse">s2exp_tr</span></a> <span class="keyword">(</span>loc0<span class="keyword">,</span> 1<span class="comment">(*deep*)</span><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#4635"><span class="dyncstuse">d2cst_typ_get</span></a> d2c<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#2808"><span class="stacstuse">hityp</span></a></span>
  <span class="keyword">val</span> hit0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#24307"><span class="dyncstuse">hityp_normalize</span></a> hit0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23032"><span class="dyncstuse">d2cst_hityp_set</span></a> <span class="keyword">(</span>d2c<span class="keyword">,</span> Some hit0<span class="keyword">)</span>
  <span class="keyword">val</span> d2cset <span class="keyword">=</span> <span class="keyword">!</span>d2cset_ref
<span class="keyword">in</span>
  <span class="keyword">!</span>d2cset_ref := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1697"><span class="dyncstuse">$Set<span class="keyword">.</span>set_insert&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2635"><span class="stacstuse">d2cst_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>d2cset<span class="keyword">,</span> d2c<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5107"><span class="dyncstuse">compare_d2cst_d2cst</span></a><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_dyncstset_add]
</span>
<span class="keyword">fn</span> dyncstset_add_if
  <span class="keyword">(</span>d2cset_ref<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#10015"><span class="stacstuse">ref</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17682"><span class="stacstuse">dyncstset</span></a><span class="keyword">)</span></span><span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2635"><span class="stacstuse">d2cst_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span>
  <span class="comment">// a template constant should not be added!
</span>  <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5504"><span class="dyncstuse">d2cst_is_temp</span></a> d2c <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">val</span> d2cset <span class="keyword">=</span> <span class="keyword">!</span>d2cset_ref
    <span class="keyword">val</span> ismem <span class="keyword">=</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1637"><span class="dyncstuse">$Set<span class="keyword">.</span>set_member&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2635"><span class="stacstuse">d2cst_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>d2cset_ref<span class="keyword">,</span> d2c<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5107"><span class="dyncstuse">compare_d2cst_d2cst</span></a><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">in</span>
    <span class="keyword">if</span> ismem <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">(*already added*)</span> <span class="keyword">else</span> dyncstset_add <span class="keyword">(</span>d2cset_ref<span class="keyword">,</span> d2c<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="comment">// end of [dyncstset_add_if]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5057"><span class="dyncstimp">dyncstset_foreach_main</span></a>
  <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> d2cs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1978"><span class="dyncstuse">$Set<span class="keyword">.</span>set_foreach_main</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> d2cs<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
<span class="comment">// end of [dyncstset_foreach_main]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5252"><span class="dyncstimp">the_dyncstset_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_dyncstset

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5326"><span class="dyncstimp">the_dyncstset_add_if</span></a> <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="comment">// a template constant should not be added!
</span>  <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5504"><span class="dyncstuse">d2cst_is_temp</span></a> d2c <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">val</span> ismem <span class="keyword">=</span> <span class="keyword">begin</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1637"><span class="dyncstuse">$Set<span class="keyword">.</span>set_member&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2635"><span class="stacstuse">d2cst_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>the_dyncstset<span class="keyword">,</span> d2c<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#5107"><span class="dyncstuse">compare_d2cst_d2cst</span></a><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">in</span>
    <span class="keyword">if</span> ismem <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">(*already added*)</span> <span class="keyword">else</span> dyncstset_add <span class="keyword">(</span>the_dyncstset<span class="keyword">,</span> d2c<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="comment">// end of [the_dyncstset_add_if]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5456"><span class="dyncstimp">the_dyncstsetlst_push</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d2cs <span class="keyword">=</span> <span class="keyword">!</span>the_dyncstset
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_dyncstsetlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>d2cs<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>the_dyncstset := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1593"><span class="dyncstuse">$Set<span class="keyword">.</span>set_nil</span></a>
<span class="keyword">in</span>
  <span class="comment">// empty
</span><span class="keyword">end</span> <span class="comment">// end of [the_dyncstsetlst_push]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5531"><span class="dyncstimp">the_dyncstsetlst_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> d2cs <span class="keyword">=</span> <span class="keyword">!</span>the_dyncstset
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_dyncstsetlst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>d2cs1<span class="keyword">,</span> d2cslst1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">$effmask_ref</span> <span class="keyword">(</span><span class="keyword">!</span>the_dyncstset := d2cs1<span class="keyword">)</span> <span class="keyword">in</span>
        <span class="keyword">!</span>p := <span class="keyword">(</span>d2cslst1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#17759"><span class="stacstuse">dyncstsetlst</span></a></span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]
</span>    <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> <span class="keyword">(</span>err <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": the_dyncstsetlst_pop"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  d2cs
<span class="keyword">end</span> <span class="comment">// end of [the_dyncstsetlst_pop]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_extypelst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5642"><span class="stacstuse">extypelst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>EXTYPELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5801"><span class="dyncstimp">the_extypelst_add</span></a> <span class="keyword">(</span>name<span class="keyword">,</span> hit<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_extypelst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := EXTYPELSTcons <span class="keyword">(</span>name<span class="keyword">,</span> hit<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_extypelst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5765"><span class="dyncstimp">the_extypelst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_extypelst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := EXTYPELSTnil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span> <span class="comment">// end of [the_extypelst_add]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_extvallst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5889"><span class="stacstuse">extvallst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>EXTVALLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">fn</span> extvallst_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5889"><span class="stacstuse">extvallst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5889"><span class="stacstuse">extvallst</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5889"><span class="stacstuse">extvallst</span></a></span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5889"><span class="stacstuse">extvallst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5889"><span class="stacstuse">extvallst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> EXTVALLSTcons <span class="keyword">(</span>_<span class="comment">(*name*)</span><span class="keyword">,</span> _<span class="comment">(*vp*)</span><span class="keyword">,</span> <span class="keyword">!</span>xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1_v <span class="keyword">=</span> <span class="keyword">!</span>xs1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>xs1 := ys<span class="keyword">;</span> fold@ <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>xs1_v<span class="keyword">,</span> xs<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> <span class="keyword">~</span>EXTVALLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> EXTVALLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [extvallst_reverse]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6062"><span class="dyncstimp">the_extvallst_add</span></a> <span class="keyword">(</span>name<span class="keyword">,</span> hit<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_extvallst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := EXTVALLSTcons <span class="keyword">(</span>name<span class="keyword">,</span> hit<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_extvallst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6026"><span class="dyncstimp">the_extvallst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_extvallst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
    <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := EXTVALLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> res
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  extvallst_reverse <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_extvallst_get]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5982"><span class="dyncstimp">extvallst_free</span></a> <span class="keyword">(</span>exts<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> exts <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>EXTVALLSTcons <span class="keyword">(</span>_<span class="comment">(*name*)</span><span class="keyword">,</span> _<span class="comment">(*vp*)</span><span class="keyword">,</span> exts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#5982"><span class="dyncstuse">extvallst_free</span></a> exts
  <span class="keyword">|</span> <span class="keyword">~</span>EXTVALLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [extvallst_free]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_extcodelst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6149"><span class="stacstuse">extcodelst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>EXTCODELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">fn</span> extcodelst_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6149"><span class="stacstuse">extcodelst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6149"><span class="stacstuse">extcodelst</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6149"><span class="stacstuse">extcodelst</span></a></span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6149"><span class="stacstuse">extcodelst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6149"><span class="stacstuse">extcodelst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> EXTCODELSTcons <span class="keyword">(</span>
        _<span class="comment">(*loc*)</span><span class="keyword">,</span> _<span class="comment">(*pos*)</span><span class="keyword">,</span> _<span class="comment">(*code*)</span><span class="keyword">,</span> <span class="keyword">!</span>p_xs1
      <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1_v <span class="keyword">=</span> <span class="keyword">!</span>p_xs1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>p_xs1 := ys<span class="keyword">;</span> fold@ <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>xs1_v<span class="keyword">,</span> xs<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> <span class="keyword">~</span>EXTCODELSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> EXTCODELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [extcodelst_reverse]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6381"><span class="dyncstimp">the_extcodelst_add</span></a> <span class="keyword">(</span>loc<span class="keyword">,</span> pos<span class="keyword">,</span> code<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_extcodelst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := EXTCODELSTcons <span class="keyword">(</span>loc<span class="keyword">,</span> pos<span class="keyword">,</span> code<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_extcodelst_add]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6343"><span class="dyncstimp">the_extcodelst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_extcodelst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
    <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := EXTCODELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> res
  <span class="keyword">end</span> <span class="comment">// end of [res]
</span><span class="keyword">in</span>
  extcodelst_reverse <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_extcodelst_get]
</span>
<span class="keyword">implement</span>
<a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6296"><span class="dyncstimp">extcodelst_free</span></a> <span class="keyword">(</span>codes<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> codes <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>EXTCODELSTcons <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> codes<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6296"><span class="dyncstuse">extcodelst_free</span></a> <span class="keyword">(</span>codes<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>EXTCODELSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [extcodelst_free]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_stafilelst <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6478"><span class="stacstuse">stafilelst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>STAFILELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [val]
</span>
<span class="keyword">fn</span> stafilelst_reverse
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6478"><span class="stacstuse">stafilelst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6478"><span class="stacstuse">stafilelst</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6478"><span class="stacstuse">stafilelst</span></a></span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6478"><span class="stacstuse">stafilelst</span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6478"><span class="stacstuse">stafilelst</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> STAFILELSTcons <span class="keyword">(</span>_fil<span class="keyword">,</span> _loadflag<span class="keyword">,</span> <span class="keyword">!</span>xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> xs1_v <span class="keyword">=</span> <span class="keyword">!</span>xs1<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>xs1 := ys<span class="keyword">;</span> fold@ <span class="keyword">(</span>xs<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>xs1_v<span class="keyword">,</span> xs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [STAFILELSTcons]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>STAFILELSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ys
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>xs<span class="keyword">,</span> STAFILELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [stafilelst_reverse]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6696"><span class="dyncstimp">the_stafilelst_add</span></a> <span class="keyword">(</span>fil<span class="keyword">,</span> loadflag<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_stafilelst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := STAFILELSTcons <span class="keyword">(</span>fil<span class="keyword">,</span> loadflag<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_stafilelst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6658"><span class="dyncstimp">the_stafilelst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> res <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_stafilelst<span class="keyword">)</span>
    <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := STAFILELSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  stafilelst_reverse <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_stafilelst_get]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6612"><span class="dyncstimp">stafilelst_free</span></a> <span class="keyword">(</span>fils<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> fils <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>STAFILELSTcons <span class="keyword">(</span>_fil<span class="keyword">,</span> _loadflag<span class="keyword">,</span> fils<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6612"><span class="dyncstuse">stafilelst_free</span></a> fils
  <span class="keyword">|</span> <span class="keyword">~</span>STAFILELSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [stafilelst_free]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_dynfilelst <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6794"><span class="stacstuse">dynfilelst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>DYNFILELSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6995"><span class="dyncstimp">the_dynfilelst_add</span></a> <span class="keyword">(</span>fil<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_dynfilelst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := DYNFILELSTcons <span class="keyword">(</span>fil<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [the_dynfilelst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6957"><span class="dyncstimp">the_dynfilelst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_dynfilelst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := DYNFILELSTnil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  res
<span class="keyword">end</span> <span class="comment">// end of [the_dynfilelst_get]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6911"><span class="dyncstimp">dynfilelst_free</span></a> <span class="keyword">(</span>fils<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> fils <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>DYNFILELSTcons <span class="keyword">(</span>fil<span class="keyword">,</span> fils<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#6911"><span class="dyncstuse">dynfilelst_free</span></a> fils
  <span class="keyword">|</span> <span class="keyword">~</span>DYNFILELSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [dynfilelst_free]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">assume</span> <span class="staexp">funlab_token <span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#23184"><span class="stacstuse">unit_v</span></a></span>
<span class="keyword">val</span> the_funlablst <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2248"><span class="stacstuse">funlablst_vt</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7090"><span class="dyncstimp">funlab_pop</span></a> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">prval</span> <span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlablst<span class="keyword">)</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> fls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">!</span>p := <span class="keyword">(</span>fls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2248"><span class="stacstuse">funlablst_vt</span></a></span><span class="keyword">)</span>
    <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": funlab_pop"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [funlab_pop]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7141"><span class="dyncstimp">funlab_push</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlablst<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>fl<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">(</span><span class="prfexp">unit_v <span class="keyword">(</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [funlab_push]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7195"><span class="dyncstimp">funlab_top</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> err <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": funlab_top"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [err]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">vbox pf</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlablst<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
  <span class="keyword">|</span> list_vt_cons <span class="keyword">(</span>fl<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> fl
    <span class="keyword">end</span> <span class="comment">// end of [list_vt_cons]
</span>  <span class="keyword">|</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">$effmask_ref</span> <span class="keyword">(</span>err <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_vt_nil]
</span><span class="keyword">end</span> <span class="comment">// end of [funlab_top]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="26670"><span class="stacstdec">funentry <span class="keyword">=</span> <span class="keyword">'{</span>
  funentry_loc<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1591"><span class="stacstuse">loc_t</span></a> <span class="comment">// location of the function in the source
</span><span class="keyword">,</span> funentry_lab<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a> <span class="comment">// the funentry label
</span><span class="keyword">,</span> funentry_lev<span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a>
<span class="keyword">,</span> funentry_vtps<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a> <span class="comment">// local variables
</span><span class="keyword">,</span> funentry_vtps_flag<span class="keyword">=</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a> <span class="comment">// 0/1: changeable/finalized
</span><span class="keyword">,</span> funentry_labset<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4069"><span class="stacstuse">funlabset</span></a> <span class="comment">// list of funentrys called
</span><span class="keyword">,</span> funentry_ret<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#5102"><span class="stacstuse">tmpvar_t</span></a> <span class="comment">// storing the funentry return
</span><span class="keyword">,</span> funentry_body<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#14703"><span class="stacstuse">instrlst</span></a> <span class="comment">// instructions of the funentry body
</span><span class="keyword">,</span> funentry_tailjoin<span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#24175"><span class="stacstuse">tailjoinlst</span></a> <span class="comment">// mutual tail-recursion
</span><span class="keyword">}</span></span></a></span> <span class="comment">// end of [funentry]
</span>
<span class="keyword">assume</span> <span class="staexp">funentry_t <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#26670"><span class="stacstuse">funentry</span></a></span>

<span class="keyword">in</span>

<span class="keyword">extern</span> <span class="keyword">typedef</span> <span class="staexp">"funentry_t" <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#26670"><span class="stacstuse">funentry</span></a></span>

<span class="keyword">fn</span> _funentry_make <span class="keyword">(</span>
    loc<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#1591"><span class="stacstuse">loc_t</span></a></span>
  <span class="keyword">,</span> fl<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span>
  <span class="keyword">,</span> level<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span>
  <span class="keyword">,</span> fls<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4069"><span class="stacstuse">funlabset</span></a></span>
  <span class="keyword">,</span> vtps<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a></span>
  <span class="keyword">,</span> tmp_ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#5102"><span class="stacstuse">tmpvar_t</span></a></span>
  <span class="keyword">,</span> inss<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#14703"><span class="stacstuse">instrlst</span></a></span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#26670"><span class="stacstuse">funentry</span></a></span> <span class="keyword">=</span> <span class="keyword">'{</span>
  funentry_loc<span class="keyword">=</span> loc
<span class="keyword">,</span> funentry_lab<span class="keyword">=</span> fl
<span class="keyword">,</span> funentry_lev<span class="keyword">=</span> level
<span class="keyword">,</span> funentry_vtps<span class="keyword">=</span> vtps
<span class="keyword">,</span> funentry_vtps_flag<span class="keyword">=</span> 0 <span class="comment">// it needs to be finalized
</span><span class="keyword">,</span> funentry_labset<span class="keyword">=</span> fls
<span class="keyword">,</span> funentry_ret<span class="keyword">=</span> tmp_ret
<span class="keyword">,</span> funentry_body<span class="keyword">=</span> inss
<span class="keyword">,</span> funentry_tailjoin<span class="keyword">=</span> TAILJOINLSTnil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [_funentry_make]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7245"><span class="dyncstimp">funentry_make</span></a>
   <span class="keyword">(</span>loc<span class="keyword">,</span> fl<span class="keyword">,</span> level<span class="keyword">,</span> fls<span class="keyword">,</span> vtps<span class="keyword">,</span> tmp_ret<span class="keyword">,</span> inss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  _funentry_make <span class="keyword">(</span>loc<span class="keyword">,</span> fl<span class="keyword">,</span> level<span class="keyword">,</span> fls<span class="keyword">,</span> vtps<span class="keyword">,</span> tmp_ret<span class="keyword">,</span> inss<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [funentry_make]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7407"><span class="dyncstimp">funentry_loc_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_loc
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7455"><span class="dyncstimp">funentry_lab_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_lab
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7506"><span class="dyncstimp">funentry_lev_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_lev
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7552"><span class="dyncstimp">funentry_vtps_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_vtps
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7709"><span class="dyncstimp">funentry_vtps_flag_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_vtps_flag
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7870"><span class="dyncstimp">funentry_labset_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_labset
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7925"><span class="dyncstimp">funentry_ret_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_ret
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7976"><span class="dyncstimp">funentry_body_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_body
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8033"><span class="dyncstimp">funentry_tailjoin_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span> entry<span class="keyword">.</span>funentry_tailjoin

<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8210"><span class="dyncstimp">funentry_associate</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">let</span> <span class="keyword">val</span> fl <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7455"><span class="dyncstuse">funentry_lab_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span> <span class="keyword">in</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#4135"><span class="dyncstuse">funlab_entry_set</span></a> <span class="keyword">(</span>fl<span class="keyword">,</span> Some entry<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [funentry_associate]
</span>
<span class="keyword">local</span>

<span class="comment">// transitive closure
</span><span class="keyword">fn</span> funentry_labset_get_all
  <span class="keyword">(</span>entry0<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2291"><span class="stacstuse">funentry_t</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4069"><span class="stacstuse">funlabset</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> level0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7506"><span class="dyncstuse">funentry_lev_get</span></a> <span class="keyword">(</span>entry0<span class="keyword">)</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>fl<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloptr1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> entry <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#4226"><span class="dyncstuse">funlab_entry_get_some</span></a> fl
    <span class="keyword">val</span> level <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7506"><span class="dyncstuse">funentry_lev_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span>
<span class="comment">(*
    val () = begin
      print "funentry_labset_get_all: aux: fl = "; print fl; print_newline ();
      print "funentry_labset_get_all: aux: level = "; print level; print_newline ();
    end // end of [val]
*)</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> 0 <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> level &gt;= level0 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4151"><span class="dyncstuse">the_funlabset_mem</span></a> fl <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">begin</span>
          <span class="keyword">let</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4108"><span class="dyncstuse">the_funlabset_add</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">in</span>
            <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4456"><span class="dyncstuse">funlabset_foreach_cloptr</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7870"><span class="dyncstuse">funentry_labset_get</span></a> entry<span class="keyword">,</span> aux<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [let]
</span>        <span class="keyword">end</span> <span class="comment">// end of [if]
</span>      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4108"><span class="dyncstuse">the_funlabset_add</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4230"><span class="dyncstuse">the_funlabset_push</span></a> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> fls0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7870"><span class="dyncstuse">funentry_labset_get</span></a> entry0
<span class="comment">(*
  val () = begin
    print "funentry_labset_get_all: fls0 = "; print_funlabset fls0; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4456"><span class="dyncstuse">funlabset_foreach_cloptr</span></a> <span class="keyword">(</span>fls0<span class="keyword">,</span> aux<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4194"><span class="dyncstuse">the_funlabset_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [funentry_labset_get_all]
</span>
<span class="keyword">dataviewtype</span> <span class="staexp"><a name="29758"><span class="stacstdec">ENV <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">)</span></span></a></span> <span class="keyword">=</span> ENVcon <span class="staexp"><span class="keyword">(</span>l<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> l<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a><span class="keyword">)</span></span>

<span class="keyword">in</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8259"><span class="dyncstimp">funentry_vtps_get_all</span></a> <span class="keyword">(</span>entry0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val fl0 = funentry_lab_get entry0
  val () = begin
    print "funentry_vtps_get_all: entry0 = "; print fl0; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> vtps_flag <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7709"><span class="dyncstuse">funentry_vtps_flag_get</span></a> <span class="keyword">(</span>entry0<span class="keyword">)</span>
  <span class="keyword">var</span> vtps_all<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a></span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7552"><span class="dyncstuse">funentry_vtps_get</span></a> <span class="keyword">(</span>entry0<span class="keyword">)</span>
  <span class="keyword">viewdef</span> <span class="staexp"><a name="30122"><span class="stacstdec">V <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> vtps_all</span></a></span>
  <span class="keyword">viewtypedef</span> <span class="staexp"><a name="30161"><span class="stacstdec">VT <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#29758"><span class="stacstuse">ENV</span></a> <span class="keyword">(</span>vtps_all<span class="keyword">)</span></span></a></span>
  <span class="keyword">fun</span> aux
    <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#30122"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#30122"><span class="stacstuse">V</span></a></span></a></span></span> <span class="keyword">|</span> fl<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2179"><span class="stacstuse">funlab_t</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#30161"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#30161"><span class="stacstuse">VT</span></a></span></a></span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val+</span> ENVcon <span class="keyword">(</span>p<span class="keyword">,</span> level0<span class="keyword">)</span> <span class="keyword">=</span> env
    <span class="keyword">val</span> entry <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#4226"><span class="dyncstuse">funlab_entry_get_some</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span>
    <span class="keyword">val</span> level <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7506"><span class="dyncstuse">funentry_lev_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span>
    <span class="keyword">val</span> vtps <span class="keyword">=</span> <span class="keyword">(</span>
      <span class="keyword">if</span> level <span class="keyword">&lt;</span> level0 <span class="keyword">then</span> <span class="keyword">begin</span>
        <span class="comment">// higher-level should be handled earlier
</span>        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8259"><span class="dyncstuse">funentry_vtps_get_all</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">// [level = level0]
</span>        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7552"><span class="dyncstuse">funentry_vtps_get</span></a> <span class="keyword">(</span>entry<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3382"><span class="stacstuse">vartypset</span></a></span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
      <span class="keyword">!</span>p := <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fset_5ffun_2esats.html#1889"><span class="dyncstuse">$Set<span class="keyword">.</span>set_union</span></a> <span class="keyword">(</span>vtps<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23465"><span class="dyncstuse">compare_vartyp_vartyp</span></a><span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">in</span>
    fold@ env
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span>
    <span class="keyword">if</span> vtps_flag <span class="keyword">=</span> 0 <span class="keyword">then</span> <span class="keyword">let</span>
      <span class="keyword">val</span> level0 <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7506"><span class="dyncstuse">funentry_lev_get</span></a> <span class="keyword">(</span>entry0<span class="keyword">)</span>
      <span class="keyword">val</span> fls <span class="keyword">=</span> funentry_labset_get_all <span class="keyword">(</span>entry0<span class="keyword">)</span>
<span class="comment">(*
      val () = begin
        print "funentry_vtps_get_all: fls = "; print_funlabset fls; print_newline ()        
      end // end of [val]
*)</span>
      <span class="keyword">val</span> env <span class="keyword">=</span> ENVcon <span class="keyword">(</span><span class="keyword">&amp;</span>vtps_all<span class="keyword">,</span> level0<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#4263"><span class="dyncstuse">funlabset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#30122"><span class="stacstuse">V</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#30161"><span class="stacstuse">VT</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">view@ vtps_all</span> <span class="keyword">|</span> fls<span class="keyword">,</span> aux<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">end</span>
      <span class="keyword">val+</span> <span class="keyword">~</span>ENVcon <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> env
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7605"><span class="dyncstuse">funentry_vtps_set</span></a> <span class="keyword">(</span>entry0<span class="keyword">,</span> vtps_all<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#7761"><span class="dyncstuse">funentry_vtps_flag_set</span></a> <span class="keyword">(</span>entry0<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span>
<span class="comment">(*
  val () = begin
    print "funentry_vtps_get_all: vtps_all = "; print_vartypset vtps_all; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  vtps_all
<span class="keyword">end</span> <span class="comment">// end of [funentry_vtps_get_all]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">viewtypedef</span> <span class="staexp"><a name="31592"><span class="stacstdec">varindmap <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1634"><span class="stacstuse">$Map<span class="keyword">.</span>map_vt</span></a> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a><span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a><span class="keyword">)</span></span></a></span>

<span class="keyword">dataviewtype</span> <span class="staexp"><a name="31645"><span class="stacstdec">ENV <span class="keyword">(</span>l<span class="keyword">:</span>addr<span class="keyword">,</span> i<span class="keyword">:</span>addr<span class="keyword">)</span></span></a></span> <span class="keyword">=</span> ENVcon <span class="staexp"><span class="keyword">(</span>l<span class="keyword">,</span> i<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> l<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15783"><span class="stacstuse">ptr</span></a> i<span class="keyword">)</span></span>

<span class="keyword">fn</span> varindmap_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#31592"><span class="stacstuse">varindmap</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1706"><span class="dyncstuse">$Map<span class="keyword">.</span>map_make</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a><span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#8404"><span class="dyncstuse">compare_d2var_d2var</span></a><span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">val</span> the_varindmap <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#31592"><span class="stacstuse">varindmap</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>varindmap_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">in</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8321"><span class="dyncstimp">varindmap_find</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_varindmap<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2271"><span class="dyncstuse">$Map<span class="keyword">.</span>map_search</span></a> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">,</span> d2v<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [varindmap_find]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8370"><span class="dyncstimp">varindmap_find_some</span></a> <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8321"><span class="dyncstuse">varindmap_find</span></a> d2v <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt ind <span class="keyword">=&gt;</span> ind <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": varindmap_find: d2v = "<span class="keyword">;</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#8852"><span class="dyncstuse">prerr_d2var</span></a> d2v<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">// end of [varindmap_find_some]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8415"><span class="dyncstimp">funentry_varindmap_reset</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_varindmap<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#1870"><span class="dyncstuse">$Map<span class="keyword">.</span>map_free&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fdynexp2_2esats.html#2719"><span class="stacstuse">d2var_t</span></a></span><span class="keyword">,</span><span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := varindmap_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [funentry_varindmap_reset]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8453"><span class="dyncstimp">funentry_varindmap_set</span></a> <span class="keyword">(</span>vtps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> <span class="keyword">[</span><span class="staexp">l<span class="keyword">:</span>addr</span><span class="keyword">]</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> r<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_varindmap<span class="keyword">)</span>
  <span class="keyword">viewdef</span> <span class="staexp"><a name="32726"><span class="stacstdec">V <span class="keyword">=</span> <span class="keyword">(</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#31592"><span class="stacstuse">varindmap</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> l<span class="keyword">,</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#9893"><span class="stacstuse">@</span></a> i<span class="keyword">)</span></span></a></span>
  <span class="keyword">viewdef</span> <span class="staexp"><a name="32765"><span class="stacstdec">VT <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#31645"><span class="stacstuse">ENV</span></a> <span class="keyword">(</span>l<span class="keyword">,</span> i<span class="keyword">)</span></span></a></span>
  <span class="keyword">fn</span> f <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#32726"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#32726"><span class="stacstuse">V</span></a></span></a></span></span> <span class="keyword">|</span> vtp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23198"><span class="stacstuse">vartyp_t</span></a></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#32765"><span class="stacstuse"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#32765"><span class="stacstuse">VT</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">@(</span>pf_map<span class="keyword">,</span> pf_int<span class="keyword">)</span> <span class="keyword">=</span> pf</span>
    <span class="keyword">val+</span> ENVcon <span class="keyword">(</span>p_l<span class="keyword">,</span> p_i<span class="keyword">)</span> <span class="keyword">=</span> env
    <span class="keyword">val</span> i <span class="keyword">=</span> <span class="keyword">!</span>p_i<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">!</span>p_i := i + 1<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fmap_5flin_2esats.html#2066"><span class="dyncstuse">$Map<span class="keyword">.</span>map_insert</span></a> <span class="keyword">(</span><span class="keyword">!</span>p_l<span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fhiexp_2esats.html#23328"><span class="dyncstuse">vartyp_var_get</span></a> vtp<span class="keyword">,</span> i<span class="keyword">)</span>
  <span class="keyword">in</span>
    pf := <span class="keyword">(</span>pf_map<span class="keyword">,</span> pf_int<span class="keyword">)</span><span class="keyword">;</span> fold@ env
  <span class="keyword">end</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf_map <span class="keyword">=</span> pfbox</span>
  <span class="keyword">prval</span> <span class="prfexp">pf <span class="keyword">=</span> <span class="keyword">@(</span>pf_map<span class="keyword">,</span> view@ i<span class="keyword">)</span></span>
  <span class="keyword">val</span> env <span class="keyword">=</span> ENVcon <span class="keyword">(</span>r<span class="keyword">,</span> <span class="keyword">&amp;</span>i<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#3593"><span class="dyncstuse">vartypset_foreach_main</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#32726"><span class="stacstuse">V</span></a><span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#32765"><span class="stacstuse">VT</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> vtps<span class="keyword">,</span> f<span class="keyword">,</span> env<span class="keyword">)</span>
  <span class="keyword">val+</span> <span class="keyword">~</span>ENVcon <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> env
<span class="keyword">in</span>
  pf_map := pf<span class="keyword">.</span>0<span class="keyword">;</span> view@ i := pf<span class="keyword">.</span>1
<span class="keyword">end</span> <span class="comment">// end of [funentry_varindmap_set]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">val</span> the_funlablst <span class="keyword">=</span> <span class="keyword">begin</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#2248"><span class="stacstuse">funlablst_vt</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8567"><span class="dyncstimp">funentry_lablst_add</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "funentry_lablst_add: fl = "; print fl; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlablst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := list_vt_cons <span class="keyword">(</span>fl<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [funentry_lablst_add]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8526"><span class="dyncstimp">funentry_lablst_get</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_funlablst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
    <span class="keyword">val</span> res <span class="keyword">=</span> <span class="keyword">!</span>p
  <span class="keyword">in</span>
    <span class="keyword">!</span>p := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> res
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5flist_2esats.html#4322"><span class="dyncstuse">$Lst<span class="keyword">.</span>list_vt_reverse</span></a> <span class="keyword">(</span>res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [funentry_lablst_get]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">dataviewtype</span> <span class="staexp"><a name="34101"><span class="stacstdec">loopexnlablst</span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> LOOPEXNLABLSTcons <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>
      <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#1810"><span class="stacstuse">tmplab_t</span></a><span class="comment">(*init*)</span><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#1810"><span class="stacstuse">tmplab_t</span></a><span class="comment">(*fini*)</span><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#1810"><span class="stacstuse">tmplab_t</span></a><span class="comment">(*cont*)</span><span class="keyword">,</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#34101"><span class="stacstuse">loopexnlablst</span></a>
    <span class="keyword">)</span></span>
  <span class="keyword">|</span> LOOPEXNLABLSTnil <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [loopexnlablst]
</span>
<span class="keyword">val</span> the_loopexnlablst <span class="keyword">=</span>
  <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#1801"><span class="dyncstuse">ref_make_elt&lt;</span></a><span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2edats.html#34101"><span class="stacstuse">loopexnlablst</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>LOOPEXNLABLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [the_loopexnlablst]
</span>
<span class="keyword">in</span>

<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8665"><span class="dyncstimp">loopexnlablst_push</span></a> <span class="keyword">(</span>tl_init<span class="keyword">,</span> tl_fini<span class="keyword">,</span> tl_cont<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_loopexnlablst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">!</span>p := LOOPEXNLABLSTcons <span class="keyword">(</span>tl_init<span class="keyword">,</span> tl_fini<span class="keyword">,</span> tl_cont<span class="keyword">,</span> <span class="keyword">!</span>p<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [loopexnlablst_push]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8634"><span class="dyncstimp">loopexnlablst_pop</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> err<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#15410"><span class="stacstuse">int</span></a></span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_loopexnlablst<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>LOOPEXNLABLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> tls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">!</span>p := tls<span class="keyword">)</span>
    <span class="keyword">|</span> LOOPEXNLABLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> err := 1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": loopexnlablst_pop"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fsta_2esats.html#16293"><span class="stacstuse">void</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [loopexnlablst_pop]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_5fenv_2esats.html#8754"><span class="dyncstimp">loopexnlablst_get</span></a> <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> tmplab_gen <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#1810"><span class="stacstuse">tmplab_t</span></a></span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> prerr ": loopexnlablst_get"<span class="keyword">;</span> <a href="XREF/_2ftmp_2fATS_2d0_2e2_2e3_2fprelude_2fbasics_5fdyn_2esats.html#12890"><span class="dyncstuse">prerr_newline</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5ferror_2esats.html#1817"><span class="dyncstuse">$Err<span class="keyword">.</span>abort</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5fccomp_2esats.html#1810"><span class="stacstuse">tmplab_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [tmplab_gen]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfbox</span> <span class="keyword">|</span> p<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fscratch_2ftmp_2fATS_2d0_2e2_2e3_2fsrc_2fats_5freference_2esats.html#2660"><span class="dyncstuse">ref_get_view_ptr</span></a> <span class="keyword">(</span>the_loopexnlablst<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp">vbox pf <span class="keyword">=</span> pfbox</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> <span class="keyword">!</span>p <span class="keyword">of</span>
  <span class="keyword">|</span> LOOPEXNLABLSTcons
      <span class="keyword">(</span>_<span class="comment">(*init*)</span><span class="keyword">,</span> tl_fini<span class="keyword">,</span> tl_cont<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">if</span> i <span class="keyword">=</span> 0 <span class="keyword">then</span> tl_fini <span class="keyword">else</span> tl_cont
    <span class="keyword">end</span> <span class="comment">// end of [LOOPEXNLABLSTcons]
</span>  <span class="keyword">|</span> LOOPEXNLABLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">(</span>fold@ <span class="keyword">(</span><span class="keyword">!</span>p<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">$effmask_all</span> <span class="keyword">(</span>tmplab_gen <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [loopexnlablst_get]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{$

ats_void_type
ats_ccomp_env_funentry_vtps_set
  (ats_ptr_type entry, ats_ptr_type vtps) {
  ((funentry_t)entry)-&gt;atslab_funentry_vtps = vtps ; return ;
}

ats_void_type
ats_ccomp_env_funentry_vtps_flag_set (ats_ptr_type entry) {
  ((funentry_t)entry)-&gt;atslab_funentry_vtps_flag = 1 ; return ;
}

ats_void_type
ats_ccomp_env_funentry_tailjoin_set
  (ats_ptr_type entry, ats_ptr_type tjs) {
  ((funentry_t)entry)-&gt;atslab_funentry_tailjoin = tjs ; return ;
}

%}</span> <span class="comment">// end of [%{$]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_ccomp_env.dats] *)</span>
</pre>
</body>
</html>
