/*
 *
 * This C code is generated by ATS/Geizella
 * The compilation time is: 2012-5-27: 21:23
 *
 */

#define _ATS_GEIZELLA 1

#include "ats_config.h"
#include "ats_basics.h"
#include "ats_types.h"
#include "ats_exception.h"
#include "ats_memory.h"

/* include some .cats files */

#include "prelude/CATS/array.cats"
#include "prelude/CATS/basics.cats"
#include "prelude/CATS/bool.cats"
#include "prelude/CATS/byte.cats"
#include "prelude/CATS/char.cats"
#include "prelude/CATS/float.cats"
#include "prelude/CATS/integer.cats"
#include "prelude/CATS/pointer.cats"
#include "prelude/CATS/printf.cats"
#include "prelude/CATS/reference.cats"
#include "prelude/CATS/sizetype.cats"
#include "prelude/CATS/string.cats"

/* external codes at top */


#include "libc/CATS/stdio.cats" // for some IO functions


static inline
ats_int_type
ats_int_of_lint (ats_lint_type i) { return i ; }

/* type definitions */

typedef struct {
ats_int_type atslab_line ;
ats_int_type atslab_loff ;
ats_lint_type atslab_toff ;
} _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0 ;

typedef struct {
ats_ptr_type atslab_free ;
ats_ptr_type atslab_getc ;
} _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1 ;

/* external dynamic constructor declarations */

ATSextern(ats_exn_type, _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__LexingErrorException) ;

/* external dynamic constant declarations */

extern ats_ptr_type atspre_stdout_get() ;
extern ats_void_type atspre_stdout_view_set() ;
extern ats_ptr_type atspre_stderr_get() ;
extern ats_void_type atspre_stderr_view_set() ;
extern ats_int_type atspre_int_of_char(ats_char_type) ;
extern ats_int_type atspre_add_int_int(ats_int_type, ats_int_type) ;
extern ats_bool_type atspre_gt_int_int(ats_int_type, ats_int_type) ;
extern ats_lint_type atspre_add_lint_lint(ats_lint_type, ats_lint_type) ;
extern ats_bool_type atspre_lt_lint_lint(ats_lint_type, ats_lint_type) ;
extern ats_bool_type atspre_lte_lint_lint(ats_lint_type, ats_lint_type) ;
extern ats_bool_type atspre_eq_lint_lint(ats_lint_type, ats_lint_type) ;
extern ats_bool_type atspre_neq_lint_lint(ats_lint_type, ats_lint_type) ;
extern ats_ptr_type atspre_ptr_alloc_tsz(ats_size_type) ;
extern ats_void_type atspre_ptr_free(ats_ptr_type) ;
extern ats_void_type atspre_fprintf_exn(ats_ref_type, ats_ptr_type, ...) ;
extern ats_size_type atspre_size1_of_int1(ats_int_type) ;
extern ats_size_type atspre_add_size1_int1(ats_size_type, ats_int_type) ;
extern ats_bool_type atspre_lt_size1_size1(ats_size_type, ats_size_type) ;
extern ats_ptr_type atspre_castfn_ptr(ats_ptr_type) ;
extern ats_char_type atspre_string_get_char_at(ats_ptr_type, ats_size_type) ;
extern ats_size_type atspre_string_length(ats_ptr_type) ;
extern ats_int_type _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__accept_table_get(ats_ptr_type, ats_int_type) ;
extern ats_int_type _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__transition_table_get(ats_ptr_type, ats_int_type, ats_int_type) ;
extern ats_void_type _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__fprint_position(ats_ref_type, ats_ptr_type) ;
extern ats_void_type lexbuf_fstpos_set(ats_ref_type) ;
extern ats_void_type lexbuf_lstpos_set(ats_ref_type) ;
extern ats_void_type lexbuf_curpos_set(ats_ref_type) ;
extern ats_int_type lexbuf_char_next(ats_ref_type) ;
extern ats_bool_type lexbuf_is_eof(ats_ref_type) ;
extern ats_int_type lexing_engine_lexbuf(ats_ref_type, ats_ptr_type, ats_ptr_type) ;
extern ats_ptr_type lexing_lexbuf_get() ;
extern ats_void_type lexing_lexbuf_set(ats_ptr_type) ;
extern ats_char_type lexeme_get_lexbuf(ats_ref_type, ats_int_type) ;
extern ats_void_type lexeme_set_lexbuf(ats_ref_type, ats_int_type, ats_char_type) ;
extern ats_ptr_type lexeme_string_lexbuf(ats_ref_type) ;
extern ats_lint_type lexeme_lint_lexbuf(ats_ref_type, ats_int_type) ;
extern ats_lint_type lexeme_lint(ats_int_type) ;
extern ats_ptr_type position_make_int_int_lint(ats_int_type, ats_int_type, ats_lint_type) ;
extern ats_void_type atslib_fclose_exn(ats_ptr_type) ;
extern ats_int_type atslib_getchar() ;
extern ats_int_type ats_int_of_lint(ats_lint_type) ;
extern ats_void_type lexing_lexbuf_markroot() ;

/* internal function declarations */

static ats_void_type _free_14 (ats_ptr_type env0) ;
static ats_void_type _free_14_clofun (ats_clo_ptr_type clo) ;
static ats_clo_ptr_type _free_14_clo_make (ats_ptr_type env0) ;

static ats_int_type _getc_15 (ats_ptr_type env0, ats_size_type env1, ats_ptr_type env2) ;
static ats_int_type _getc_15_clofun (ats_clo_ptr_type clo) ;
static ats_clo_ptr_type _getc_15_clo_make (ats_ptr_type env0, ats_size_type env1, ats_ptr_type env2) ;

static ats_void_type _free_17 (ats_ptr_type env0) ;
static ats_void_type _free_17_clofun (ats_clo_ptr_type clo) ;
static ats_clo_ptr_type _free_17_clo_make (ats_ptr_type env0) ;

static ats_int_type _getc_18 (ats_ptr_type env0) ;
static ats_int_type _getc_18_clofun (ats_clo_ptr_type clo) ;
static ats_clo_ptr_type _getc_18_clo_make (ats_ptr_type env0) ;

static ats_void_type _free_20 () ;
static ats_void_type _free_20_clofun (ats_clo_ptr_type clo) ;
static ats_clo_ptr_type _free_20_clo_make () ;

static ats_int_type _getc_21 () ;
static ats_int_type _getc_21_clofun (ats_clo_ptr_type clo) ;
static ats_clo_ptr_type _getc_21_clo_make () ;

static ats_int_type aux_23 (ats_ptr_type env0, ats_ptr_type env1, ats_ref_type arg0, ats_ref_type arg1, ats_int_type arg2) ;
static ats_int_type aux_23_clofun (ats_clo_ptr_type clo, ats_ref_type arg0, ats_ref_type arg1, ats_int_type arg2) ;
static ats_clo_ptr_type aux_23_clo_make (ats_ptr_type env0, ats_ptr_type env1) ;

/* sum constructor declarations */

/* exception constructor declarations */

ATSglobal(ats_exn_type, _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__LexingErrorException) ;

/* global dynamic constant declarations */

/* static temporary variable declarations */

ATSstatic_void(tmp111) ;

/* function implementations */

ats_int_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__position_line (ats_ptr_type arg0) {
ATSlocal(ats_int_type, tmp0) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__position_line:
tmp0 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_line ;
return tmp0 ;
} /* fun */

ats_int_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__position_loff (ats_ptr_type arg0) {
ATSlocal(ats_int_type, tmp1) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__position_loff:
tmp1 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_loff ;
return tmp1 ;
} /* fun */

ats_lint_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__position_toff (ats_ptr_type arg0) {
ATSlocal(ats_lint_type, tmp2) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__position_toff:
tmp2 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_toff ;
return tmp2 ;
} /* fun */

ats_bool_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__lt_position_position (ats_ptr_type arg0, ats_ptr_type arg1) {
ATSlocal(ats_bool_type, tmp3) ;
ATSlocal(ats_lint_type, tmp4) ;
ATSlocal(ats_lint_type, tmp5) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__lt_position_position:
tmp4 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_toff ;
tmp5 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_toff ;
tmp3 = atspre_lt_lint_lint (tmp4, tmp5) ;
return tmp3 ;
} /* fun */

ats_bool_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__lte_position_position (ats_ptr_type arg0, ats_ptr_type arg1) {
ATSlocal(ats_bool_type, tmp6) ;
ATSlocal(ats_lint_type, tmp7) ;
ATSlocal(ats_lint_type, tmp8) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__lte_position_position:
tmp7 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_toff ;
tmp8 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_toff ;
tmp6 = atspre_lte_lint_lint (tmp7, tmp8) ;
return tmp6 ;
} /* fun */

ats_bool_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__eq_position_position (ats_ptr_type arg0, ats_ptr_type arg1) {
ATSlocal(ats_bool_type, tmp9) ;
ATSlocal(ats_lint_type, tmp10) ;
ATSlocal(ats_lint_type, tmp11) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__eq_position_position:
tmp10 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_toff ;
tmp11 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_toff ;
tmp9 = atspre_eq_lint_lint (tmp10, tmp11) ;
return tmp9 ;
} /* fun */

ats_bool_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__neq_position_position (ats_ptr_type arg0, ats_ptr_type arg1) {
ATSlocal(ats_bool_type, tmp12) ;
ATSlocal(ats_lint_type, tmp13) ;
ATSlocal(ats_lint_type, tmp14) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__neq_position_position:
tmp13 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg0)->atslab_toff ;
tmp14 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_toff ;
tmp12 = atspre_neq_lint_lint (tmp13, tmp14) ;
return tmp12 ;
} /* fun */

ats_ptr_type
position_make_int_int_lint (ats_int_type arg0, ats_int_type arg1, ats_lint_type arg2) {
ATSlocal(ats_ptr_type, tmp15) ;
__ats_lab_position_make_int_int_lint:
tmp15 = ATS_MALLOC(sizeof(_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0)) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)tmp15)->atslab_line = arg0 ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)tmp15)->atslab_loff = arg1 ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)tmp15)->atslab_toff = arg2 ;

return tmp15 ;
} /* fun */

ats_void_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__fprint_position (ats_ref_type arg0, ats_ptr_type arg1) {
ATSlocal_void(tmp16) ;
ATSlocal(ats_lint_type, tmp17) ;
ATSlocal(ats_lint_type, tmp18) ;
ATSlocal(ats_int_type, tmp19) ;
ATSlocal(ats_int_type, tmp20) ;
ATSlocal(ats_int_type, tmp21) ;
ATSlocal(ats_int_type, tmp22) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__fprint_position:
tmp18 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_toff ;
tmp17 = atspre_add_lint_lint (tmp18, 1) ;
tmp20 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_line ;
tmp19 = atspre_add_int_int (tmp20, 1) ;
tmp22 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_0*)arg1)->atslab_loff ;
tmp21 = atspre_add_int_int (tmp22, 1) ;
/* tmp16 = */ atspre_fprintf_exn (arg0, "%li(line=%i, offs=%i)", tmp17, tmp19, tmp21) ;
return ;
} /* fun */

ats_void_type
lexing_print_position (ats_ptr_type arg0) {
ATSlocal_void(tmp23) ;
ATSlocal(ats_ptr_type, tmp24) ;
ATSlocal(ats_ptr_type, tmp25) ;
ATSlocal_void(tmp26) ;
__ats_lab_lexing_print_position:
tmp24 = atspre_stdout_get () ;
tmp25 = (tmp24) ;
/* tmp26 = */ _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__fprint_position (tmp25, arg0) ;
/* tmp23 = */ atspre_stdout_view_set () ;
return ;
} /* fun */

ats_void_type
lexing_prerr_position (ats_ptr_type arg0) {
ATSlocal_void(tmp27) ;
ATSlocal(ats_ptr_type, tmp28) ;
ATSlocal(ats_ptr_type, tmp29) ;
ATSlocal_void(tmp30) ;
__ats_lab_lexing_prerr_position:
tmp28 = atspre_stderr_get () ;
tmp29 = (tmp28) ;
/* tmp30 = */ _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__fprint_position (tmp29, arg0) ;
/* tmp27 = */ atspre_stderr_view_set () ;
return ;
} /* fun */

ats_void_type
lexing_infile_free (ats_ptr_type arg0) {
ATSlocal_void(tmp31) ;
ATSlocal(ats_ptr_type, tmp32) ;
__ats_lab_lexing_infile_free:
tmp32 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)arg0)->atslab_free ;
/* tmp31 = */ ((ats_void_type (*)(ats_clo_ptr_type))(ats_closure_fun(tmp32))) (tmp32) ;
return ;
} /* fun */

ats_int_type
lexing_infile_getc (ats_ptr_type arg0) {
ATSlocal(ats_int_type, tmp33) ;
ATSlocal(ats_ptr_type, tmp34) ;
__ats_lab_lexing_infile_getc:
tmp34 = ((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)arg0)->atslab_getc ;
tmp33 = ((ats_int_type (*)(ats_clo_ptr_type))(ats_closure_fun(tmp34))) (tmp34) ;
return tmp33 ;
} /* fun */

ats_ptr_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__infile_make_string (ats_ptr_type arg0) {
ATSlocal(ats_ptr_type, tmp35) ;
ATSlocal(ats_ptr_type, tmp36) ;
ATSlocal(ats_size_type, tmp37) ;
ATSlocal(ats_ptr_type, tmp38) ;
ATSlocal(ats_ptr_type, tmp39) ;
ATSlocal(ats_size_type, tmp49) ;
ATSlocal(ats_ptr_type, tmp50) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__infile_make_string:
tmp36 = atspre_castfn_ptr (arg0) ;
tmp37 = atspre_string_length (tmp36) ;
tmp38 = atspre_ptr_alloc_tsz (sizeof(ats_size_type)) ;
tmp39 = (tmp38) ;
tmp49 = atspre_size1_of_int1 (0) ;
*((ats_size_type*)tmp39) = tmp49 ;
tmp50 = ATS_MALLOC(sizeof(_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1)) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)tmp50)->atslab_free = (_free_14_clo_make (tmp39)) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)tmp50)->atslab_getc = (_getc_15_clo_make (tmp36, tmp37, tmp39)) ;

tmp35 = tmp50 ;
return tmp35 ;
} /* fun */

ats_void_type
_free_14 (ats_ptr_type env0) {
ATSlocal_void(tmp40) ;
__ats_lab__free_14:
/* tmp40 = */ atspre_ptr_free (env0) ;
return ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
ats_ptr_type closure_env_0 ;
} _free_14_clo_type ;

ats_clo_ptr_type
_free_14_clo_make (ats_ptr_type env0) {
_free_14_clo_type *p = ATS_MALLOC(sizeof(_free_14_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&_free_14_clofun ;
p->closure_env_0 = env0 ;
return (ats_clo_ptr_type)p ;
}

ats_void_type
_free_14_clofun (ats_clo_ptr_type clo) {
_free_14 (((_free_14_clo_type *)clo)->closure_env_0) ; return ;
}

ats_int_type
_getc_15 (ats_ptr_type env0, ats_size_type env1, ats_ptr_type env2) {
ATSlocal(ats_int_type, tmp41) ;
ATSlocal(ats_size_type, tmp42) ;
ATSlocal(ats_bool_type, tmp43) ;
ATSlocal(ats_size_type, tmp46) ;
ATSlocal(ats_char_type, tmp47) ;
__ats_lab__getc_15:
tmp42 = *((ats_size_type*)env2) ;
tmp43 = atspre_lt_size1_size1 (tmp42, env1) ;
if (tmp43) {
tmp46 = atspre_add_size1_int1 (tmp42, 1) ;
*((ats_size_type*)env2) = tmp46 ;
tmp47 = atspre_string_get_char_at (env0, tmp42) ;
tmp41 = atspre_int_of_char (tmp47) ;
} else {
tmp41 = -1 ;
} /* if */
return tmp41 ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
ats_ptr_type closure_env_0 ;
ats_size_type closure_env_1 ;
ats_ptr_type closure_env_2 ;
} _getc_15_clo_type ;

ats_clo_ptr_type
_getc_15_clo_make (ats_ptr_type env0, ats_size_type env1, ats_ptr_type env2) {
_getc_15_clo_type *p = ATS_MALLOC(sizeof(_getc_15_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&_getc_15_clofun ;
p->closure_env_0 = env0 ;
p->closure_env_1 = env1 ;
p->closure_env_2 = env2 ;
return (ats_clo_ptr_type)p ;
}

ats_int_type
_getc_15_clofun (ats_clo_ptr_type clo) {
return _getc_15 (((_getc_15_clo_type *)clo)->closure_env_0, ((_getc_15_clo_type *)clo)->closure_env_1, ((_getc_15_clo_type *)clo)->closure_env_2) ;
}

ats_ptr_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__infile_make_file (ats_ptr_type arg0) {
ATSlocal(ats_ptr_type, tmp51) ;
ATSlocal(ats_ptr_type, tmp54) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__infile_make_file:
tmp54 = ATS_MALLOC(sizeof(_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1)) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)tmp54)->atslab_free = (_free_17_clo_make (arg0)) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)tmp54)->atslab_getc = (_getc_18_clo_make (arg0)) ;

tmp51 = tmp54 ;
return tmp51 ;
} /* fun */

ats_void_type
_free_17 (ats_ptr_type env0) {
ATSlocal_void(tmp52) ;
__ats_lab__free_17:
/* tmp52 = */ atslib_fclose_exn (env0) ;
return ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
ats_ptr_type closure_env_0 ;
} _free_17_clo_type ;

ats_clo_ptr_type
_free_17_clo_make (ats_ptr_type env0) {
_free_17_clo_type *p = ATS_MALLOC(sizeof(_free_17_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&_free_17_clofun ;
p->closure_env_0 = env0 ;
return (ats_clo_ptr_type)p ;
}

ats_void_type
_free_17_clofun (ats_clo_ptr_type clo) {
_free_17 (((_free_17_clo_type *)clo)->closure_env_0) ; return ;
}

ats_int_type
_getc_18 (ats_ptr_type env0) {
ATSlocal(ats_int_type, tmp53) ;
__ats_lab__getc_18:
tmp53 = atslib_fgetc_err (env0) ;
return tmp53 ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
ats_ptr_type closure_env_0 ;
} _getc_18_clo_type ;

ats_clo_ptr_type
_getc_18_clo_make (ats_ptr_type env0) {
_getc_18_clo_type *p = ATS_MALLOC(sizeof(_getc_18_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&_getc_18_clofun ;
p->closure_env_0 = env0 ;
return (ats_clo_ptr_type)p ;
}

ats_int_type
_getc_18_clofun (ats_clo_ptr_type clo) {
return _getc_18 (((_getc_18_clo_type *)clo)->closure_env_0) ;
}

ats_ptr_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__infile_make_stdin () {
ATSlocal(ats_ptr_type, tmp55) ;
ATSlocal(ats_ptr_type, tmp58) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__infile_make_stdin:
tmp58 = ATS_MALLOC(sizeof(_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1)) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)tmp58)->atslab_free = (_free_20_clo_make ()) ;
((_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats_rec_1*)tmp58)->atslab_getc = (_getc_21_clo_make ()) ;

tmp55 = tmp58 ;
return tmp55 ;
} /* fun */

ats_void_type
_free_20 () {
ATSlocal_void(tmp56) ;
__ats_lab__free_20:
return ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
} _free_20_clo_type ;

ats_clo_ptr_type
_free_20_clo_make () {
_free_20_clo_type *p = ATS_MALLOC(sizeof(_free_20_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&_free_20_clofun ;
return (ats_clo_ptr_type)p ;
}

ats_void_type
_free_20_clofun (ats_clo_ptr_type clo) {
_free_20 () ; return ;
}

ats_int_type
_getc_21 () {
ATSlocal(ats_int_type, tmp57) ;
__ats_lab__getc_21:
tmp57 = atslib_getchar () ;
return tmp57 ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
} _getc_21_clo_type ;

ats_clo_ptr_type
_getc_21_clo_make () {
_getc_21_clo_type *p = ATS_MALLOC(sizeof(_getc_21_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&_getc_21_clofun ;
return (ats_clo_ptr_type)p ;
}

ats_int_type
_getc_21_clofun (ats_clo_ptr_type clo) {
return _getc_21 () ;
}

ats_int_type
lexing_engine_lexbuf (ats_ref_type arg0, ats_ptr_type arg1, ats_ptr_type arg2) {
ATSlocal(ats_int_type, tmp59) ;
ATSlocal(ats_int_type, tmp76) ;
ATSlocal_void(tmp77) ;
__ats_lab_lexing_engine_lexbuf:
tmp76 = 0 ;
/* tmp77 = */ lexbuf_fstpos_set (arg0) ;
tmp59 = aux_23 (arg1, arg2, arg0, (&tmp76), 1) ;
return tmp59 ;
} /* fun */

ats_int_type
aux_23 (ats_ptr_type env0, ats_ptr_type env1, ats_ref_type arg0, ats_ref_type arg1, ats_int_type arg2) {
ATSlocal(ats_int_type, tmp60) ;
ATSlocal(ats_bool_type, tmp61) ;
ATSlocal(ats_int_type, tmp63) ;
ATSlocal(ats_bool_type, tmp65) ;
ATSlocal_void(tmp67) ;
ATSlocal(ats_int_type, tmp69) ;
ATSlocal(ats_int_type, tmp70) ;
ATSlocal(ats_ref_type, tmp71) ;
ATSlocal(ats_ref_type, tmp72) ;
ATSlocal(ats_int_type, tmp73) ;
ATSlocal_void(tmp75) ;
__ats_lab_aux_23:
tmp61 = atspre_gt_int_int (arg2, 0) ;
if (tmp61) {
tmp63 = _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__accept_table_get (env1, arg2) ;
tmp65 = atspre_gt_int_int (tmp63, 0) ;
if (tmp65) {
/* tmp67 = */ lexbuf_lstpos_set (arg0) ;
*((ats_int_type*)arg1) = tmp63 ;
} else {
} /* if */
tmp69 = lexbuf_char_next (arg0) ;
tmp70 = _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__transition_table_get (env0, arg2, tmp69) ;
tmp71 = arg0 ;
tmp72 = arg1 ;
tmp73 = tmp70 ;
arg0 = tmp71 ;
arg1 = tmp72 ;
arg2 = tmp73 ;
goto __ats_lab_aux_23 ;
} else {
/* tmp75 = */ lexbuf_curpos_set (arg0) ;
tmp60 = *((ats_int_type*)arg1) ;
} /* if */
return tmp60 ;
} /* fun */

typedef struct {
ats_fun_ptr_type closure_fun ;
ats_ptr_type closure_env_0 ;
ats_ptr_type closure_env_1 ;
} aux_23_clo_type ;

ats_clo_ptr_type
aux_23_clo_make (ats_ptr_type env0, ats_ptr_type env1) {
aux_23_clo_type *p = ATS_MALLOC(sizeof(aux_23_clo_type)) ;
p->closure_fun = (ats_fun_ptr_type)&aux_23_clofun ;
p->closure_env_0 = env0 ;
p->closure_env_1 = env1 ;
return (ats_clo_ptr_type)p ;
}

ats_int_type
aux_23_clofun (ats_clo_ptr_type clo, ats_ref_type arg0, ats_ref_type arg1, ats_int_type arg2) {
return aux_23 (((aux_23_clo_type *)clo)->closure_env_0, ((aux_23_clo_type *)clo)->closure_env_1, arg0, arg1, arg2) ;
}

ats_int_type
lexing_engine (ats_ptr_type arg0, ats_ptr_type arg1) {
ATSlocal(ats_int_type, tmp78) ;
ATSlocal(ats_ptr_type, tmp79) ;
ATSlocal(ats_ptr_type, tmp80) ;
ATSlocal(ats_int_type, tmp81) ;
ATSlocal_void(tmp82) ;
__ats_lab_lexing_engine:
tmp79 = lexing_lexbuf_get () ;
tmp80 = (tmp79) ;
tmp81 = lexing_engine_lexbuf (tmp80, arg0, arg1) ;
/* tmp82 = */ lexing_lexbuf_set (tmp80) ;
tmp78 = tmp81 ;
return tmp78 ;
} /* fun */

ats_char_type
lexeme_get (ats_int_type arg0) {
ATSlocal(ats_char_type, tmp83) ;
ATSlocal(ats_ptr_type, tmp84) ;
ATSlocal(ats_ptr_type, tmp85) ;
ATSlocal(ats_char_type, tmp86) ;
ATSlocal_void(tmp87) ;
__ats_lab_lexeme_get:
tmp84 = lexing_lexbuf_get () ;
tmp85 = (tmp84) ;
tmp86 = lexeme_get_lexbuf (tmp85, arg0) ;
/* tmp87 = */ lexing_lexbuf_set (tmp85) ;
tmp83 = tmp86 ;
return tmp83 ;
} /* fun */

ats_void_type
lexeme_set (ats_int_type arg0, ats_char_type arg1) {
ATSlocal_void(tmp88) ;
ATSlocal(ats_ptr_type, tmp89) ;
ATSlocal(ats_ptr_type, tmp90) ;
ATSlocal_void(tmp91) ;
__ats_lab_lexeme_set:
tmp89 = lexing_lexbuf_get () ;
tmp90 = (tmp89) ;
/* tmp91 = */ lexeme_set_lexbuf (tmp90, arg0, arg1) ;
/* tmp88 = */ lexing_lexbuf_set (tmp90) ;
return ;
} /* fun */

ats_ptr_type
lexeme_string () {
ATSlocal(ats_ptr_type, tmp92) ;
ATSlocal(ats_ptr_type, tmp93) ;
ATSlocal(ats_ptr_type, tmp94) ;
ATSlocal(ats_ptr_type, tmp95) ;
ATSlocal_void(tmp96) ;
__ats_lab_lexeme_string:
tmp93 = lexing_lexbuf_get () ;
tmp94 = (tmp93) ;
tmp95 = lexeme_string_lexbuf (tmp94) ;
/* tmp96 = */ lexing_lexbuf_set (tmp94) ;
tmp92 = tmp95 ;
return tmp92 ;
} /* fun */

ats_lint_type
lexeme_lint (ats_int_type arg0) {
ATSlocal(ats_lint_type, tmp97) ;
ATSlocal(ats_ptr_type, tmp98) ;
ATSlocal(ats_ptr_type, tmp99) ;
ATSlocal(ats_lint_type, tmp100) ;
ATSlocal_void(tmp101) ;
__ats_lab_lexeme_lint:
tmp98 = lexing_lexbuf_get () ;
tmp99 = (tmp98) ;
tmp100 = lexeme_lint_lexbuf (tmp99, arg0) ;
/* tmp101 = */ lexing_lexbuf_set (tmp99) ;
tmp97 = tmp100 ;
return tmp97 ;
} /* fun */

ats_int_type
lexeme_int (ats_int_type arg0) {
ATSlocal(ats_int_type, tmp102) ;
ATSlocal(ats_lint_type, tmp103) ;
__ats_lab_lexeme_int:
tmp103 = lexeme_lint (arg0) ;
tmp102 = ats_int_of_lint (tmp103) ;
return tmp102 ;
} /* fun */

ats_bool_type
lexing_is_eof () {
ATSlocal(ats_bool_type, tmp104) ;
ATSlocal(ats_ptr_type, tmp105) ;
ATSlocal(ats_ptr_type, tmp106) ;
ATSlocal(ats_bool_type, tmp107) ;
ATSlocal_void(tmp108) ;
__ats_lab_lexing_is_eof:
tmp105 = lexing_lexbuf_get () ;
tmp106 = (tmp105) ;
tmp107 = lexbuf_is_eof (tmp106) ;
/* tmp108 = */ lexing_lexbuf_set (tmp106) ;
tmp104 = tmp107 ;
return tmp104 ;
} /* fun */

ats_var_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__lexing_error () {
ATSlocal_void(tmp109) ;
ATSlocal(ats_ptr_type, tmp110) ;
__ats_lab__2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__lexing_error:
tmp110 = (ats_sum_ptr_type)(&_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__LexingErrorException) ;

ats_raise_exn(tmp110) ;
return ;
} /* fun */

/* static load function */

extern ats_void_type
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__staload () ;
static int _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__staload_flag = 0 ;
ats_void_type _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__staload () {
if (_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__staload_flag) return ;
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__staload_flag = 1 ;
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__staload () ;
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__LexingErrorException.tag = ats_exception_con_tag_new () ;
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__LexingErrorException.name = "_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2esats__LexingErrorException" ;
}

/* dynamic load function */

extern int _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__dynload_flag ;
ats_void_type _2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__dynload () {
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__dynload_flag = 1 ;
_2fhome_2ffac2_2fhwxi_2fresearch_2fATS_2fIMPLEMENT_2fGeizella_2fAnairiats_2fsvn_2fats_2dlang_2fsrc_2flibats_lex_lexing_2edats__staload () ;
/* tmp111 = */ lexing_lexbuf_markroot () ;
}

/* external types */

/* external codes at mid */

/* external codes at bot */



typedef
struct {
  unsigned char *buf_ptr ;
  int buf_size ;
  ats_ptr_type infile ;
  int fstpos ;
  int fstpos_line ; // line number
  int fstpos_loff ; // line offset
  long int fstpos_toff ; // total offset
  int lstpos ;
  int lstpos_line ; // line number
  int lstpos_loff ; // line offset
  long int lstpos_toff ; // total offset
  int curpos ;
  int curpos_line ; // line number
  int curpos_loff ; // line offset
  long int curpos_toff ; // total offset
  int endpos ;
} lexbuf ;

//

ats_ptr_type
lexbuf_fstpos_get (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf *)lxbf0 ;
  return position_make_int_int_lint
    (lxbf->fstpos_line, lxbf->fstpos_loff, lxbf->fstpos_toff) ;
}

ats_void_type
lexbuf_fstpos_set (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf *)lxbf0 ;
  lxbf->fstpos = lxbf->curpos ;
  lxbf->fstpos_line = lxbf->curpos_line ;
  lxbf->fstpos_loff = lxbf->curpos_loff ;
  lxbf->fstpos_toff = lxbf->curpos_toff ;
  return ;
}

//

ats_ptr_type
lexbuf_lstpos_get (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf *)lxbf0 ;
  return position_make_int_int_lint
    (lxbf->lstpos_line, lxbf->lstpos_loff, lxbf->lstpos_toff) ;
}

ats_void_type
lexbuf_lstpos_set (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf *)lxbf0 ;
  lxbf->lstpos = lxbf->curpos ;
  lxbf->lstpos_line = lxbf->curpos_line ;
  lxbf->lstpos_loff = lxbf->curpos_loff ;
  lxbf->lstpos_toff = lxbf->curpos_toff ;
  return ;
}

//

ats_ptr_type
lexbuf_curpos_get (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf *)lxbf0 ;
  return position_make_int_int_lint
    (lxbf->curpos_line, lxbf->curpos_loff, lxbf->curpos_toff) ;
}

ats_void_type
lexbuf_curpos_set (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf *)lxbf0 ;
  lxbf->curpos = lxbf->lstpos ;
  lxbf->curpos_line = lxbf->lstpos_line ;
  lxbf->curpos_loff = lxbf->lstpos_loff ;
  lxbf->curpos_toff = lxbf->lstpos_toff ;
  return ;
}

//

ats_int_type
lexbuf_size_get (ats_ptr_type lxbf0) {
  int sz ; lexbuf *lxbf ;
  lxbf = (lexbuf *)lxbf0;
  sz = lxbf->lstpos - lxbf->fstpos ;
  if (sz < 0) { sz += lxbf->buf_size ; }
  return sz ;
}

/* ****** ****** */

#define BUF_SIZE 1024
#define BUF_RESIZE 256

/* ****** ****** */

ats_void_type
lexbuf_resize
  (lexbuf *lxbf) {
  int fstpos, curpos, lstpos, endpos ;
  int buf_size, buf_size_new ;
  unsigned char *buf_ptr, *buf_ptr_new;
/*
  fprintf (stdout, "lexbuf_resize: before: buf_size = %i\n", lxbf->buf_size) ;
  fprintf (stdout, "lexbuf_resize: before: fstpos = %i\n", lxbf->fstpos) ;
  fprintf (stdout, "lexbuf_resize: before: curpos = %i\n", lxbf->curpos) ;
  fprintf (stdout, "lexbuf_resize: before: lstpos = %i\n", lxbf->lstpos) ;
  fprintf (stdout, "lexbuf_resize: before: endpos = %i\n", lxbf->endpos) ;
*/
  buf_ptr = lxbf->buf_ptr ;
  buf_size = lxbf->buf_size ;
  fstpos = lxbf->fstpos ;
  endpos = lxbf->endpos ;

  buf_size_new = buf_size + buf_size ;
  buf_ptr_new = ATS_MALLOC (buf_size_new) ;

  lxbf->buf_ptr = buf_ptr_new ;
  lxbf->buf_size = buf_size_new ;

  lxbf->fstpos = 0 ;

  if (fstpos <= endpos) {
    memcpy(buf_ptr_new, buf_ptr+fstpos, endpos-fstpos) ;
    lxbf->endpos = endpos - fstpos ;
  } else {
    memcpy(buf_ptr_new, buf_ptr+fstpos, buf_size-fstpos) ;
    memcpy(buf_ptr_new+buf_size-fstpos, buf_ptr, endpos) ;
    lxbf->endpos = buf_size + endpos - fstpos ;
  } // end of [if]

  curpos = lxbf->curpos ;

  if (fstpos <= curpos) {
    lxbf->curpos = curpos - fstpos ;
  } else {
    lxbf->curpos = buf_size + curpos - fstpos ;
  }

  lstpos = lxbf->lstpos ;

  if (fstpos <= lstpos) {
    lxbf->lstpos = lstpos - fstpos ;
  } else {
    lxbf->lstpos = buf_size + lstpos - fstpos ;
  } // end of [if]

/*
  fprintf (stdout, "lexbuf_resize: after: buf_size = %i\n", lxbf->buf_size) ;
  fprintf (stdout, "lexbuf_resize: after: fstpos = %i\n", lxbf->fstpos) ;
  fprintf (stdout, "lexbuf_resize: after: curpos = %i\n", lxbf->curpos) ;
  fprintf (stdout, "lexbuf_resize: after: lstpos = %i\n", lxbf->lstpos) ;
  fprintf (stdout, "lexbuf_resize: after: endpos = %i\n", lxbf->endpos) ;
*/

  ATS_FREE (buf_ptr) ;
} /* end of [lexbuf_resize] */

ats_void_type
lexbuf_resize_if
  (lexbuf *lxbf) {
  int fstpos, endpos ;

/*
  fprintf (stdout, "lexbuf_resize_if: buf_size = %i\n", lxbf->buf_size) ;
  fprintf (stdout, "lexbuf_resize_if: fstpos = %i\n", lxbf->fstpos) ;
  fprintf (stdout, "lexbuf_resize_if: curpos = %i\n", lxbf->curpos) ;
  fprintf (stdout, "lexbuf_resize_if: lstpos = %i\n", lxbf->lstpos) ;
  fprintf (stdout, "lexbuf_resize_if: endpos = %i\n", lxbf->endpos) ;
*/

  fstpos = lxbf->fstpos ;
  endpos = lxbf->endpos ;

  if (fstpos <= endpos) {
    if (endpos - fstpos + BUF_RESIZE > lxbf->buf_size) {
      lexbuf_resize(lxbf) ;
    }
  } else {
    if (endpos + BUF_RESIZE >= fstpos) {
      lexbuf_resize (lxbf) ;
    }
  }
  return ;
} /* end of [lexbuf_resize_if] */

ats_void_type
lexbuf_refill (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf ;
  unsigned char *buf_ptr ;
  int c, fstpos, curpos, endpos ;

  lxbf = (lexbuf*)lxbf0 ;

  lexbuf_resize_if (lxbf) ;

  buf_ptr = lxbf->buf_ptr ;
  fstpos = lxbf->fstpos ;
  endpos = lxbf->endpos ;
/*
  fprintf (stdout, "lexbuf_refill: fstpos = %i\n", fstpos) ;
  fprintf (stdout, "lexbuf_refill: endpos = %i\n", endpos) ;
*/
  if (fstpos <= endpos) {
    while (endpos+1 < lxbf->buf_size) {
      c = lexing_infile_getc (lxbf->infile) ;
      if (c < 0) { lxbf->endpos = endpos ; return ; }
      buf_ptr[endpos] = c; ++endpos ;
    }

    if (fstpos == 0) { lxbf->endpos = endpos ; return ; }

    c = lexing_infile_getc (lxbf->infile) ;
    if (c < 0) { lxbf->endpos = endpos ; return ; }
    buf_ptr[endpos] = c; endpos = 0;
  } /* end of [if] */

  while (endpos+1 < fstpos) {
    c = lexing_infile_getc (lxbf->infile) ;
    if (c < 0) { lxbf->endpos = endpos ; return ; }
    buf_ptr[endpos] = c; ++endpos ;
  } /* end of [while] */

  lxbf->endpos = endpos ;
  return ;
} /* end of [lexbuf_refill] */

/* ****** ****** */

ats_void_type
lexbuf_curpos_next (
  lexbuf *lxbf, int c
) {
  int curpos1 = lxbf->curpos + 1 ;

  if (curpos1 < lxbf->buf_size) {
    lxbf->curpos = curpos1;
  } else {
    lxbf->curpos = 0;
  }

  if (c == '\n') {
    lxbf->curpos_line += 1; lxbf->curpos_loff = 0; lxbf->curpos_toff += 1 ;
  } else {
    lxbf->curpos_loff += 1 ; lxbf->curpos_toff += 1 ;
  }
  return ;
} /* end of [lexbuf_curpos_next] */

/* ****** ****** */

ats_int_type
lexbuf_char_next (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf ;
  unsigned char *buf_ptr ;
  int c, fstpos, curpos, endpos ;

  lxbf = (lexbuf*)lxbf0 ;

  buf_ptr = lxbf->buf_ptr ;
  curpos = lxbf->curpos ;
  endpos = lxbf->endpos ;

  if (curpos != endpos) {
    c = buf_ptr[curpos] ; lexbuf_curpos_next (lxbf, c); return c ;
  }

  lexbuf_refill (lxbf0) ;

  buf_ptr = lxbf->buf_ptr ;
  curpos = lxbf->curpos ;
  endpos = lxbf->endpos ;
/*
  fprintf (stdout, "lexbuf_char_next: refill: curpos = %i\n", curpos);
  fprintf (stdout, "lexbuf_char_next: refill: endpos = %i\n", endpos);
*/
  if (curpos != endpos) {
    c = buf_ptr[curpos] ; lexbuf_curpos_next (lxbf, c); return c ;
  }
  return -1 ; /* [-1] represents a special character */
} /* end of [lexbuf_char_next] */

/* ****** ****** */

ats_bool_type
lexbuf_is_eof (
  ats_ptr_type lxbf0
) {
  lexbuf *lxbf = (lexbuf*)lxbf0 ;

  if (lxbf->curpos != lxbf->endpos) return ats_false_bool ;

  lexbuf_refill (lxbf0) ;  

  if (lxbf->curpos != lxbf->endpos) {
    return ats_false_bool ;
  } else {
    return ats_true_bool ;
  } /* end of [if] */
} /* end of [lexbuf_is_eof] */

/* ****** ****** */

ats_ptr_type
lexing_fstpos_get () {
  ats_ptr_type pos ; lexbuf *lxbf ;
  lxbf = (lexbuf *)(lexing_lexbuf_get()) ;
  pos = lexbuf_fstpos_get (lxbf) ;
  lexing_lexbuf_set(lxbf) ;
  return pos;
}

ats_ptr_type
lexing_lstpos_get () {
  ats_ptr_type pos ; lexbuf *lxbf ;
  lxbf = (lexbuf *)(lexing_lexbuf_get()) ;
  pos = lexbuf_lstpos_get (lxbf) ;
  lexing_lexbuf_set(lxbf) ;
  return pos;
}

ats_ptr_type
lexing_curpos_get () {
  ats_ptr_type pos ; lexbuf *lxbf ;
  lxbf = (lexbuf *)(lexing_lexbuf_get()) ;
  pos = lexbuf_curpos_get (lxbf) ;
  lexing_lexbuf_set(lxbf) ;
  return pos;
}

/* ****** ****** */

ats_void_type
lexbuf_curpos_fprint (
  ats_ptr_type fil, lexbuf *lxbf
) {
  fprintf ((FILE *)fil, "%li(line=%i, offset=%i)",
    lxbf->curpos_toff+1, lxbf->curpos_line+1, lxbf->curpos_loff+1
  ) ;
  return ;
} /* end of [lexbuf_curpos_fprint] */

ats_void_type
lexing_curpos_prerr () {
  lexbuf *lxbf ;
  lxbf = (lexbuf *)(lexing_lexbuf_get()) ;
  lexbuf_curpos_fprint (stderr, lxbf) ;
  lexing_lexbuf_set(lxbf) ;
  return ;
}

/* ****** ****** */

ats_ptr_type
lexbuf_make_infile (
  ats_ptr_type infile
) {
  lexbuf *lxbf ;
  unsigned char *buf_ptr ;

  buf_ptr = ATS_MALLOC (BUF_SIZE) ;
  lxbf = ATS_MALLOC (sizeof(lexbuf)) ;
  lxbf->buf_ptr = buf_ptr ;
  lxbf->buf_size = BUF_SIZE ;
  lxbf->infile = infile ;

  lxbf->fstpos = 0 ;
  lxbf->fstpos_line = 0 ;
  lxbf->fstpos_loff = 0 ;
  lxbf->fstpos_toff = 0 ;

  lxbf->lstpos = 0 ;
  lxbf->lstpos_line = 0 ;
  lxbf->lstpos_loff = 0 ;
  lxbf->lstpos_toff = 0 ;

  lxbf->curpos = 0 ;
  lxbf->curpos_line = 0 ;
  lxbf->curpos_loff = 0 ;
  lxbf->curpos_toff = 0 ;

  lxbf->endpos = 0 ;
/*
  printf ("lexbuf_make_infile: lxbf = %p\n", lxbf) ;
*/
  return lxbf ;
} /* end of [lexbuf_make_infile] */

ats_void_type
lexbuf_free (ats_ptr_type lxbf0) {
  lexbuf *lxbf ;
  lxbf = (lexbuf*)lxbf0 ;

  lexing_infile_free (lxbf->infile) ;
  ATS_FREE (lxbf->buf_ptr) ;
  return ;
}

/* ****** ****** */

ats_char_type
lexeme_get_lexbuf (ats_ptr_type lxbf0, ats_int_type i) {
  int len, fstpos, lstpos, bufsz ;
  lexbuf *lxbf ;

  if (i < 0) {
    ats_exit_errmsg (
      1, "lexeme_get_lexbuf: index is out_of_bounds.\n"
    ) ;
  } /* end of [if] */

  lxbf = (lexbuf*)lxbf0 ;

  fstpos = lxbf->fstpos ;
  lstpos = lxbf->lstpos ;
  len = lstpos - fstpos ;
  bufsz = lxbf->buf_size ;
  if (len < 0) { len += bufsz ; }

  if (i > len) {
    ats_exit_errmsg (
      1, "lexeme_get_lexbuf: index is out_of_bounds.\n"
    ) ;
  } /* end of [if] */

  i = fstpos + i ;
  if (i >= bufsz) { i -= bufsz ; }

  return *((lxbf->buf_ptr) + i) ;
}

ats_void_type
lexeme_set_lexbuf (
  ats_ptr_type lxbf0
, ats_int_type i, ats_char_type c
) {
  int len, fstpos, lstpos, bufsz ;
  lexbuf *lxbf ;

  if (i < 0) { ats_exit_errmsg (
      1, (ats_ptr_type)"lexeme_set_lexbuf: index is out_of_bounds.\n"
    ) ;
  } /* end of [if] */

  lxbf = (lexbuf*)lxbf0 ;

  fstpos = lxbf->fstpos ;
  lstpos = lxbf->lstpos ;
  len = lstpos - fstpos ;
  bufsz = lxbf->buf_size ;
  if (len < 0) { len += bufsz ; }

  if (i > len) { ats_exit_errmsg (
      1, (ats_ptr_type)"lexeme_set_lexbuf: index is out_of_bounds.\n"
    ) ;
  } /* end of [if] */

  i = fstpos + i ; if (i >= bufsz) { i -= bufsz ; }

  *((lxbf->buf_ptr) + i) = c ;

  return ;
} /* end of [lexeme_set_lexbuf] */

/* ****** ****** */

ats_ptr_type
lexeme_string_lexbuf
  (ats_ptr_type lxbf0) {
  int len, fstpos, lstpos ;
  char *src, *dst0, *dst ;
  lexbuf *lxbf ;

  lxbf = (lexbuf*)lxbf0 ;
  fstpos = lxbf->fstpos ;
  lstpos = lxbf->lstpos ;
  len = lstpos - fstpos ;
  if (len < 0) { len += lxbf->buf_size ; }

  src = (lxbf->buf_ptr) + fstpos ;
  dst0 = ATS_MALLOC ((len + 1) * sizeof(char)) ;
  dst = dst0 ;

  if (lstpos < fstpos) {
    while (fstpos < lxbf->buf_size) {
      *dst = *src ; ++fstpos ; ++src ; ++dst ;
    }
    fstpos = 0 ; src = lxbf->buf_ptr ;
  } // end of [if]

  while (fstpos < lstpos) {
    *dst = *src ; ++fstpos ; ++src ; ++dst ;
  } // end of [while]

  *dst = '\000' ;

  return dst0 ;
} /* end of [lexeme_string_lexbuf] */

/* ****** ****** */

ats_lint_type
lexeme_lint_lexbuf (
  ats_ptr_type lxbf0
, ats_int_type base
) {
  int fstpos ; lexbuf *lxbf ;
  lxbf = (lexbuf*)lxbf0 ;
  fstpos = lxbf->fstpos ;
  return strtol ((lxbf->buf_ptr) + fstpos, (char**)0, base) ;
} /* end of [lexeme_lint_lexbuf] */

/* ****** ****** */

static ats_ptr_type the_lexbuf = (lexbuf*)0 ;

ats_void_type lexing_lexbuf_markroot () {
  ATS_GC_MARKROOT (&the_lexbuf, sizeof(ats_ptr_type)) ;
  return ;
}

static ats_int_type the_lexbuf_flag = 0 ;

ats_ptr_type lexing_lexbuf_get() {
  if (the_lexbuf_flag == 0) {
    ats_exit_errmsg (
      1, "[lexeme_get] failed: The default lexbuf is not set!\n"
    );
  }
  the_lexbuf_flag = 0 ;
  return the_lexbuf ;
}

ats_void_type
lexing_lexbuf_set(ats_ptr_type lxbf) {
  if (the_lexbuf_flag == 1) {
    ats_exit_errmsg (
      1, "[lexeme_set] failed: The default lexbuf is already set!\n"
    );
  }
  the_lexbuf_flag = 1 ;
  the_lexbuf = lxbf ;
/*
  printf ("lexing_lexbuf_set: lxbf = %p\n", lxbf) ;
*/
  return ;
}

ats_void_type lexing_lexbuf_free () {
  lexbuf_free (lexing_lexbuf_get ()) ; return ;
}


