<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">//
</span><span class="comment">// BU CAS CS 520: Principles of Programing Languages
</span><span class="comment">// Semester: Fall 2005
</span><span class="comment">//
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">//
</span><span class="comment">// Some programming examples in System F
</span><span class="comment">// By Hongwei Xi (November 2, 2005)
</span>
<span class="comment">//
</span><span class="comment">// HX-2010-08-12:
</span><span class="comment">// This code is updated to compile and run under ATS-0.2.1. Voila!
</span><span class="comment">//
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">//
</span><span class="comment">// Implementing Church numerals in System F
</span><span class="comment">//
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="357"><span class="stacstdec">nat_f <span class="keyword">=</span>
  <span class="keyword">{</span>X<span class="keyword">:</span>type<span class="keyword">}</span> <span class="keyword">(</span>X <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X</span></a></span>
<span class="comment">// end of [nat_f]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> pair_get_fst <span class="staexp"><span class="keyword">{</span>X<span class="keyword">,</span>Y<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">'(</span>x<span class="keyword">:</span> <span class="staexp">X</span><span class="keyword">,</span> _<span class="keyword">:</span> <span class="staexp">Y</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">X</span> <span class="keyword">=</span> x
<span class="keyword">fn</span> pair_get_snd <span class="staexp"><span class="keyword">{</span>X<span class="keyword">,</span>Y<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">'(</span>_<span class="keyword">:</span> <span class="staexp">X</span><span class="keyword">,</span> y<span class="keyword">:</span> <span class="staexp">Y</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">Y</span> <span class="keyword">=</span> y

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="586"><span class="stacstdec">int <span class="keyword">=</span> uintptr</span></a></span>
<span class="keyword">val</span> _0 <span class="keyword">=</span> uintptr_of_uint <span class="keyword">(</span>0U<span class="keyword">)</span>
<span class="keyword">val</span> _1 <span class="keyword">=</span> uintptr_of_uint <span class="keyword">(</span>1U<span class="keyword">)</span>
<span class="keyword">#define</span> <span class="neuexp">isucc succ_uintptr</span>
<span class="keyword">fun</span> print_nat_f <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> print <span class="keyword">(</span>n <span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">lam</span> x <span class="keyword">=&gt;</span> isucc x<span class="keyword">)</span> <span class="keyword">(</span>_0<span class="keyword">)</span><span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> Z <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">lam</span> s <span class="keyword">=&gt;</span> <span class="keyword">lam</span> z <span class="keyword">=&gt;</span> z<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">nat_f</span>
<span class="keyword">val</span> S <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">nat_f</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">lam</span> s <span class="keyword">=&gt;</span> <span class="keyword">lam</span> z <span class="keyword">=&gt;</span> n<span class="keyword">(</span>s<span class="keyword">)</span><span class="keyword">(</span>s<span class="keyword">(</span>z<span class="keyword">)</span><span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> zero <span class="keyword">=</span> Z
<span class="keyword">val</span> one <span class="keyword">=</span> S<span class="keyword">(</span>zero<span class="keyword">)</span>
<span class="keyword">val</span> two <span class="keyword">=</span> S<span class="keyword">(</span>one<span class="keyword">)</span>
<span class="keyword">val</span> three <span class="keyword">=</span> S<span class="keyword">(</span>two<span class="keyword">)</span>
<span class="keyword">val</span> four <span class="keyword">=</span> S<span class="keyword">(</span>three<span class="keyword">)</span>
<span class="keyword">val</span> five <span class="keyword">=</span> S<span class="keyword">(</span>four<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> add <span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">nat_f</span> <span class="keyword">=</span> m <span class="keyword">(</span>S<span class="keyword">)</span> <span class="keyword">(</span>n<span class="keyword">)</span>
<span class="keyword">fn</span> mul <span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">nat_f</span> <span class="keyword">=</span> m <span class="staexp"><span class="keyword">{</span>nat_f<span class="keyword">}</span></span> <span class="keyword">(</span>n S<span class="keyword">)</span> <span class="keyword">(</span>Z<span class="keyword">)</span>
<span class="keyword">fn</span> pow <span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">nat_f</span> <span class="keyword">=</span> n <span class="staexp"><span class="keyword">{</span>nat_f<span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span>nat_f<span class="keyword">}</span></span> <span class="keyword">(</span>m <span class="staexp"><span class="keyword">{</span>nat_f<span class="keyword">}</span></span><span class="keyword">)</span> <span class="keyword">(</span>S<span class="keyword">)</span> <span class="keyword">(</span>Z<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "pow (3, 5) = "<span class="keyword">;</span>
  print_nat_f <span class="keyword">(</span>pow <span class="keyword">(</span>three<span class="keyword">,</span> five<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> pred <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">nat_f</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> z <span class="keyword">=</span> <span class="keyword">'(</span>zero<span class="keyword">,</span> zero<span class="keyword">)</span>
  <span class="keyword">val</span> s <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">'(</span>n1<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">,</span> n2<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">'(</span>nat_f<span class="keyword">,</span> nat_f<span class="keyword">)</span></span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">'(</span>S n1<span class="keyword">,</span> n1<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">'(</span>_<span class="keyword">,</span> res<span class="keyword">)</span> <span class="keyword">=</span> n <span class="staexp"><span class="keyword">{</span><span class="keyword">'(</span>nat_f<span class="keyword">,</span> nat_f<span class="keyword">)</span><span class="keyword">}</span></span> s z
<span class="keyword">in</span>
   res
<span class="keyword">end</span> <span class="comment">// end of [pred]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> fact <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">nat_f</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="1670"><span class="stacstdec">X <span class="keyword">=</span> <span class="keyword">'(</span>nat_f<span class="keyword">,</span> nat_f<span class="keyword">)</span></span></a></span>
  <span class="keyword">val</span> z<span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=</span> <span class="keyword">'(</span>one<span class="keyword">,</span> one<span class="keyword">)</span>
  <span class="keyword">val</span> s <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span><span class="keyword">'(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">'(</span>S x<span class="keyword">,</span> mul <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">in</span>
  pair_get_snd <span class="keyword">(</span>n <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">(</span>z<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fact]
</span>
<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "fact (5) = "<span class="keyword">;</span>
  print_nat_f <span class="keyword">(</span>fact five<span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="keyword">fun</span> fib <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">nat_f</span> <span class="keyword">=</span>
  <span class="keyword">let</span>
     <span class="keyword">typedef</span> <span class="staexp"><a name="1989"><span class="stacstdec">X <span class="keyword">=</span> <span class="keyword">'(</span>nat_f<span class="keyword">,</span> nat_f<span class="keyword">)</span></span></a></span>
     <span class="keyword">val</span> z<span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=</span> <span class="keyword">'(</span>zero<span class="keyword">,</span> one<span class="keyword">)</span>
     <span class="keyword">val</span> s <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span><span class="keyword">'(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">'(</span>y<span class="keyword">,</span> add <span class="keyword">(</span>x<span class="keyword">,</span> y<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">in</span>
     pair_get_fst <span class="keyword">(</span>n <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">(</span>z<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span>

<span class="keyword">val</span> _ <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "fib (10) = "<span class="keyword">;</span>
  print_nat_f <span class="keyword">(</span>fib <span class="keyword">(</span>add <span class="keyword">(</span>five<span class="keyword">,</span> five<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">fn</span> ack
  <span class="keyword">(</span>m<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">nat_f <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> nat_f</span> <span class="keyword">=</span>
<span class="keyword">let</span>
  <span class="keyword">val</span> helper <span class="keyword">=</span>
    <span class="keyword">lam</span> <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp">nat_f <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> nat_f</span><span class="keyword">)</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span>
    <span class="keyword">lam</span> <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">nat_f</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">nat_f</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> f <span class="keyword">(</span>n <span class="staexp"><span class="keyword">{</span>nat_f<span class="keyword">}</span></span> <span class="keyword">(</span>f<span class="keyword">)</span> <span class="keyword">(</span>one<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">in</span>
  m <span class="staexp"><span class="keyword">{</span>nat_f <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> nat_f<span class="keyword">}</span></span> helper <span class="keyword">(</span>S<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [ack]
</span>
<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "ack (3, 5) = "<span class="keyword">;</span>
  print_nat_f <span class="keyword">(</span>ack three five<span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// Implementing Lists in System F
</span><span class="comment">//
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2674"><span class="stacstdec">list_f <span class="keyword">(</span>A<span class="keyword">:</span> type<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">{</span>X<span class="keyword">:</span>type<span class="keyword">}</span> <span class="keyword">(</span>X<span class="keyword">,</span> <span class="keyword">(</span>A<span class="keyword">,</span> X<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> X<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> X</span></a></span>
<span class="comment">// endof [[list_f]
</span>
<span class="keyword">val</span> Nil <span class="keyword">=</span> <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span><span class="keyword">:</span> <span class="staexp">list_f <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">=&gt;</span> <span class="keyword">lam</span> <span class="keyword">(</span>n<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=&gt;</span> n
<span class="keyword">val</span> Cons <span class="keyword">=</span>
  <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">A</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_f A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_f A</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">lam</span> <span class="keyword">(</span>n<span class="keyword">,</span> c<span class="keyword">)</span> <span class="keyword">=&gt;</span> c <span class="keyword">(</span>x<span class="keyword">,</span> xs <span class="keyword">(</span>n<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [Cons]
</span>
<span class="keyword">val</span> list_length <span class="keyword">=</span>
  <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_f A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> nil <span class="keyword">=</span> _0
    <span class="keyword">val</span> cons <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">A</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> succ i
  <span class="keyword">in</span>
    xs <span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span> <span class="keyword">(</span>nil<span class="keyword">,</span> cons<span class="keyword">)</span>
  <span class="keyword">end</span>
<span class="comment">// end of [list_length]
</span>
<span class="keyword">val</span> list_append <span class="keyword">=</span>
  <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_f A</span><span class="keyword">,</span> ys<span class="keyword">:</span> <span class="staexp">list_f A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_f A</span> <span class="keyword">=&gt;</span> xs <span class="staexp"><span class="keyword">{</span>list_f A<span class="keyword">}</span></span> <span class="keyword">(</span>ys<span class="keyword">,</span> Cons<span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span><span class="keyword">)</span>
<span class="comment">// end of [list_append]
</span>
<span class="keyword">val</span> list_reverse <span class="keyword">=</span>
  <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span> <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_f A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_f A</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
     <span class="keyword">val</span> nil <span class="keyword">=</span> Nil <span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span>
     <span class="keyword">val</span> cons <span class="keyword">=</span>
       <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">A</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">list_f A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_f A</span> <span class="keyword">=&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> list_append <span class="keyword">(</span>xs<span class="keyword">,</span> Cons <span class="keyword">(</span>x<span class="keyword">,</span> Nil<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">in</span>
     xs <span class="staexp"><span class="keyword">{</span>list_f A<span class="keyword">}</span></span> <span class="keyword">(</span>nil<span class="keyword">,</span> cons<span class="keyword">)</span>
  <span class="keyword">end</span>
<span class="comment">// end of [list_reverse]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
// Please note that the above code make use of no recursion!
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">//
</span><span class="comment">// The following is some test code:
</span><span class="comment">//
</span>
<span class="comment">// condef :: = cons // HX: 2010-08-12: this is what it was
</span><span class="keyword">#define</span> <span class="neuexp">:: cons</span>
<span class="keyword">#define</span> <span class="neuexp">ipred pred_uintptr</span>

<span class="keyword">fun</span> gen_list_f <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp">Nat</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">list_f <span class="keyword">(</span>int<span class="keyword">)</span></span> <span class="keyword">=</span>
  <span class="keyword">if</span> i <span class="keyword">=</span> 0 <span class="keyword">then</span> Nil <span class="keyword">else</span> Cons <span class="keyword">(</span>uintptr_of_int1 i<span class="keyword">,</span> gen_list_f <span class="keyword">(</span>i - 1<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [gen_list_f]
</span>
<span class="keyword">typedef</span> <span class="staexp"><a name="3910"><span class="stacstdec">intlst <span class="keyword">=</span> list0 int</span></a></span>

<span class="keyword">fun</span> print_intlist <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">intlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">case</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> print_intlist_aux <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="comment">// end of [print_intlist]
</span>
<span class="keyword">and</span> print_intlist_aux <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">intlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">case</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>print x<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> list0_cons <span class="keyword">(</span>x'<span class="keyword">,</span> xs'<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>print x<span class="keyword">;</span> print_string ", "<span class="keyword">;</span> print_intlist_aux <span class="keyword">(</span>x'<span class="keyword">,</span> xs'<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [print_intlist_aux]
</span>
<span class="keyword">fn</span> print_list
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">list_f int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> nil <span class="keyword">=</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> cons <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">intlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">intlst</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> list0_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span>
<span class="keyword">in</span>
   print_intlist <span class="keyword">(</span>xs <span class="staexp"><span class="keyword">{</span>intlst<span class="keyword">}</span></span> <span class="keyword">(</span>nil<span class="keyword">,</span> cons<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [print_list]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> xs <span class="keyword">=</span> gen_list_f <span class="keyword">(</span>5<span class="keyword">)</span>
  <span class="keyword">val</span> xs' <span class="keyword">=</span> list_reverse xs
  <span class="keyword">val</span> xsxs <span class="keyword">=</span> list_append <span class="keyword">(</span>xs<span class="keyword">,</span> xs<span class="keyword">)</span>
  <span class="keyword">val</span> xsxs' <span class="keyword">=</span> list_reverse xsxs
<span class="keyword">in</span>
<span class="comment">//
</span>  print_string "xs = "<span class="keyword">;</span>
  print_list xs<span class="keyword">;</span>
  print_string "length (xs) = "<span class="keyword">;</span>
  print <span class="keyword">(</span>list_length xs<span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
<span class="comment">//
</span>  print_string "xs' = "<span class="keyword">;</span>
  print_list xs'<span class="keyword">;</span>
  print_string "list_length (xs') = "<span class="keyword">;</span>
  print <span class="keyword">(</span>list_length xs'<span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
<span class="comment">//
</span>  print_string "xsxs = "<span class="keyword">;</span>
  print_list xsxs<span class="keyword">;</span>
  print_string "length (xsxs) = "<span class="keyword">;</span>
  print <span class="keyword">(</span>list_length xsxs<span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
<span class="comment">//
</span>  print_string "xsxs' = "<span class="keyword">;</span>
  print_list xsxs'<span class="keyword">;</span>
  print_string "length (xsxs') = "<span class="keyword">;</span>
  print <span class="keyword">(</span>list_length xsxs'<span class="keyword">)</span><span class="keyword">;</span>
  print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">//
</span><span class="comment">// Implementing generic trees in System F
</span><span class="comment">//
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="5343"><span class="stacstdec">gtree <span class="keyword">(</span>A<span class="keyword">:</span> type<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">{</span>X<span class="keyword">:</span>type<span class="keyword">}</span> <span class="keyword">(</span>X<span class="keyword">,</span> <span class="keyword">(</span>A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X</span></a></span>

<span class="comment">// E: {A:type} gtree (A)
</span><span class="keyword">val</span> E <span class="keyword">=</span> <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span><span class="keyword">:</span> <span class="staexp">gtree <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">=&gt;</span> <span class="keyword">lam</span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span> <span class="keyword">=&gt;</span> e
<span class="keyword">val</span> B <span class="keyword">=</span> <span class="keyword">lam</span> <span class="staexp"><span class="keyword">{</span>A<span class="keyword">:</span>type<span class="keyword">}</span></span>
  <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp">A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> gtree A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">gtree <span class="keyword">(</span>A<span class="keyword">)</span></span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">lam</span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span> <span class="keyword">=&gt;</span> b <span class="keyword">(</span><span class="keyword">lam</span> x <span class="keyword">=&gt;</span> f <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [B]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="5647"><span class="stacstdec">A <span class="keyword">=</span> int</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="5663"><span class="stacstdec">btree <span class="keyword">=</span> gtree <span class="keyword">(</span>A<span class="keyword">)</span></span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> print_btree
  <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">btree</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="5753"><span class="stacstdec">X <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">-&lt;</span>cloref1<span class="keyword">&gt;</span> void</span></a></span>
  <span class="keyword">val</span> e <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">lam</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> print_string "E"<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span>
  <span class="keyword">val</span> b <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span>
    <span class="keyword">lam</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="comment">// 0/1: left/right
</span>      print_string "B("<span class="keyword">;</span> f <span class="keyword">(</span>_0<span class="keyword">)</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> print_string ", "<span class="keyword">;</span> f <span class="keyword">(</span>_1<span class="keyword">)</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> print_string ")"
    <span class="keyword">end</span> <span class="comment">(* end of [lam] *)</span>
  <span class="comment">// end of [b]
</span><span class="keyword">in</span>
   t <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [print_btree]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> btree_size <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">btree</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="6151"><span class="stacstdec">X <span class="keyword">=</span> int</span></a></span>
  <span class="keyword">val</span> e <span class="keyword">=</span> _0
  <span class="keyword">val</span> b <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> isucc <span class="keyword">(</span>f _1 + f _0<span class="keyword">)</span>
<span class="keyword">in</span>
  t <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [btree_size]
</span>
<span class="keyword">fn</span> btree_height <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">btree</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">int</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="6336"><span class="stacstdec">X <span class="keyword">=</span> int</span></a></span>
  <span class="keyword">val</span> e <span class="keyword">=</span> _0
  <span class="keyword">val</span> b <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> max <span class="keyword">(</span>f _1<span class="keyword">,</span> f _0<span class="keyword">)</span> + _1
<span class="keyword">in</span>
  t <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [btree_height]
</span>
<span class="keyword">fn</span> btree_isperfect <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">btree</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="6529"><span class="stacstdec">X <span class="keyword">=</span> Option int</span></a></span>
  <span class="keyword">val</span> e <span class="keyword">=</span> <span class="keyword">(</span>Some _0<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span>
  <span class="keyword">val</span> b <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp">A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span>
    <span class="keyword">case+</span> <span class="keyword">(</span>f _0<span class="keyword">,</span> f _1<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">(</span>Some h1<span class="keyword">,</span> Some h2<span class="keyword">)</span> <span class="keyword">=&gt;</span>
        <span class="keyword">if</span> h1 <span class="keyword">=</span> h2 <span class="keyword">then</span> Some <span class="keyword">(</span>isucc h1<span class="keyword">)</span> <span class="keyword">else</span> None
    <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> None
  <span class="comment">// end of [val]
</span><span class="keyword">in</span>
   <span class="keyword">case+</span> t <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span> <span class="keyword">of</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false <span class="keyword">|</span> Some _ <span class="keyword">=&gt;</span> true
<span class="keyword">end</span> <span class="comment">// end of [btree_isperfect]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> btree_left
  <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">btree</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">btree</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="6924"><span class="stacstdec">X <span class="keyword">=</span> <span class="keyword">'(</span>btree<span class="keyword">,</span> btree<span class="keyword">)</span></span></a></span>
  <span class="keyword">val</span> e <span class="keyword">=</span> <span class="keyword">'(</span>E<span class="keyword">,</span> E<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span>
  <span class="keyword">val</span> b <span class="keyword">=</span> <span class="keyword">lam</span>
    <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">'(</span>t1<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span>_1<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">'(</span>t2<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span>_0<span class="keyword">)</span>
    <span class="keyword">val</span> f1 <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">if</span> x <span class="keyword">&gt;</span> _0 <span class="keyword">then</span> t1 <span class="keyword">else</span> t2
  <span class="keyword">in</span>
    <span class="keyword">'(</span>B <span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span> <span class="keyword">(</span>f1<span class="keyword">)</span><span class="keyword">,</span> t2<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  pair_get_snd <span class="keyword">(</span>t <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [left_child_tree]
</span>
<span class="keyword">fn</span> btree_right
  <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">btree</span><span class="keyword">)</span><span class="keyword">:&lt;&gt;</span> <span class="staexp">btree</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="7305"><span class="stacstdec">X <span class="keyword">=</span> <span class="keyword">'(</span>btree<span class="keyword">,</span> btree<span class="keyword">)</span></span></a></span>
  <span class="keyword">val</span> e <span class="keyword">=</span> <span class="keyword">'(</span>E<span class="keyword">,</span> E<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span>
  <span class="keyword">val</span> b <span class="keyword">=</span> <span class="keyword">lam</span>
    <span class="keyword">(</span>f<span class="keyword">:</span> <span class="staexp"><span class="keyword">(</span>A <span class="keyword">-&lt;</span>cloref<span class="keyword">&gt;</span> X<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">X</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">'(</span>t1<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span>_1<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">'(</span>t2<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> f <span class="keyword">(</span>_0<span class="keyword">)</span>
    <span class="keyword">val</span> f1 <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">A</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">if</span> x <span class="keyword">&gt;</span> _0 <span class="keyword">then</span> t1 <span class="keyword">else</span> t2
  <span class="keyword">in</span>
    <span class="keyword">'(</span>B <span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span> <span class="keyword">(</span>f1<span class="keyword">)</span><span class="keyword">,</span> t1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  pair_get_snd <span class="keyword">(</span>t <span class="staexp"><span class="keyword">{</span>X<span class="keyword">}</span></span> <span class="keyword">(</span>e<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [right_child_tree]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> t0 <span class="keyword">=</span> E<span class="keyword">:</span> <span class="staexp">btree</span>
<span class="keyword">val</span> t1<span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> f <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">if</span> x &lt;= _0 <span class="keyword">then</span> t0 <span class="keyword">else</span> t0
<span class="keyword">in</span>
  B <span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span> <span class="keyword">(</span>f<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">val</span> t2<span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> f <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">if</span> x &lt;= _0 <span class="keyword">then</span> t1 <span class="keyword">else</span> t0
<span class="keyword">in</span>
  B <span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span> <span class="keyword">(</span>f<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "The tree t2 = "<span class="keyword">;</span> print_btree t2<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> t3<span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> f <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">if</span> x &lt;= _0 <span class="keyword">then</span> t1 <span class="keyword">else</span> t2
<span class="keyword">in</span>
   B <span class="staexp"><span class="keyword">{</span>A<span class="keyword">}</span></span> <span class="keyword">(</span>f<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "The tree t3 = "<span class="keyword">;</span> print_btree t3<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> isperfect <span class="keyword">=</span> btree_isperfect <span class="keyword">(</span>t1<span class="keyword">)</span>
<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>print "isperfect(t1) = "<span class="keyword">;</span> print isperfect<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">val</span> isperfect <span class="keyword">=</span> btree_isperfect <span class="keyword">(</span>t3<span class="keyword">)</span>
<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>print "isperfect(t3) = "<span class="keyword">;</span> print isperfect<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> t31<span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=</span> btree_left <span class="keyword">(</span>t3<span class="keyword">)</span>
<span class="keyword">val</span> t32<span class="keyword">:</span> <span class="staexp">btree</span> <span class="keyword">=</span> btree_right <span class="keyword">(</span>t3<span class="keyword">)</span>

<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "The left subtree of t3 = "<span class="keyword">;</span> print_btree t31<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
  print_string "The right subtree of t3 = "<span class="keyword">;</span> print_btree t32<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">val</span> s<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> btree_size <span class="keyword">(</span>t3<span class="keyword">)</span>
<span class="keyword">val</span> h<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> btree_height <span class="keyword">(</span>t3<span class="keyword">)</span>

<span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  print_string "The size of t3 = "<span class="keyword">;</span> print s<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
  print_string "The height of t3 = "<span class="keyword">;</span> print h<span class="keyword">;</span> print_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> main <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [systemf_programming_examples.dats] *)</span>
</pre>
</body>
</html>
