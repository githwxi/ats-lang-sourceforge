<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: January 2008
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Eff <span class="keyword">=</span> "ats_effect.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lab <span class="keyword">=</span> "ats_label.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp3.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">nil list_nil</span>
<span class="keyword">#define</span> <span class="neuexp">cons list_cons</span>
<span class="keyword">#define</span> <span class="neuexp">:: list_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">macdef</span> <span class="neuexp">fprint_label <span class="keyword">=</span> $Lab<span class="keyword">.</span>fprint_label</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_p3at <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3t<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> p3t<span class="keyword">.</span>p3at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P3Tann <span class="keyword">(</span>p3t<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tann("<span class="keyword">;</span>
      fprint_p3at <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3t<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Tann]
</span>  <span class="keyword">|</span> P3Tany d2v <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tany("<span class="keyword">;</span> fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Tany]
</span>  <span class="keyword">|</span> P3Tas <span class="keyword">(</span>refknd<span class="keyword">,</span> d2v<span class="keyword">,</span> p3t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tas("<span class="keyword">;</span>
      <span class="keyword">if</span> <span class="keyword">(</span>refknd <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> prstr "!"<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_p3at <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3t<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Tas]
</span>  <span class="keyword">|</span> P3Tbool b <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tbool("<span class="keyword">;</span> fprint1_bool <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Tbool]
</span>  <span class="keyword">|</span> P3Tchar c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tchar("<span class="keyword">;</span> fprint1_char <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P2Tchar]
</span>  <span class="keyword">|</span> P3Tcon <span class="keyword">(</span>refknd<span class="keyword">,</span> d2c<span class="keyword">,</span> npf<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tcon("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> refknd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d2con <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_p3atlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3ts<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Tcon]
</span>  <span class="keyword">|</span> P3Tempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "P3Tempty()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P3Tempty]
</span>  <span class="keyword">|</span> P3Texist <span class="keyword">(</span>s2vs<span class="keyword">,</span> p3t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Texist("<span class="keyword">;</span>
      fprint_s2varlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2vs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_p3at <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3t<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Texist]
</span>  <span class="keyword">|</span> P3Tfloat str <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "P3Tfloat(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P3Tfloat]
</span>  <span class="keyword">|</span> P3Tint <span class="keyword">(</span>str<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "P3Tint(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P2Tint]
</span>  <span class="keyword">|</span> P3Tlst <span class="keyword">(</span>s2e<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tlst("<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_p3atlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3ts<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [P3Tlst]
</span>  <span class="keyword">|</span> P3Trec <span class="keyword">(</span>recknd<span class="keyword">,</span> npf<span class="keyword">,</span> lp3ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "P3Trec(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P3Trec]
</span>  <span class="keyword">|</span> P3Tstring str <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "P3Tstring(\"%s\")"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P3Tstring]
</span>  <span class="keyword">|</span> P3Tvar <span class="keyword">(</span>refknd<span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tvar("<span class="keyword">;</span>
      <span class="keyword">if</span> <span class="keyword">(</span>refknd <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> prstr "!"<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> P3Tvbox <span class="keyword">(</span>d2v<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "P3Tvbox("<span class="keyword">;</span> fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span>
<span class="comment">(*
  | _ =&gt; begin
      prstr "INTERNAL ERROR";
      prstr ": fprint_p3at: not implemented yet"; fprint_newline (pf | out);
      exit (1)
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_p3at]
</span>
<span class="keyword">implement</span> fprint_p3atlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> p3ts<span class="keyword">:</span> <span class="staexp">p3atlst</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p3ts <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>p3t<span class="keyword">,</span> p3ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <span class="keyword">(</span>i <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_p3at <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3t<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i + 1<span class="keyword">,</span> p3ts<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> p3ts<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_p3atlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_p3at <span class="keyword">(</span>p3t<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_p3at<span class="keyword">,</span> p3t<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_p3at <span class="keyword">(</span>p3t<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_p3at<span class="keyword">,</span> p3t<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> d3e<span class="keyword">.</span>d3exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D3Eann_type <span class="keyword">(</span>d3e<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eann_type("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eann_type]
</span>  <span class="keyword">|</span> D3Eapp_dyn <span class="keyword">(</span>d3e_fun<span class="keyword">,</span> npf<span class="keyword">,</span> d3es_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eapp_dyn("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_fun<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es_arg<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eapp_dyn]
</span>  <span class="keyword">|</span> D3Eapp_sta d3e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eapp_sta("<span class="keyword">;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eapp_sta]
</span>  <span class="keyword">|</span> D3Earrinit <span class="keyword">(</span>s2e_elt<span class="keyword">,</span> od3e_asz<span class="keyword">,</span> d3es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Earrinit("<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e_elt<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      <span class="keyword">begin</span> <span class="keyword">case+</span> od3e_asz <span class="keyword">of</span>
      <span class="keyword">|</span> Some d3e <span class="keyword">=&gt;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es_elt<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Earrinit]
</span>  <span class="keyword">|</span> D3Earrsize <span class="keyword">(</span>s2e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Earrsize("<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Earrsize]
</span>  <span class="keyword">|</span> D3Eassgn_ptr <span class="keyword">(</span>d3e_ptr<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_val<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eassgn_ptr("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_ptr<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_val<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eassgn_ptr]
</span>  <span class="keyword">|</span> D3Eassgn_var <span class="keyword">(</span>d2v_ptr<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_val<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eassgn_val("<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v_ptr<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_val<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eassgn_var]
</span>  <span class="keyword">|</span> D3Ebool b <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> b <span class="keyword">then</span>
        fprint_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Ebool(true)"<span class="keyword">)</span>
      <span class="keyword">else</span>
        fprint_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Ebool(false)"<span class="keyword">)</span>
      <span class="comment">// end of [if]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D3Ebool]
</span>  <span class="keyword">|</span> D3Ecaseof <span class="keyword">(</span>knd<span class="keyword">,</span> d3es<span class="keyword">,</span> c3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Ecaseof(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Ecaseof]
</span>  <span class="keyword">|</span> D3Echar chr <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Echar("<span class="keyword">;</span> fprint1_char <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> chr<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Echar]
</span>  <span class="keyword">|</span> D3Econ <span class="keyword">(</span>d2c<span class="keyword">,</span> npf<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Econ("<span class="keyword">;</span>
      fprint_d2con <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Econ]
</span>  <span class="keyword">|</span> D3Ecst d2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Ecst("<span class="keyword">;</span> fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Ecst]
</span>  <span class="keyword">|</span> D3Ecstsp cst <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Ecstsp("<span class="keyword">;</span> $Syn<span class="keyword">.</span>fprint_cstsp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> cst<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Ecstsp]
</span>  <span class="keyword">|</span> D3Ecrypt <span class="keyword">(</span>knd<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Ecrypt("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Ecrypt]
</span>  <span class="keyword">|</span> D3Edynload fil <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Edynload("<span class="keyword">;</span>
      $Fil<span class="keyword">.</span>fprint_filename <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fil<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Edynload]
</span>  <span class="keyword">|</span> D3Eeffmask <span class="keyword">(</span>effs<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eeffmask("<span class="keyword">;</span>
      $Eff<span class="keyword">.</span>fprint_effectlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> effs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eeffmask]
</span>  <span class="keyword">|</span> D3Eempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Eempty()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Eempty]
</span>  <span class="keyword">|</span> D3Eextval <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Eextval(\"%s\")"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Eextval]
</span>  <span class="keyword">|</span> D3Efix <span class="keyword">(</span>knd<span class="keyword">,</span> d2v<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Efix("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Efix]
</span>  <span class="keyword">|</span> D3Efloat <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Efloat(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Efloat]
</span>  <span class="keyword">|</span> D3Efloatsp <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Efloatsp(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Efloatsp]
</span>  <span class="keyword">|</span> D3Efoldat d3e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Efoldat("<span class="keyword">;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Efoldat]
</span>  <span class="keyword">|</span> D3Efreeat d3e <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Efreeat("<span class="keyword">;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Efreeat]
</span>  <span class="keyword">|</span> D3Eif <span class="keyword">(</span>d3e_cond<span class="keyword">,</span> d3e_then<span class="keyword">,</span> d3e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eif("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_cond<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_then<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_else<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eif]
</span>  <span class="keyword">|</span> D3Eint <span class="keyword">(</span>str<span class="keyword">,</span> _<span class="comment">(*intinf*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Eint(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Eint]
</span>  <span class="keyword">|</span> D3Eintsp <span class="keyword">(</span>str<span class="keyword">,</span> _<span class="comment">(*intinf*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Eintsp(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Eintsp]
</span>  <span class="keyword">|</span> D3Elam_dyn <span class="keyword">(</span>lin<span class="keyword">,</span> npf<span class="keyword">,</span> p3ts<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elam_dyn("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lin<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_p3atlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3ts<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elam_dyn]
</span>  <span class="keyword">|</span> D3Elaminit_dyn <span class="keyword">(</span>lin<span class="keyword">,</span> npf<span class="keyword">,</span> p3ts<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elaminit_dyn("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lin<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_p3atlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> p3ts<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elaminit_dyn]
</span>  <span class="keyword">|</span> D3Elam_met <span class="keyword">(</span>s2es<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elam_met("<span class="keyword">;</span>
      fprint_s2explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2es<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elam_met]
</span>  <span class="keyword">|</span> D3Elam_sta <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elam_sta("<span class="keyword">;</span>
      fprint_s2varlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2vs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s2explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2ps<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elam_sta]
</span>  <span class="keyword">|</span> D3Elazy_delay <span class="keyword">(</span>d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elazy_delay("<span class="keyword">;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elazy_delay]
</span>  <span class="keyword">|</span> D3Elazy_vt_delay <span class="keyword">(</span>d3e_eval<span class="keyword">,</span> d3e_free<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elazy_delay("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_eval<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_free<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elazy_vt_delay]
</span>  <span class="keyword">|</span> D3Elazy_force <span class="keyword">(</span>lin<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elazy_force("<span class="keyword">;</span>
      fprint_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lin<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elazy_force]
</span>  <span class="keyword">|</span> D3Elet <span class="keyword">(</span>d3cs<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elet("<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "..."<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elet]
</span>  <span class="keyword">|</span> D3Eloop <span class="keyword">(</span>od3e_init<span class="keyword">,</span> d3e_test<span class="keyword">,</span> od3e_post<span class="keyword">,</span> d3e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eloop("<span class="keyword">;</span>
      <span class="keyword">begin</span> <span class="keyword">case+</span> od3e_init <span class="keyword">of</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> Some d3e <span class="keyword">=&gt;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      <span class="keyword">end</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_test<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      <span class="keyword">begin</span> <span class="keyword">case+</span> od3e_post <span class="keyword">of</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> Some d3e <span class="keyword">=&gt;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span>
      <span class="keyword">end</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_body<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eloop]
</span>  <span class="keyword">|</span> D3Eloopexn i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Eloopexn(%i)"<span class="keyword">,</span> <span class="keyword">@(</span>i<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Eloopexn]
</span>  <span class="keyword">|</span> D3Elst <span class="keyword">(</span>lin<span class="keyword">,</span> s2e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Elst("<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Elst]
</span>  <span class="keyword">|</span> D3Eptrof_ptr <span class="keyword">(</span>d3e<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eptrof_ptr("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eptrof_ptr]
</span>  <span class="keyword">|</span> D3Eptrof_var <span class="keyword">(</span>d2v<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eptrof_var("<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eptrof_var]
</span>  <span class="keyword">|</span> D3Eraise <span class="keyword">(</span>d3e_exn<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eraise("<span class="keyword">;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_exn<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eraise]
</span>  <span class="keyword">|</span> D3Erec <span class="keyword">(</span>knd<span class="keyword">,</span> npf<span class="keyword">,</span> ld3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Erec("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> npf<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_labd3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ld3es<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Erec]
</span>  <span class="keyword">|</span> D3Erefarg <span class="keyword">(</span>refval<span class="keyword">,</span> freeknd<span class="keyword">,</span> d3e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Erefarg("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> refval<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> freeknd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Erefarg]
</span>  <span class="keyword">|</span> D3Escaseof <span class="keyword">(</span>s2e<span class="keyword">,</span> sc3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Escaseof(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Escaseof]
</span>  <span class="keyword">|</span> D3Esel <span class="keyword">(</span>d3e<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Esel("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Esel]
</span>  <span class="keyword">|</span> D3Esel_ptr <span class="keyword">(</span>d3e<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Esel_ptr("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Esel_ptr]
</span>  <span class="keyword">|</span> D3Esel_var <span class="keyword">(</span>d2v<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Esel_var("<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Esel_var]
</span>  <span class="keyword">|</span> D3Eseq d3es <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eseq("<span class="keyword">;</span> fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eseq]
</span>  <span class="keyword">|</span> D3Esif <span class="keyword">(</span>s2e_cond<span class="keyword">,</span> d3e_then<span class="keyword">,</span> d3e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Esif("<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e_cond<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_then<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_else<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [sif]
</span>  <span class="keyword">|</span> D3Estring <span class="keyword">(</span>str<span class="keyword">,</span> len<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Estring(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Estring]
</span>  <span class="keyword">|</span> D3Estruct <span class="keyword">(</span>ld3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Estruct("<span class="keyword">;</span> fprint_labd3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ld3es<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Estruct]
</span>  <span class="keyword">|</span> D3Etmpcst <span class="keyword">(</span>d2c<span class="keyword">,</span> s2ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Etmpcst("<span class="keyword">;</span>
      fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s2explstlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2ess<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Etmpcst]
</span>  <span class="keyword">|</span> D3Etmpvar <span class="keyword">(</span>d2v<span class="keyword">,</span> s2ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Etmpvar("<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_s2explstlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2ess<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Etmpvar]
</span>  <span class="keyword">|</span> D3Etop <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Etop()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D3Etop]
</span>  <span class="keyword">|</span> D3Etrywith <span class="keyword">(</span>d3e<span class="keyword">,</span> c3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "D3Etrywith(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [trywith]
</span>  <span class="keyword">|</span> D3Evar d2v <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Evar("<span class="keyword">;</span> fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Evar]
</span>  <span class="keyword">|</span> D3Eviewat_assgn_ptr <span class="keyword">(</span>d3e_l<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eviewat_assgn_ptr("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_l<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_r<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eviewat_assgn_ptr]
</span>  <span class="keyword">|</span> D3Eviewat_assgn_var <span class="keyword">(</span>d2v_l<span class="keyword">,</span> d3ls<span class="keyword">,</span> d3e_r<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eviewat_assgn_var("<span class="keyword">;</span>
      fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v_l<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3lab1lst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e_r<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eviewat_assgn_var]
</span>  <span class="keyword">|</span> D3Eviewat_ptr <span class="keyword">(</span>d3e<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eviewat_ptr("<span class="keyword">;</span> fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eviewat_ptr]
</span>  <span class="keyword">|</span> D3Eviewat_var <span class="keyword">(</span>d2v<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Eviewat_var("<span class="keyword">;</span> fprint_d2var <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2v<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Eviewat_var]
</span>  <span class="keyword">|</span> D3Ewhere <span class="keyword">(</span>d3e<span class="keyword">,</span> d3cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "D3Ewhere("<span class="keyword">;</span>
      fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "..."<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3Ewhere]
</span><span class="comment">(*
  | _ =&gt; begin
      fprint1_string (pf | out, "[...]")
    end // end of [val]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_d3exp]
</span>
<span class="keyword">implement</span> fprint_d3explst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> d3es<span class="keyword">:</span> <span class="staexp">d3explst</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d3es <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>d3e<span class="keyword">,</span> d3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <span class="keyword">(</span>i <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i + 1<span class="keyword">,</span> d3es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> d3es<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_d3explst]
</span>
<span class="keyword">implement</span> fprint_d3explstlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ess<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> d3ess<span class="keyword">:</span> <span class="staexp">d3explstlst</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d3ess <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>d3es<span class="keyword">,</span> d3ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <span class="keyword">(</span>i <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_d3explst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3es<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i + 1<span class="keyword">,</span> d3ess<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> d3ess<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_d3explstlst]
</span>
<span class="keyword">implement</span> fprint_labd3explst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ld3es0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ld3es<span class="keyword">:</span> <span class="staexp">labd3explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">in</span>
    <span class="keyword">case+</span> ld3es <span class="keyword">of</span>
    <span class="keyword">|</span> LABD3EXPLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> d3e<span class="keyword">,</span> ld3es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> prstr ", "<span class="keyword">;</span>
        fprint_label <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">;</span> prstr "= "<span class="keyword">;</span>
        fprint_d3exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3e<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> ld3es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [LABD3EXPLSTcons]
</span>    <span class="keyword">|</span> LABD3EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [LABD3EXPLSTnil]
</span>    <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> ld3es0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_labd3explst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_d3lab1 <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3l<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> d3l<span class="keyword">.</span>d3lab1_node <span class="keyword">of</span>
  <span class="keyword">|</span> D3LAB1lab <span class="keyword">(</span>l<span class="keyword">,</span> s2e_rec<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint_label <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">;</span>
      prstr "("<span class="keyword">;</span> fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e_rec<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3LAB1lab]
</span>  <span class="keyword">|</span> D3LAB1ind <span class="keyword">(</span>d3ess_ind<span class="keyword">,</span> s2e_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "["<span class="keyword">;</span>
      fprint_d3explstlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ess_ind<span class="keyword">)</span><span class="keyword">;</span>
      prstr "]"<span class="keyword">;</span>
      prstr "("<span class="keyword">;</span>
      fprint_s2exp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> s2e_elt<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [D3LAB1ind]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_d3lab1]
</span>
<span class="keyword">implement</span> fprint_d3lab1lst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> d3ls<span class="keyword">:</span> <span class="staexp">d3lab1lst</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d3ls <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>d3l<span class="keyword">,</span> d3ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> <span class="keyword">(</span>i <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_d3lab1 <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d3l<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i + 1<span class="keyword">,</span> d3ls<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// end of [nil]
</span>  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> d3ls<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_d3lab1lst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_d3exp <span class="keyword">(</span>d3e<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_d3exp<span class="keyword">,</span> d3e<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_d3exp <span class="keyword">(</span>d3e<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_d3exp<span class="keyword">,</span> d3e<span class="keyword">)</span>

<span class="keyword">implement</span> print_d3explst <span class="keyword">(</span>d3es<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_d3explst<span class="keyword">,</span> d3es<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_d3explst <span class="keyword">(</span>d3es<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_d3explst<span class="keyword">,</span> d3es<span class="keyword">)</span>

<span class="keyword">implement</span> print_d3explstlst <span class="keyword">(</span>d3ess<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_d3explstlst<span class="keyword">,</span> d3ess<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_d3explstlst <span class="keyword">(</span>d3ess<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_d3explstlst<span class="keyword">,</span> d3ess<span class="keyword">)</span>

<span class="keyword">implement</span> print_labd3explst <span class="keyword">(</span>ld3es<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_labd3explst<span class="keyword">,</span> ld3es<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_labd3explst <span class="keyword">(</span>ld3es<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_labd3explst<span class="keyword">,</span> ld3es<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_dynexp3_print.dats] *)</span>
</pre>
</body>
</html>
