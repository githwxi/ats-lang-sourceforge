<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: November 2007
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Arr <span class="keyword">=</span> "ats_array.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Deb <span class="keyword">=</span> "ats_debug.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Fil <span class="keyword">=</span> "ats_filename.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Glo <span class="keyword">=</span> "ats_global.sats"</span>
<span class="keyword">staload</span> <span class="staexp">IntInf <span class="keyword">=</span> "ats_intinf.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lab <span class="keyword">=</span> "ats_label.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Loc <span class="keyword">=</span> "ats_location.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lst <span class="keyword">=</span> "ats_list.sats"</span>
<span class="keyword">staload</span> <span class="staexp">NS <span class="keyword">=</span> "ats_namespace.sats"</span>
<span class="keyword">staload</span> <span class="staexp">PM <span class="keyword">=</span> "ats_posmark.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Stamp <span class="keyword">=</span> "ats_stamp.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Sym <span class="keyword">=</span> "ats_symbol.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Syn <span class="keyword">=</span> "ats_syntax.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp1.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp1.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_stadyncst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_trans2_env.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_trans2.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">MAC <span class="keyword">=</span> "ats_macro2.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_array.dats"</span>

<span class="keyword">staload</span> <span class="staexp">"ats_reference.sats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_reference.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_map_lin.dats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_symenv.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">THISFILENAME "ats_trans2_dyn1.dats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">#define</span> <span class="neuexp">nil list_nil</span>
<span class="keyword">#define</span> <span class="neuexp">cons list_cons</span>
<span class="keyword">#define</span> <span class="neuexp">:: list_cons</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="2698"><span class="stacstdec">loc_t <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_t</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2730"><span class="stacstdec">funclo <span class="keyword">=</span> $Syn<span class="keyword">.</span>funclo</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2759"><span class="stacstdec">funcloopt <span class="keyword">=</span> $Syn<span class="keyword">.</span>funcloopt</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2794"><span class="stacstdec">efc <span class="keyword">=</span> $Eff<span class="keyword">.</span>effcst</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2820"><span class="stacstdec">efcopt <span class="keyword">=</span> Option efc</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2848"><span class="stacstdec">sym_t <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_t</span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2878"><span class="stacstdec">symopt_t <span class="keyword">=</span> Option sym_t</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> $Sym<span class="keyword">.</span>eq_symbol_symbol</span>

<span class="neuexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> $Syn<span class="keyword">.</span>prerr_d0ynq</span>
<span class="neuexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> $Sym<span class="keyword">.</span>prerr_symbol</span>
<span class="neuexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> $Loc<span class="keyword">.</span>prerr_location</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> prerr_loc_error2
  <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  <span class="keyword">(</span>$Loc<span class="keyword">.</span>prerr_location loc<span class="keyword">;</span> prerr ": error(2)"<span class="keyword">)</span>
<span class="comment">// end of [prerr_loc_error2]
</span>
<span class="keyword">fn</span> prerr_interror <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr "INTERNAL ERROR (ats_trans2_dyn1)"

<span class="keyword">fn</span> prerr_loc_interror <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  $Loc<span class="keyword">.</span>prerr_location loc<span class="keyword">;</span> prerr ": INTERNAL ERROR (ats_trans2_dyn1)"
<span class="keyword">end</span> <span class="comment">// end of [prerr_loc_interror]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> dyncstuseloc_posmark
  <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp">d2cst_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc_d2c <span class="keyword">=</span> d2cst_loc_get <span class="keyword">(</span>d2c<span class="keyword">)</span>
  <span class="keyword">val</span> loc_begoff <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_begpos_toff loc
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $PM<span class="keyword">.</span>posmark_insert_dyncstuse_beg <span class="keyword">(</span>loc_begoff<span class="keyword">,</span> loc_d2c<span class="keyword">)</span>
  <span class="keyword">val</span> loc_endoff <span class="keyword">=</span> $Loc<span class="keyword">.</span>location_endpos_toff loc
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $PM<span class="keyword">.</span>posmark_insert_dyncstuse_end <span class="keyword">(</span>loc_endoff<span class="keyword">,</span> loc_d2c<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="comment">// empty
</span><span class="keyword">end</span> <span class="comment">// end of [dyncstuseloc_posmark]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> s2exp_arity_list
  <span class="keyword">(</span>s2e<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">List int</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2e<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Efun <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> s2es<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      cons <span class="keyword">(</span>$Lst<span class="keyword">.</span>list_length s2es<span class="keyword">,</span> s2exp_arity_list s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of[S2Efun]
</span>  <span class="keyword">|</span> S2Eexi <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> s2exp_arity_list s2e
  <span class="keyword">|</span> S2Euni <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> s2exp_arity_list s2e
  <span class="keyword">|</span> S2Emetfn <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> s2e<span class="keyword">)</span> <span class="keyword">=&gt;</span> s2exp_arity_list s2e
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2exp_arity_list]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d1cstdec_tr <span class="keyword">(</span>
    dck<span class="keyword">:</span> <span class="staexp">$Syn<span class="keyword">.</span>dcstkind</span><span class="keyword">,</span> s2vpslst<span class="keyword">:</span> <span class="staexp">s2qualst</span><span class="keyword">,</span> d1c<span class="keyword">:</span> <span class="staexp">d1cstdec</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2cst_t</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc <span class="keyword">=</span> d1c<span class="keyword">.</span>d1cstdec_loc
  <span class="keyword">val</span> fil <span class="keyword">=</span> d1c<span class="keyword">.</span>d1cstdec_fil
  <span class="keyword">val</span> id <span class="keyword">=</span> d1c<span class="keyword">.</span>d1cstdec_sym
  <span class="keyword">var</span> s2e_cst <span class="keyword">=</span> <span class="keyword">(</span> <span class="comment">// it must be a prop or a t@ye; it cannot be linear
</span>    <span class="keyword">if</span> $Syn<span class="keyword">.</span>dcstkind_is_proof dck <span class="keyword">then</span> s1exp_tr_dn_prop d1c<span class="keyword">.</span>d1cstdec_typ
                                  <span class="keyword">else</span> s1exp_tr_dn_t0ype d1c<span class="keyword">.</span>d1cstdec_typ
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="comment">// end of [var]
</span>  <span class="keyword">val</span> arilst <span class="keyword">=</span> s2exp_arity_list s2e_cst
  <span class="keyword">val</span> extdef <span class="keyword">=</span> d1c<span class="keyword">.</span>d1cstdec_extdef
  <span class="keyword">val</span> d2c <span class="keyword">=</span> d2cst_make <span class="keyword">(</span>loc<span class="keyword">,</span> fil<span class="keyword">,</span> id<span class="keyword">,</span> dck<span class="keyword">,</span> s2vpslst<span class="keyword">,</span> arilst<span class="keyword">,</span> s2e_cst<span class="keyword">,</span> extdef<span class="keyword">)</span>
<span class="keyword">in</span>
  the_d2expenv_add_dcst d2c<span class="keyword">;</span> d2c
<span class="keyword">end</span> <span class="comment">// end of [d1cstdec_tr]
</span>
<span class="keyword">implement</span>
d1cstdeclst_tr
  <span class="keyword">(</span>dck<span class="keyword">,</span> s2vpslst<span class="keyword">,</span> d1cs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d1cs <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d1c<span class="keyword">,</span> d1cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2c <span class="keyword">=</span> d1cstdec_tr <span class="keyword">(</span>dck<span class="keyword">,</span> s2vpslst<span class="keyword">,</span> d1c<span class="keyword">)</span>
    <span class="keyword">in</span>
      cons <span class="keyword">(</span>d2c<span class="keyword">,</span> d1cstdeclst_tr <span class="keyword">(</span>dck<span class="keyword">,</span> s2vpslst<span class="keyword">,</span> d1cs<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d1cstdeclst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> s1arg_arg_tr <span class="keyword">(</span>s1a<span class="keyword">:</span> <span class="staexp">s1arg</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2arg</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  s2arg_make <span class="keyword">(</span>s1a<span class="keyword">.</span>s1arg_loc<span class="keyword">,</span> s1a<span class="keyword">.</span>s1arg_sym<span class="keyword">,</span> s1rtopt_tr s1a<span class="keyword">.</span>s1arg_srt<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s1arg_arg_tr]
</span>
<span class="keyword">fun</span> s1arglst_arg_tr <span class="keyword">(</span>s1as<span class="keyword">:</span> <span class="staexp">s1arglst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2arglst</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s1as <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>s1a<span class="keyword">,</span> s1as<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>s1arg_arg_tr s1a<span class="keyword">,</span> s1arglst_arg_tr s1as<span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s1arglst_arg_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">:</span> <span class="staexp">d2conlst</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d2conlst</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
  <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      <span class="keyword">if</span> d2con_arity_full_get d2c <span class="keyword">=</span> n <span class="keyword">then</span> <span class="keyword">begin</span>
        D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
        d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">,</span> n<span class="keyword">)</span>
      <span class="keyword">end</span>
  <span class="keyword">|</span> D2CONLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> D2CONLSTnil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2con_select_arity]
</span>
<span class="keyword">fun</span> d2con_select_arity_err_some
  <span class="keyword">(</span>loc_id<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d2con_t</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  prerr_loc_error2 loc_id<span class="keyword">;</span>
  prerr ": the dynamic identifier ["<span class="keyword">;</span>
  prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
  prerrf <span class="keyword">(</span>"] refers to multiple constructors of arity %i."<span class="keyword">,</span> <span class="keyword">@(</span>n<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
  prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
  $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2con_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2con_select_arity_err_some]
</span>
<span class="keyword">fun</span> d2con_select_arity_err_none
  <span class="keyword">(</span>loc_id<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d2con_t</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  prerr_loc_error2 loc_id<span class="keyword">;</span>
  prerr ": the dynamic identifier ["<span class="keyword">;</span>
  prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
  prerrf <span class="keyword">(</span>"] does not refer to any constructor of arity %i."<span class="keyword">,</span> <span class="keyword">@(</span>n<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
  prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
  $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2con_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2con_select_arity_err_none]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> p1at_make_p1at
  <span class="keyword">(</span>p1t<span class="keyword">:</span> <span class="staexp">p1at</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1at</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> p1t<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P1Tqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ans <span class="keyword">=</span> the_d2expenv_find_qua <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> ans <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
        <span class="keyword">|</span> D2ITEMe1xp e1xp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> p1t <span class="keyword">=</span> p1at_make_e1xp <span class="keyword">(</span>p1t<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> e1xp<span class="keyword">)</span>
          <span class="keyword">in</span>
            p1at_make_p1at <span class="keyword">(</span>p1t<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2ITEMe1xp]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> p1t <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> p1t
    <span class="keyword">end</span> <span class="comment">// end of [P2Tqid]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> p1t
<span class="keyword">end</span> <span class="comment">// end of [p1at_make_p1at]
</span>
<span class="keyword">fun</span> d1exp_make_d1exp
  <span class="keyword">(</span>d1e<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d1e<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D1Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ans <span class="keyword">=</span> the_d2expenv_find_qua <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> ans <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
        <span class="keyword">|</span> D2ITEMe1xp e1xp <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> d1e <span class="keyword">=</span> d1exp_make_e1xp <span class="keyword">(</span>d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> e1xp<span class="keyword">)</span>
          <span class="keyword">in</span>
            d1exp_make_d1exp <span class="keyword">(</span>d1e<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2ITEMe1xp]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d1e <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1e <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D1Eqid]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d1e
<span class="keyword">end</span> <span class="comment">// end of [d1exp_make_d1exp]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span> <span class="comment">// implementing [p1at_con_tr]
</span>
<span class="keyword">fun</span> aux1
  <span class="keyword">(</span>d2c<span class="keyword">:</span> <span class="staexp">d2con_t</span><span class="keyword">,</span> sub<span class="keyword">:</span> <span class="staexp">stasub_t</span><span class="keyword">,</span>
   s2vpslst<span class="keyword">:</span> <span class="staexp">s2qualst</span><span class="keyword">,</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2qualst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2vpslst <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpslst<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">@(</span>sub<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=</span> stasub_extend_svarlst <span class="keyword">(</span>sub<span class="keyword">,</span> s2vps<span class="keyword">.</span>0<span class="keyword">)</span>
      <span class="keyword">val</span> s2ps <span class="keyword">=</span> s2explst_subst <span class="keyword">(</span>sub<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span>
    <span class="keyword">in</span>
      out := <span class="keyword">@(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> :: out<span class="keyword">;</span> aux1 <span class="keyword">(</span>d2c<span class="keyword">,</span> sub<span class="keyword">,</span> s2vpslst<span class="keyword">,</span> out<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> npf <span class="keyword">=</span> d2con_npf_get d2c
      <span class="keyword">val</span> s2es_arg <span class="keyword">=</span>
        s2explst_subst <span class="keyword">(</span>sub<span class="keyword">,</span> d2con_arg_get d2c<span class="keyword">)</span>
      <span class="keyword">val</span> s2c <span class="keyword">=</span> d2con_scst_get d2c
      <span class="keyword">val</span> s2e_res<span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">case+</span> d2con_ind_get d2c <span class="keyword">of</span>
        <span class="keyword">|</span> Some s2es_ind <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> s2es_ind <span class="keyword">=</span> s2explst_subst <span class="keyword">(</span>sub<span class="keyword">,</span> s2es_ind<span class="keyword">)</span>
          <span class="keyword">in</span>
            s2exp_cstapp <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es_ind<span class="keyword">)</span>
          <span class="keyword">end</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s2exp_cst s2c
    <span class="keyword">in</span>
      out := s2qualst_reverse out<span class="keyword">;</span>
      s2exp_confun <span class="keyword">(</span>npf<span class="keyword">,</span> s2es_arg<span class="keyword">,</span> s2e_res<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [nil]
</span><span class="keyword">end</span> <span class="comment">// end [aux1]
</span>
<span class="keyword">fun</span> aux2 <span class="keyword">(</span>
    loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp">d2con_t</span>
  <span class="keyword">,</span> sub<span class="keyword">:</span> <span class="staexp">stasub_t</span>
  <span class="keyword">,</span> s2vpss<span class="keyword">:</span> <span class="staexp">s2qualst</span>
  <span class="keyword">,</span> s1as<span class="keyword">:</span> <span class="staexp">s1vararglst</span>
  <span class="keyword">,</span> out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2qualst</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> err <span class="keyword">(</span>loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp">d2con_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_loc_error2 loc_sap<span class="keyword">;</span>
    $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: p1at_con_tr: aux2"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": the constructor ["<span class="keyword">;</span>
    prerr d2c<span class="keyword">;</span>
    prerr "] is applied to too many static arguments."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [err]
</span><span class="keyword">in</span> <span class="comment">// in of [let]
</span>  <span class="keyword">case+</span> s1as <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>s1a<span class="keyword">,</span> s1as<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s1a <span class="keyword">of</span>
    <span class="keyword">|</span> S1VARARGone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
      <span class="keyword">|</span> cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">@(</span>sub<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=</span> stasub_extend_svarlst <span class="keyword">(</span>sub<span class="keyword">,</span> s2vps<span class="keyword">.</span>0<span class="keyword">)</span>
          <span class="keyword">val</span> s2ps <span class="keyword">=</span> s2explst_subst <span class="keyword">(</span>sub<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span>
        <span class="keyword">in</span>
          out := <span class="keyword">@(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> :: out<span class="keyword">;</span>
          aux2 <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">,</span> sub<span class="keyword">,</span> s2vpss<span class="keyword">,</span> s1as<span class="keyword">,</span> out<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>      <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> err <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S1VARARGone]
</span>    <span class="keyword">|</span> S1VARARGall <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux1 <span class="keyword">(</span>d2c<span class="keyword">,</span> sub<span class="keyword">,</span> s2vpss<span class="keyword">,</span> out<span class="keyword">)</span>
    <span class="keyword">|</span> S1VARARGseq arg <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2vpss <span class="keyword">of</span>
      <span class="keyword">|</span> cons <span class="keyword">(</span>s2vps<span class="keyword">,</span> s2vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> arg <span class="keyword">=</span> s1arglst_arg_tr arg
          <span class="keyword">val</span> <span class="keyword">@(</span>sub<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=</span>
            stasub_extend_sarglst_svarlst <span class="keyword">(</span>loc_sap<span class="keyword">,</span> sub<span class="keyword">,</span> arg<span class="keyword">,</span> s2vps<span class="keyword">.</span>0<span class="keyword">)</span>
          <span class="keyword">val</span> s2ps <span class="keyword">=</span> s2explst_subst <span class="keyword">(</span>sub<span class="keyword">,</span> s2vps<span class="keyword">.</span>1<span class="keyword">)</span>
        <span class="keyword">in</span>
          out := <span class="keyword">@(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> :: out<span class="keyword">;</span>
          aux2 <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">,</span> sub<span class="keyword">,</span> s2vpss<span class="keyword">,</span> s1as<span class="keyword">,</span> out<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>      <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> err <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S1VARARGseq]
</span>    <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux1 <span class="keyword">(</span>d2c<span class="keyword">,</span> sub<span class="keyword">,</span> s2vpss<span class="keyword">,</span> out<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [aux2]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">fn</span> p1at_con_tr <span class="keyword">(</span>
    loc_dap<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> d2c<span class="keyword">:</span> <span class="staexp">d2con_t</span><span class="keyword">,</span> s1as<span class="keyword">:</span> <span class="staexp">s1vararglst</span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> p1ts<span class="keyword">:</span> <span class="staexp">p1atlst</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p2at</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2vpss <span class="keyword">=</span> d2con_qua_get d2c
  <span class="keyword">var</span> out<span class="keyword">:</span> <span class="staexp">s2qualst</span> <span class="keyword">=</span> nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> s2e <span class="keyword">=</span> aux2 <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">,</span> stasub_nil<span class="keyword">,</span> s2vpss<span class="keyword">,</span> s1as<span class="keyword">,</span> out<span class="keyword">)</span>
  <span class="keyword">val</span> p2ts <span class="keyword">=</span> p1atlst_tr p1ts
<span class="keyword">in</span>
  p2at_con <span class="keyword">(</span>loc_dap<span class="keyword">,</span> 1<span class="comment">(*freeknd*)</span><span class="keyword">,</span> d2c<span class="keyword">,</span> out<span class="keyword">,</span> s2e<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [p1at_con_tr]
</span>
<span class="keyword">implement</span>
p1at_con_instantiate <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> out<span class="keyword">:</span> <span class="staexp">s2qualst</span> <span class="keyword">=</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> s2e <span class="keyword">=</span> <span class="keyword">begin</span>
    aux2 <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">,</span> stasub_nil<span class="keyword">,</span> d2con_qua_get d2c<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> out<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">@(</span>out<span class="keyword">,</span> s2e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [p1at_con_instantiate]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> p1at_qid_app_dyn_tr <span class="keyword">(</span>
    loc_dap<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> loc_id<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">$Syn<span class="keyword">.</span>d0ynq</span>
  <span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span>
  <span class="keyword">,</span> s1as<span class="keyword">:</span> <span class="staexp">s1vararglst</span>
  <span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp">int</span>
  <span class="keyword">,</span> p1ts<span class="keyword">:</span> <span class="staexp">p1atlst</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p2at</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span>  <span class="keyword">fn</span> err1 <span class="keyword">(</span>
      loc_id<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">$Syn<span class="keyword">.</span>d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2conlst</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_loc_error2 loc_id<span class="keyword">;</span>
    $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: p1at_qid_app_dyn_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": the dynamic identifier ["<span class="keyword">;</span>
    prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
    prerr "] does not refer to a constructor."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2conlst<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>     
  <span class="keyword">end</span> <span class="comment">// end of [err1]
</span><span class="comment">//
</span>  <span class="keyword">fn</span> err2 <span class="keyword">(</span>
      loc_id<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">$Syn<span class="keyword">.</span>d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span>
    <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2conlst</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_loc_error2 loc_id<span class="keyword">;</span>
    $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: p1at_qid_app_dyn_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": unrecognized dynamic constructor ["<span class="keyword">;</span>
    prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
    prerr "]."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2conlst<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [err2]
</span><span class="comment">//
</span>  <span class="keyword">val</span> d2cs <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> ans <span class="keyword">=</span> the_d2expenv_find_qua <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">in</span> <span class="keyword">case+</span> ans <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
      <span class="keyword">|</span> D2ITEMcon d2cs <span class="keyword">=&gt;</span> d2cs <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> err1 <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> err2 <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> is_arg_omit <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> p1ts <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>p1t<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> p1t<span class="keyword">.</span>p1at_node <span class="keyword">of</span> P1Tanys <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> false
      <span class="keyword">end</span> <span class="comment">// end of [cons (_, nil)]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> false
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> np1ts <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_length p1ts
  <span class="keyword">val</span> d2cs <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">if</span> is_arg_omit <span class="keyword">then</span> d2cs <span class="keyword">else</span> d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">,</span> np1ts<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2conlst</span>
  <span class="keyword">val</span> d2c <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
    <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
      <span class="keyword">|</span> D2CONLSTcons _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          d2con_select_arity_err_some <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> np1ts<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> D2CONLSTnil _ <span class="keyword">=&gt;</span> d2c
      <span class="keyword">end</span> <span class="comment">// end of [D2CONLSTcons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        d2con_select_arity_err_none <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> np1ts<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> p1ts <span class="keyword">=</span> <span class="keyword">if</span> is_arg_omit <span class="keyword">then</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> p1ts <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>p1t<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> npf <span class="keyword">=</span> d2con_npf_get d2c
        <span class="keyword">and</span> s2es <span class="keyword">=</span> d2con_arg_get d2c
        <span class="keyword">fun</span> aux <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p1atlst</span> <span class="keyword">=</span>
          <span class="keyword">case+</span> s2es <span class="keyword">of</span>
          <span class="keyword">|</span> cons <span class="keyword">(</span>_<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>p1at_any loc<span class="keyword">,</span> aux <span class="keyword">(</span>loc<span class="keyword">,</span> s2es<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>p1t<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> s2es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons (_, nil)]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> p1ts <span class="comment">// deadcode
</span>  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    p1ts <span class="comment">// there are no omitted arguments
</span>  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  p1at_con_tr <span class="keyword">(</span>loc_dap<span class="keyword">,</span> loc_sap<span class="keyword">,</span> d2c<span class="keyword">,</span> s1as<span class="keyword">,</span> npf<span class="keyword">,</span> p1ts<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [p1at_qid_app_dyn_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> p1at_app_tr
  <span class="keyword">(</span>loc_dap<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span>
   p1t_fun<span class="keyword">:</span> <span class="staexp">p1at</span><span class="keyword">,</span> sarg<span class="keyword">:</span> <span class="staexp">s1vararglst</span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> darg<span class="keyword">:</span> <span class="staexp">p1atlst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">p2at</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> p1t_fun <span class="keyword">=</span> p1at_make_p1at <span class="keyword">(</span>p1t_fun<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> p1t_fun<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P1Tqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc_id <span class="keyword">=</span> p1t_fun<span class="keyword">.</span>p1at_loc
    <span class="keyword">in</span>
      p1at_qid_app_dyn_tr <span class="keyword">(</span>loc_dap<span class="keyword">,</span> loc_sap<span class="keyword">,</span> loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> sarg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tqid]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
     prerr_loc_error2 loc_dap<span class="keyword">;</span>
     $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: p1at_app_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
     prerr ": the application in the pattern is not allowed."<span class="keyword">;</span>
     prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
     $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>p2at<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
   <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [p1at_app_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// [freeknd]: 0: nonlinear; 1: preserve; ~1: free
</span><span class="keyword">fn</span> p1at_free_tr <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> p1t<span class="keyword">:</span> <span class="staexp">p1at</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p2at</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_tr p1t
<span class="keyword">in</span>
  <span class="keyword">case+</span> p2t<span class="keyword">.</span>p2at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P2Tcon <span class="keyword">(</span>freeknd<span class="keyword">,</span> d2c<span class="keyword">,</span> s2vpss<span class="keyword">,</span> s2e<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      p2at_con <span class="keyword">(</span>loc0<span class="keyword">,</span> <span class="keyword">~</span>freeknd<span class="keyword">,</span> d2c<span class="keyword">,</span> s2vpss<span class="keyword">,</span> s2e<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P2Tcon]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error2 loc0<span class="keyword">;</span>
      $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: p1at_free_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": values that match this pattern are not allowed to be freed."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>p2at<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [p1at_free_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> qid_is_vbox
  <span class="keyword">(</span>q<span class="keyword">:</span> <span class="staexp">$Syn<span class="keyword">.</span>d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> q<span class="keyword">.</span>d0ynq_node <span class="keyword">of</span>
  <span class="keyword">|</span> $Syn<span class="keyword">.</span>D0YNQnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_VBOX <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> false
<span class="keyword">end</span> <span class="comment">// end of [qid_is_vbox]
</span>
<span class="keyword">fn</span> p1at_vbox_tr <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> p1ts<span class="keyword">:</span> <span class="staexp">p1atlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p2at</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span>  <span class="keyword">fn</span> err <span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span>viewt@ype<span class="keyword">}</span></span> <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">a</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_loc_error2 loc<span class="keyword">;</span>
    prerr ": the [vbox] pattern is syntactically incorrect."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [err]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> npf &lt;&gt; 0 <span class="keyword">then</span> err <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span>loc<span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> p1t <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> p1ts <span class="keyword">of</span> cons <span class="keyword">(</span>p1t<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> p1t <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> err <span class="staexp"><span class="keyword">{</span>p1at<span class="keyword">}</span></span> <span class="keyword">(</span>loc<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p1at</span>
  <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_tr p1t
<span class="keyword">in</span>
  <span class="keyword">case+</span> p2t<span class="keyword">.</span>p2at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P2Tvar <span class="keyword">(</span>refknd<span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">when</span> refknd <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> p2at_vbox <span class="keyword">(</span>loc<span class="keyword">,</span> d2v<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> err <span class="staexp"><span class="keyword">{</span>p2at<span class="keyword">}</span></span> <span class="keyword">(</span>loc<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [p2at_vbox_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
p1at_tr <span class="keyword">(</span>p1t0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">//
</span><span class="keyword">val</span> loc0 <span class="keyword">=</span> p1t0<span class="keyword">.</span>p1at_loc
<span class="keyword">var</span> linearity_check<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
<span class="comment">//
</span><span class="keyword">val</span> p2t0 <span class="keyword">=</span> <span class="keyword">(</span>
  <span class="keyword">case+</span> p1t0<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P1Tann <span class="keyword">(</span>p1t<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_tr p1t
      <span class="keyword">val</span> s2e <span class="keyword">=</span> s1exp_tr_dn_impredicative s1e
    <span class="keyword">in</span>
      p2at_ann <span class="keyword">(</span>loc0<span class="keyword">,</span> p2t<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tann]
</span>  <span class="keyword">|</span> P1Tany _ <span class="keyword">=&gt;</span> p2at_any <span class="keyword">(</span>loc0<span class="keyword">)</span>
  <span class="keyword">|</span> P1Tanys _ <span class="keyword">=&gt;</span> p2at_any <span class="keyword">(</span>loc0<span class="keyword">)</span>
  <span class="keyword">|</span> P1Tapp_dyn <span class="keyword">(</span>p1t_fun<span class="keyword">,</span> _<span class="comment">(*loc_arg*)</span><span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc1 <span class="keyword">=</span> p1t_fun<span class="keyword">.</span>p1at_loc
      <span class="keyword">val</span> p1t_fun <span class="keyword">=</span> p1at_make_p1at p1t_fun
    <span class="keyword">in</span>
      <span class="keyword">case+</span> p1t_fun<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
      <span class="keyword">|</span> P1Tqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> 0 <span class="keyword">of</span>
        <span class="keyword">|</span> _ <span class="keyword">when</span> qid_is_vbox <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> p1at_vbox_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            linearity_check := 2<span class="keyword">;</span>
            p1at_qid_app_dyn_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> loc1<span class="keyword">,</span> loc1<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> <span class="keyword">'[</span><span class="keyword">]</span><span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">(* end of [P1Tqid] *)</span>
      <span class="keyword">|</span> P1Tapp_sta <span class="keyword">(</span>p1t_fun<span class="keyword">,</span> sarg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          linearity_check := 2<span class="keyword">;</span>
          p1at_app_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> loc1<span class="keyword">,</span> p1t_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [P1Tapp_sta]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          prerr_loc_error2 loc0<span class="keyword">;</span>
          $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: p1at_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
          prerr ": the application in the pattern is not allowed."<span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>p2at<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [P1Tapp_dyn]
</span>  <span class="keyword">|</span> P1Tapp_sta <span class="keyword">(</span>p1t_fun<span class="keyword">,</span> sarg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc1 <span class="keyword">=</span> p1t_fun<span class="keyword">.</span>p1at_loc
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>linearity_check := 1<span class="keyword">)</span>
    <span class="keyword">in</span>
      p1at_app_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> loc1<span class="keyword">,</span> p1t_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> 0<span class="keyword">,</span> <span class="keyword">'[</span><span class="keyword">]</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tapp_sta]
</span>  <span class="keyword">|</span> P1Tas <span class="keyword">(</span>id<span class="keyword">,</span> p1t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2v <span class="keyword">=</span> d2var_make <span class="keyword">(</span>id<span class="keyword">.</span>i0de_loc<span class="keyword">,</span> id<span class="keyword">.</span>i0de_sym<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>linearity_check := 2<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_as <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">,</span> p1at_tr p1t<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tas]
</span>  <span class="keyword">|</span> P1Tchar c<span class="comment">(*char*)</span> <span class="keyword">=&gt;</span> p2at_char <span class="keyword">(</span>loc0<span class="keyword">,</span> c<span class="keyword">)</span>
  <span class="keyword">|</span> P1Texist <span class="keyword">(</span>s1as<span class="keyword">,</span> p1t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> s2vs <span class="keyword">=</span> s1arglst_var_tr s1as
      <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_tr p1t
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_pop <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>linearity_check := 1<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_exist <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> p2t<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Texist]
</span>  <span class="keyword">|</span> P1Tempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> p2at_empty <span class="keyword">(</span>loc0<span class="keyword">)</span>
  <span class="keyword">|</span> P1Tfloat f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> p2at_float <span class="keyword">(</span>loc0<span class="keyword">,</span> f<span class="keyword">)</span>
  <span class="keyword">|</span> P1Tfree p1t <span class="keyword">=&gt;</span> p1at_free_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> p1t<span class="keyword">)</span>
  <span class="keyword">|</span> P1Tint str<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> int <span class="keyword">=</span> $IntInf<span class="keyword">.</span>intinf_make_string str
    <span class="keyword">in</span>
      p2at_int <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">,</span> int<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tint]
</span>  <span class="keyword">|</span> P1Tqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> q<span class="keyword">.</span>d0ynq_node <span class="keyword">of</span>
    <span class="keyword">|</span> $Syn<span class="keyword">.</span>D0YNQnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> the_d2expenv_find id <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
        <span class="keyword">|</span> D2ITEMe1xp e1xp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <span class="keyword">let</span> <span class="keyword">val</span> p1t <span class="keyword">=</span> p1at_make_e1xp <span class="keyword">(</span>loc0<span class="keyword">,</span> e1xp<span class="keyword">)</span> <span class="keyword">in</span> p1at_tr p1t <span class="keyword">end</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2ITEMe1xp]
</span><span class="comment">//
</span><span class="comment">// HX-2010-08-01: for handling [true] and [false] patterns
</span><span class="comment">//
</span>        <span class="keyword">|</span> D2ITEMcst d2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> sym <span class="keyword">=</span> d2cst_sym_get d2c <span class="keyword">in</span> <span class="keyword">case+</span> 0 <span class="keyword">of</span>
            <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_TRUE <span class="keyword">=&gt;</span> p2at_bool <span class="keyword">(</span>loc0<span class="keyword">,</span> true<span class="keyword">)</span>
            <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_FALSE <span class="keyword">=&gt;</span> p2at_bool <span class="keyword">(</span>loc0<span class="keyword">,</span> false<span class="keyword">)</span>
            <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> p2at_var <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2var_make <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcst]
</span><span class="comment">//
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> p2at_var <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2var_make <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> p2at_var <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2var_make <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D0YNQnone]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        p1at_qid_app_dyn_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> loc0<span class="keyword">,</span> loc0<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> <span class="keyword">'[</span><span class="keyword">]</span><span class="keyword">,</span> 0<span class="comment">(*npf*)</span><span class="keyword">,</span> <span class="keyword">'[</span><span class="keyword">]</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [P1Tqid]
</span>  <span class="keyword">|</span> P1Tlist <span class="keyword">(</span>npf<span class="keyword">,</span> p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p1ts <span class="keyword">of</span>
    <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p2ts <span class="keyword">=</span> p1atlst_tr p1ts
      <span class="keyword">in</span>
        linearity_check := 2<span class="keyword">;</span> p2at_tup <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="comment">(*tupknd*)</span><span class="keyword">,</span> npf<span class="keyword">,</span> p2ts<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil _ <span class="keyword">=&gt;</span> p2at_empty <span class="keyword">(</span>loc0<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tlist]
</span>  <span class="keyword">|</span> P1Tlst <span class="keyword">(</span>p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      linearity_check := 2<span class="keyword">;</span> p2at_lst <span class="keyword">(</span>loc0<span class="keyword">,</span> p1atlst_tr p1ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tlst]
</span>  <span class="keyword">|</span> P1Trec <span class="keyword">(</span>recknd<span class="keyword">,</span> lp1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> lp2ts <span class="keyword">=</span> labp1atlst_tr lp1ts
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>linearity_check := 2<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_rec <span class="keyword">(</span>loc0<span class="keyword">,</span> recknd<span class="keyword">,</span> 0<span class="comment">(*npf*)</span><span class="keyword">,</span> lp2ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Trec]
</span>  <span class="keyword">|</span> P1Tref <span class="keyword">(</span>id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2v <span class="keyword">=</span> d2var_make <span class="keyword">(</span>id<span class="keyword">.</span>i0de_loc<span class="keyword">,</span> id<span class="keyword">.</span>i0de_sym<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_var <span class="keyword">(</span>loc0<span class="keyword">,</span> 1<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tref]
</span>  <span class="keyword">|</span> P1Trefas <span class="keyword">(</span>id<span class="keyword">,</span> p1t<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2v <span class="keyword">=</span> d2var_make <span class="keyword">(</span>id<span class="keyword">.</span>i0de_loc<span class="keyword">,</span> id<span class="keyword">.</span>i0de_sym<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>linearity_check := 2<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_as <span class="keyword">(</span>loc0<span class="keyword">,</span> 1<span class="comment">(*refknd*)</span><span class="keyword">,</span> d2v<span class="keyword">,</span> p1at_tr p1t<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Trefas]
</span>  <span class="keyword">|</span> P1Tstring str <span class="keyword">=&gt;</span> p2at_string <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">)</span>
  <span class="keyword">|</span> P1Tsvararg _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror loc0<span class="keyword">;</span>
      prerr ": p1at_tr: P1Tsvararg"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>p2at<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tavararg]
</span>  <span class="keyword">|</span> P1Ttup <span class="keyword">(</span>tupknd<span class="keyword">,</span> npf<span class="keyword">,</span> p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>linearity_check := 2<span class="keyword">)</span> <span class="keyword">in</span>
      p2at_tup <span class="keyword">(</span>loc0<span class="keyword">,</span> tupknd<span class="keyword">,</span> npf<span class="keyword">,</span> p1atlst_tr p1ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Ttup]
</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p2at</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span><span class="keyword">in</span> <span class="comment">// in of [p1at_tr]
</span><span class="comment">//
</span><span class="keyword">if</span> linearity_check &gt;= 1 <span class="keyword">then</span> <span class="keyword">begin</span>
  s2varlstord_linearity_test <span class="keyword">(</span>loc0<span class="keyword">,</span> p2t0<span class="keyword">.</span>p2at_svs<span class="keyword">)</span><span class="keyword">;</span>
<span class="keyword">end</span><span class="keyword">;</span>
<span class="comment">//
</span><span class="keyword">if</span> linearity_check &gt;= 2 <span class="keyword">then</span> <span class="keyword">begin</span>
  d2varlstord_linearity_test <span class="keyword">(</span>loc0<span class="keyword">,</span> p2t0<span class="keyword">.</span>p2at_dvs<span class="keyword">)</span><span class="keyword">;</span>
<span class="keyword">end</span><span class="keyword">;</span>
<span class="comment">//
</span>p2t0 <span class="comment">// the return value
</span><span class="comment">//
</span><span class="keyword">end</span> <span class="comment">// end of [p1at_tr]
</span>
<span class="keyword">implement</span>
p1atlst_tr <span class="keyword">(</span>p1ts<span class="keyword">)</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>p1ts<span class="keyword">,</span> p1at_tr<span class="keyword">)</span>

<span class="keyword">implement</span>
labp1atlst_tr <span class="keyword">(</span>lp1ts<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> lp1ts <span class="keyword">of</span>
  <span class="keyword">|</span> LABP1ATLSTcons <span class="keyword">(</span>l0<span class="keyword">,</span> p1t<span class="keyword">,</span> lp1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      LABP2ATLSTcons <span class="keyword">(</span>l0<span class="keyword">.</span>l0ab_lab<span class="keyword">,</span> p1at_tr p1t<span class="keyword">,</span> labp1atlst_tr lp1ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [LABP1ATLSTcons]
</span>  <span class="keyword">|</span> LABP1ATLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABP2ATLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> LABP1ATLSTdot <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABP2ATLSTdot <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [labp1atlst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
p1at_arg_tr
  <span class="keyword">(</span>p1t0<span class="keyword">,</span> wths1es<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> p1t0<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
  <span class="keyword">|</span> P1Tann <span class="keyword">(</span>p1t<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_tr p1t
      <span class="keyword">val</span> s2e <span class="keyword">=</span> s1exp_arg_tr_dn_impredicative <span class="keyword">(</span>s1e<span class="keyword">,</span> wths1es<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_ann <span class="keyword">(</span>p1t0<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> p2t<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tann]
</span>  <span class="keyword">|</span> P1Tlist <span class="keyword">(</span>npf<span class="keyword">,</span> p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> p2ts <span class="keyword">=</span> p1atlst_arg_tr <span class="keyword">(</span>p1ts<span class="keyword">,</span> wths1es<span class="keyword">)</span>
    <span class="keyword">in</span>
      p2at_list <span class="keyword">(</span>p1t0<span class="keyword">.</span>p1at_loc<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [P1Tlist]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> p1at_tr p1t0
<span class="comment">// end of [p1at_arg_tr]
</span>
<span class="keyword">implement</span>
p1atlst_arg_tr
  <span class="keyword">(</span>p1ts<span class="keyword">,</span> wths1es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> p1ts <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>p1t<span class="keyword">,</span> p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_arg_tr <span class="keyword">(</span>p1t<span class="keyword">,</span> wths1es<span class="keyword">)</span>
      <span class="keyword">val</span> p2ts <span class="keyword">=</span> p1atlst_arg_tr <span class="keyword">(</span>p1ts<span class="keyword">,</span> wths1es<span class="keyword">)</span>
    <span class="keyword">in</span>
      list_cons <span class="keyword">(</span>p2t<span class="keyword">,</span> p2ts<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [p1atlst_arg_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d2sym_lrbrackets
  <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d2sym</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_LRBRACKETS
  <span class="keyword">var</span> d2is0<span class="keyword">:</span> <span class="staexp">d2itemlst</span> <span class="keyword">=</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">and</span> err<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> the_d2expenv_find <span class="keyword">(</span>id<span class="keyword">)</span> <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> d2i <span class="keyword">of</span> D2ITEMsymdef d2is <span class="keyword">=&gt;</span> d2is0 := d2is <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> err := 1
      <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>err := 1<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">// run-time checking
</span>    prerr_loc_interror loc<span class="keyword">;</span> prerr ": d2sym_lrbrackets"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  d2sym_make <span class="keyword">(</span>loc<span class="keyword">,</span> $Syn<span class="keyword">.</span>d0ynq_none <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> id<span class="keyword">,</span> d2is0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d2sym_lrbrackets]
</span>
<span class="keyword">fn</span> d1exp_arrsub_tr
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> d1e_arr<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">,</span> loc_ind<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> d1ess_ind<span class="keyword">:</span> <span class="staexp">d1explstlst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d2s <span class="keyword">=</span> d2sym_lrbrackets <span class="keyword">(</span>loc0<span class="keyword">)</span>
  <span class="keyword">val</span> d2e_arr <span class="keyword">=</span> d1exp_tr d1e_arr
  <span class="keyword">val</span> d2ess_ind <span class="keyword">=</span> d1explstlst_tr d1ess_ind
<span class="keyword">in</span>
  d2exp_arrsub <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">,</span> d2e_arr<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d2ess_ind<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d1exp_arrsub_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d1exp_assgn_tr
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> d1es<span class="keyword">:</span> <span class="staexp">d1explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d1es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d1e1<span class="keyword">,</span> cons <span class="keyword">(</span>d1e2<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_assgn <span class="keyword">(</span>loc0<span class="keyword">,</span> d1exp_tr d1e1<span class="keyword">,</span> d1exp_tr d1e2<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror loc0<span class="keyword">;</span> prerr ": d1exp_assgn_tr"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [d1exp_assgn_tr]
</span>
<span class="keyword">fn</span> d1exp_deref_tr <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> d1es<span class="keyword">:</span> <span class="staexp">d1explst</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d1es <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>d1e<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_deref <span class="keyword">(</span>loc0<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror loc0<span class="keyword">;</span> prerr ": d1exp_deref_tr"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [d1exp_deref_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> macro_def_check
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> knd<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> level <span class="keyword">=</span> macro_level_get <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> level <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    <span class="keyword">if</span> knd <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">(* long form *)</span>
      prerr_loc_error2 loc0<span class="keyword">;</span>
      prerr ": the identifier ["<span class="keyword">;</span> prerr id<span class="keyword">;</span>
      prerr "] refers to a macro definition in long form"<span class="keyword">;</span>
      prerr ", but one in short form is expected."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">(* level = 0 *)</span>
    <span class="keyword">if</span> knd <span class="keyword">=</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">(* short form *)</span>
      prerr_loc_error2 loc0<span class="keyword">;</span>
      prerr ": the identifier ["<span class="keyword">;</span> prerr id<span class="keyword">;</span>
      prerr "] refers to a macro definition in short form"<span class="keyword">;</span>
      prerr ", but one in long form is expected."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="comment">(* end of [macro_def_check] *)</span>

<span class="keyword">fn</span> macro_var_check <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> level <span class="keyword">=</span> macro_level_get <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> level <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_loc_error2 loc0<span class="keyword">;</span>
    prerr ": the identifier ["<span class="keyword">;</span> prerr id<span class="keyword">;</span>
    prerr "] incorrectly refers to a macro argument variable."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
<span class="keyword">end</span> <span class="comment">// end of [macro_var_check]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataviewtype</span>
<span class="staexp"><a name="24674"><span class="stacstdec">specdynid</span></a></span> <span class="keyword">=</span> SPDIDassgn <span class="keyword">|</span> SPDIDderef <span class="keyword">|</span> SPDIDnone
<span class="comment">// end of [specdynid]
</span>
<span class="keyword">fn</span> specdynid_of_qid
  <span class="keyword">(</span>q<span class="keyword">:</span> <span class="staexp">d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">specdynid</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> q<span class="keyword">.</span>d0ynq_node <span class="keyword">of</span>
  <span class="keyword">|</span> $Syn<span class="keyword">.</span>D0YNQnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_COLONEQ <span class="keyword">then</span> SPDIDassgn <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">else</span> <span class="keyword">if</span> id <span class="keyword">=</span> $Sym<span class="keyword">.</span>symbol_BANG <span class="keyword">then</span> SPDIDderef <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">else</span> SPDIDnone <span class="keyword">(</span><span class="keyword">)</span>        
    <span class="keyword">end</span> <span class="comment">// end of [D0YNQnone]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> SPDIDnone <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [specdynid_of_qid]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d1exp_qid_tr <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">$Syn<span class="keyword">.</span>d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> ans <span class="keyword">=</span> the_d2expenv_find_qua <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">in</span>
  <span class="keyword">case+</span> ans <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
    <span class="keyword">|</span> D2ITEMcon d2cs <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2cs <span class="keyword">=</span> d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">,</span> 0<span class="keyword">)</span>
        <span class="keyword">val</span> d2c<span class="keyword">:</span> <span class="staexp">d2con_t</span> <span class="keyword">=</span> <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
          <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
            <span class="keyword">|</span> D2CONLSTcons _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                d2con_select_arity_err_some <span class="keyword">(</span>loc0<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> 0<span class="keyword">)</span>
              <span class="keyword">end</span> <span class="comment">// end of [D2CONLSTcons]
</span>            <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d2c
            <span class="keyword">end</span> <span class="comment">// end of [D2CONLSTcons]
</span>          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              d2con_select_arity_err_none <span class="keyword">(</span>loc0<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> 0<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">in</span>
        d2exp_con <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> 0<span class="comment">(*npf*)</span><span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcon]
</span>    <span class="keyword">|</span> D2ITEMcst d2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> dyncstuseloc_posmark <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span> <span class="keyword">in</span>
        d2exp_cst <span class="keyword">(</span>loc0<span class="keyword">,</span> d2c<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcst]
</span>    <span class="keyword">|</span> D2ITEMe1xp e1xp <span class="keyword">=&gt;</span> d1exp_tr <span class="keyword">(</span>d1exp_make_e1xp <span class="keyword">(</span>loc0<span class="keyword">,</span> e1xp<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">|</span> D2ITEMmacdef d2m <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> knd <span class="keyword">=</span> d2mac_kind_get d2m
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_def_check <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> id<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_mac <span class="keyword">(</span>loc0<span class="keyword">,</span> d2m<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMmacdef]
</span>    <span class="keyword">|</span> D2ITEMmacvar d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_var_check <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_var <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMmacvar]
</span>    <span class="keyword">|</span> D2ITEMsymdef d2is <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2s <span class="keyword">=</span> d2sym_make <span class="keyword">(</span>loc0<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> d2is<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_sym <span class="keyword">(</span>loc0<span class="keyword">,</span> d2s<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMsymdef]
</span>    <span class="keyword">|</span> D2ITEMvar d2v <span class="keyword">=&gt;</span> d2exp_var <span class="keyword">(</span>loc0<span class="keyword">,</span> d2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error2 loc0<span class="keyword">;</span>
      $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_qid_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic identifier ["<span class="keyword">;</span>
      prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
      prerr "] is unrecognized."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">// end of [d1exp_qid_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d1exp_qid_app_sta_tr
  <span class="keyword">(</span>loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> loc_id<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">,</span> s1as<span class="keyword">:</span> <span class="staexp">s1exparglst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2as <span class="keyword">=</span> s1exparglst_tr s1as
  <span class="keyword">val</span> od2i <span class="keyword">=</span> the_d2expenv_find_qua <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> od2i <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
    <span class="keyword">|</span> D2ITEMcon d2cs <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2cs <span class="keyword">=</span> d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">,</span> 0<span class="keyword">)</span>
        <span class="keyword">val</span> d2c <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d2cs <span class="keyword">of</span>
          <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> d2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2cs <span class="keyword">of</span>
            <span class="keyword">|</span> D2CONLSTcons _ <span class="keyword">=&gt;</span>
                d2con_select_arity_err_some <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> 0<span class="keyword">)</span>
              <span class="comment">// end of [D2CONLSTcons]
</span>            <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d2c
            <span class="keyword">end</span> <span class="comment">// end of [D2CONLSTcons]
</span>          <span class="keyword">|</span> D2CONLSTnil _ <span class="keyword">=&gt;</span> d2con_select_arity_err_none <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> 0<span class="keyword">)</span>
        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2con_t</span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        d2exp_con <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2c<span class="keyword">,</span> s2as<span class="keyword">,</span> 0<span class="comment">(*npf*)</span><span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcon]
</span>    <span class="keyword">|</span> D2ITEMcst d2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d2exp_cst <span class="keyword">(</span>loc_id<span class="keyword">,</span> d2c<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_app_sta <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> s2as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcst]
</span>    <span class="keyword">|</span> D2ITEMvar d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d2exp_var <span class="keyword">(</span>loc_id<span class="keyword">,</span> d2v<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_app_sta <span class="keyword">(</span>loc_sap<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> s2as<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMvar]
</span>    <span class="keyword">|</span> D2ITEMmacdef _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 loc_id<span class="keyword">;</span>
        $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_qid_app_sta_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": the identifier refers to a macro definition"<span class="keyword">;</span>
        prerr ", which cannot be applied to static arguments."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMmacdef]
</span>    <span class="keyword">|</span> D2ITEMmacvar _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 loc_id<span class="keyword">;</span>
        $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_qid_app_sta_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": the identifier refers to a macro argument variable"<span class="keyword">;</span>
        prerr ", which cannot be applied."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMmacvar]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 loc_id<span class="keyword">;</span>
        $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_qid_app_sta_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": the identifier refers to a dynamic term that cannot be applied."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">(* end of [Some_vt] *)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error2 loc_id<span class="keyword">;</span>
      $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_qid_app_sta_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": unrecognized dynamic identifier ["<span class="keyword">;</span>
      prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
      prerr "]"<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">(* end of [d2exp_qid_app_sta_tr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> d1exp_qid_app_dyn_tr <span class="keyword">(</span>
    loc_dap<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> loc_sap<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> loc_qid<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> q<span class="keyword">:</span> <span class="staexp">d0ynq</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span> <span class="comment">// qid
</span>  <span class="keyword">,</span> sarg<span class="keyword">:</span> <span class="staexp">s1exparglst</span>
  <span class="keyword">,</span> loc_arg<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> npf<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> darg<span class="keyword">:</span> <span class="staexp">d1explst</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> sarg <span class="keyword">=</span> s1exparglst_tr sarg
  <span class="keyword">val</span> darg <span class="keyword">=</span> d1explst_tr darg
  <span class="keyword">val</span> od2i <span class="keyword">=</span> the_d2expenv_find_qua <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> od2i <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
    <span class="keyword">|</span> D2ITEMcon d2cs <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> n <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_length darg
        <span class="keyword">val</span> d2cs <span class="keyword">=</span> d2con_select_arity <span class="keyword">(</span>d2cs<span class="keyword">,</span> n<span class="keyword">)</span>
        <span class="keyword">val</span> d2c <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> d2cs <span class="keyword">of</span>
          <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> D2CONLSTnil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2c
          <span class="keyword">|</span> D2CONLSTcons <span class="keyword">(</span>d2c<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              d2con_select_arity_err_some <span class="keyword">(</span>loc_qid<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> n<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [D2CONLST]
</span>          <span class="keyword">|</span> D2CONLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              d2con_select_arity_err_none <span class="keyword">(</span>loc_qid<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> n<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [D2CONLSTnil]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2con_t</span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        d2exp_con <span class="keyword">(</span>loc_dap<span class="keyword">,</span> d2c<span class="keyword">,</span> sarg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcon]
</span>    <span class="keyword">|</span> D2ITEMcst d2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">//
</span>        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> dyncstuseloc_posmark <span class="keyword">(</span>loc_qid<span class="keyword">,</span> d2c<span class="keyword">)</span>
<span class="comment">//
</span>        <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d2exp_cst <span class="keyword">(</span>loc_qid<span class="keyword">,</span> d2c<span class="keyword">)</span> <span class="keyword">in</span>
        d2exp_app_sta_dyn <span class="keyword">(</span>loc_dap<span class="keyword">,</span> loc_sap<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMcst]
</span>    <span class="keyword">|</span> D2ITEMe1xp _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_interror loc_qid<span class="keyword">;</span>
        prerr ": d1exp_qid_app_dyn_tr: D2ITEMe1xp"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMe1xp]
</span>    <span class="keyword">|</span> D2ITEMmacdef d2m <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> knd <span class="keyword">=</span> d2mac_kind_get d2m
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_def_check <span class="keyword">(</span>loc_qid<span class="keyword">,</span> knd<span class="keyword">,</span> id<span class="keyword">)</span>
        <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d2exp_mac <span class="keyword">(</span>loc_qid<span class="keyword">,</span> d2m<span class="keyword">)</span>
      <span class="keyword">in</span>
        d2exp_app_sta_dyn <span class="keyword">(</span>loc_dap<span class="keyword">,</span> loc_sap<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMmacdef]
</span>    <span class="keyword">|</span> D2ITEMmacvar _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 loc_qid<span class="keyword">;</span>
        prerr ": the identifer refers to a macro argument variable"<span class="keyword">;</span>
        prerr ", which cannot be applied."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMmacvar]
</span>    <span class="keyword">|</span> D2ITEMsymdef d2is <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2s <span class="keyword">=</span>
          d2sym_make <span class="keyword">(</span>loc_qid<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> d2is<span class="keyword">)</span>
        <span class="comment">// end of [val]
</span>        <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d2exp_sym <span class="keyword">(</span>loc_qid<span class="keyword">,</span> d2s<span class="keyword">)</span> <span class="keyword">in</span>
        d2exp_app_sta_dyn <span class="keyword">(</span>loc_dap<span class="keyword">,</span> loc_sap<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMsym]
</span>    <span class="keyword">|</span> D2ITEMvar d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d2exp_var <span class="keyword">(</span>loc_qid<span class="keyword">,</span> d2v<span class="keyword">)</span> <span class="keyword">in</span>
        d2exp_app_sta_dyn <span class="keyword">(</span>loc_dap<span class="keyword">,</span> loc_sap<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [D2ITEMvar]
</span>    <span class="keyword">end</span> <span class="comment">(* end of [Some_vt] *)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error2 loc_qid<span class="keyword">;</span>
      $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_qid_app_dyn_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic identifier ["<span class="keyword">;</span>
      prerr q<span class="keyword">;</span> prerr id<span class="keyword">;</span>
      prerr "] is unrecognized."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">(* end of [d1exp_qid_app_dyn_tr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> d1exp_idextapp_tr <span class="keyword">(</span>
  loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> id<span class="keyword">:</span> <span class="staexp">sym_t</span><span class="keyword">,</span> d1es<span class="keyword">:</span> <span class="staexp">d1explst</span>
<span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
<span class="comment">//
</span><span class="keyword">case+</span> 0 <span class="keyword">of</span>
<span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_loc_error2 <span class="keyword">(</span>loc0<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>
      prerr ": the external id ["<span class="keyword">;</span> prerr id<span class="keyword">;</span> prerr "] cannot be handled."
    <span class="keyword">)</span> <span class="comment">// end of [val]
</span>    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">in</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="comment">//
</span><span class="keyword">end</span> <span class="comment">// end of [d1exp_idextapp_tr]
</span>  
<span class="comment">(* ****** ****** *)</span>

<span class="comment">// [wths1es] is assumed to be not empty
</span><span class="keyword">fun</span> d1exp_wths1explst_tr
  <span class="keyword">(</span>d1e0<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">,</span> wths1es<span class="keyword">:</span> <span class="staexp">wths1explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> d1e0<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D1Eann_type <span class="keyword">(</span>d1e<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e
      <span class="keyword">val</span> s2e <span class="keyword">=</span> s1exp_res_tr_dn_impredicative <span class="keyword">(</span>s1e<span class="keyword">,</span> wths1es<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_ann_type <span class="keyword">(</span>d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d2e<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eann_type]
</span>  <span class="keyword">|</span> D1Eann_effc <span class="keyword">(</span>d1e<span class="keyword">,</span> efc<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_wths1explst_tr <span class="keyword">(</span>d1e<span class="keyword">,</span> wths1es<span class="keyword">)</span>
      <span class="keyword">val</span> s2fe <span class="keyword">=</span> effcst_tr <span class="keyword">(</span>efc<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_ann_seff <span class="keyword">(</span>d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d2e<span class="keyword">,</span> s2fe<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eann_effc]
</span>  <span class="keyword">|</span> D1Eann_funclo <span class="keyword">(</span>d1e<span class="keyword">,</span> fc<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_wths1explst_tr <span class="keyword">(</span>d1e<span class="keyword">,</span> wths1es<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_ann_funclo <span class="keyword">(</span>d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d2e<span class="keyword">,</span> fc<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of[D1Eann_funclo]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error2 d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">;</span>
      $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_wths1explst_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": the dynamic expression is expected to be ascribed a type but it is not."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">(* end of [d1exp_wths1explst_tr] *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> i1nvarglst_tr
  <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp">i1nvarglst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">i2nvarglst</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> xs <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>x<span class="keyword">,</span> xs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> the_d2expenv_find x<span class="keyword">.</span>i1nvarg_sym <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt d2i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2i <span class="keyword">of</span>
      <span class="keyword">|</span> D2ITEMvar d2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> os2e <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> x<span class="keyword">.</span>i1nvarg_typ <span class="keyword">of</span>
            <span class="keyword">|</span> Some s1e <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>s1exp_tr_dn_impredicative s1e<span class="keyword">)</span>
            <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2expopt</span>
          <span class="keyword">val</span> arg <span class="keyword">=</span> i2nvarg_make <span class="keyword">(</span>d2v<span class="keyword">,</span> os2e<span class="keyword">)</span>
        <span class="keyword">in</span>
          cons <span class="keyword">(</span>arg<span class="keyword">,</span> i1nvarglst_tr xs<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [D2ITEMvar]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          prerr_loc_error2 x<span class="keyword">.</span>i1nvarg_loc<span class="keyword">;</span>
          $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: i1nvarglst_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
          prerr ": the dynamic identifier ["<span class="keyword">;</span>
          prerr x<span class="keyword">.</span>i1nvarg_sym<span class="keyword">;</span>
          prerr "] does not refer to a variable."<span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          $Err<span class="keyword">.</span>abort <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">(* end of [Some_vt] *)</span>
    <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 x<span class="keyword">.</span>i1nvarg_loc<span class="keyword">;</span>
        $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: i1nvarglst_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": the dynamic identifier ["<span class="keyword">;</span>
        prerr x<span class="keyword">.</span>i1nvarg_sym<span class="keyword">;</span>
        prerr "] is unrecognized."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>    <span class="keyword">end</span> <span class="comment">(* end of [cons] *)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [i1nvarglst_tr]
</span>
<span class="keyword">fn</span> i1nvresstate_tr
  <span class="keyword">(</span>r1es<span class="keyword">:</span> <span class="staexp">i1nvresstate</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">i2nvresstate</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">@(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span> s1qualst_tr <span class="keyword">(</span>r1es<span class="keyword">.</span>i1nvresstate_qua<span class="keyword">)</span>
  <span class="keyword">val</span> body <span class="keyword">=</span> i1nvarglst_tr r1es<span class="keyword">.</span>i1nvresstate_arg
<span class="keyword">in</span>
  i2nvresstate_make <span class="keyword">(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> body<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [i1nvresstate_tr]
</span>
<span class="keyword">fn</span> loopi1nv_tr <span class="keyword">(</span>inv<span class="keyword">:</span> <span class="staexp">loopi1nv</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">loopi2nv</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">@(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span> s1qualst_tr <span class="keyword">(</span>inv<span class="keyword">.</span>loopi1nv_qua<span class="keyword">)</span>
  <span class="keyword">val</span> met <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> inv<span class="keyword">.</span>loopi1nv_met <span class="keyword">of</span>
    <span class="keyword">|</span> Some s1es <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>s1explst_tr_dn_int s1es<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2explstopt</span>
  <span class="keyword">val</span> arg <span class="keyword">=</span> i1nvarglst_tr inv<span class="keyword">.</span>loopi1nv_arg
  <span class="keyword">val</span> res <span class="keyword">=</span> i1nvresstate_tr inv<span class="keyword">.</span>loopi1nv_res
<span class="keyword">in</span>
  loopi2nv_make <span class="keyword">(</span>inv<span class="keyword">.</span>loopi1nv_loc<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> met<span class="keyword">,</span> arg<span class="keyword">,</span> res<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [loopi1nv_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> m1atch_tr
  <span class="keyword">(</span>m1at<span class="keyword">:</span> <span class="staexp">m1atch</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">m2atch</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr <span class="keyword">(</span>m1at<span class="keyword">.</span>m1atch_exp<span class="keyword">)</span>
  <span class="keyword">val</span> op2t <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> m1at<span class="keyword">.</span>m1atch_pat <span class="keyword">of</span>
    <span class="keyword">|</span> Some p1t <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> p2t <span class="keyword">=</span> p1at_tr p1t
        <span class="keyword">val</span> s2vs <span class="keyword">=</span> s2varlst_of_s2varlstord <span class="keyword">(</span>p2t<span class="keyword">.</span>p2at_svs<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_add_svarlst s2vs
        <span class="keyword">val</span> d2vs <span class="keyword">=</span> d2varlst_of_d2varlstord <span class="keyword">(</span>p2t<span class="keyword">.</span>p2at_dvs<span class="keyword">)</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_d2expenv_add_dvarlst d2vs
      <span class="keyword">in</span>
        Some p2t
      <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>    <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p2atopt</span> <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  m2atch_make <span class="keyword">(</span>m1at<span class="keyword">.</span>m1atch_loc<span class="keyword">,</span> d2e<span class="keyword">,</span> op2t<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [m1atch_tr]
</span>
<span class="keyword">fn</span> m1atchlst_tr <span class="keyword">(</span>m1ats<span class="keyword">:</span> <span class="staexp">m1atchlst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">m2atchlst</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>m1ats<span class="keyword">,</span> m1atch_tr<span class="keyword">)</span>
<span class="comment">// end of [m1atchlst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> c1lau_tr <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int n</span><span class="keyword">,</span> c1l<span class="keyword">:</span> <span class="staexp">c1lau</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">c2lau n</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> p1t <span class="keyword">=</span> c1l<span class="keyword">.</span>c1lau_pat
  <span class="keyword">val</span> p1ts <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> p1t<span class="keyword">.</span>p1at_node <span class="keyword">of</span>
    <span class="keyword">|</span> P1Tlist <span class="keyword">(</span>_<span class="comment">(*npf*)</span><span class="keyword">,</span> p1ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> p1ts <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>p1t<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p1atlst</span>
  <span class="keyword">val</span> p2ts<span class="keyword">:</span> <span class="staexp">p2atlst</span> <span class="keyword">=</span> p1atlst_tr p1ts
  <span class="keyword">stavar</span> <span class="staexp">np2ts<span class="keyword">:</span> int</span>
  <span class="keyword">val</span> np2ts<span class="keyword">:</span> <span class="staexp">int np2ts</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_length p2ts
<span class="comment">(*
  val () = begin
    printf ("c1lau_tr: n = %i and np2ts = %i\n", @(n, np2ts))
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> np2ts &lt;&gt; n <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr_loc_error2 c1l<span class="keyword">.</span>c1lau_loc<span class="keyword">;</span>
    $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: c1lau_tr"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">if</span> np2ts <span class="keyword">&lt;</span> n <span class="keyword">then</span> prerr ": this clause should contain more patterns."<span class="keyword">;</span>
    <span class="keyword">if</span> np2ts <span class="keyword">&gt;</span> n <span class="keyword">then</span> prerr ": this clause should contain less patterns."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    assert <span class="keyword">(</span>np2ts <span class="keyword">=</span> n<span class="keyword">)</span> <span class="comment">// deadcode
</span>  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// [np2ts = n] holds!
</span>  <span class="keyword">end</span><span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>np2ts==n<span class="keyword">]</span> void</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_env2</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_push <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> s2vs <span class="keyword">=</span> s2varlst_of_s2varlstord <span class="keyword">(</span>p2atlst_svs_union p2ts<span class="keyword">)</span>
  <span class="keyword">in</span>
    the_s2expenv_add_svarlst s2vs
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> d2vs <span class="keyword">=</span> d2varlst_of_d2varlstord <span class="keyword">(</span>p2atlst_dvs_union p2ts<span class="keyword">)</span>
  <span class="keyword">in</span>
    the_d2expenv_add_dvarlst d2vs
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> gua <span class="keyword">=</span> m1atchlst_tr <span class="keyword">(</span>c1l<span class="keyword">.</span>c1lau_gua<span class="keyword">)</span>
  <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr <span class="keyword">(</span>c1l<span class="keyword">.</span>c1lau_exp<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_pop <span class="keyword">(</span><span class="prfexp">pf_env2</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
<span class="keyword">in</span>
  c2lau_make <span class="keyword">(</span>c1l<span class="keyword">.</span>c1lau_loc<span class="keyword">,</span> p2ts<span class="keyword">,</span> gua<span class="keyword">,</span> c1l<span class="keyword">.</span>c1lau_seq<span class="keyword">,</span> c1l<span class="keyword">.</span>c1lau_neg<span class="keyword">,</span> d2e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [c1lau_tr]
</span>
<span class="keyword">fun</span> c1laulst_tr <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>n<span class="keyword">:</span> <span class="staexp">int n</span><span class="keyword">,</span> c1ls<span class="keyword">:</span> <span class="staexp">c1laulst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">c2laulst n</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> c1ls <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>c1l<span class="keyword">,</span> c1ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>c1lau_tr <span class="keyword">(</span>n<span class="keyword">,</span> c1l<span class="keyword">)</span><span class="keyword">,</span> c1laulst_tr <span class="keyword">(</span>n<span class="keyword">,</span> c1ls<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [c1laulst_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> sc1lau_tr_dn
  <span class="keyword">(</span>sc1l<span class="keyword">:</span> <span class="staexp">sc1lau</span><span class="keyword">,</span> s2t_pat<span class="keyword">:</span> <span class="staexp">s2rt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sc2lau</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_push <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> sp2t <span class="keyword">=</span> sp1at_tr_dn <span class="keyword">(</span>sc1l<span class="keyword">.</span>sc1lau_pat<span class="keyword">,</span> s2t_pat<span class="keyword">)</span>
  <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr <span class="keyword">(</span>sc1l<span class="keyword">.</span>sc1lau_exp<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_pop <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>  
<span class="keyword">in</span>
  sc2lau_make <span class="keyword">(</span>sc1l<span class="keyword">.</span>sc1lau_loc<span class="keyword">,</span> sp2t<span class="keyword">,</span> d2e<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [sc1lau_tr]
</span>
<span class="keyword">fun</span> sc1laulst_tr_dn
  <span class="keyword">(</span>sc1ls<span class="keyword">:</span> <span class="staexp">sc1laulst</span><span class="keyword">,</span> s2t_pat<span class="keyword">:</span> <span class="staexp">s2rt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">sc2laulst</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> sc1ls <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>sc1l<span class="keyword">,</span> sc1ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> sc2l <span class="keyword">=</span> sc1lau_tr_dn <span class="keyword">(</span>sc1l<span class="keyword">,</span> s2t_pat<span class="keyword">)</span>
      <span class="keyword">val</span> sc2ls <span class="keyword">=</span> sc1laulst_tr_dn <span class="keyword">(</span>sc1ls<span class="keyword">,</span> s2t_pat<span class="keyword">)</span>
    <span class="keyword">in</span>
      list_cons <span class="keyword">(</span>sc2l<span class="keyword">,</span> sc2ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [sc1laulst_tr_dn]
</span>
<span class="keyword">fn</span> sc2laulst_covercheck
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> sc2ls<span class="keyword">:</span> <span class="staexp">sc2laulst</span><span class="keyword">,</span> s2t_pat<span class="keyword">:</span> <span class="staexp">s2rt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2tb_pat <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> s2t_pat <span class="keyword">of</span>
    <span class="keyword">|</span> S2RTbas s2tb <span class="keyword">=&gt;</span> s2tb <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 loc0<span class="keyword">;</span>
        prerr ": the static expression being analyzed is of the sort ["<span class="keyword">;</span>
        prerr s2t_pat<span class="keyword">;</span> prerr "], which is not a base sort as is required."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s2rtbas<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2rtbas</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> s2tdat_pat <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> s2tb_pat <span class="keyword">of</span>
    <span class="keyword">|</span> S2RTBASdef s2td <span class="keyword">=&gt;</span> s2td <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_loc_error2 loc0<span class="keyword">;</span>
        prerr ": the static expression being analyzed is of the sort ["<span class="keyword">;</span>
        prerr s2t_pat<span class="keyword">;</span> prerr "], which is not a datasort as is required."<span class="keyword">;</span>
        prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s2rtdat_t<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2rtdat_t</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> s2cs <span class="keyword">=</span> s2rtdat_conlst_get <span class="keyword">(</span>s2tdat_pat<span class="keyword">)</span>
  <span class="keyword">val</span> ns2cs <span class="keyword">=</span> s2cstlst_length <span class="keyword">(</span>s2cs<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> A<span class="keyword">)</span> <span class="keyword">=</span> $Arr<span class="keyword">.</span>array_ptr_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>ns2cs<span class="keyword">,</span> 0<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> check <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> A<span class="keyword">,</span> ns2cs<span class="keyword">,</span> sc2ls<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> check <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
        <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>array_v <span class="keyword">(</span>int<span class="keyword">,</span> n<span class="keyword">,</span> l<span class="keyword">)</span></span></span> <span class="keyword">|</span> p<span class="keyword">:</span> <span class="staexp">ptr l</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span><span class="keyword">,</span> sc2ls<span class="keyword">:</span> <span class="staexp">sc2laulst</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">case+</span> sc2ls <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>sc2l<span class="keyword">,</span> sc2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> sp2t <span class="keyword">=</span> sc2l<span class="keyword">.</span>sc2lau_pat
          <span class="keyword">val+</span> SP2Tcon <span class="keyword">(</span>s2c<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=</span> sp2t<span class="keyword">.</span>sp2at_node
          <span class="keyword">val</span> tag <span class="keyword">=</span> s2cst_tag_get <span class="keyword">(</span>s2c<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> tag <span class="keyword">=</span> int1_of_int tag
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>tag &gt;= 0<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> assert <span class="keyword">(</span>tag <span class="keyword">&lt;</span> n<span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>p<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">tag</span><span class="keyword">]</span> := p<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">tag</span><span class="keyword">]</span> + 1<span class="keyword">)</span> <span class="comment">// end of [val]
</span>        <span class="keyword">in</span>
          check <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> p<span class="keyword">,</span> n<span class="keyword">,</span> sc2ls<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="comment">// end of [check]
</span>  <span class="keyword">}</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> err <span class="keyword">=</span> loop_errmsg
    <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> A<span class="keyword">,</span> ns2cs<span class="keyword">,</span> s2cs<span class="keyword">,</span> 0<span class="keyword">,</span> 0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> loop_errmsg <span class="staexp"><span class="keyword">{</span>n<span class="keyword">,</span>i<span class="keyword">:</span>nat <span class="keyword">|</span> i &lt;= n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>n-i<span class="keyword">&gt;.</span></span> <span class="keyword">(</span>
        <span class="prfexp">pf<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>array_v <span class="keyword">(</span>int<span class="keyword">,</span> n<span class="keyword">,</span> l<span class="keyword">)</span></span></span>
      <span class="keyword">|</span> loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> p<span class="keyword">:</span> <span class="staexp">ptr l</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp">s2cstlst</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int i</span><span class="keyword">,</span> err<span class="keyword">:</span> <span class="staexp">int</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span>
      <span class="keyword">if</span> i <span class="keyword">&lt;</span> n <span class="keyword">then</span> <span class="keyword">let</span>
        <span class="keyword">val</span> times <span class="keyword">=</span> p<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">i</span><span class="keyword">]</span> <span class="keyword">in</span> <span class="keyword">case+</span> s2cs <span class="keyword">of</span>
        <span class="keyword">|</span> S2CSTLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> 0 <span class="keyword">of</span>
          <span class="keyword">|</span> _ <span class="keyword">when</span> times <span class="keyword">=</span> 1 <span class="keyword">=&gt;</span> loop_errmsg <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> p<span class="keyword">,</span> n<span class="keyword">,</span> s2cs<span class="keyword">,</span> i+1<span class="keyword">,</span> err<span class="keyword">)</span>
          <span class="keyword">|</span> _ <span class="keyword">when</span> times <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              prerr_loc_error2 loc0<span class="keyword">;</span>
              prerr ": ill-formed static case-expression"<span class="keyword">;</span>
              prerr ": the constructor ["<span class="keyword">;</span> prerr s2c<span class="keyword">;</span> prerr "] is missing."<span class="keyword">;</span>
              prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              loop_errmsg <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> p<span class="keyword">,</span> n<span class="keyword">,</span> s2cs<span class="keyword">,</span> i+1<span class="keyword">,</span> err+1<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [_ when times = 0]
</span>          <span class="keyword">|</span> _ <span class="comment">(* times &gt; 1 *)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
              prerr_loc_error2 loc0<span class="keyword">;</span>
              prerr ": ill-formed static case-expression"<span class="keyword">;</span>
              prerr ": the constructor ["<span class="keyword">;</span> prerr s2c<span class="keyword">;</span> prerr "] occurs repeatedly."<span class="keyword">;</span>
              prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
              loop_errmsg <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> p<span class="keyword">,</span> n<span class="keyword">,</span> s2cs<span class="keyword">,</span> i+1<span class="keyword">,</span> err+1<span class="keyword">)</span>
            <span class="keyword">end</span> <span class="comment">// end of [_ when times &gt; 0]
</span>          <span class="keyword">end</span> <span class="comment">(* end of [S2CSTLSTcons] *)</span>
        <span class="keyword">|</span> S2CSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> err <span class="comment">// deadcode!
</span>      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
        err <span class="comment">// loop exists
</span>      <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
  <span class="keyword">}</span> <span class="comment">(* end of [loop_errmsg] *)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Arr<span class="keyword">.</span>array_ptr_free <span class="staexp"><span class="keyword">{</span>int<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> A<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> err <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="comment">// empty
</span><span class="keyword">end</span> <span class="comment">// end of [sc2laulst_covercheck]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> lamvararg_proc
  <span class="keyword">(</span>p2ts<span class="keyword">:</span> <span class="staexp">p2atlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p2atlst</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> proc <span class="keyword">(</span>p2ts<span class="keyword">:</span> <span class="staexp">p2atlst</span><span class="keyword">,</span> flag<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">p2atlst</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> p2ts <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>p2t<span class="keyword">,</span> p2ts1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p2t<span class="keyword">.</span>p2at_node <span class="keyword">of</span>
      <span class="keyword">|</span> P2Tann <span class="keyword">(</span>p2t1<span class="keyword">,</span> s2e1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">case+</span> 0 <span class="keyword">of</span>
          <span class="keyword">|</span> _ <span class="keyword">when</span> s2exp_is_types <span class="keyword">(</span>s2e1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> p2ts1 <span class="keyword">of</span>
            <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
                <span class="keyword">val</span> p2t <span class="keyword">=</span> p2at_ann <span class="keyword">(</span>p2t<span class="keyword">.</span>p2at_loc<span class="keyword">,</span> p2t1<span class="keyword">,</span> s2exp_vararg s2e1<span class="keyword">)</span>
                <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> flag := flag + 1
              <span class="keyword">in</span>
                list_cons <span class="keyword">(</span>p2t<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
              <span class="keyword">end</span> <span class="comment">// end of [list_nil]
</span>            <span class="keyword">|</span> list_cons _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                prerr_loc_error2 p2t<span class="keyword">.</span>p2at_loc<span class="keyword">;</span>
                $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: lamvararg_proc: proc"<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
                prerr ": this function argument must be the last one."<span class="keyword">;</span>
                prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
                $Err<span class="keyword">.</span>abort <span class="keyword">(</span><span class="keyword">)</span>
              <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>            <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> flag0 <span class="keyword">=</span> flag<span class="keyword">;</span> <span class="keyword">val</span> p2ts1 <span class="keyword">=</span> proc <span class="keyword">(</span>p2ts1<span class="keyword">,</span> flag<span class="keyword">)</span>
            <span class="keyword">in</span>
              <span class="keyword">if</span> flag <span class="keyword">&gt;</span> flag0 <span class="keyword">then</span> list_cons <span class="keyword">(</span>p2t<span class="keyword">,</span> p2ts1<span class="keyword">)</span> <span class="keyword">else</span> p2ts
            <span class="keyword">end</span> <span class="comment">// end of [_]
</span>        <span class="keyword">)</span> <span class="comment">// end of [P2Tann]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> flag0 <span class="keyword">=</span> flag<span class="keyword">;</span> <span class="keyword">val</span> p2ts1 <span class="keyword">=</span> proc <span class="keyword">(</span>p2ts1<span class="keyword">,</span> flag<span class="keyword">)</span>
        <span class="keyword">in</span>
          <span class="keyword">if</span> flag <span class="keyword">&gt;</span> flag0 <span class="keyword">then</span> list_cons <span class="keyword">(</span>p2t<span class="keyword">,</span> p2ts1<span class="keyword">)</span> <span class="keyword">else</span> p2ts
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [proc]
</span>  <span class="keyword">var</span> flag<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
<span class="keyword">in</span>
  proc <span class="keyword">(</span>p2ts<span class="keyword">,</span> flag<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [lamvararg_proc]
</span>
<span class="keyword">fn</span> d1exp_arg_body_tr
  <span class="keyword">(</span>p1t_arg<span class="keyword">:</span> <span class="staexp">p1at</span><span class="keyword">,</span> d1e_body<span class="keyword">:</span> <span class="staexp">d1exp</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp"><span class="keyword">@(</span>int<span class="keyword">,</span> p2atlst<span class="keyword">,</span> d2exp<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> wths1es <span class="keyword">=</span> WTHS1EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> p2t_arg <span class="keyword">=</span> p1at_arg_tr <span class="keyword">(</span>p1t_arg<span class="keyword">,</span> wths1es<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> wths1es := wths1explst_reverse wths1es
  <span class="keyword">var</span> npf<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> p2ts_arg <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">case+</span> p2t_arg<span class="keyword">.</span>p2at_node <span class="keyword">of</span>
    <span class="keyword">|</span> P2Tlist <span class="keyword">(</span>npf1<span class="keyword">,</span> p2ts<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>npf := npf1<span class="keyword">;</span> p2ts<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> cons <span class="keyword">(</span>p2t_arg<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">p2atlst</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_push <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> s2vs <span class="keyword">=</span> s2varlst_of_s2varlstord p2t_arg<span class="keyword">.</span>p2at_svs
  <span class="keyword">in</span>
    the_s2expenv_add_svarlst s2vs
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> d2vs <span class="keyword">=</span> d2varlst_of_d2varlstord p2t_arg<span class="keyword">.</span>p2at_dvs
  <span class="keyword">in</span>
    the_d2expenv_add_dvarlst d2vs
  <span class="keyword">end</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_level</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> d2var_current_level_inc <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> d2e_body <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">if</span> wths1explst_is_none wths1es <span class="keyword">then</span> <span class="keyword">begin</span>
      d1exp_tr d1e_body <span class="comment">// regular translation
</span>    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
      d1exp_wths1explst_tr <span class="keyword">(</span>d1e_body<span class="keyword">,</span> wths1es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [if]
</span>  <span class="keyword">end</span> <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> d2var_current_level_dec <span class="keyword">(</span><span class="prfexp">pf_level</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_pop <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> p2ts_arg <span class="keyword">=</span> lamvararg_proc <span class="keyword">(</span>p2ts_arg<span class="keyword">)</span> <span class="comment">// HX-2010-08-26: for handling variadic functions
</span><span class="comment">//
</span><span class="keyword">in</span>
  <span class="keyword">@(</span>npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [d1exp_arg_body_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
d1exp_tr <span class="keyword">(</span>d1e0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> loc0 <span class="keyword">=</span> d1e0<span class="keyword">.</span>d1exp_loc
<span class="comment">(*
  val () = begin
    print "d1exp_tr: d1e0 = "; print_d1exp d1e0; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> d1e0<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> D1Eann_type <span class="keyword">(</span>d1e<span class="keyword">,</span> s1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e
      <span class="keyword">val</span> s2e <span class="keyword">=</span> s1exp_tr_dn_impredicative <span class="keyword">(</span>s1e<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_ann_type <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> s2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eann_type]
</span>  <span class="keyword">|</span> D1Eann_effc <span class="keyword">(</span>d1e<span class="keyword">,</span> efc<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e<span class="keyword">;</span> <span class="keyword">val</span> s2fe <span class="keyword">=</span> effcst_tr <span class="keyword">(</span>efc<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_ann_seff <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> s2fe<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eann_effc]
</span>  <span class="keyword">|</span> D1Eann_funclo <span class="keyword">(</span>d1e<span class="keyword">,</span> fc<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e <span class="keyword">in</span> d2exp_ann_funclo <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> fc<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Efunclo]
</span>  <span class="keyword">|</span> D1Eapp_dyn <span class="keyword">(</span>
      d1e_fun<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc1 <span class="keyword">=</span> d1e_fun<span class="keyword">.</span>d1exp_loc
      <span class="keyword">val</span> d1e_fun <span class="keyword">=</span> d1exp_make_d1exp d1e_fun
    <span class="keyword">in</span>
      <span class="keyword">case+</span> d1e_fun<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
      <span class="keyword">|</span> D1Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> spdid <span class="keyword">=</span> specdynid_of_qid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span>
        <span class="keyword">in</span>
          <span class="keyword">case+</span> spdid <span class="keyword">of</span>
          <span class="keyword">|</span> <span class="keyword">~</span>SPDIDnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_qid_app_dyn_tr <span class="keyword">(</span>
              loc0<span class="keyword">,</span> loc1<span class="keyword">,</span> loc1<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> <span class="keyword">'[</span><span class="keyword">]</span><span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg
            <span class="keyword">)</span> <span class="comment">// end of [SPDIDnone]
</span>          <span class="keyword">|</span> <span class="keyword">~</span>SPDIDassgn <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_assgn_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> darg<span class="keyword">)</span>
          <span class="keyword">|</span> <span class="keyword">~</span>SPDIDderef <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_deref_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> darg<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [D1Eapp_dyn]
</span>      <span class="keyword">|</span> D1Eapp_sta <span class="keyword">(</span>d1e_fun<span class="keyword">,</span> sarg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d1e_fun <span class="keyword">=</span> d1exp_make_d1exp d1e_fun
        <span class="keyword">in</span>
          <span class="keyword">case+</span> d1e_fun<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
          <span class="keyword">|</span> D1Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> loc_qid <span class="keyword">=</span> d1e_fun<span class="keyword">.</span>d1exp_loc
            <span class="keyword">in</span>
              d1exp_qid_app_dyn_tr <span class="keyword">(</span>
                loc0<span class="keyword">,</span> loc1<span class="keyword">,</span> loc_qid<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> sarg<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg
              <span class="keyword">)</span> <span class="comment">// end of [d1exp_qid_app_dyn_tr]
</span>            <span class="keyword">end</span> <span class="comment">// end of [D1Eqid]
</span>          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d1exp_tr d1e_fun
              <span class="keyword">val</span> sarg <span class="keyword">=</span> s1exparglst_tr sarg
              <span class="keyword">val</span> darg <span class="keyword">=</span> d1explst_tr darg
            <span class="keyword">in</span>
              d2exp_app_sta_dyn <span class="keyword">(</span>
                loc0<span class="keyword">,</span> loc1<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> sarg<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg
              <span class="keyword">)</span> <span class="comment">// end of [d1exp_app_sta_dyn]
</span>            <span class="keyword">end</span> <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">// end of [D1Eapp_sta]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d1exp_tr d1e_fun
          <span class="keyword">val</span> darg <span class="keyword">=</span> d1explst_tr darg
        <span class="keyword">in</span>
          d2exp_app_dyn <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> loc_arg<span class="keyword">,</span> npf<span class="keyword">,</span> darg<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D1Eapp_dyn]
</span>  <span class="keyword">|</span> D1Eapp_sta <span class="keyword">(</span>d1e_fun<span class="keyword">,</span> sarg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d1e_fun <span class="keyword">=</span> d1exp_make_d1exp d1e_fun
    <span class="keyword">in</span>
      <span class="keyword">case+</span> d1e_fun<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
      <span class="keyword">|</span> D1Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          d1exp_qid_app_sta_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e_fun<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">,</span> sarg<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [D1Eqid]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d2e_fun <span class="keyword">=</span> d1exp_tr d1e_fun
          <span class="keyword">val</span> sarg <span class="keyword">=</span> s1exparglst_tr sarg
        <span class="keyword">in</span>
          d2exp_app_sta <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_fun<span class="keyword">,</span> sarg<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D1Eapp_sta]
</span>  <span class="keyword">|</span> D1Earrinit <span class="keyword">(</span>s1e_elt<span class="keyword">,</span> od1e_asz<span class="keyword">,</span> d1es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2t_elt <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> od1e_asz <span class="keyword">of</span>
        <span class="keyword">|</span> Some _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d1es_elt <span class="keyword">of</span>
          <span class="keyword">|</span> list_cons _ <span class="comment">(*initialized*)</span> <span class="keyword">=&gt;</span> s2rt_t0ype <span class="comment">// cannot be linear
</span>          <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">(*uninitialized*)</span> <span class="keyword">=&gt;</span> s2rt_viewt0ype <span class="comment">// can be linear
</span>          <span class="keyword">end</span> <span class="comment">// end of [Some]
</span>        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s2rt_viewt0ype <span class="comment">// can be linear
</span>      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2rt</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> s2e_elt <span class="keyword">=</span> s1exp_tr_dn <span class="keyword">(</span>s1e_elt<span class="keyword">,</span> s2t_elt<span class="keyword">)</span>
      <span class="keyword">val</span> od2e_asz <span class="keyword">=</span> d1expopt_tr od1e_asz<span class="keyword">;</span> <span class="keyword">val</span> d2es_elt <span class="keyword">=</span> d1explst_tr d1es_elt
    <span class="keyword">in</span>
      d2exp_arrinit <span class="keyword">(</span>loc0<span class="keyword">,</span> s2e_elt<span class="keyword">,</span> od2e_asz<span class="keyword">,</span> d2es_elt<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Earrinit]
</span>  <span class="keyword">|</span> D1Earrsize <span class="keyword">(</span>os1e_elt<span class="keyword">,</span> d1es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> os2e_elt <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> os1e_elt <span class="keyword">of</span>
        <span class="keyword">|</span> Some s1e <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>s1exp_tr_dn <span class="keyword">(</span>s1e<span class="keyword">,</span> s2rt_viewt0ype<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2expopt</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> d2es_elt <span class="keyword">=</span> d1explst_tr d1es_elt
    <span class="keyword">in</span>
      d2exp_arrsize <span class="keyword">(</span>loc0<span class="keyword">,</span> os2e_elt<span class="keyword">,</span> d2es_elt<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Earrsize]
</span>  <span class="keyword">|</span> D1Earrsub <span class="keyword">(</span>d1e_arr<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d1ess_ind<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d1exp_arrsub_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> d1e_arr<span class="keyword">,</span> loc_ind<span class="keyword">,</span> d1ess_ind<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Earrsub]
</span>  <span class="keyword">|</span> D1Ebool tf <span class="keyword">=&gt;</span> d2exp_bool <span class="keyword">(</span>loc0<span class="keyword">,</span> tf<span class="keyword">)</span>
  <span class="keyword">|</span> D1Echar chr <span class="keyword">=&gt;</span> d2exp_char <span class="keyword">(</span>loc0<span class="keyword">,</span> chr<span class="keyword">)</span>
  <span class="keyword">|</span> D1Ecstsp cst <span class="keyword">=&gt;</span> d2exp_cstsp <span class="keyword">(</span>loc0<span class="keyword">,</span> cst<span class="keyword">)</span>
  <span class="keyword">|</span> D1Ecaseof <span class="keyword">(</span>knd<span class="keyword">,</span> r1es<span class="keyword">,</span> d1es<span class="keyword">,</span> c1ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> r2es <span class="keyword">=</span> i1nvresstate_tr r1es
      <span class="keyword">val</span> d2es <span class="keyword">=</span> d1explst_tr d1es
      <span class="keyword">val</span> nd2es <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_length d2es
      <span class="keyword">val</span> c2ls <span class="keyword">=</span> c1laulst_tr <span class="keyword">(</span>nd2es<span class="keyword">,</span> c1ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_caseof <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> r2es<span class="keyword">,</span> nd2es<span class="keyword">,</span> d2es<span class="keyword">,</span> c2ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Ecaseof]
</span>  <span class="keyword">|</span> D1Ecrypt <span class="keyword">(</span>knd<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_crypt <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Ecrypt]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D1Edecseq <span class="keyword">(</span>d1cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d2cs <span class="keyword">=</span> d1eclst_tr <span class="keyword">(</span>d1cs<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_pop <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d2exp_empty <span class="keyword">(</span>loc0<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_let <span class="keyword">(</span>loc0<span class="keyword">,</span> d2cs<span class="keyword">,</span> d2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Edecseq]
</span><span class="comment">//
</span>  <span class="keyword">|</span> D1Edynload fil <span class="keyword">=&gt;</span> d2exp_dynload <span class="keyword">(</span>loc0<span class="keyword">,</span> fil<span class="keyword">)</span>
  <span class="keyword">|</span> D1Eeffmask <span class="keyword">(</span>effs<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_effmask <span class="keyword">(</span>loc0<span class="keyword">,</span> effs<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eeffmask]
</span>  <span class="keyword">|</span> D1Eempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_empty <span class="keyword">(</span>loc0<span class="keyword">)</span>
  <span class="keyword">|</span> D1Eexist <span class="keyword">(</span>s1a<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      d2exp_exist <span class="keyword">(</span>loc0<span class="keyword">,</span> s1exparg_tr s1a<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
  <span class="keyword">|</span> D1Eextval <span class="keyword">(</span>s1e<span class="keyword">,</span> code<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      d2exp_extval <span class="keyword">(</span>loc0<span class="keyword">,</span> s1exp_tr_dn_viewt0ype s1e<span class="keyword">,</span> code<span class="keyword">)</span>
  <span class="keyword">|</span> D1Efix <span class="keyword">(</span>knd<span class="keyword">,</span> id<span class="keyword">,</span> d1e_def<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2v <span class="keyword">=</span> d2var_make <span class="keyword">(</span>id<span class="keyword">.</span>i0de_loc<span class="keyword">,</span> id<span class="keyword">.</span>i0de_sym<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> d2var_isfix_set <span class="keyword">(</span>d2v<span class="keyword">,</span> true<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_d2expenv</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> the_d2expenv_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_d2expenv_add_dvar d2v
      <span class="keyword">val</span> d2e_def <span class="keyword">=</span> d1exp_tr <span class="keyword">(</span>d1e_def<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_d2expenv_pop <span class="keyword">(</span><span class="prfexp">pf_d2expenv</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_fix <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d2v<span class="keyword">,</span> d2e_def<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Efix]
</span>  <span class="keyword">|</span> D1Efloat f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> d2exp_float <span class="keyword">(</span>d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> f<span class="keyword">)</span>
  <span class="keyword">|</span> D1Efloatsp f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> d2exp_floatsp <span class="keyword">(</span>d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> f<span class="keyword">)</span>
  <span class="keyword">|</span> D1Efoldat <span class="keyword">(</span>s1as<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_foldat <span class="keyword">(</span>loc0<span class="keyword">,</span> s1exparglst_tr s1as<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Efoldat]
</span>  <span class="keyword">|</span> D1Efor <span class="keyword">(</span>
      inv<span class="keyword">,</span> ini<span class="keyword">,</span> test<span class="keyword">,</span> post<span class="keyword">,</span> body
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ini <span class="keyword">=</span> d1exp_tr ini
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> inv <span class="keyword">=</span> loopi1nv_tr inv
      <span class="keyword">val</span> test <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> test<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
        <span class="keyword">|</span> D1Eempty <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_bool <span class="keyword">(</span>loc0<span class="keyword">,</span> true<span class="keyword">)</span> <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> d1exp_tr test
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">d2exp</span> <span class="comment">// end of [val]
</span>      <span class="keyword">val</span> post <span class="keyword">=</span> d1exp_tr post
      <span class="keyword">val</span> body <span class="keyword">=</span> d1exp_tr body
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_pop <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_for <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> ini<span class="keyword">,</span> test<span class="keyword">,</span> post<span class="keyword">,</span> body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Efor]
</span>  <span class="keyword">|</span> D1Efreeat <span class="keyword">(</span>s1as<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_freeat <span class="keyword">(</span>loc0<span class="keyword">,</span> s1exparglst_tr s1as<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Efreeat]
</span>  <span class="keyword">|</span> D1Eidextapp <span class="keyword">(</span>id<span class="keyword">,</span> _<span class="comment">(*ns*)</span><span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_idextapp_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> id<span class="keyword">,</span> d1es<span class="keyword">)</span>
  <span class="keyword">|</span> D1Eif <span class="keyword">(</span>
      r1es<span class="keyword">,</span> d1e_cond<span class="keyword">,</span> d1e_then<span class="keyword">,</span> od1e_else
    <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> r2es <span class="keyword">=</span> i1nvresstate_tr r1es
      <span class="keyword">val</span> d2e_cond <span class="keyword">=</span> d1exp_tr d1e_cond
      <span class="keyword">val</span> d2e_then <span class="keyword">=</span> d1exp_tr d1e_then
      <span class="keyword">val</span> od2e_else <span class="keyword">=</span> d1expopt_tr od1e_else
    <span class="keyword">in</span>
      d2exp_if <span class="keyword">(</span>loc0<span class="keyword">,</span> r2es<span class="keyword">,</span> d2e_cond<span class="keyword">,</span> d2e_then<span class="keyword">,</span> od2e_else<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eif]
</span>  <span class="keyword">|</span> D1Eint str<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_int <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">,</span> $IntInf<span class="keyword">.</span>intinf_make_string str<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eint]
</span>  <span class="keyword">|</span> D1Eintsp str<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_intsp <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">,</span> $IntInf<span class="keyword">.</span>intinf_make_stringsp str<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eintsp]
</span>  <span class="keyword">|</span> D1Elam_dyn <span class="keyword">(</span>lin<span class="keyword">,</span> p1t_arg<span class="keyword">,</span> d1e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">@(</span>npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=</span> d1exp_arg_body_tr <span class="keyword">(</span>p1t_arg<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_lam_dyn <span class="keyword">(</span>loc0<span class="keyword">,</span> lin<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elam_dyn]
</span>  <span class="keyword">|</span> D1Elaminit_dyn <span class="keyword">(</span>lin<span class="keyword">,</span> p1t_arg<span class="keyword">,</span> d1e_body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">@(</span>npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span> <span class="keyword">=</span> d1exp_arg_body_tr <span class="keyword">(</span>p1t_arg<span class="keyword">,</span> d1e_body<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_laminit_dyn <span class="keyword">(</span>loc0<span class="keyword">,</span> lin<span class="keyword">,</span> npf<span class="keyword">,</span> p2ts_arg<span class="keyword">,</span> d2e_body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elam_dyn]
</span>  <span class="keyword">|</span> D1Elam_met <span class="keyword">(</span>_<span class="keyword">,</span> met<span class="keyword">,</span> body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> met <span class="keyword">=</span> s1explst_tr_up met<span class="keyword">;</span> <span class="keyword">val</span> body <span class="keyword">=</span> d1exp_tr body
    <span class="keyword">in</span>
      d2exp_lam_met_new <span class="keyword">(</span>loc0<span class="keyword">,</span> met<span class="keyword">,</span> body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elam_met]
</span>  <span class="keyword">|</span> D1Elam_sta_ana _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_error2 loc0<span class="keyword">;</span>
      $Deb<span class="keyword">.</span>debug_prerrf <span class="keyword">(</span>": %s: d1exp_tr: D1Elam_sta_ana: "<span class="keyword">,</span> <span class="keyword">@(</span>THISFILENAME<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": illegal use of static lambda-abstraction in analysis form."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elam_sta_ana]
</span>  <span class="keyword">|</span> D1Elam_sta_syn <span class="keyword">(</span>_<span class="keyword">,</span> s1qs<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">@(</span>s2vs<span class="keyword">,</span> s2ps<span class="keyword">)</span> <span class="keyword">=</span> s1qualst_tr <span class="keyword">(</span>s1qs<span class="keyword">)</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_pop <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_lam_sta <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s2ps<span class="keyword">,</span> d2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elam_sta_syn]
</span>  <span class="keyword">|</span> D1Elazy_delay <span class="keyword">(</span>lin<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> 0 <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> lin <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e <span class="keyword">in</span> d2exp_lazy_delay <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when lin = 0]
</span>    <span class="keyword">|</span> _ <span class="comment">(* lin = 1 *)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d1e<span class="keyword">.</span>d1exp_node <span class="keyword">of</span>
      <span class="keyword">|</span> D1Elist <span class="keyword">(</span>_<span class="comment">(*npf*)</span><span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d1es <span class="keyword">of</span>
        <span class="keyword">|</span> cons <span class="keyword">(</span>d1e1<span class="keyword">,</span> cons <span class="keyword">(</span>d1e2<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> d2e1 <span class="keyword">=</span> d1exp_tr d1e1 <span class="keyword">and</span> d2e2 <span class="keyword">=</span> d1exp_tr d1e2
          <span class="keyword">in</span>
            d2exp_lazy_vt_delay <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e1<span class="keyword">,</span> d2e2<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [cons (_, cons (_, nil))]
</span>        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
            <span class="keyword">val</span> n <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_length d1es
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_loc_error2 loc0
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> n <span class="keyword">&gt;</span> 2 <span class="keyword">then</span> prerr ": less argumnets should be given."
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> n <span class="keyword">&lt;</span> 2 <span class="keyword">then</span> prerr ": more argumnets should be given."
            <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">}</span> <span class="comment">// end of [_]
</span>        <span class="keyword">end</span> <span class="comment">// end of [D1Elist]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> d2e1 <span class="keyword">=</span> d1exp_tr d1e <span class="keyword">and</span> d2e2 <span class="keyword">=</span> d2exp_empty <span class="keyword">(</span>d1e<span class="keyword">.</span>d1exp_loc<span class="keyword">)</span>
        <span class="keyword">in</span>
          d2exp_lazy_vt_delay <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e1<span class="keyword">,</span> d2e2<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [_ when lin = 1]
</span>    <span class="keyword">end</span> <span class="comment">(* end of [D1Elazy_delay] *)</span>
  <span class="keyword">|</span> D1Elet <span class="keyword">(</span>d1cs<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d2cs <span class="keyword">=</span> d1eclst_tr d1cs<span class="keyword">;</span> <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_pop <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_let <span class="keyword">(</span>loc0<span class="keyword">,</span> d2cs<span class="keyword">,</span> d2e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elet]
</span>  <span class="keyword">|</span> D1Elist <span class="keyword">(</span>npf<span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d1es <span class="keyword">of</span>
    <span class="keyword">|</span> cons _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> d2es <span class="keyword">=</span> d1explst_tr d1es <span class="keyword">in</span> d2exp_tup <span class="keyword">(</span>loc0<span class="keyword">,</span> 0<span class="keyword">,</span> npf<span class="keyword">,</span> d2es<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [cons]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_empty <span class="keyword">(</span>loc0<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elist]
</span>  <span class="keyword">|</span> D1Eloopexn flag <span class="keyword">=&gt;</span> d2exp_loopexn <span class="keyword">(</span>loc0<span class="keyword">,</span> flag<span class="keyword">)</span>
  <span class="keyword">|</span> D1Elst <span class="keyword">(</span>lin<span class="keyword">,</span> os1e_elt<span class="keyword">,</span> d1es_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2t_elt<span class="keyword">:</span> <span class="staexp">s2rt</span> <span class="keyword">=</span>
        <span class="keyword">if</span> lin <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> s2rt_viewt0ype <span class="keyword">else</span> s2rt_t0ype
      <span class="keyword">val</span> os2e_elt <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">case+</span> os1e_elt <span class="keyword">of</span>
        <span class="keyword">|</span> Some s1e_elt <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>s1exp_tr_dn <span class="keyword">(</span>s1e_elt<span class="keyword">,</span> s2t_elt<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2expopt</span>
      <span class="keyword">val</span> d2es_elt <span class="keyword">=</span> d1explst_tr d1es_elt
    <span class="keyword">in</span>
      d2exp_lst <span class="keyword">(</span>loc0<span class="keyword">,</span> lin<span class="keyword">,</span> os2e_elt<span class="keyword">,</span> d2es_elt<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Elst]
</span>  <span class="keyword">|</span> D1Emacsyn <span class="keyword">(</span>knd<span class="keyword">,</span> d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
      val () = begin
        print "d1exp_tr: D1Emacsyn: knd = "; print d1e; print_newline ();
        print "d1exp_tr: D1Emacsyn: d1e = "; print d1e; print_newline ();
      end // end of [val]
*)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> knd <span class="keyword">of</span>
      <span class="keyword">|</span> $Syn<span class="keyword">.</span>MACSYNKINDcross <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="comment">// val mdef = macdef_get ()
</span>          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_level_dec <span class="keyword">(</span>loc0<span class="keyword">)</span>
          <span class="comment">// val level = macro_level_get ()
</span>          <span class="keyword">val</span> d2e0 <span class="keyword">=</span> d2exp_macsyn <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_level_inc <span class="keyword">(</span>loc0<span class="keyword">)</span>
        <span class="keyword">in</span>
          d2e0 <span class="comment">// if (mdef + level = 0) then $MAC.macro_eval_cross (d2e0) else d2e0
</span>        <span class="keyword">end</span> <span class="comment">// end of [MACSYNKINDcross]
</span>      <span class="keyword">|</span> $Syn<span class="keyword">.</span>MACSYNKINDdecode <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="comment">// val mdef = macdef_get ()
</span>          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_level_dec <span class="keyword">(</span>loc0<span class="keyword">)</span>
          <span class="comment">// val level = macro_level_get ()
</span>          <span class="keyword">val</span> d2e0 <span class="keyword">=</span> d2exp_macsyn <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_level_inc <span class="keyword">(</span>loc0<span class="keyword">)</span>
        <span class="keyword">in</span>
          d2e0 <span class="comment">// if (mdef + level = 0) then $MAC.macro_eval_decode (d2e0) else d2e0
</span>        <span class="keyword">end</span> <span class="comment">// end of [MACSYNKINDdecode]
</span>      <span class="keyword">|</span> $Syn<span class="keyword">.</span>MACSYNKINDencode <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_level_inc <span class="keyword">(</span>loc0<span class="keyword">)</span>
          <span class="keyword">val</span> d2e0 <span class="keyword">=</span> d2exp_macsyn <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> macro_level_dec <span class="keyword">(</span>loc0<span class="keyword">)</span>
        <span class="keyword">in</span>
          d2e0
        <span class="keyword">end</span> <span class="comment">// end of [DACSYNKINDencode]
</span>    <span class="keyword">end</span> <span class="comment">// end of [D1Emacsyn]
</span><span class="comment">(*
  | D1Emod (m1ids) =&gt; d2exp_mod (loc, mid1_list_tr m1ids)
*)</span>
  <span class="keyword">|</span> D1Eqid <span class="keyword">(</span>q<span class="keyword">,</span> id<span class="keyword">)</span> <span class="keyword">=&gt;</span> d1exp_qid_tr <span class="keyword">(</span>loc0<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">)</span>
  <span class="keyword">|</span> D1Eptrof d1e <span class="keyword">=&gt;</span> d2exp_ptrof <span class="keyword">(</span>loc0<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
  <span class="keyword">|</span> D1Eraise <span class="keyword">(</span>d1e<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_raise <span class="keyword">(</span>loc0<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Eraise]
</span>  <span class="keyword">|</span> D1Erec <span class="keyword">(</span>recknd<span class="keyword">,</span> ld1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_rec <span class="keyword">(</span>loc0<span class="keyword">,</span> recknd<span class="keyword">,</span> 0<span class="comment">(*npf*)</span><span class="keyword">,</span> labd1explst_tr ld1es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Erec]
</span>  <span class="keyword">|</span> D1Escaseof <span class="keyword">(</span>r1es<span class="keyword">,</span> s1e<span class="keyword">,</span> sc1ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> r2es <span class="keyword">=</span> i1nvresstate_tr r1es
      <span class="keyword">val</span> s2e <span class="keyword">=</span> s1exp_tr_up s1e<span class="keyword">;</span> <span class="keyword">val</span> s2t_pat <span class="keyword">=</span> s2e<span class="keyword">.</span>s2exp_srt
      <span class="keyword">val</span> sc2ls <span class="keyword">=</span> sc1laulst_tr_dn <span class="keyword">(</span>sc1ls<span class="keyword">,</span> s2t_pat<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> sc2laulst_covercheck <span class="keyword">(</span>loc0<span class="keyword">,</span> sc2ls<span class="keyword">,</span> s2t_pat<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_scaseof <span class="keyword">(</span>loc0<span class="keyword">,</span> r2es<span class="keyword">,</span> s2e<span class="keyword">,</span> sc2ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Escaseof]
</span>  <span class="keyword">|</span> D1Esel <span class="keyword">(</span>ptr<span class="keyword">,</span> d1e<span class="keyword">,</span> d1l<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e<span class="keyword">;</span> <span class="keyword">val</span> d2l <span class="keyword">=</span> d1lab_tr d1l
    <span class="keyword">in</span>
      <span class="keyword">if</span> ptr <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> d2exp_sel_ptr <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> d2l<span class="keyword">)</span>
      <span class="keyword">else</span> <span class="keyword">begin</span> <span class="keyword">case+</span> d2e<span class="keyword">.</span>d2exp_node <span class="keyword">of</span>
      <span class="keyword">|</span> D2Esel <span class="keyword">(</span>d2e_root<span class="keyword">,</span> d2ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          d2exp_sel <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_root<span class="keyword">,</span> $Lst<span class="keyword">.</span>list_extend <span class="keyword">(</span>d2ls<span class="keyword">,</span> d2l<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">end</span>
       <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          d2exp_sel <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> cons <span class="keyword">(</span>d2l<span class="keyword">,</span> nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
         <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>    <span class="keyword">end</span> <span class="comment">(* end of [D1Esel] *)</span>
  <span class="keyword">|</span> D1Eseq d1es <span class="keyword">=&gt;</span> d2exp_seq <span class="keyword">(</span>d1e0<span class="keyword">.</span>d1exp_loc<span class="keyword">,</span> d1explst_tr d1es<span class="keyword">)</span>
  <span class="keyword">|</span> D1Esif <span class="keyword">(</span>r1es<span class="keyword">,</span> s1e_cond<span class="keyword">,</span> d1e_then<span class="keyword">,</span> d1e_else<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> r2es <span class="keyword">=</span> i1nvresstate_tr r1es
      <span class="keyword">val</span> s2e_cond <span class="keyword">=</span> s1exp_tr_dn_bool s1e_cond
      <span class="keyword">val</span> d2e_then <span class="keyword">=</span> d1exp_tr d1e_then
      <span class="keyword">val</span> d2e_else <span class="keyword">=</span> d1exp_tr d1e_else
    <span class="keyword">in</span>
      d2exp_sif <span class="keyword">(</span>loc0<span class="keyword">,</span> r2es<span class="keyword">,</span> s2e_cond<span class="keyword">,</span> d2e_then<span class="keyword">,</span> d2e_else<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Esif]
</span>  <span class="keyword">|</span> D1Estring <span class="keyword">(</span>str<span class="keyword">,</span> len<span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_string <span class="keyword">(</span>loc0<span class="keyword">,</span> str<span class="keyword">,</span> len<span class="keyword">)</span>
  <span class="keyword">|</span> D1Estruct ld1es <span class="keyword">=&gt;</span> d2exp_struct <span class="keyword">(</span>loc0<span class="keyword">,</span> labd1explst_tr ld1es<span class="keyword">)</span>
  <span class="keyword">|</span> D1Etmpid <span class="keyword">(</span>qid<span class="keyword">,</span> ts1ess<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> loc_id <span class="keyword">=</span> qid<span class="keyword">.</span>tmpqi0de_loc
      <span class="keyword">val</span> q <span class="keyword">=</span> qid<span class="keyword">.</span>tmpqi0de_qua <span class="keyword">and</span> id <span class="keyword">=</span> qid<span class="keyword">.</span>tmpqi0de_sym
      <span class="keyword">val</span> d2e_qid <span class="keyword">=</span> d1exp_qid_tr <span class="keyword">(</span>loc_id<span class="keyword">,</span> q<span class="keyword">,</span> id<span class="keyword">)</span>
      <span class="keyword">val</span> ts2ess <span class="keyword">=</span> tmps1explstlst_tr_up ts1ess
    <span class="keyword">in</span>
      d2exp_tmpid <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e_qid<span class="keyword">,</span> ts2ess<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Etmpid]
</span>  <span class="keyword">|</span> D1Etop <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> d2exp_top <span class="keyword">(</span>loc0<span class="keyword">)</span>
  <span class="keyword">|</span> D1Etrywith <span class="keyword">(</span>r1es<span class="keyword">,</span> d1e<span class="keyword">,</span> c1ls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> r2es <span class="keyword">=</span> i1nvresstate_tr r1es
      <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e<span class="keyword">;</span> <span class="keyword">val</span> c2ls <span class="keyword">=</span> c1laulst_tr <span class="keyword">(</span>1<span class="keyword">,</span> c1ls<span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_trywith <span class="keyword">(</span>loc0<span class="keyword">,</span> r2es<span class="keyword">,</span> d2e<span class="keyword">,</span> c2ls<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Etrywith]
</span>  <span class="keyword">|</span> D1Etup <span class="keyword">(</span>tupknd<span class="keyword">,</span> npf<span class="keyword">,</span> d1es<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      d2exp_tup <span class="keyword">(</span>loc0<span class="keyword">,</span> tupknd<span class="keyword">,</span> npf<span class="keyword">,</span> d1explst_tr d1es<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Etup]
</span>  <span class="keyword">|</span> D1Eviewat d1e <span class="keyword">=&gt;</span> d2exp_viewat <span class="keyword">(</span>loc0<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">)</span>
  <span class="keyword">|</span> D1Ewhere <span class="keyword">(</span>d1e<span class="keyword">,</span> d1cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> d2cs <span class="keyword">=</span> d1eclst_tr d1cs<span class="keyword">;</span> <span class="keyword">val</span> d2e <span class="keyword">=</span> d1exp_tr d1e
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans2_env_pop <span class="keyword">(</span><span class="prfexp">pf_env</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_where <span class="keyword">(</span>loc0<span class="keyword">,</span> d2e<span class="keyword">,</span> d2cs<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Ewhere]
</span>  <span class="keyword">|</span> D1Ewhile <span class="keyword">(</span>inv<span class="keyword">,</span> test<span class="keyword">,</span> body<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_push <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">val</span> inv <span class="keyword">=</span> loopi1nv_tr inv
      <span class="keyword">val</span> test <span class="keyword">=</span> d1exp_tr test
      <span class="keyword">val</span> body <span class="keyword">=</span> d1exp_tr body
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2expenv_pop <span class="keyword">(</span><span class="prfexp">pf_s2expenv</span> <span class="keyword">|</span> <span class="comment">(*none*)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      d2exp_while <span class="keyword">(</span>loc0<span class="keyword">,</span> inv<span class="keyword">,</span> test<span class="keyword">,</span> body<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [D1Ewhile]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror loc0<span class="keyword">;</span>
      prerr ": d1exp_tr: d1e0 = "<span class="keyword">;</span> prerr_d1exp d1e0<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>d2exp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [d1exp_tr]
</span>
<span class="keyword">implement</span>
d1explst_tr <span class="keyword">(</span>d1es<span class="keyword">)</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>d1es<span class="keyword">,</span> d1exp_tr<span class="keyword">)</span>
<span class="keyword">implement</span>
d1explstlst_tr <span class="keyword">(</span>d1ess<span class="keyword">)</span> <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_map_fun <span class="keyword">(</span>d1ess<span class="keyword">,</span> d1explst_tr<span class="keyword">)</span>

<span class="keyword">implement</span>
d1expopt_tr <span class="keyword">(</span>od1e<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> od1e <span class="keyword">of</span>
  <span class="keyword">|</span> Some d1e <span class="keyword">=&gt;</span> Some <span class="keyword">(</span>d1exp_tr d1e<span class="keyword">)</span> <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [d1expopt_tr]
</span>
<span class="keyword">implement</span>
labd1explst_tr <span class="keyword">(</span>ld1es<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> ld1es <span class="keyword">of</span>
  <span class="keyword">|</span> LABD1EXPLSTcons <span class="keyword">(</span>l0<span class="keyword">,</span> d1e<span class="keyword">,</span> ld1es<span class="keyword">)</span> <span class="keyword">=&gt;</span>
      LABD2EXPLSTcons <span class="keyword">(</span>l0<span class="keyword">.</span>l0ab_lab<span class="keyword">,</span> d1exp_tr d1e<span class="keyword">,</span> labd1explst_tr ld1es<span class="keyword">)</span>
  <span class="keyword">|</span> LABD1EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> LABD2EXPLSTnil <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">// end of [labd1explst_tr]
</span>
<span class="keyword">implement</span>
d1lab_tr <span class="keyword">(</span>d1l<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> d1l<span class="keyword">.</span>d1lab_node <span class="keyword">of</span>
  <span class="keyword">|</span> D1LABlab lab <span class="keyword">=&gt;</span> d2lab_lab <span class="keyword">(</span>d1l<span class="keyword">.</span>d1lab_loc<span class="keyword">,</span> lab<span class="keyword">)</span>
  <span class="keyword">|</span> D1LABind ind <span class="keyword">=&gt;</span> d2lab_ind <span class="keyword">(</span>d1l<span class="keyword">.</span>d1lab_loc<span class="keyword">,</span> d1explstlst_tr ind<span class="keyword">)</span>
<span class="comment">// end of [d1lab_tr]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_trans2_dyn1.dats] *)</span>
</pre>
</body>
</html>
