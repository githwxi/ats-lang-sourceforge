<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: February 2008
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* for representing and handling constraints *)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="extern">%{^
#include "ats_counter.cats" /* only needed for [ATS/Geizella] */
#include "ats_solver_fm.cats"
%}</span> <span class="comment">// end of [%{^]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Deb <span class="keyword">=</span> "ats_debug.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">IntInf <span class="keyword">=</span> "ats_intinf.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lst <span class="keyword">=</span> "ats_list.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_stadyncst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_patcst2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_trans3_env.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_solver_fm.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_constraint.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">~</span> <span class="keyword">with</span> $IntInf<span class="keyword">.</span>neg_intinf</span>
<span class="neuexp"><span class="keyword">overload</span> + <span class="keyword">with</span> $IntInf<span class="keyword">.</span>add_intinf_intinf</span>
<span class="neuexp"><span class="keyword">overload</span> - <span class="keyword">with</span> $IntInf<span class="keyword">.</span>sub_intinf_intinf</span>
<span class="neuexp"><span class="keyword">overload</span> * <span class="keyword">with</span> $IntInf<span class="keyword">.</span>mul_intinf_intinf</span>

<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">&lt;</span> <span class="keyword">with</span> $IntInf<span class="keyword">.</span>lt_intinf_int</span>
<span class="neuexp"><span class="keyword">overload</span> &lt;= <span class="keyword">with</span> $IntInf<span class="keyword">.</span>lte_intinf_int</span>
<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">&gt;</span> <span class="keyword">with</span> $IntInf<span class="keyword">.</span>gt_intinf_int</span>
<span class="neuexp"><span class="keyword">overload</span> &gt;= <span class="keyword">with</span> $IntInf<span class="keyword">.</span>gte_intinf_int</span>
<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> $IntInf<span class="keyword">.</span>eq_intinf_int</span>
<span class="neuexp"><span class="keyword">overload</span> &lt;&gt; <span class="keyword">with</span> $IntInf<span class="keyword">.</span>neq_intinf_int</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> prerr_interror <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> prerr "INTERNAL ERROR (ats_constraint)"
<span class="keyword">fn</span> prerr_loc_interror <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  $Loc<span class="keyword">.</span>prerr_location loc<span class="keyword">;</span> prerr ": INTERNAL ERROR (ats_constraint)"
<span class="keyword">end</span> <span class="comment">// end of [prerr_loc_interror]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> s3aexp_null <span class="keyword">=</span> S3AEnull <span class="keyword">(</span><span class="keyword">)</span>

<span class="keyword">implement</span> s3aexp_cst <span class="keyword">(</span>s2c<span class="keyword">)</span> <span class="keyword">=</span> S3AEcst <span class="keyword">(</span>s2c<span class="keyword">)</span>
<span class="keyword">implement</span> s3aexp_var <span class="keyword">(</span>s2v<span class="keyword">)</span> <span class="keyword">=</span> S3AEvar <span class="keyword">(</span>s2v<span class="keyword">)</span>

<span class="keyword">implement</span>
s3aexp_padd <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3ae1 <span class="keyword">of</span>
  <span class="keyword">|</span> S3AEpadd <span class="keyword">(</span>s3ae11<span class="keyword">,</span> s3ie12<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3aexp_padd <span class="keyword">(</span>s3ae11<span class="keyword">,</span> s3iexp_iadd <span class="keyword">(</span>s3ie12<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3AEpadd]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3AEpadd <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ie2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3aexp_padd]
</span>
<span class="keyword">implement</span>
s3aexp_psub <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3ae1 <span class="keyword">of</span>
  <span class="keyword">|</span> S3AEpadd <span class="keyword">(</span>s3ae11<span class="keyword">,</span> s3ie12<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3aexp_padd <span class="keyword">(</span>s3ae11<span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie12<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3AEpadd]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3AEpadd <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3iexp_ineg s3ie2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3aexp_psub]
</span>
<span class="keyword">implement</span> s3aexp_psucc <span class="keyword">(</span>s3ae<span class="keyword">)</span> <span class="keyword">=</span> s3aexp_padd <span class="keyword">(</span>s3ae<span class="keyword">,</span> s3iexp_1<span class="keyword">)</span>
<span class="keyword">implement</span> s3aexp_ppred <span class="keyword">(</span>s3ae<span class="keyword">)</span> <span class="keyword">=</span> s3aexp_psub <span class="keyword">(</span>s3ae<span class="keyword">,</span> s3iexp_1<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> s3bexp_true <span class="keyword">=</span> S3BEbool <span class="keyword">(</span>true<span class="keyword">)</span>
<span class="keyword">implement</span> s3bexp_false <span class="keyword">=</span> S3BEbool <span class="keyword">(</span>false<span class="keyword">)</span>

<span class="keyword">implement</span> s3bexp_cst <span class="keyword">(</span>s2c<span class="keyword">)</span> <span class="keyword">=</span> S3BEcst <span class="keyword">(</span>s2c<span class="keyword">)</span>
<span class="keyword">implement</span> s3bexp_var <span class="keyword">(</span>s2v<span class="keyword">)</span> <span class="keyword">=</span> S3BEvar <span class="keyword">(</span>s2v<span class="keyword">)</span>

<span class="keyword">implement</span>
s3bexp_bneg <span class="keyword">(</span>s3be0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> s3be0 <span class="keyword">of</span>
  <span class="keyword">|</span> S3BEbool b <span class="keyword">=&gt;</span> S3BEbool <span class="keyword">(</span>not b<span class="keyword">)</span>
  <span class="keyword">|</span> S3BEbadd <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3BEbmul <span class="keyword">(</span>S3BEbneg s3be1<span class="keyword">,</span> S3BEbneg s3be2<span class="keyword">)</span>
  <span class="keyword">|</span> S3BEbmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3BEbadd <span class="keyword">(</span>S3BEbneg s3be1<span class="keyword">,</span> S3BEbneg s3be2<span class="keyword">)</span>
  <span class="keyword">|</span> S3BEbneg s3be <span class="keyword">=&gt;</span> s3be
  <span class="keyword">|</span> S3BEiexp <span class="keyword">(</span>knd<span class="keyword">,</span> s3ie<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3BEiexp <span class="keyword">(</span><span class="keyword">~</span>knd<span class="keyword">,</span> s3ie<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3BEbneg s3be0
<span class="comment">// end of [s3bexp_bneg]
</span>
<span class="keyword">implement</span>
s3bexp_beq <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3be1 <span class="keyword">of</span>
  <span class="keyword">|</span> S3BEbool b1 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b1 <span class="keyword">then</span> s3be2 <span class="keyword">else</span> s3bexp_bneg s3be2
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3be2 <span class="keyword">of</span>
    <span class="keyword">|</span> S3BEbool b2 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b2 <span class="keyword">then</span> s3be1 <span class="keyword">else</span> s3bexp_bneg s3be1
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> _s3be1 <span class="keyword">=</span> s3bexp_bneg s3be1 <span class="keyword">and</span> _s3be2 <span class="keyword">=</span> s3bexp_bneg s3be2
      <span class="keyword">in</span>
        S3BEbadd <span class="keyword">(</span>S3BEbmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">,</span> S3BEbmul <span class="keyword">(</span>_s3be1<span class="keyword">,</span> _s3be2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s3bexp_beq]
</span>
<span class="keyword">implement</span>
s3bexp_bneq <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3be1 <span class="keyword">of</span>
  <span class="keyword">|</span> S3BEbool b1 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b1 <span class="keyword">then</span> s3bexp_bneg s3be2 <span class="keyword">else</span> s3be2
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3be2 <span class="keyword">of</span>
    <span class="keyword">|</span> S3BEbool b2 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b2 <span class="keyword">then</span> s3bexp_bneg s3be1 <span class="keyword">else</span> s3be1
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> _s3be1 <span class="keyword">=</span> s3bexp_bneg s3be1 <span class="keyword">and</span> _s3be2 <span class="keyword">=</span> s3bexp_bneg s3be2
      <span class="keyword">in</span>
        S3BEbadd <span class="keyword">(</span>S3BEbmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> _s3be2<span class="keyword">)</span><span class="keyword">,</span> S3BEbmul <span class="keyword">(</span>_s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s3bexp_beq]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
s3bexp_badd <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3be1 <span class="keyword">of</span>
  <span class="keyword">|</span> S3BEbool b1 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b1 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3be2
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3be2 <span class="keyword">of</span>
    <span class="keyword">|</span> S3BEbool b2 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b2 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3be1
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3BEbadd <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s3bexp_badd]
</span>
<span class="keyword">implement</span>
s3bexp_bmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3be1 <span class="keyword">of</span>
  <span class="keyword">|</span> S3BEbool b1 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b1 <span class="keyword">then</span> s3be2 <span class="keyword">else</span> s3bexp_false
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3be2 <span class="keyword">of</span>
    <span class="keyword">|</span> S3BEbool b2 <span class="keyword">=&gt;</span> <span class="keyword">if</span> b2 <span class="keyword">then</span> s3be1 <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3BEbmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s3bexp_bmul]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
s3bexp_iexp <span class="keyword">(</span>knd<span class="keyword">,</span> s3ie<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3ie <span class="keyword">of</span>
  <span class="keyword">|</span> S3IEint i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> knd <span class="keyword">of</span>
    <span class="keyword">|</span> 2<span class="comment">(*gte*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i &gt;= 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> 1<span class="comment">(*eq*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i <span class="keyword">=</span> 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> ~1<span class="comment">(*neq*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i &lt;&gt; 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> ~2<span class="comment">(*lt*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i <span class="keyword">&lt;</span> 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": s3bexp_iexp: knd = "<span class="keyword">;</span> prerr knd<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s3bexp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [S3IEint]
</span>  <span class="keyword">|</span> S3IEintinf i <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> knd <span class="keyword">of</span>
    <span class="keyword">|</span> 2<span class="comment">(*gte*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i &gt;= 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> 1<span class="comment">(*eq*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i <span class="keyword">=</span> 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> ~1<span class="comment">(*neq*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i &lt;&gt; 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> ~2<span class="comment">(*lt*)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i <span class="keyword">&lt;</span> 0 <span class="keyword">then</span> s3bexp_true <span class="keyword">else</span> s3bexp_false
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        prerr ": s3bexp_iexp: knd = "<span class="keyword">;</span> prerr knd<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
        $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s3bexp<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_]
</span>    <span class="keyword">end</span> <span class="comment">// end of [S2IEintinf]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3BEiexp <span class="keyword">(</span>knd<span class="keyword">,</span> s3ie<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3bexp_iexp]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span> s3bexp_igt <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>~2<span class="comment">(*lt*)</span><span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie2<span class="keyword">,</span> s3ie1<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_igt]
</span>
<span class="keyword">implement</span> s3bexp_igte <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>2<span class="comment">(*gte*)</span><span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_igte]
</span>
<span class="keyword">implement</span> s3bexp_ilt <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>~2<span class="comment">(*lt*)</span><span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_ilt]
</span>
<span class="keyword">implement</span> s3bexp_ilte <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>2<span class="comment">(*gte*)</span><span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie2<span class="keyword">,</span> s3ie1<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_ilte]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span> s3bexp_ieq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>1<span class="comment">(*eq*)</span><span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_ieq]
</span>
<span class="keyword">implement</span> s3bexp_ineq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>~1<span class="comment">(*neq*)</span><span class="keyword">,</span> s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_ineq]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span> s3bexp_pgt <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>~2<span class="comment">(*lt*)</span><span class="keyword">,</span> s3iexp_pdiff <span class="keyword">(</span>s3ae2<span class="keyword">,</span> s3ae1<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_pgt]
</span>
<span class="keyword">implement</span> s3bexp_pgte <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>2<span class="comment">(*gte*)</span><span class="keyword">,</span> s3iexp_pdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_pgte]
</span>
<span class="keyword">implement</span> s3bexp_plt <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>~2<span class="comment">(*lt*)</span><span class="keyword">,</span> s3iexp_pdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_plt]
</span>
<span class="keyword">implement</span> s3bexp_plte <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>2<span class="comment">(*gte*)</span><span class="keyword">,</span> s3iexp_pdiff <span class="keyword">(</span>s3ae2<span class="keyword">,</span> s3ae1<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_plte]
</span>
<span class="keyword">implement</span> s3bexp_peq <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>1<span class="comment">(*eq*)</span><span class="keyword">,</span> s3iexp_pdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_peq]
</span>
<span class="keyword">implement</span> s3bexp_pneq <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span>
  s3bexp_iexp <span class="keyword">(</span>~1<span class="comment">(*neq*)</span><span class="keyword">,</span> s3iexp_pdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s3bexp_pneq]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> s3iexp_is_const <span class="keyword">(</span>s3ie<span class="keyword">:</span> <span class="staexp">s3iexp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3ie <span class="keyword">of</span> S3IEint _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> S3IEintinf _ <span class="keyword">=&gt;</span> true <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> false
<span class="keyword">end</span> <span class="comment">// end of [s3iexp_is_const]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> s3iexp_0 <span class="keyword">=</span> S3IEint 0
<span class="keyword">implement</span> s3iexp_1 <span class="keyword">=</span> S3IEint 1
<span class="keyword">implement</span> s3iexp_neg_1 <span class="keyword">=</span> S3IEint <span class="keyword">(</span>~1<span class="keyword">)</span>

<span class="keyword">implement</span> s3iexp_cst <span class="keyword">(</span>s2c<span class="keyword">)</span> <span class="keyword">=</span> S3IEcst s2c
<span class="keyword">implement</span> s3iexp_int <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> S3IEint i
<span class="keyword">implement</span> s3iexp_intinf <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=</span> S3IEintinf i
<span class="keyword">implement</span> s3iexp_var <span class="keyword">(</span>s2v<span class="keyword">)</span> <span class="keyword">=</span> S3IEvar s2v

<span class="keyword">implement</span>
s3iexp_ineg <span class="keyword">(</span>s3ie<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3ie <span class="keyword">of</span>
  <span class="keyword">|</span> S3IEint i <span class="keyword">=&gt;</span> S3IEint <span class="keyword">(</span><span class="keyword">~</span>i<span class="keyword">)</span>
  <span class="keyword">|</span> S3IEintinf i <span class="keyword">=&gt;</span> S3IEintinf <span class="keyword">(</span><span class="keyword">~</span>i<span class="keyword">)</span>
  <span class="keyword">|</span> S3IEineg s3ie <span class="keyword">=&gt;</span> s3ie
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> S3IEineg s3ie <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s3iexp_ineg]
</span>
<span class="keyword">implement</span>
s3iexp_iadd <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEint i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie2
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEint i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie1
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie2
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEintinf i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie1
<span class="comment">(*
  // avoid it: potential arithmetic overflow/underflow
  | (S3IEint i1, S3IEint i2) =&gt; S3IEint (i1 + i2)
*)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i1<span class="keyword">,</span> S3IEintinf i2<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3IEintinf <span class="keyword">(</span>i1 + i2<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3IEiadd <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3iexp_iadd]
</span>
<span class="keyword">implement</span>
s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEint i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3iexp_ineg s3ie2
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEint i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie1
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3iexp_ineg s3ie2
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEintinf i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie1
<span class="comment">(* 
  // avoid it: potential arithmetic overflow/underflow
  | (S3IEint i1, S3IEint i2) =&gt; S3IEint (i1 - i2)
*)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i1<span class="keyword">,</span> S3IEintinf i2<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3IEintinf <span class="keyword">(</span>i1 - i2<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3IEisub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3iexp_isub]
</span>
<span class="keyword">implement</span>
s3iexp_imul <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEint i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie1 <span class="comment">// 0
</span>  <span class="keyword">|</span> <span class="keyword">(</span>S3IEint i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 1 <span class="keyword">=&gt;</span> s3ie2
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEint i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie2 <span class="comment">// 0
</span>  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEint i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 1 <span class="keyword">=&gt;</span> s3ie1
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie1 <span class="comment">// 0
</span>  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 1 <span class="keyword">=&gt;</span> s3ie2
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEintinf i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> s3ie2 <span class="comment">// 0
</span>  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> S3IEintinf i<span class="keyword">)</span> <span class="keyword">when</span> i <span class="keyword">=</span> 1 <span class="keyword">=&gt;</span> s3ie1
  <span class="keyword">|</span> <span class="keyword">(</span>S3IEintinf i1<span class="keyword">,</span> S3IEintinf i2<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3IEintinf <span class="keyword">(</span>i1 * i2<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">)</span> <span class="keyword">=&gt;</span> S3IEimul <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3iexp_imul]
</span>
<span class="keyword">implement</span> s3iexp_pdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=</span> S3IEpdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span>

<span class="keyword">implement</span> s3iexp_isucc <span class="keyword">(</span>s3ie<span class="keyword">:</span> <span class="staexp">s3iexp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s3iexp</span> <span class="keyword">=</span> s3iexp_iadd <span class="keyword">(</span>s3ie<span class="keyword">,</span> s3iexp_1<span class="keyword">)</span>
<span class="keyword">implement</span> s3iexp_ipred <span class="keyword">(</span>s3ie<span class="keyword">:</span> <span class="staexp">s3iexp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s3iexp</span> <span class="keyword">=</span> s3iexp_isub <span class="keyword">(</span>s3ie<span class="keyword">,</span> s3iexp_1<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> s2cfdeflst_free
  <span class="keyword">(</span>fds<span class="keyword">:</span> <span class="staexp">s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> fds <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>S2CFDEFLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> os3be<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> os3be <span class="keyword">of</span> <span class="keyword">~</span>Some_vt _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      s2cfdeflst_free <span class="keyword">(</span>fds<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2CFDEFLSTcons]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>S2CFDEFLSTmark <span class="keyword">(</span>fds<span class="keyword">)</span> <span class="keyword">=&gt;</span> s2cfdeflst_free <span class="keyword">(</span>fds<span class="keyword">)</span>
  <span class="keyword">|</span> <span class="keyword">~</span>S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2cfdeflst_free]
</span>
<span class="comment">//
</span>
<span class="keyword">fn</span> s2cfdeflst_pop
  <span class="keyword">(</span>fds0<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>fds<span class="keyword">:</span> <span class="staexp">s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2cfdeflst_vt</span> <span class="keyword">=</span> <span class="keyword">case+</span> fds <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>S2CFDEFLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2v<span class="keyword">,</span> os3be<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> os3be <span class="keyword">of</span> <span class="keyword">~</span>Some_vt _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        aux <span class="keyword">(</span>fds<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">(* end of [S2CFDEFLSTcons] *)</span>
    <span class="keyword">|</span> <span class="keyword">~</span>S2CFDEFLSTmark <span class="keyword">(</span>fds<span class="keyword">)</span> <span class="keyword">=&gt;</span> fds
    <span class="keyword">|</span> <span class="keyword">~</span>S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]  
</span><span class="keyword">in</span>
  fds0 := aux <span class="keyword">(</span>fds0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">(* end of [s2cfdeflst_pop] *)</span>

<span class="keyword">fn</span> s2cfdeflst_push <span class="keyword">(</span>fds0<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  fds0 := S2CFDEFLSTmark <span class="keyword">(</span>fds0<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2cfdeflst_push]
</span>
<span class="keyword">fun</span> s2cfdeflst_find
  <span class="keyword">(</span>fds0<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">,</span> s2c0<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es0<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">Option_vt s2var_t</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> fds0 <span class="keyword">of</span>
  <span class="keyword">|</span> S2CFDEFLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2v<span class="keyword">,</span> _<span class="keyword">,</span> <span class="keyword">!</span>fds<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> cond <span class="keyword">=</span> <span class="keyword">(</span>
        <span class="keyword">if</span> eq_s2cst_s2cst <span class="keyword">(</span>s2c0<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">then</span> s2explst_syneq <span class="keyword">(</span>s2es<span class="keyword">,</span> s2es0<span class="keyword">)</span> <span class="keyword">else</span> false
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">bool</span>
    <span class="keyword">in</span>
      <span class="keyword">if</span> cond <span class="keyword">then</span> <span class="keyword">begin</span>
        fold@ fds0<span class="keyword">;</span> Some_vt s2v
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
        <span class="keyword">val</span> ans <span class="keyword">=</span> s2cfdeflst_find <span class="keyword">(</span><span class="keyword">!</span>fds<span class="keyword">,</span> s2c0<span class="keyword">,</span> s2es0<span class="keyword">)</span>
      <span class="keyword">in</span>
        fold@ fds0<span class="keyword">;</span> ans
      <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2CFDEFLSTcons]
</span>  <span class="keyword">|</span> S2CFDEFLSTmark <span class="keyword">(</span><span class="keyword">!</span>fds<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ans <span class="keyword">=</span> s2cfdeflst_find <span class="keyword">(</span><span class="keyword">!</span>fds<span class="keyword">,</span> s2c0<span class="keyword">,</span> s2es0<span class="keyword">)</span>
    <span class="keyword">in</span>
      fold@ fds0<span class="keyword">;</span> ans
    <span class="keyword">end</span> <span class="comment">// end of [S2CFDEFLSTmark]
</span>  <span class="keyword">|</span> S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fold@ fds0<span class="keyword">;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2CFDEFLSTnil]
</span><span class="keyword">end</span> <span class="comment">// end of [s2cfdeflst_find]
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// for handling a special static function
</span><span class="comment">//
</span><span class="keyword">fn</span> s2cfdeflst_add
  <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">,</span> s2v<span class="keyword">:</span> <span class="staexp">s2var_t</span><span class="keyword">,</span>
   s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2cfdeflst_add: s2c = "; print s2c; print_newline ();
    print "s2cfdeflst_add: s2es = "; print s2es; print_newline ();
    print "s2cfdeflst_add: s2v = "; print s2v; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> s2e_s2c <span class="keyword">=</span> s2exp_cst s2c
  <span class="keyword">val</span> s2e_s2v <span class="keyword">=</span> s2exp_var s2v
  <span class="keyword">val</span> s2es_arg <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_extend <span class="keyword">(</span>s2es<span class="keyword">,</span> s2e_s2v<span class="keyword">)</span>
  <span class="keyword">val</span> s2e_rel <span class="keyword">=</span> s2exp_app_srt <span class="keyword">(</span>s2rt_bool<span class="keyword">,</span> s2e_s2c<span class="keyword">,</span> s2es_arg<span class="keyword">)</span>
  <span class="keyword">val</span> os3be <span class="keyword">=</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e_rel<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
<span class="keyword">in</span>
  fds := S2CFDEFLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2v<span class="keyword">,</span> os3be<span class="keyword">,</span> fds<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2cfdeflst_add]
</span>
<span class="comment">//
</span><span class="comment">// for handling a generic static function
</span><span class="comment">//
</span><span class="keyword">fn</span> s2cfdeflst_add_none
  <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">,</span> s2v<span class="keyword">:</span> <span class="staexp">s2var_t</span><span class="keyword">,</span>
   s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s2cfdeflst_add: s2c = "; print s2c; print_newline ();
    print "s2cfdeflst_add: s2es = "; print s2es; print_newline ();
    print "s2cfdeflst_add: s2v = "; print s2v; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  fds := S2CFDEFLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2v<span class="keyword">,</span> None_vt <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> fds<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2cfdeflst_add_none]
</span>
<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// for handling a special static function
</span><span class="comment">//
</span><span class="keyword">fn</span> s2cfdeflst_replace <span class="keyword">(</span>
    s2t<span class="keyword">:</span> <span class="staexp">s2rt</span>
  <span class="keyword">,</span> s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2var_t</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2cfdeflst_find <span class="keyword">(</span>fds<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2var_make_srt <span class="keyword">(</span>s2t<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_add <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2v<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      s2v
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2v <span class="keyword">=&gt;</span> s2v <span class="comment">// end of [Some_vt]
</span><span class="comment">// end of [s2cfdeflst_replace]
</span>
<span class="comment">//
</span><span class="comment">// for handling a generic static function
</span><span class="comment">//
</span><span class="keyword">fn</span> s2cfdeflst_replace_none <span class="keyword">(</span>
    s2t<span class="keyword">:</span> <span class="staexp">s2rt</span>
  <span class="keyword">,</span> s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s2var_t</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> s2cfdeflst_find <span class="keyword">(</span>fds<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2var_make_srt <span class="keyword">(</span>s2t<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_add_none <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2v<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      s2v
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s2v <span class="keyword">=&gt;</span> s2v <span class="comment">// end of [Some_vt]
</span><span class="comment">// end of [s2cfdeflst_replace_none]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="14453"><span class="dyncstdec">s3aexp_make_s2cst_s2explst
  <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">s3aexpopt_vt</span></span></a>
<span class="comment">// end of [fun s3aexp_make_s2cst_s2explst]
</span>
<span class="keyword">implement</span>
s3aexp_make_s2cst_s2explst
  <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> errmsg <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s3aexpopt_vt</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": s3aexp_make_s2cst_s2explst: s2c = "<span class="keyword">;</span> prerr s2c<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s3aexpopt_vt<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [errmsg]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> 0 <span class="keyword">of</span> <span class="comment">// this looks prettier than [if-then-else] sequence
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Add_addr_int_addr<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3aexp_padd <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Add_addr_int_addr]
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Sub_addr_int_addr<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3aexp_psub <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Sub_addr_int_addr]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace_none <span class="keyword">(</span>s2rt_addr<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3aexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="comment">(*
  // a function cannot be handled
  | _ =&gt; let
      val () = begin
        print "s3aexp_make_s2cst_s2explst: s2c = "; print s2c; print_newline ();
        print "s3aexp_make_s2cst_s2explst: s2es = "; print s2es; print_newline ();
      end // end of [val]
    in
      None_vt ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3aexp_make_s2cst_s2explst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="16566"><span class="dyncstdec">s3bexp_make_s2cst_s2explst
  <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">s3bexpopt_vt</span></span></a>
<span class="comment">// end of [fun s3bexp_make_s2cst_s2explst]
</span>
<span class="comment">//
</span><span class="comment">// this is a large but simple function
</span><span class="comment">//
</span><span class="keyword">implement</span>
s3bexp_make_s2cst_s2explst
  <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> errmsg <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s3bexpopt_vt</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": s3bexp_make_s2cst_s2explst: s2c = "<span class="keyword">;</span> prerr s2c<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s3bexpopt_vt<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> 0 <span class="keyword">of</span>
  <span class="comment">// boolean negation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Neg_bool_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_bneg s3be<span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Neg_bool_bool]
</span>  <span class="comment">// boolean addition/disjunction
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Add_bool_bool_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_badd <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Add_bool_bool_bool]
</span>  <span class="comment">// boolean multiplication/conjuction
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Mul_bool_bool_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_bmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Mul_bool_bool_bool]
</span>  <span class="comment">// boolean equality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Eq_bool_bool_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_beq <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Eq_bool_bool_bool]
</span>  <span class="comment">// boolean inequality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Neq_bool_bool_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_bneq <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Neq_bool_bool_bool]
</span>  <span class="comment">// charater GT relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Gt_char_char_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_igt <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Gt_char_char_bool]
</span>  <span class="comment">// character GTE relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Gte_char_char_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_igte <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Gte_char_char_bool]
</span>  <span class="comment">// character LT relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lt_char_char_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ilt <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lt_char_char_bool]
</span>  <span class="comment">// charater LTE relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lte_char_char_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ilte <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lte_char_char_bool]
</span>  <span class="comment">// character equality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Eq_char_char_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ieq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Eq_char_char_bool]
</span>  <span class="comment">// character inequality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Neq_char_char_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ineq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Neq_char_char_bool]
</span>  <span class="comment">// integer GT relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Gt_int_int_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_igt <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Gt_int_int_bool]
</span>  <span class="comment">// integer GTE relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Gte_int_int_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_igte <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Gte_int_int_bool]
</span>  <span class="comment">// integer LT relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lt_int_int_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ilt <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lt_int_int_bool]
</span>  <span class="comment">// integer LTE relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lte_int_int_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ilte <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lte_int_int_bool]
</span>  <span class="comment">// integer equality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Eq_int_int_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ieq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Eq_int_int_bool]
</span>  <span class="comment">// integer inequality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Neq_int_int_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ineq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Neq_int_int_bool]
</span>  <span class="comment">// address GT relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Gt_addr_addr_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_pgt <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Gt_addr_addr_bool]
</span>  <span class="comment">// address GTE relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Gte_addr_addr_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_pgte <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Gte_addr_addr_bool]
</span>  <span class="comment">// address LT relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lt_addr_addr_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_plt <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lt_addr_addr_bool]
</span>  <span class="comment">// address LTE relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lte_addr_addr_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_plte <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lte_addr_addr_bool]
</span>  <span class="comment">// address equality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Eq_addr_addr_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_peq <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Eq_addr_addr_bool]
</span>  <span class="comment">// address inequality
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Neq_addr_addr_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_pneq <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Neq_addr_addr_bool]
</span>  <span class="comment">// subclass relation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Lte_cls_cls_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>
        s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> sgn <span class="keyword">=</span> s2exp_subclass_test <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">in</span>
        <span class="keyword">case+</span> 0 <span class="keyword">of</span>
        <span class="keyword">|</span> _ <span class="keyword">when</span> sgn <span class="keyword">&gt;</span> 0 <span class="keyword">=&gt;</span> Some_vt s3bexp_true
        <span class="keyword">|</span> _ <span class="keyword">when</span> sgn <span class="keyword">&lt;</span> 0 <span class="keyword">=&gt;</span> Some_vt s3bexp_false
        <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
            <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace_none <span class="keyword">(</span>s2rt_bool<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
          <span class="keyword">in</span>
            Some_vt <span class="keyword">(</span>s3bexp_var s2v<span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">(* end of [if] *)</span>
        <span class="comment">// end of [case]       
</span>      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Lte_cls_cls_bool]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace_none <span class="keyword">(</span>s2rt_bool<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3bexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="comment">(*
  // a function cannot be handled
  | _ =&gt; let
      val () = begin
        print "s3bexp_make_s2cst_s2explst: s2c = "; print s2c; print_newline ();
        print "s3bexp_make_s2cst_s2explst: s2es = "; print s2es; print_newline ();
      end // end of [val]
    in
      None_vt ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3bexp_make_s2cst_s2explst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="31003"><span class="dyncstdec">s3iexp_make_s2cst_s2explst
  <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> s2es<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">s3iexpopt_vt</span></span></a>
<span class="comment">// end of [fun s3iexp_make_s2cst_s2explst]
</span>
<span class="keyword">implement</span>
s3iexp_make_s2cst_s2explst
  <span class="keyword">(</span>s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> errmsg <span class="keyword">(</span>s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s3iexpopt_vt</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    prerr ": s3iexp_make_s2cst_s2explst: s2c = "<span class="keyword">;</span> prerr s2c<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>s3iexpopt_vt<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [errmsg]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> 0 <span class="keyword">of</span>
  <span class="comment">// integer negation
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Neg_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_ineg s3ie<span class="keyword">)</span> <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Neg_int_int]
</span>  <span class="comment">// integer addition
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Add_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_iadd <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Add_int_int_int]
</span>  <span class="comment">// integer subtraction
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Sub_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Sub_int_int_int]
</span>  <span class="comment">// integer multiplication
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Mul_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> islin <span class="keyword">=</span> s3iexp_is_const s3ie1
        <span class="keyword">in</span>
          <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
          <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
              <span class="keyword">val</span> islin <span class="keyword">=</span> islin orelse <span class="keyword">(</span>s3iexp_is_const s3ie2<span class="keyword">)</span>
            <span class="keyword">in</span>
              <span class="keyword">if</span> islin <span class="keyword">then</span>
                Some_vt <span class="keyword">(</span>s3iexp_imul <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span> <span class="comment">// linear term
</span>              <span class="keyword">else</span> <span class="keyword">let</span> <span class="comment">// nonlinear term
</span>                <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace_none <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
              <span class="keyword">in</span>
                Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
              <span class="keyword">end</span> <span class="comment">// end of [if]
</span>            <span class="keyword">end</span> <span class="comment">// end of [Some_v]
</span>          <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Mul_int_int_int]
</span>  <span class="comment">// addr difference
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Sub_addr_addr_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_pdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Sub_addr_addr_int]
</span>  <span class="comment">// char difference
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Sub_char_char_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> list_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_isub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> errmsg s2c
    <span class="keyword">end</span> <span class="comment">// end of [Sub_addr_addr_int]
</span>  <span class="comment">// integer division
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Div_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>Div_int_int_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="comment">// integer absolute value function
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Abs_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>Abs_int_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="comment">// integer maximum
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Max_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>Max_int_int_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="comment">// integer minimum
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Min_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>Min_int_int_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="comment">// Natural number subtraction
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Nsub_int_int_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>Nsub_int_int_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Nsub_int_int_int]
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>IntOfBool_bool_int<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>IntOfBool_bool_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [IntOfBool_bool_int]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace_none <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c<span class="keyword">,</span> s2es<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="comment">(*
  // a function cannot be handled
  | _ =&gt; let
      val () = begin
        print "s3iexp_make_s2cst_s2explst: s2c = "; print s2c; print_newline ();
        print "s3iexp_make_s2cst_s2explst: s2es = "; print s2es; print_newline ();
      end // end of [val]
    in
      None_vt ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3iexp_make_s2cst_s2explst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">fn</span> aux_equal
  <span class="keyword">(</span>s2e1<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2e2<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">s3bexpopt_vt</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2t1 <span class="keyword">=</span> s2e1<span class="keyword">.</span>s2exp_srt
<span class="keyword">in</span>
  <span class="keyword">case+</span> 0 <span class="keyword">of</span> <span class="comment">// this seems prettier than [if-then-else] sequence
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2t1 <span class="keyword">=</span> s2rt_int <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ieq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [s2t1 = s2rt_int]
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2t1 <span class="keyword">=</span> s2rt_addr <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3aexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ae2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_peq <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [s2t1 = s2rt_addr]
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2t1 <span class="keyword">=</span> s2rt_bool <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3bexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_beq <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [s2t1 = s2rt_bool]
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2t1 <span class="keyword">=</span> s2rt_char <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ieq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [s2t1 = s2rt_char]
</span><span class="comment">// (*
</span>  <span class="comment">// this is an experimental feature!!!
</span>  <span class="keyword">|</span> _ <span class="keyword">when</span> s2rt_is_dat s2t1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
      <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">case+</span> s3iexp_make_s2exp <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
        <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3ie2 <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_ieq <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span><span class="keyword">)</span>
        <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>      <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [s2rt_is_dat s2t1]
</span><span class="comment">// *)
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> s2exp_syneq <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">then</span> Some_vt <span class="keyword">(</span>s3bexp_true<span class="keyword">)</span> <span class="keyword">else</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [aux_equal]
</span>
<span class="keyword">fn</span> aux_bind
  <span class="keyword">(</span>loc<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> s2v1<span class="keyword">:</span> <span class="staexp">s2var_t</span><span class="keyword">,</span> s2e2<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">s3bexpopt_vt</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "aux_bind: s2v1 = "; print s2v1; print_newline ();
    print "aux_bind: s2e2 = "; print s2e2; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> os3be <span class="keyword">=</span> aux_equal <span class="keyword">(</span>s2exp_var s2v1<span class="keyword">,</span> s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans3_env_hypo_add_bind <span class="keyword">(</span>loc<span class="keyword">,</span> s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
<span class="keyword">in</span>
  os3be
<span class="keyword">end</span> <span class="comment">// end of [aux_bind]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">fun</span> s2cstlst_add <span class="keyword">(</span>s2cs<span class="keyword">:</span> <span class="staexp">s2cstlst</span><span class="keyword">,</span> s2c0<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2cstlst</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>s2cs<span class="keyword">:</span> <span class="staexp">s2cstlst</span><span class="keyword">,</span> s2c0<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2cs <span class="keyword">of</span>
    <span class="keyword">|</span> S2CSTLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span>
        <span class="keyword">if</span> eq_s2cst_s2cst <span class="keyword">(</span>s2c0<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">then</span> true <span class="keyword">else</span> aux <span class="keyword">(</span>s2cs<span class="keyword">,</span> s2c0<span class="keyword">)</span>
    <span class="keyword">|</span> S2CSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  <span class="keyword">if</span> aux <span class="keyword">(</span>s2cs<span class="keyword">,</span> s2c0<span class="keyword">)</span> <span class="keyword">then</span> s2cs <span class="keyword">else</span> S2CSTLSTcons <span class="keyword">(</span>s2c0<span class="keyword">,</span> s2cs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2cstlst_add]
</span>
<span class="keyword">implement</span>
s3aexp_make_s2exp
  <span class="keyword">(</span>s2e0<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> s2exp_whnf s2e0
<span class="comment">(*
  val () = begin
    print "s3aexp_make_s2exp: s2e0 = "; print s2e0; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Eapp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2e1<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Ecst s2c1 <span class="keyword">=&gt;</span> s3aexp_make_s2cst_s2explst <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2es2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Eapp]
</span>  <span class="keyword">|</span> S2Ecst s2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2c <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>Null_addr<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3aexp_null<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>s2cs := s2cstlst_add <span class="keyword">(</span>s2cs<span class="keyword">,</span> s2c<span class="keyword">)</span><span class="keyword">;</span> Some_vt <span class="keyword">(</span>s3aexp_cst s2c<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Ecst]
</span>  <span class="keyword">|</span> S2Evar s2v <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3aexp_var s2v<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span> <span class="comment">// an expression that cannot be handled
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        prerr "warning(3): s3aexp_make_s2exp: s2e0 = "<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Evar]
</span><span class="keyword">end</span> <span class="comment">// end of [s3aexp_make_s2exp]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> s2exp_synlt <span class="keyword">(</span>s2e1<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2e2<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e2 <span class="keyword">=</span> s2exp_whnf s2e2
<span class="comment">(*
  val () = begin
    print "s2exp_synlt: s2e1 = "; print s2e1; print_newline ();
    print "s2exp_synlt: s2e2 = "; print s2e2; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e2<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Eapp <span class="keyword">(</span>_<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> s2explst_synlte <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2es2<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> false
<span class="keyword">end</span> <span class="comment">// end pf [s2exp_synlt]
</span>
<span class="keyword">and</span> s2exp_synlte <span class="keyword">(</span>s2e1<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2e2<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span>
  s2exp_syneq <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> orelse s2exp_synlt <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>

<span class="keyword">and</span> s2explst_synlte
  <span class="keyword">(</span>s2e1<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2es2<span class="keyword">:</span> <span class="staexp">s2explst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s2es2 <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s2exp_synlte <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> orelse s2explst_synlte <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2es2<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> false
<span class="keyword">end</span> <span class="comment">// end of [s2explst_synlte]
</span>
<span class="keyword">fn</span> s2exp_metlt_reduce <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
  <span class="keyword">(</span>met<span class="keyword">:</span> <span class="staexp">s2explst n</span><span class="keyword">,</span> met_bound<span class="keyword">:</span> <span class="staexp">s2explst n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fn</span> auxlt
    <span class="keyword">(</span>isint<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> s2e1<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2e2<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> lt<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int &gt;&gt; int</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">if</span> isint <span class="keyword">then</span>
      s2exp_lt_int_int_bool <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
    <span class="keyword">else</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> s2exp_synlt <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>lt := 1<span class="keyword">;</span> s2exp_bool true<span class="keyword">)</span>
      <span class="keyword">else</span> <span class="keyword">(</span>lt := ~1<span class="keyword">;</span> s2exp_bool false<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span> <span class="comment">// end of [auxlt]
</span>
  <span class="keyword">fn</span> auxlte
    <span class="keyword">(</span>isint<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> s2e1<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> s2e2<span class="keyword">:</span> <span class="staexp">s2exp</span><span class="keyword">,</span> lte<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int &gt;&gt; int</span><span class="keyword">)</span>
    <span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">if</span> isint <span class="keyword">then</span>
      s2exp_lte_int_int_bool <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span>
    <span class="keyword">else</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> s2exp_synlte <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span>lte := 1<span class="keyword">;</span> s2exp_bool true<span class="keyword">)</span>
      <span class="keyword">else</span> <span class="keyword">(</span>lte := ~1<span class="keyword">;</span> s2exp_bool false<span class="keyword">)</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span> <span class="comment">// end of [auxlte]
</span>
  <span class="keyword">fun</span> auxlst <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>nat<span class="keyword">}</span></span>
    <span class="keyword">(</span>s2es1<span class="keyword">:</span> <span class="staexp">s2explst n</span><span class="keyword">,</span> s2es2<span class="keyword">:</span> <span class="staexp">s2explst n</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2exp</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> s2es1 <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2es1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">var</span> lt<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0 <span class="keyword">and</span> lte<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
        <span class="keyword">val+</span> list_cons <span class="keyword">(</span>s2e2<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">=</span> s2es2
        <span class="keyword">val</span> isint <span class="keyword">=</span> s2rt_is_int <span class="keyword">(</span>s2e1<span class="keyword">.</span>s2exp_srt<span class="keyword">)</span>
        <span class="keyword">val</span> s2p_lt <span class="keyword">=</span> auxlt <span class="keyword">(</span>isint<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">,</span> lt<span class="keyword">)</span>
        <span class="keyword">val</span> s2p_lte <span class="keyword">=</span> auxlte <span class="keyword">(</span>isint<span class="keyword">,</span> s2e1<span class="keyword">,</span> s2e2<span class="keyword">,</span> lte<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">case+</span> lt <span class="keyword">of</span>
        <span class="keyword">|</span> _ <span class="keyword">when</span> lt <span class="keyword">=</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            s2exp_add_bool_bool_bool <span class="keyword">(</span>
              s2p_lt
            <span class="keyword">,</span> s2exp_mul_bool_bool_bool <span class="keyword">(</span>s2p_lte<span class="keyword">,</span> auxlst <span class="keyword">(</span>s2es1<span class="keyword">,</span> s2es2<span class="keyword">)</span><span class="keyword">)</span>
            <span class="keyword">)</span>
          <span class="keyword">end</span> <span class="comment">// end of [lt = 0]
</span>        <span class="keyword">|</span> _ <span class="keyword">when</span> lt <span class="keyword">&gt;</span> 0 <span class="keyword">=&gt;</span> s2p_lt <span class="comment">(* true *)</span> <span class="comment">// end of [lt &gt; 0]
</span>        <span class="keyword">|</span> _ <span class="comment">(* lt &lt; 0 *)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            <span class="keyword">if</span> lte <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> auxlst <span class="keyword">(</span>s2es1<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">else</span> s2p_lte <span class="comment">(* false *)</span>
          <span class="keyword">end</span> <span class="comment">// end of [lt &lt; 0]
</span>      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> s2exp_bool false
  <span class="keyword">end</span> <span class="comment">// end of [auxlst]
</span><span class="keyword">in</span>
  auxlst <span class="keyword">(</span>met<span class="keyword">,</span> met_bound<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s2exp_metlt_reduce]
</span>
<span class="keyword">implement</span>
s3bexp_make_s2exp
  <span class="keyword">(</span>s2e0<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> s2exp_whnf s2e0
<span class="comment">(*
  val () = begin
    print "s3bexp_make_s2exp: s2e0 = "; print s2e0; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Eapp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2e1<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Ecst s2c1 <span class="keyword">=&gt;</span> s3bexp_make_s2cst_s2explst <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2es2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Eapp]
</span>  <span class="keyword">|</span> S2Ecst s2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2c <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>True_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_true<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> s2cstref_cst_equ <span class="keyword">(</span>False_bool<span class="keyword">,</span> s2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_false<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span>s2cs := s2cstlst_add <span class="keyword">(</span>s2cs<span class="keyword">,</span> s2c<span class="keyword">)</span><span class="keyword">;</span> Some_vt <span class="keyword">(</span>s3bexp_cst s2c<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Ecst]
</span>  <span class="keyword">|</span> S2Evar s2v <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3bexp_var s2v<span class="keyword">)</span>
  <span class="keyword">|</span> S2Eeqeq <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux_equal <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
  <span class="keyword">|</span> S2Emetlt <span class="keyword">(</span>met<span class="keyword">,</span> met_bound<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2e_met <span class="keyword">=</span> s2exp_metlt_reduce <span class="keyword">(</span>met<span class="keyword">,</span> met_bound<span class="keyword">)</span>
    <span class="keyword">in</span>
      s3bexp_make_s2exp <span class="keyword">(</span>s2e_met<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3Emetlt]
</span>  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span> <span class="comment">// an expression that cannot be handled
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        prerr "warning(3): s3bexp_make_s2exp: s2e0 = "<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s3bexp_make_s2exp]
</span>
<span class="keyword">implement</span>
s3bexp_make_h3ypo
  <span class="keyword">(</span>h3p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> h3p<span class="keyword">.</span>h3ypo_node <span class="keyword">of</span>
  <span class="keyword">|</span> H3YPOprop s2p <span class="keyword">=&gt;</span> s3bexp_make_s2exp <span class="keyword">(</span>s2p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
  <span class="keyword">|</span> H3YPObind <span class="keyword">(</span>s2v1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux_bind <span class="keyword">(</span>h3p<span class="keyword">.</span>h3ypo_loc<span class="keyword">,</span> s2v1<span class="keyword">,</span> s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
  <span class="keyword">|</span> H3YPOeqeq <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">)</span> <span class="keyword">=&gt;</span> aux_equal <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2e2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [s3bexp_make_h3ypo]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
s3iexp_make_s2exp
  <span class="keyword">(</span>s2e0<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> s2e0 <span class="keyword">=</span> s2exp_whnf s2e0
<span class="comment">(*
  val () = begin
    print "s3iexp_make_s2exp: s2e0 = "; print s2e0; print_newline ()
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s2e0<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
  <span class="keyword">|</span> S2Eapp <span class="keyword">(</span>s2e1<span class="keyword">,</span> s2es2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s2e1<span class="keyword">.</span>s2exp_node <span class="keyword">of</span>
    <span class="keyword">|</span> S2Ecst s2c1 <span class="keyword">=&gt;</span> s3iexp_make_s2cst_s2explst <span class="keyword">(</span>s2c1<span class="keyword">,</span> s2es2<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Eapp]
</span>  <span class="keyword">|</span> S2Echar c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> i <span class="keyword">=</span> int_of_char c <span class="keyword">in</span> Some_vt <span class="keyword">(</span>s3iexp_int i<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Echar]
</span>  <span class="keyword">|</span> S2Ecst s2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s2cs := s2cstlst_add <span class="keyword">(</span>s2cs<span class="keyword">,</span> s2c<span class="keyword">)</span><span class="keyword">;</span> Some_vt <span class="keyword">(</span>s3iexp_cst s2c<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Ecst]
</span>  <span class="keyword">|</span> S2Eint i <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_int i<span class="keyword">)</span>
  <span class="keyword">|</span> S2Eintinf i <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_intinf i<span class="keyword">)</span>
  <span class="keyword">|</span> S2Esize s2ze <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2c_rel <span class="keyword">=</span> s2cstref_cst_get <span class="keyword">(</span>Size_int_int_bool<span class="keyword">)</span>
      <span class="keyword">val</span> s2v <span class="keyword">=</span> s2cfdeflst_replace <span class="keyword">(</span>s2rt_int<span class="keyword">,</span> s2c_rel<span class="keyword">,</span> <span class="keyword">'[</span>s2e0<span class="keyword">]</span><span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
    <span class="keyword">in</span>
      Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S2Esize]
</span>  <span class="keyword">|</span> S2Evar s2v <span class="keyword">=&gt;</span> Some_vt <span class="keyword">(</span>s3iexp_var s2v<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span> <span class="comment">// an expression that cannot be handled
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
        prerr "warning(3): s3iexp_make_s2exp: s2e0 = "<span class="keyword">;</span> prerr s2e0<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      <span class="keyword">end</span> <span class="comment">// end of [val]
</span>    <span class="keyword">in</span>
      None_vt <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [_]
</span><span class="keyword">end</span> <span class="comment">// end of [s2iexp_make_s2exp]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Map <span class="keyword">=</span> "ats_map_lin.sats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anonymous*)</span> <span class="keyword">=</span> "ats_map_lin.dats"</span> <span class="comment">// for template definition
</span>
<span class="keyword">viewtypedef</span> <span class="staexp"><a name="46675"><span class="stacstdec">s2cst_index_map <span class="keyword">=</span> $Map<span class="keyword">.</span>map_vt <span class="keyword">(</span>stamp_t<span class="keyword">,</span> Pos<span class="keyword">)</span></span></a></span>
<span class="keyword">viewtypedef</span> <span class="staexp"><a name="46732"><span class="stacstdec">s2var_index_map <span class="keyword">=</span> $Map<span class="keyword">.</span>map_vt <span class="keyword">(</span>stamp_t<span class="keyword">,</span> Pos<span class="keyword">)</span></span></a></span>

<span class="comment">//
</span>
<span class="neuexp"><span class="keyword">overload</span> compare <span class="keyword">with</span> $Stamp<span class="keyword">.</span>compare_stamp_stamp</span>

<span class="keyword">fn</span> s2cst_index_map_make <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2cst_index_map</span> <span class="keyword">=</span>
  $Map<span class="keyword">.</span>map_make <span class="staexp"><span class="keyword">{</span>stamp_t<span class="keyword">,</span> Pos<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">lam</span> <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span> <span class="keyword">=&gt;</span> compare <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s2cst_index_map_make]
</span>
<span class="keyword">fn</span> s2var_index_map_make <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">s2var_index_map</span> <span class="keyword">=</span>
  $Map<span class="keyword">.</span>map_make <span class="staexp"><span class="keyword">{</span>stamp_t<span class="keyword">,</span> Pos<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">lam</span> <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span> <span class="keyword">=&gt;</span> compare <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span><span class="keyword">)</span>
<span class="comment">// end of [s2cst_index_map_make]
</span>
<span class="comment">//
</span>
<span class="keyword">fn</span> s2cst_index_find <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span>
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cst_index_map</span><span class="keyword">,</span> s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>1<span class="keyword">,</span> n<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = print "s2cst_index_find: s2c = "; print s2c; print_newline ()
*)</span>
  <span class="keyword">val</span> stamp <span class="keyword">=</span> s2cst_stamp_get s2c
<span class="keyword">in</span>
  <span class="keyword">case+</span> $Map<span class="keyword">.</span>map_search <span class="keyword">(</span>m<span class="keyword">,</span> stamp<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i <span class="keyword">&lt;</span> n <span class="keyword">then</span> i <span class="keyword">else</span> <span class="keyword">begin</span>
      prerr_loc_interror <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s2cst_index_find: the static constant ["<span class="keyword">;</span>
      prerr_s2cst s2c<span class="keyword">;</span>
      prerr "] is associated with an index that is out-of-range."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>intBtw <span class="keyword">(</span>1<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s2cst_index_find: the static constant ["<span class="keyword">;</span>
      prerr_s2cst s2c<span class="keyword">;</span>
      prerr "] is not associated with any index."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>intBtw <span class="keyword">(</span>1<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">// end of [s2cst_index_find]
</span>
<span class="keyword">fn</span> s2var_index_find <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span>
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> m<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2var_index_map</span><span class="keyword">,</span> s2v<span class="keyword">:</span> <span class="staexp">s2var_t</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span><span class="keyword">)</span>
  <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>1<span class="keyword">,</span> n<span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = print "s2var_index_find: s2v = "; print s2v; print_newline ()
*)</span>
  <span class="keyword">val</span> stamp <span class="keyword">=</span> s2var_stamp_get s2v
<span class="keyword">in</span>
  <span class="keyword">case+</span> $Map<span class="keyword">.</span>map_search <span class="keyword">(</span>m<span class="keyword">,</span> stamp<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">~</span>Some_vt <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> i <span class="keyword">&lt;</span> n <span class="keyword">then</span> i <span class="keyword">else</span> <span class="keyword">begin</span>
      prerr_loc_interror <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s2var_index_find: the static variable ["<span class="keyword">;</span>
      prerr_s2var s2v<span class="keyword">;</span>
      prerr "] is associated with an index that is out-of-range."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>intBtw <span class="keyword">(</span>1<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [Some_vt]
</span>  <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_loc_interror <span class="keyword">(</span>loc0<span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s2var_index_find: the static variable ["<span class="keyword">;</span>
      prerr_s2var s2v<span class="keyword">;</span>
      prerr "] is not associated with any index."<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>intBtw <span class="keyword">(</span>1<span class="keyword">,</span> n<span class="keyword">)</span><span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span><span class="keyword">end</span> <span class="comment">// end of [s2var_index_find]
</span>
<span class="comment">//
</span>
<span class="keyword">fn</span> s2cst_index_insert
  <span class="keyword">(</span>cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cst_index_map</span><span class="keyword">,</span> s2c<span class="keyword">:</span> <span class="staexp">s2cst_t</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">Pos</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  $Map<span class="keyword">.</span>map_insert <span class="keyword">(</span>cim<span class="keyword">,</span> s2cst_stamp_get s2c<span class="keyword">,</span> i<span class="keyword">)</span>

<span class="keyword">fn</span> s2var_index_insert
  <span class="keyword">(</span>vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2var_index_map</span><span class="keyword">,</span> s2v<span class="keyword">:</span> <span class="staexp">s2var_t</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">Pos</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
  $Map<span class="keyword">.</span>map_insert <span class="keyword">(</span>vim<span class="keyword">,</span> s2var_stamp_get s2v<span class="keyword">,</span> i<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">FM <span class="keyword">=</span> "ats_solver_fm.sats"</span>

<span class="keyword">stadef</span> <span class="staexp"><a name="49235"><span class="stacstdec">i0nt <span class="keyword">=</span> $FM<span class="keyword">.</span>i0nt</span></a></span>
<span class="keyword">stadef</span> <span class="staexp"><a name="49258"><span class="stacstdec">intvec <span class="keyword">=</span> $FM<span class="keyword">.</span>intvec</span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="49311"><span class="dyncstdec">s3aexp_intvec_update_err <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="prfexp">pf_arr<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>intvec n @ l</span></span>
  <span class="keyword">|</span> loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cst_index_map</span>
  <span class="keyword">,</span> vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2var_index_map</span>
  <span class="keyword">,</span> ivp<span class="keyword">:</span> <span class="staexp">ptr l</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span>
  <span class="keyword">,</span> coef<span class="keyword">:</span> <span class="staexp">i0nt</span><span class="keyword">,</span> s3ae0<span class="keyword">:</span> <span class="staexp">s3aexp</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span></a>
<span class="comment">// end of [s3aexp_intvec_update_err]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="49580"><span class="dyncstdec">s3bexp_intvec_update_err <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="prfexp">pf_arr<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>intvec n @ l</span></span>
  <span class="keyword">|</span> loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cst_index_map</span>
  <span class="keyword">,</span> vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2var_index_map</span>
  <span class="keyword">,</span> ivp<span class="keyword">:</span> <span class="staexp">ptr l</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span>
  <span class="keyword">,</span> coef<span class="keyword">:</span> <span class="staexp">i0nt</span><span class="keyword">,</span> s3be0<span class="keyword">:</span> <span class="staexp">s3bexp</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span></a>
<span class="comment">// end of [s3bexp_intvec_update_err]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="49849"><span class="dyncstdec">s3iexp_intvec_update_err <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span> <span class="keyword">(</span>
    <span class="prfexp">pf_arr<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>intvec n @ l</span></span>
  <span class="keyword">|</span> loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cst_index_map</span>
  <span class="keyword">,</span> vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2var_index_map</span>
  <span class="keyword">,</span> ivp<span class="keyword">:</span> <span class="staexp">ptr l</span><span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span>
  <span class="keyword">,</span> coef<span class="keyword">:</span> <span class="staexp">i0nt</span><span class="keyword">,</span> s3ie0<span class="keyword">:</span> <span class="staexp">s3iexp</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span></span></a>
<span class="comment">// end of [s3iexp_intvec_update_err]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
s3aexp_intvec_update_err
  <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ae0<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s3aexp_intvec_update_err: coef = "; print coef; print_newline ();
    print "s3aexp_intvec_update_err: s3ae0 = "; print s3ae0; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s3ae0 <span class="keyword">of</span>
  <span class="keyword">|</span> S3AEcst s2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> s2cst_index_find <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> s2c<span class="keyword">,</span> n<span class="keyword">)</span>
    <span class="keyword">in</span>
      ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> := ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> + coef
    <span class="keyword">end</span> <span class="comment">// end of [S3AEcst]
</span>  <span class="keyword">|</span> S3AEvar s2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> s2var_index_find <span class="keyword">(</span>loc0<span class="keyword">,</span> vim<span class="keyword">,</span> s2v<span class="keyword">,</span> n<span class="keyword">)</span>
    <span class="keyword">in</span>
      ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> := ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> + coef
    <span class="keyword">end</span> <span class="comment">// end of [S3AEvar]
</span>  <span class="keyword">|</span> S3AEnull <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">|</span> S3AEpadd <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3aexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ae1<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
      s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie2<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3AEpadd]
</span>  <span class="keyword">|</span> S3AEexp _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s3aexp_intvec_update_err: unsupported term: s3ae0 = "<span class="keyword">;</span> prerr s3ae0<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEexp]
</span><span class="keyword">end</span> <span class="comment">// end of [s3aexp_intvec_update_err]
</span>
<span class="comment">//
</span>
<span class="keyword">implement</span>
s3iexp_intvec_update_err
  <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie0<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s3iexp_intvec_update_err: coef = "; print_i0nt coef; print_newline ();
    print "s3iexp_intvec_update_err: s3ie0 = "; print_s3iexp s3ie0; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s3ie0 <span class="keyword">of</span>
  <span class="keyword">|</span> S3IEcst s2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> s2cst_index_find <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> s2c<span class="keyword">,</span> n<span class="keyword">)</span>
    <span class="keyword">in</span>
      ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> := ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> + coef
    <span class="keyword">end</span> <span class="comment">// end of [S3IEcst]
</span>  <span class="keyword">|</span> S3IEvar s2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> s2var_index_find <span class="keyword">(</span>loc0<span class="keyword">,</span> vim<span class="keyword">,</span> s2v<span class="keyword">,</span> n<span class="keyword">)</span>
    <span class="keyword">in</span>
      ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> := ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> + coef
    <span class="keyword">end</span> <span class="comment">// end of [S3IEvar]
</span>  <span class="keyword">|</span> S3IEint <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> i0 <span class="keyword">=</span> $FM<span class="keyword">.</span>i0nt_of_int i <span class="keyword">in</span> ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">0</span><span class="keyword">]</span> := ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">0</span><span class="keyword">]</span> + coef * i0
    <span class="keyword">end</span> <span class="comment">// end of [S3IEint]
</span>  <span class="keyword">|</span> S3IEintinf <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">let</span> <span class="keyword">val</span> i0 <span class="keyword">=</span> $FM<span class="keyword">.</span>i0nt_of_intinf i <span class="keyword">in</span> ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">0</span><span class="keyword">]</span> := ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">0</span><span class="keyword">]</span> + coef * i0 <span class="keyword">end</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEintinf]
</span>  <span class="keyword">|</span> S3IEineg <span class="keyword">(</span>s3ie<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> <span class="keyword">~</span>coef<span class="keyword">,</span> s3ie<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEineg]
</span>  <span class="keyword">|</span> S3IEiadd <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie1<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
      s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie2<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEiadd]
</span>  <span class="keyword">|</span> S3IEisub <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie1<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
      s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> <span class="keyword">~</span>coef<span class="keyword">,</span> s3ie2<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEisub]
</span>  <span class="keyword">|</span> S3IEimul <span class="keyword">(</span>s3ie1<span class="keyword">,</span> s3ie2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3ie1 <span class="keyword">of</span>
    <span class="keyword">|</span> S3IEint i1 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> coef <span class="keyword">=</span> coef * $FM<span class="keyword">.</span>i0nt_of_int <span class="keyword">(</span>i1<span class="keyword">)</span>
      <span class="keyword">in</span>
        s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie2<span class="keyword">,</span> errno<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S3IEint]
</span>    <span class="keyword">|</span> S3IEintinf i1 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> coef <span class="keyword">=</span> coef * $FM<span class="keyword">.</span>i0nt_of_intinf <span class="keyword">(</span>i1<span class="keyword">)</span>
      <span class="keyword">in</span>
        s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie2<span class="keyword">,</span> errno<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S3IEintinf]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3ie2 <span class="keyword">of</span>
      <span class="keyword">|</span> S3IEint i2 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> coef <span class="keyword">=</span> coef * $FM<span class="keyword">.</span>i0nt_of_int <span class="keyword">(</span>i2<span class="keyword">)</span> <span class="keyword">in</span>
          s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie1<span class="keyword">,</span> errno<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [S3IEint]
</span>      <span class="keyword">|</span> S3IEintinf i2 <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> coef <span class="keyword">=</span> coef * $FM<span class="keyword">.</span>i0nt_of_intinf <span class="keyword">(</span>i2<span class="keyword">)</span> <span class="keyword">in</span>
          s3iexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ie1<span class="keyword">,</span> errno<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [S3IEintinf]
</span>      <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">;</span>
          prerr ": it is not allowed to have a nonlinear term appear in a constraint: ["<span class="keyword">;</span>
          prerr s3ie0<span class="keyword">;</span> prerr "]"<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
          $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [_]
</span>      <span class="keyword">end</span> <span class="comment">(* end of [_] *)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEimul]
</span>  <span class="keyword">|</span> S3IEpdiff <span class="keyword">(</span>s3ae1<span class="keyword">,</span> s3ae2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      s3aexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> coef<span class="keyword">,</span> s3ae1<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
      s3aexp_intvec_update_err <span class="keyword">(</span><span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> <span class="keyword">~</span>coef<span class="keyword">,</span> s3ae2<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEpdiff]
</span>  <span class="keyword">|</span> S3IEexp _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s3iexp_intvec_update_err: unsupported term: s3ie0 = "<span class="keyword">;</span> prerr s3ie0<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3IEexp]
</span><span class="keyword">end</span> <span class="comment">// end of [s3iexp_intvec_update_err]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="54517"><span class="dyncstdec">s3bexp_icstr_make_err <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cst_index_map</span>
  <span class="keyword">,</span> vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2var_index_map</span>
  <span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span> <span class="comment">(* 1 + number of variables *)</span>
  <span class="keyword">,</span> s3be0<span class="keyword">:</span> <span class="staexp">s3bexp</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">$FM<span class="keyword">.</span>icstr n</span></span></a>
<span class="comment">// end of [s3bexp_icstr_make_err]
</span>
<span class="keyword">implement</span>
s3bexp_icstr_make_err
  <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> n<span class="keyword">,</span> s3be0<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s3bexp_icstr_err: s3be0 = "; print_s3bexp s3be; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">macdef</span> <span class="neuexp">aux <span class="keyword">(</span>s3be<span class="keyword">)</span> <span class="keyword">=</span> s3bexp_icstr_make_err <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> n<span class="keyword">,</span> <span class="keyword">,(</span>s3be<span class="keyword">)</span><span class="keyword">,</span> errno<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s3be0 <span class="keyword">of</span>
  <span class="keyword">|</span> S3BEbool b <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      <span class="keyword">if</span> b <span class="keyword">then</span> <span class="keyword">begin</span>
        $FM<span class="keyword">.</span>ICveclst <span class="keyword">(</span>0<span class="comment">(*conj*)</span><span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
        $FM<span class="keyword">.</span>ICveclst <span class="keyword">(</span>1<span class="comment">(*disj*)</span><span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [if]
</span>    <span class="keyword">end</span> <span class="comment">// end of [S3BEbool]
</span>  <span class="keyword">|</span> S3BEcst s2c <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> s2cst_index_find <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> s2c<span class="keyword">,</span> n<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> ivp<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>intvec_ptr_make <span class="keyword">(</span>n<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> := $FM<span class="keyword">.</span>i0nt_1<span class="keyword">;</span> ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">0</span><span class="keyword">]</span> := $FM<span class="keyword">.</span>i0nt_neg_1<span class="keyword">)</span>
    <span class="keyword">in</span>
      $FM<span class="keyword">.</span>ICvec <span class="keyword">(</span>2<span class="comment">(*gte*)</span><span class="keyword">,</span> $FM<span class="keyword">.</span>intvecptr_make_view_ptr <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> ivp<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3BEcst]
</span>  <span class="keyword">|</span> S3BEvar s2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ind <span class="keyword">=</span> s2var_index_find <span class="keyword">(</span>loc0<span class="keyword">,</span> vim<span class="keyword">,</span> s2v<span class="keyword">,</span> n<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> ivp<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>intvec_ptr_make <span class="keyword">(</span>n<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">(</span>ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">ind</span><span class="keyword">]</span> := $FM<span class="keyword">.</span>i0nt_1<span class="keyword">;</span> ivp<span class="keyword">-&gt;</span><span class="keyword">[</span><span class="prfexp">0</span><span class="keyword">]</span> := $FM<span class="keyword">.</span>i0nt_neg_1<span class="keyword">)</span>
    <span class="keyword">in</span>
      $FM<span class="keyword">.</span>ICvec <span class="keyword">(</span>2<span class="comment">(*gte*)</span><span class="keyword">,</span> $FM<span class="keyword">.</span>intvecptr_make_view_ptr <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> ivp<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3BEvar]
</span>  <span class="keyword">|</span> S3BEbneg s3be <span class="keyword">=&gt;</span> $FM<span class="keyword">.</span>icstr_negate <span class="keyword">(</span>aux s3be<span class="keyword">)</span>
  <span class="keyword">|</span> S3BEbadd <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ic1 <span class="keyword">=</span> aux s3be1 <span class="keyword">and</span> ic2 <span class="keyword">=</span> aux s3be2
      <span class="keyword">val</span> ics <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>ic1<span class="keyword">,</span> list_vt_cons <span class="keyword">(</span>ic2<span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $FM<span class="keyword">.</span>ICveclst <span class="keyword">(</span>1<span class="comment">(*disj*)</span><span class="keyword">,</span> ics<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3BEbadd]
</span>  <span class="keyword">|</span> S3BEbmul <span class="keyword">(</span>s3be1<span class="keyword">,</span> s3be2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> ic1 <span class="keyword">=</span> aux s3be1 <span class="keyword">and</span> ic2 <span class="keyword">=</span> aux s3be2
      <span class="keyword">val</span> ics <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>ic1<span class="keyword">,</span> list_vt_cons <span class="keyword">(</span>ic2<span class="keyword">,</span> list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">in</span>
      $FM<span class="keyword">.</span>ICveclst <span class="keyword">(</span>0<span class="comment">(*conj*)</span><span class="keyword">,</span> ics<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3BEbmul]
</span>  <span class="keyword">|</span> S3BEiexp <span class="keyword">(</span>knd<span class="keyword">,</span> s3ie<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span> <span class="comment">(* gte/lt: 2/~2; eq/neq: 1/~1 *)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> ivp<span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>intvec_ptr_make <span class="keyword">(</span>n<span class="keyword">)</span>
      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s3iexp_intvec_update_err <span class="keyword">(</span>
        <span class="prfexp">pf_arr</span> <span class="keyword">|</span> loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> ivp<span class="keyword">,</span> n<span class="keyword">,</span> $FM<span class="keyword">.</span>i0nt_1<span class="keyword">,</span> s3ie<span class="keyword">,</span> errno
      <span class="keyword">)</span> <span class="comment">// end of [s3iexp_intvec_update_err]
</span>    <span class="keyword">in</span>
      $FM<span class="keyword">.</span>ICvec <span class="keyword">(</span>knd<span class="keyword">,</span> $FM<span class="keyword">.</span>intvecptr_make_view_ptr <span class="keyword">(</span><span class="prfexp">pf_gc</span><span class="keyword">,</span> <span class="prfexp">pf_arr</span> <span class="keyword">|</span> ivp<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3BEiexp]
</span>  <span class="keyword">|</span> S3BEexp _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prerr_interror <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      prerr ": s3bexp_intvec_make_err: unsupported term: s3be0 = "<span class="keyword">;</span> prerr s3be0<span class="keyword">;</span>
      prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
      $Err<span class="keyword">.</span>abort <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [S3BEexp]
</span><span class="keyword">end</span> <span class="comment">// end of [s3bexp_icstr_make_err]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="57048"><span class="dyncstdec">s3bexplst_s2exp_solve_fm <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp">s2varlst</span>
  <span class="keyword">,</span> s3bes<span class="keyword">:</span> <span class="staexp">s3bexplst</span>
  <span class="keyword">,</span> s2p<span class="keyword">:</span> <span class="staexp">s2exp</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span>
  <span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span></span></a>
<span class="comment">// end of [s3bexplst_s2exp_solve_fm]
</span>
<span class="keyword">implement</span>
s3bexplst_s2exp_solve_fm
  <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s2p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "s3bexplst_s2exp_solve_fm: s2vs = "; print s2vs; print_newline ();
    print "s3bexplst_s2exp_solve_fm: s3bes = "; print s3bes; print_newline ();
    print "s3bexplst_s2exp_solve_fm: s2p = "; print s2p; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">viewtypedef</span> <span class="staexp"><a name="57641"><span class="stacstdec">cim_vt <span class="keyword">=</span> s2cst_index_map</span></a></span> <span class="keyword">and</span> <span class="staexp"><a name="57670"><span class="stacstdec">vim_vt <span class="keyword">=</span> s2var_index_map</span></a></span>
  <span class="keyword">val</span> os3p <span class="keyword">=</span> s3bexp_make_s2exp <span class="keyword">(</span>s2p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span>
  <span class="keyword">var</span> s3bes_asmp<span class="keyword">:</span> <span class="staexp">s3bexplst</span> <span class="keyword">=</span> s3bes
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>s3bes_asmp<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>s3bes<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s3bexplst</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
      <span class="keyword">case+</span> fds <span class="keyword">of</span>
      <span class="keyword">|</span> S2CFDEFLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">,</span> <span class="keyword">!</span>rel<span class="keyword">,</span> <span class="keyword">!</span>fds_nxt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">case+</span> <span class="keyword">!</span>rel <span class="keyword">of</span>
            <span class="keyword">|</span> Some_vt s3be <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
                fold@ <span class="keyword">(</span><span class="keyword">!</span>rel<span class="keyword">)</span><span class="keyword">;</span> s3bes := list_cons <span class="keyword">(</span>s3be<span class="keyword">,</span> s3bes<span class="keyword">)</span>
              <span class="keyword">end</span>
            <span class="keyword">|</span> None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> fold@ <span class="keyword">(</span><span class="keyword">!</span>rel<span class="keyword">)</span>
        <span class="keyword">in</span>
          aux <span class="keyword">(</span>s3bes<span class="keyword">,</span> <span class="keyword">!</span>fds_nxt<span class="keyword">)</span><span class="keyword">;</span> fold@ <span class="keyword">(</span>fds<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [S2CFDEFLSTcons]
</span>      <span class="keyword">|</span> S2CFDEFLSTmark <span class="keyword">(</span><span class="keyword">!</span>fds_nxt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          aux <span class="keyword">(</span>s3bes<span class="keyword">,</span> <span class="keyword">!</span>fds_nxt<span class="keyword">)</span><span class="keyword">;</span> fold@ <span class="keyword">(</span>fds<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [S2CFDEFLSTmark]
</span>      <span class="keyword">|</span> S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> fold@ <span class="keyword">(</span>fds<span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span>
  <span class="keyword">val</span> s3p <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> os3p <span class="keyword">of</span>
    <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3p <span class="keyword">=&gt;</span> s3p <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span>
          prerr ": warning(3)"<span class="keyword">;</span> prerr ": the constraint ["<span class="keyword">;</span> prerr_s2exp s2p<span class="keyword">;</span>
          prerr "] cannot be translated into a form accepted by the constraint solver."<span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span>      <span class="keyword">in</span>
        s3bexp_false <span class="comment">(* make it the worst scenario *)</span>
      <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>  <span class="keyword">end</span> <span class="comment">// end of [val]
</span><span class="comment">//
</span>  <span class="keyword">var</span> cnt<span class="keyword">:</span> <span class="staexp">Pos</span> <span class="keyword">=</span> 1
  <span class="keyword">var</span> cim <span class="keyword">=</span> s2cst_index_map_make <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>cim<span class="keyword">,</span> cnt<span class="keyword">,</span> s2cs<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>cim_vt</span><span class="keyword">,</span> cnt<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>Pos</span><span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp">s2cstlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
      <span class="keyword">case+</span> s2cs <span class="keyword">of</span>
      <span class="keyword">|</span> S2CSTLSTcons <span class="keyword">(</span>s2c<span class="keyword">,</span> s2cs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cst_index_insert <span class="keyword">(</span>cim<span class="keyword">,</span> s2c<span class="keyword">,</span> cnt<span class="keyword">)</span>
        <span class="keyword">in</span>
          cnt := cnt + 1<span class="keyword">;</span> aux <span class="keyword">(</span>cim<span class="keyword">,</span> cnt<span class="keyword">,</span> s2cs<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> S2CSTLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span>  <span class="keyword">var</span> vim <span class="keyword">=</span> s2var_index_map_make <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>vim<span class="keyword">,</span> cnt<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>vim_vt</span><span class="keyword">,</span> cnt<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>Pos</span><span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp">s2varlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
      <span class="keyword">case+</span> s2vs <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> s2vs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2var_index_insert <span class="keyword">(</span>vim<span class="keyword">,</span> s2v<span class="keyword">,</span> cnt<span class="keyword">)</span>
        <span class="keyword">in</span>
          cnt := cnt + 1<span class="keyword">;</span> aux <span class="keyword">(</span>vim<span class="keyword">,</span> cnt<span class="keyword">,</span> s2vs<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>vim<span class="keyword">,</span> cnt<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">fun</span> aux <span class="keyword">(</span>vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>vim_vt</span><span class="keyword">,</span> cnt<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>Pos</span><span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>s2cfdeflst_vt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
      <span class="keyword">case+</span> fds <span class="keyword">of</span>
      <span class="keyword">|</span> S2CFDEFLSTcons <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> s2v_res<span class="keyword">,</span> _<span class="keyword">,</span> <span class="keyword">!</span>fds_nxt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2var_index_insert <span class="keyword">(</span>vim<span class="keyword">,</span> s2v_res<span class="keyword">,</span> cnt<span class="keyword">)</span>
        <span class="keyword">in</span>
          cnt := cnt + 1<span class="keyword">;</span> aux <span class="keyword">(</span>vim<span class="keyword">,</span> cnt<span class="keyword">,</span> <span class="keyword">!</span>fds_nxt<span class="keyword">)</span><span class="keyword">;</span> fold@ fds
        <span class="keyword">end</span>
      <span class="keyword">|</span> S2CFDEFLSTmark <span class="keyword">(</span><span class="keyword">!</span>fds_nxt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          aux <span class="keyword">(</span>vim<span class="keyword">,</span> cnt<span class="keyword">,</span> <span class="keyword">!</span>fds_nxt<span class="keyword">)</span><span class="keyword">;</span> fold@ <span class="keyword">(</span>fds<span class="keyword">)</span>
        <span class="keyword">end</span>
      <span class="keyword">|</span> S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> fold@ <span class="keyword">(</span>fds<span class="keyword">)</span>
  <span class="keyword">}</span> <span class="comment">// end of [where]
</span><span class="comment">//
</span>  <span class="keyword">val</span> cnt <span class="keyword">=</span> cnt <span class="comment">// the [cnt] variable is shadowed intentionally!
</span>  <span class="keyword">val</span> ics_asmp <span class="keyword">=</span> ics <span class="keyword">where</span> <span class="keyword">{</span>
    <span class="keyword">viewtypedef</span> <span class="staexp"><a name="60279"><span class="stacstdec">T <span class="keyword">=</span> <span class="keyword">[</span>n<span class="keyword">,</span>s<span class="keyword">:</span>int<span class="keyword">]</span> $FM<span class="keyword">.</span>icstrlst <span class="keyword">(</span>n<span class="keyword">,</span> s<span class="keyword">)</span></span></a></span>
    <span class="keyword">fun</span> aux <span class="staexp"><span class="keyword">{</span>n<span class="keyword">:</span>pos<span class="keyword">}</span></span> <span class="keyword">(</span>
        loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
      <span class="keyword">,</span> cim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>cim_vt</span>
      <span class="keyword">,</span> vim<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span>vim_vt</span>
      <span class="keyword">,</span> n<span class="keyword">:</span> <span class="staexp">int n</span>
      <span class="keyword">,</span> s3bes<span class="keyword">:</span> <span class="staexp">s3bexplst</span>
      <span class="keyword">,</span> ics<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>T? &gt;&gt; $FM<span class="keyword">.</span>icstrlst n</span>
      <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
      <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3bes <span class="keyword">of</span>
      <span class="keyword">|</span> list_cons <span class="keyword">(</span>s3be<span class="keyword">,</span> s3bes<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> ic <span class="keyword">=</span> s3bexp_icstr_make_err <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> n<span class="keyword">,</span> s3be<span class="keyword">,</span> errno<span class="keyword">)</span>
          <span class="keyword">val+</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ics := list_vt_cons <span class="staexp"><span class="keyword">{</span>$FM<span class="keyword">.</span>icstr n<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>0<span class="keyword">}</span></span> <span class="keyword">(</span>ic<span class="keyword">,</span> ?<span class="keyword">)</span>
          <span class="keyword">val+</span> list_vt_cons <span class="keyword">(</span>_<span class="keyword">,</span> <span class="keyword">!</span>ics_nxt<span class="keyword">)</span> <span class="keyword">=</span> ics
        <span class="keyword">in</span>
          aux <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> n<span class="keyword">,</span> s3bes<span class="keyword">,</span> <span class="keyword">!</span>ics_nxt<span class="keyword">,</span> errno<span class="keyword">)</span><span class="keyword">;</span> fold@ ics
        <span class="keyword">end</span>
      <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span>ics := list_vt_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>    <span class="keyword">var</span> ics<span class="keyword">:</span> <span class="staexp">T</span> <span class="comment">// uninitialized
</span>    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> aux <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> cnt<span class="keyword">,</span> s3bes_asmp<span class="keyword">,</span> ics<span class="keyword">,</span> errno<span class="keyword">)</span>
  <span class="keyword">}</span>
<span class="comment">//
</span>  <span class="keyword">val</span> ic_conc <span class="keyword">=</span> s3bexp_icstr_make_err <span class="keyword">(</span>loc0<span class="keyword">,</span> cim<span class="keyword">,</span> vim<span class="keyword">,</span> cnt<span class="keyword">,</span> s3p<span class="keyword">,</span> errno<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Map<span class="keyword">.</span>map_free cim <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $Map<span class="keyword">.</span>map_free vim
<span class="comment">(*
  val () = begin
    print "s3bexp_s2exp_solve_fm: ics_asmp = \n";
    print_icstrlst (ics_asmp, cnt); print_newline ();
    print "s3bexp_s2exp_solve_fm: ic_conc = "; 
    print_icstr (ic_conc, cnt); print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">var</span> ics_all <span class="keyword">=</span> list_vt_cons <span class="keyword">(</span>$FM<span class="keyword">.</span>icstr_negate ic_conc<span class="keyword">,</span> ics_asmp<span class="keyword">)</span>
<span class="comment">(*
  val () = begin
    print "s3bexp_s2exp_solve_fm: ics_all = \n";
    print_icstrlst (ics_all, cnt);
    print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> ans <span class="keyword">=</span> $FM<span class="keyword">.</span>icstrlst_solve <span class="keyword">(</span>ics_all<span class="keyword">,</span> cnt<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> $FM<span class="keyword">.</span>icstrlst_free ics_all
<span class="keyword">in</span>
  ans
<span class="keyword">end</span> <span class="comment">// end of [s3bexplst_s2exp_solve_fm]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="61780"><span class="dyncstdec">c3str_solve_main <span class="keyword">(</span>
    s2vs<span class="keyword">:</span> <span class="staexp">s2varlst</span>
  <span class="keyword">,</span> s3bes<span class="keyword">:</span> <span class="staexp">s3bexplst</span>
  <span class="keyword">,</span> c3t<span class="keyword">:</span> <span class="staexp">c3str</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span>
  <span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">,</span> unsolved<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>uint</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span></span></a>
<span class="comment">// end of [c3str_solve_main]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="61996"><span class="dyncstdec">c3str_solve_prop <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp">s2varlst</span>
  <span class="keyword">,</span> s3bes<span class="keyword">:</span> <span class="staexp">s3bexplst</span>
  <span class="keyword">,</span> s2p<span class="keyword">:</span> <span class="staexp">s2exp</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span>
  <span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span></span></a>
<span class="comment">// end of [c3str_solve_prop]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="62208"><span class="dyncstdec">c3str_solve_itmlst <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp">s2varlst</span>
  <span class="keyword">,</span> s3bes<span class="keyword">:</span> <span class="staexp">s3bexplst</span>
  <span class="keyword">,</span> s3is<span class="keyword">:</span> <span class="staexp">s3itemlst</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span>
  <span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">,</span> unsolved<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>uint</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span></span></a>
<span class="comment">// end of [c3str_solve_itmlst]
</span>
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="62449"><span class="dyncstdec">c3str_solve_itmlst_disj <span class="keyword">(</span>
    loc0<span class="keyword">:</span> <span class="staexp">loc_t</span>
  <span class="keyword">,</span> s2vs<span class="keyword">:</span> <span class="staexp">s2varlst</span>
  <span class="keyword">,</span> s3bes<span class="keyword">:</span> <span class="staexp">s3bexplst</span>
  <span class="keyword">,</span> s3is<span class="keyword">:</span> <span class="staexp">s3itemlst</span>
  <span class="keyword">,</span> s3iss<span class="keyword">:</span> <span class="staexp">s3itemlstlst</span>
  <span class="keyword">,</span> s2cs<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cstlst</span>
  <span class="keyword">,</span> fds<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>s2cfdeflst_vt</span>
  <span class="keyword">,</span> unsolved<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>uint</span>
  <span class="keyword">,</span> errno<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>int</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span></span></a>
<span class="comment">// end of [c3str_solve_itmlst_disj]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fn</span> pattern_match_exhaustiveness_msg
  <span class="keyword">(</span>loc0<span class="keyword">:</span> <span class="staexp">loc_t</span><span class="keyword">,</span> knd<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> p2tcs<span class="keyword">:</span> <span class="staexp">p2atcstlst</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>p2tcs<span class="keyword">:</span> <span class="staexp">p2atcstlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">case+</span> p2tcs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>p2tc<span class="keyword">,</span> p2tcs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        prerr p2tc<span class="keyword">;</span> prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span> aux p2tcs
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  <span class="keyword">case+</span> knd <span class="keyword">of</span>
  <span class="keyword">|</span> 0 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span>
      prerr ": warning(3)"<span class="keyword">;</span>
      prerr ": pattern match is nonexhaustive:\n"<span class="keyword">;</span>
      aux p2tcs<span class="keyword">;</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> 1 <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span>
      prerr ": error(3)"<span class="keyword">;</span>
      prerr ": pattern match is nonexhaustive:\n"<span class="keyword">;</span>
      aux p2tcs<span class="keyword">;</span>
    <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="comment">// ignore
</span><span class="keyword">end</span> <span class="comment">// end of [pattern_match_exhaustiveness_msg]
</span>
<span class="keyword">implement</span>
c3str_solve_main
  <span class="keyword">(</span>s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> c3t<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "c3str_solve_main: s2vs = "; print s2vs; print_newline ();
    print "c3str_solve_main: s3bes = "; print s3bes; print_newline ();
    print "c3str_solve_main: c3t = "; print c3t; print_newline ();
  end // end of [val]
*)</span>
  <span class="keyword">val</span> loc0 <span class="keyword">=</span> c3t<span class="keyword">.</span>c3str_loc
  <span class="keyword">val</span> s2cs0 <span class="keyword">=</span> s2cs<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_push <span class="keyword">(</span>fds<span class="keyword">)</span>
  <span class="keyword">val</span> ans <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> c3t<span class="keyword">.</span>c3str_node <span class="keyword">of</span>
    <span class="keyword">|</span> C3STRprop s2p <span class="keyword">=&gt;</span> c3str_solve_prop
        <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s2p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> errno<span class="keyword">)</span>
    <span class="keyword">|</span> C3STRitmlst s3is <span class="keyword">=&gt;</span> c3str_solve_itmlst
        <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span> <span class="comment">// end of [val]
</span><span class="comment">(*
  val () = begin
    print "c3str_solve_main: ans = "; print ans; print_newline ()
  end // end of [val]
*)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_pop <span class="keyword">(</span>fds<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cs := s2cs0
<span class="comment">//
</span>  <span class="keyword">fn</span> prerr_c3str_if <span class="keyword">(</span>unsolved<span class="keyword">:</span> <span class="staexp">uint</span><span class="keyword">,</span> c3t<span class="keyword">:</span> <span class="staexp">c3str</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">if</span> <span class="keyword">(</span>unsolved <span class="keyword">&gt;</span> 0U<span class="keyword">)</span> <span class="keyword">then</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">else</span> <span class="keyword">(</span>prerr ": "<span class="keyword">;</span> prerr_c3str c3t<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [prerr_c3str_if]
</span><span class="comment">//
</span>  <span class="keyword">var</span> ans<span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span> <span class="keyword">=</span> ans
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> ans <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> ans &gt;= 0 <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> c3t<span class="keyword">.</span>c3str_kind <span class="keyword">of</span>
      <span class="keyword">|</span> C3STRKINDnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          <span class="keyword">if</span> unsolved <span class="keyword">&gt;</span> 0U <span class="keyword">then</span> <span class="keyword">begin</span>
            <span class="comment">// an error message has already been reported
</span>          <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
            $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">;</span>
            prerr ": unsolved constraint"<span class="keyword">;</span> prerr_c3str_if <span class="keyword">(</span>unsolved<span class="keyword">,</span> c3t<span class="keyword">)</span><span class="keyword">;</span>
            prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
          <span class="keyword">end</span>
        <span class="keyword">end</span> <span class="comment">// end of [C3STRKINDnone]
</span>      <span class="keyword">|</span> C3STRKINDmetric_nat <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">;</span>
          prerr ": unsolved constraint for termination metric being welfounded"<span class="keyword">;</span>
          prerr_c3str_if <span class="keyword">(</span>unsolved<span class="keyword">,</span> c3t<span class="keyword">)</span><span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [C3STRKINDmetric_nat]
</span>      <span class="keyword">|</span> C3STRKINDmetric_dec <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">;</span>
          prerr ": unsolved constraint for termination metric being decreasing"<span class="keyword">;</span>
          prerr_c3str_if <span class="keyword">(</span>unsolved<span class="keyword">,</span> c3t<span class="keyword">)</span><span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [C3STRKINDmetric_dec]
</span>      <span class="keyword">|</span> C3STRKINDpattern_match_exhaustiveness <span class="keyword">(</span>knd<span class="keyword">,</span> p2tcs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
          <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pattern_match_exhaustiveness_msg <span class="keyword">(</span>loc0<span class="keyword">,</span> knd<span class="keyword">,</span> p2tcs<span class="keyword">)</span>
        <span class="keyword">in</span>
          <span class="keyword">if</span> knd &lt;= 0 <span class="keyword">then</span><span class="comment">(*warning*)</span> ans := <span class="keyword">(</span>~1<span class="keyword">)</span> <span class="keyword">else</span><span class="comment">(*error*)</span> <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [C3STRKINDpattern...]
</span>      <span class="keyword">|</span> C3STRKINDvarfin <span class="keyword">(</span>d2v<span class="keyword">,</span> s2e<span class="keyword">,</span> s2e_fin<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">;</span>
          prerr ": unsolved constraint for the dynamic variable ["<span class="keyword">;</span>
          prerr d2v<span class="keyword">;</span> prerr "]"<span class="keyword">;</span>
          prerr_c3str_if <span class="keyword">(</span>unsolved<span class="keyword">,</span> c3t<span class="keyword">)</span><span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">(*
          prerr ": it is expected to have the type [";
          prerr s2e_fin; prerr "]";
          prerr ", but it is given the type ["; prerr s2e_fin; prerr "]";
          prerr_newline ()
*)</span>
        <span class="keyword">end</span> <span class="comment">// end of [C3STRKINDvarfin]
</span>      <span class="keyword">|</span> C3STRKINDloop <span class="keyword">(</span>knd<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
          $Loc<span class="keyword">.</span>prerr_location loc0<span class="keyword">;</span> prerr ": error(3)"<span class="keyword">;</span>
          <span class="keyword">if</span> knd <span class="keyword">=</span> 0 <span class="keyword">then</span> prerr ": unsolved constraint for loop enter"<span class="keyword">;</span>
          <span class="keyword">if</span> knd <span class="keyword">=</span> 1 <span class="keyword">then</span> prerr ": unsolved constraint for loop exit"<span class="keyword">;</span>
          <span class="keyword">if</span> knd <span class="keyword">=</span> 2 <span class="keyword">then</span> prerr ": unsolved constraint for loop repeat"<span class="keyword">;</span>
          prerr_c3str_if <span class="keyword">(</span>unsolved<span class="keyword">,</span> c3t<span class="keyword">)</span><span class="keyword">;</span>
          prerr_newline <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [C3STRKINDloop]
</span>      <span class="keyword">end</span> <span class="comment">(* end of [ans &gt;= 0] *)</span>
    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [case]
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">if</span> ans &gt;= 0 <span class="keyword">then</span> <span class="keyword">(</span>unsolved := unsolved + 1U<span class="keyword">)</span>
<span class="keyword">in</span>
  ans <span class="comment">(* 0: unsolved; ~1: solved *)</span>
<span class="keyword">end</span> <span class="comment">// end of [c3str_solve_main]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
c3str_solve_prop
  <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s2p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "c3str_solve_prop: s2vs = "; print s2vs; print_newline ();
    print "c3str_solve_prop: s3bes = "; print s3bes; print_newline ();
    print "c3str_solve_prop: s2p = "; print s2p; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  s3bexplst_s2exp_solve_fm <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s2p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> errno<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [c3str_solve_prop]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
c3str_solve_itmlst
  <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "c3str_solve_itmlst: s2vs = "; print s2vs; print_newline ();
    print "c3str_solve_itmlst: s3bes = "; print s3bes; print_newline ();
    print "c3str_solve_itmlst: s3is = "; print s3is; print_newline ();
  end // end of [val]
*)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> s3is <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s3i<span class="keyword">,</span> s3is<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="keyword">case+</span> s3i <span class="keyword">of</span>
    <span class="keyword">|</span> S3ITEMcstr c3t <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> ans1 <span class="keyword">=</span> c3str_solve_main
          <span class="keyword">(</span>s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> c3t<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
        <span class="keyword">val</span> ans2 <span class="keyword">=</span> c3str_solve_itmlst
          <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> ans1 &gt;= 0 <span class="keyword">then</span> 0 <span class="keyword">else</span> ans2
      <span class="keyword">end</span> <span class="comment">// end of [S3ITEMcstr]
</span>    <span class="keyword">|</span> S3ITEMcstr_ref c3t_r <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> ans1 <span class="keyword">=</span> <span class="keyword">(</span>
          <span class="keyword">case+</span> <span class="keyword">!</span>c3t_r <span class="keyword">of</span>
          <span class="keyword">|</span> Some c3t <span class="keyword">=&gt;</span> c3str_solve_main
              <span class="keyword">(</span>s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> c3t<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
          <span class="keyword">|</span> None <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1 <span class="comment">(*solved*)</span>
        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">intBtw <span class="keyword">(</span>~1<span class="keyword">,</span> 1<span class="keyword">)</span></span>
        <span class="keyword">val</span> ans2 <span class="keyword">=</span> c3str_solve_itmlst
          <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
      <span class="keyword">in</span>
        <span class="keyword">if</span> ans1 &gt;= 0 <span class="keyword">then</span> 0 <span class="keyword">else</span> ans2
      <span class="keyword">end</span> <span class="comment">// end of [S3ITEMcstr_ref]
</span>    <span class="keyword">|</span> S3ITEMdisj s3iss_disj <span class="keyword">=&gt;</span> c3str_solve_itmlst_disj <span class="keyword">(</span>
        loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s3iss_disj<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno
      <span class="keyword">)</span> <span class="comment">// end of [c3str_solve_itmlst_disj]
</span>    <span class="keyword">|</span> S3ITEMhypo h3p <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2varbindmap_push <span class="keyword">(</span><span class="keyword">)</span>
        <span class="keyword">val</span> s3bes <span class="keyword">=</span> <span class="keyword">(</span>
          <span class="keyword">case+</span> s3bexp_make_h3ypo <span class="keyword">(</span>h3p<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">)</span> <span class="keyword">of</span>
          <span class="keyword">|</span> <span class="keyword">~</span>Some_vt s3be <span class="keyword">=&gt;</span> list_cons <span class="keyword">(</span>s3be<span class="keyword">,</span> s3bes<span class="keyword">)</span>
          <span class="keyword">|</span> <span class="keyword">~</span>None_vt <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
              val () = begin
                $Loc.prerr_location loc0;
                prerr "warning(3): unused hypothesis: ["; prerr h3p; prerr "]";
                prerr_newline ()
              end // end of [val]
*)</span>
            <span class="keyword">in</span>
              s3bes
            <span class="keyword">end</span> <span class="comment">// end of [None_vt]
</span>        <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">s3bexplst</span>
        <span class="keyword">val</span> ans <span class="keyword">=</span> <span class="keyword">begin</span>
          c3str_solve_itmlst <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
        <span class="keyword">end</span> <span class="comment">// end of [val]
</span>        <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2varbindmap_pop <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">in</span>
        ans
      <span class="keyword">end</span> <span class="comment">// end of [S3ITEMhypo]
</span>    <span class="keyword">|</span> S3ITEMsvar s2v <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> s2vs <span class="keyword">=</span> list_cons <span class="keyword">(</span>s2v<span class="keyword">,</span> s2vs<span class="keyword">)</span>
      <span class="keyword">in</span>
        c3str_solve_itmlst <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S3ITEMsvar]
</span>    <span class="keyword">|</span> S3ITEMsVar s2V <span class="keyword">=&gt;</span> <span class="keyword">let</span>
<span class="comment">(*
        val () = begin
          $Loc.prerr_location loc0;
          prerr "warning(3): c3str_solve_itmlst: s2V = "; prerr s2V;
          prerr_newline ()
        end // end of [val]
*)</span>
      <span class="keyword">in</span>
        c3str_solve_itmlst <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [S3ITEMsVar]
</span>    <span class="keyword">end</span> <span class="comment">// end of [lost_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1<span class="comment">(*solved*)</span>
<span class="keyword">end</span> <span class="comment">// end of [c3str_solve_itmlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
c3str_solve_itmlst_disj
  <span class="keyword">(</span>loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is0<span class="keyword">,</span> s3iss_disj<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> s3iss_disj <span class="keyword">of</span>
  <span class="keyword">|</span> list_cons <span class="keyword">(</span>s3is_disj<span class="keyword">,</span> s3iss_disj<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> s2cs0 <span class="keyword">=</span> s2cs<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_push <span class="keyword">(</span>fds<span class="keyword">)</span>
      <span class="keyword">val</span> s3is <span class="keyword">=</span> $Lst<span class="keyword">.</span>list_append <span class="keyword">(</span>s3is_disj<span class="keyword">,</span> s3is0<span class="keyword">)</span>
      <span class="keyword">val</span> ans <span class="keyword">=</span> c3str_solve_itmlst <span class="keyword">(</span>
        loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno
      <span class="keyword">)</span> <span class="comment">// end of [c3str_solve_itmlst]
</span>      <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_pop <span class="keyword">(</span>fds<span class="keyword">)</span><span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cs := s2cs0
    <span class="keyword">in</span>
      c3str_solve_itmlst_disj <span class="keyword">(</span>
        loc0<span class="keyword">,</span> s2vs<span class="keyword">,</span> s3bes<span class="keyword">,</span> s3is0<span class="keyword">,</span> s3iss_disj<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno
      <span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>  <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ~1<span class="comment">(*solved*)</span>
<span class="keyword">end</span> <span class="comment">// end of [c3str_solve_itmlst_disj]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
c3str_solve <span class="keyword">(</span>c3t<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
<span class="comment">(*
  val () = begin
    print "c3str_solve: c3t = "; print c3t; print_newline ()
  end // end of [val]
*)</span>
<span class="comment">//
</span><span class="comment">// HX-2010-09-09: this is needed for solving top-level constraints!!!
</span>  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> the_s2varbindmap_initialize <span class="keyword">(</span><span class="keyword">)</span>
<span class="comment">//
</span>  <span class="keyword">val</span> s2vs0 <span class="keyword">=</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">and</span> s3bes0 <span class="keyword">=</span> list_nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">var</span> s2cs<span class="keyword">:</span> <span class="staexp">s2cstlst</span> <span class="keyword">=</span> S2CSTLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">var</span> fds<span class="keyword">:</span> <span class="staexp">s2cfdeflst_vt</span> <span class="keyword">=</span> S2CFDEFLSTnil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">var</span> unsolved<span class="keyword">:</span> <span class="staexp">uint</span> <span class="keyword">=</span> 0U
  <span class="keyword">var</span> errno<span class="keyword">:</span> <span class="staexp">int</span> <span class="keyword">=</span> 0
  <span class="keyword">val</span> _<span class="comment">(*ans*)</span> <span class="keyword">=</span> c3str_solve_main
    <span class="keyword">(</span>s2vs0<span class="keyword">,</span> s3bes0<span class="keyword">,</span> c3t<span class="keyword">,</span> s2cs<span class="keyword">,</span> fds<span class="keyword">,</span> unsolved<span class="keyword">,</span> errno<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> s2cfdeflst_free <span class="keyword">(</span>fds<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">if</span> unsolved <span class="keyword">&gt;</span> 0U <span class="keyword">then</span> <span class="keyword">begin</span>
    prerr "type-checking has failed"<span class="keyword">;</span>
    <span class="keyword">if</span> unsolved &lt;= 1U <span class="keyword">then</span> prerr ": there is one unsolved constraint"<span class="keyword">;</span>
    <span class="keyword">if</span> unsolved &gt;= 2U <span class="keyword">then</span> prerr ": there are some unsolved constraints"<span class="keyword">;</span>
    prerr ": please inspect the above reported error message(s) for information."<span class="keyword">;</span>
    prerr_newline <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">;</span>
    $Err<span class="keyword">.</span>abort <span class="staexp"><span class="keyword">{</span>void<span class="keyword">}</span></span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span>
    <span class="comment">// prerr "type-checking has been done successfully"; prerr_newline ()
</span>  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [c3str_solve]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_constraint.dats] *)</span>
</pre>
</body>
</html>
