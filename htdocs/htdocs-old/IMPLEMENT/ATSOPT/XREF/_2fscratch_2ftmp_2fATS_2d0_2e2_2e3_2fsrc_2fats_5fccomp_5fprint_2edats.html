<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(***********************************************************************)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                         Applied Type System                         *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(*                              Hongwei Xi                             *)</span>
<span class="comment">(*                                                                     *)</span>
<span class="comment">(***********************************************************************)</span>

<span class="comment">(*
** ATS/Anairiats - Unleashing the Potential of Types!
**
** Copyright (C) 2002-2008 Hongwei Xi, Boston University
**
** All rights reserved
**
** ATS is free software;  you can  redistribute it and/or modify it under
** the terms of  the GNU GENERAL PUBLIC LICENSE (GPL) as published by the
** Free Software Foundation; either version 3, or (at  your  option)  any
** later version.
** 
** ATS is distributed in the hope that it will be useful, but WITHOUT ANY
** WARRANTY; without  even  the  implied  warranty  of MERCHANTABILITY or
** FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License
** for more details.
** 
** You  should  have  received  a  copy of the GNU General Public License
** along  with  ATS;  see the  file COPYING.  If not, please write to the
** Free Software Foundation,  51 Franklin Street, Fifth Floor, Boston, MA
** 02110-1301, USA.
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
</span><span class="comment">// Time: March 2008
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Cnt <span class="keyword">=</span> "ats_counter.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Err <span class="keyword">=</span> "ats_error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">IntInf <span class="keyword">=</span> "ats_intinf.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Lab <span class="keyword">=</span> "ats_label.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"ats_staexp2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"ats_dynexp2.sats"</span>

<span class="keyword">staload</span> <span class="staexp">"ats_hiexp.sats"</span><span class="keyword">;</span> <span class="keyword">staload</span> <span class="staexp">"ats_ccomp.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">macdef</span> <span class="neuexp">fprint_label <span class="keyword">=</span> $Lab<span class="keyword">.</span>fprint_label</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_tmplab <span class="keyword">(</span>tl<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_tmplab<span class="keyword">,</span> tl<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_tmplab <span class="keyword">(</span>tl<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_tmplab<span class="keyword">,</span> tl<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_tmpvar <span class="keyword">(</span>tmp<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_tmpvar<span class="keyword">,</span> tmp<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_tmpvar <span class="keyword">(</span>tmp<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_tmpvar<span class="keyword">,</span> tmp<span class="keyword">)</span>

<span class="keyword">implement</span> fprint_tmpvarlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> tmps<span class="keyword">:</span> <span class="staexp">tmpvarlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> tmps <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>tmp<span class="keyword">,</span> tmps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> tmps<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> tmps<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_tmpvarlst]
</span>
<span class="keyword">implement</span> print_tmpvarlst <span class="keyword">(</span>tmps<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_tmpvarlst<span class="keyword">,</span> tmps<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_tmpvarlst <span class="keyword">(</span>tmps<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_tmpvarlst<span class="keyword">,</span> tmps<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_funlab <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_funlab<span class="keyword">,</span> fl<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_funlab <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_funlab<span class="keyword">,</span> fl<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_funlablst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fls<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> fls<span class="keyword">:</span> <span class="staexp">funlablst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> fls <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>fl<span class="keyword">,</span> fls<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> fls<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> fls<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_funlablst]
</span>
<span class="keyword">implement</span> print_funlablst <span class="keyword">(</span>fls<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_funlablst<span class="keyword">,</span> fls<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_funlablst <span class="keyword">(</span>fls<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_funlablst<span class="keyword">,</span> fls<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> vp<span class="keyword">.</span>valprim_node <span class="keyword">of</span>
  <span class="keyword">|</span> VParg i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VParg("<span class="keyword">;</span> fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VParg]
</span>  <span class="keyword">|</span> VPargref i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPargref("<span class="keyword">;</span> fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPargref]
</span>  <span class="keyword">|</span> VPbool b <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPbool("<span class="keyword">;</span> fprint1_bool <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPbool]
</span>  <span class="keyword">|</span> VPcastfn <span class="keyword">(</span>d2c<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPcast("<span class="keyword">;</span>
      fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ", "<span class="keyword">;</span> fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPcast]
</span>  <span class="keyword">|</span> VPchar c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPchar("<span class="keyword">;</span> fprint1_char <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPchar]
</span>  <span class="keyword">|</span> VPclo <span class="keyword">(</span>knd<span class="keyword">,</span> fl<span class="keyword">,</span> ctx<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPclo("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "..."<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> VPcst <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPcst("<span class="keyword">;</span> fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPcst]
</span>  <span class="keyword">|</span> VPcstsp _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPcstsp("<span class="keyword">;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "..."<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPcstsp]
</span>  <span class="keyword">|</span> VPenv vtp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPenv("<span class="keyword">;</span> fprint_vartyp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vtp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPenv]
</span>  <span class="keyword">|</span> VPext code <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPext(\"%s\")"<span class="keyword">,</span> <span class="keyword">@(</span>code<span class="keyword">)</span><span class="keyword">)</span><span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPext]
</span>  <span class="keyword">|</span> VPfix vpr <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPfix("<span class="keyword">;</span> fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">!</span>vpr<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPfix]
</span>  <span class="keyword">|</span> VPfloat f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPfloat(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPfloat]
</span>  <span class="keyword">|</span> VPfloatsp f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPfloatsp(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>f<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPfloatsp]
</span>  <span class="keyword">|</span> VPfun fl <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPfun("<span class="keyword">;</span> fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPfun]
</span>  <span class="keyword">|</span> VPint <span class="keyword">(</span>int<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPint("<span class="keyword">;</span> $IntInf<span class="keyword">.</span>fprint_intinf <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> int<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPint]
</span>  <span class="keyword">|</span> VPintsp <span class="keyword">(</span>str<span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPintsp(%s)"<span class="keyword">,</span> <span class="keyword">@(</span>str<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPintsp]
</span>  <span class="keyword">|</span> VPptrof vp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPptrof("<span class="keyword">;</span> fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPptrof]
</span>  <span class="keyword">|</span> VPptrof_ptr_offs <span class="keyword">(</span>vp<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPptrof_ptr_offs("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPptrof_ptr_offs]
</span>  <span class="keyword">|</span> VPptrof_var_offs <span class="keyword">(</span>vp<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPptrof_var_offs("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPptrof_var_offs]
</span>  <span class="keyword">|</span> VPsizeof hit <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPsizeof("<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPsizeof]
</span>  <span class="keyword">|</span> VPstring <span class="keyword">(</span>str<span class="keyword">,</span> len<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPstring(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPstring]
</span>  <span class="keyword">|</span> VPtmp tmp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPtmp("<span class="keyword">;</span> fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPtmp]
</span>  <span class="keyword">|</span> VPtmpref tmp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "VPtmpref("<span class="keyword">;</span> fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [VPtmpref]
</span>  <span class="keyword">|</span> VPtop <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPtop()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPtop]
</span>  <span class="keyword">|</span> VPvoid <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "VPvoid()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [VPvoid]
</span><span class="comment">(*
  | _ =&gt; begin
      fprint1_string (pf | out, "fprint_valprim: not yet implemented.");
      fprint_newline (pf | out);
      $Err.abort {void} ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_valprim]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
fprint_valprimlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> vps<span class="keyword">:</span> <span class="staexp">valprimlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> vps <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>vp<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> vps<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> vps<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_valprimlst]
</span>
<span class="keyword">implement</span> fprint_labvalprimlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lvps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> lvps<span class="keyword">:</span> <span class="staexp">labvalprimlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> lvps <span class="keyword">of</span>
    <span class="keyword">|</span> LABVALPRIMLSTcons <span class="keyword">(</span>l<span class="keyword">,</span> vp<span class="keyword">,</span> lvps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_label <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> l<span class="keyword">)</span><span class="keyword">;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "= "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> lvps<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> LABVALPRIMLSTnil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> lvps<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_labvalprimlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_offset <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> off<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  <span class="keyword">case+</span> off <span class="keyword">of</span>
  <span class="keyword">|</span> OFFSETlab <span class="keyword">(</span>l<span class="keyword">,</span> _<span class="comment">(*hit_rec*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "."<span class="keyword">)</span><span class="keyword">;</span> fprint_label <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> l<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [OFFSETlab]
</span>  <span class="keyword">|</span> OFFSETind <span class="keyword">(</span>vpss<span class="keyword">,</span> _<span class="comment">(*hit_elt*)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> vpss<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
      <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> vpss<span class="keyword">:</span> <span class="staexp">valprimlstlst</span><span class="keyword">)</span>
        <span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> vpss <span class="keyword">of</span>
        <span class="keyword">|</span> list_cons <span class="keyword">(</span>vps<span class="keyword">,</span> vpss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
            fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "["<span class="keyword">)</span><span class="keyword">;</span>
            fprint_valprimlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vps<span class="keyword">)</span><span class="keyword">;</span>
            fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "]"<span class="keyword">)</span><span class="keyword">;</span>
            aux <span class="keyword">(</span>out<span class="keyword">,</span> vpss<span class="keyword">)</span>
          <span class="keyword">end</span>
        <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [aux]
</span>    <span class="keyword">}</span> <span class="comment">// end of [OFFSETind]
</span><span class="keyword">end</span> <span class="comment">// end of [fprint_offset]
</span>
<span class="keyword">implement</span> fprint_offsetlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> offs<span class="keyword">:</span> <span class="staexp">offsetlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> offs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>off<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_offset <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> off<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> offs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> offs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_offsetlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_patck <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> patck<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> patck <span class="keyword">of</span>
  <span class="keyword">|</span> PATCKbool b <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "PATCKbool("<span class="keyword">;</span> fprint1_bool <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> b<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> PATCKchar c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "PATCKchar("<span class="keyword">;</span> fprint1_char <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> PATCKcon d2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "PATCKcon("<span class="keyword">;</span> fprint_d2con <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> PATCKexn d2c <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "PATCKexn("<span class="keyword">;</span> fprint_d2con <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> PATCKfloat f<span class="comment">(*string*)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "PATCKfloat("<span class="keyword">;</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> f<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> PATCKint i <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "PATCKint("<span class="keyword">;</span>
      $IntInf<span class="keyword">.</span>fprint_intinf <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span>
  <span class="keyword">|</span> PATCKstring s <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "PATCKstring(\"%s\")"<span class="keyword">,</span> <span class="keyword">@(</span>s<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_patck]
</span>
<span class="keyword">implement</span> fprint_patcklst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> patcks<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> patcks<span class="keyword">:</span> <span class="staexp">patcklst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> patcks <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>patck<span class="keyword">,</span> patcks<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_patck <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> patck<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> patcks<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> patcks<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_patcklst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_kont <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> k<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> k <span class="keyword">of</span>
  <span class="keyword">|</span> KONTtmplab tl <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "KONTtmplab("<span class="keyword">;</span>
      fprint_tmplab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tl<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [KONTtmplab]
</span>  <span class="keyword">|</span> KONTtmplabint <span class="keyword">(</span>tl<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "KONTtmplabint("<span class="keyword">;</span>
      fprint_tmplab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tl<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [KONTtmplabint]
</span>  <span class="keyword">|</span> KONTcaseof_fail <span class="keyword">(</span>loc<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "KONTcaseof_fail(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [KONTcaseof_fail]
</span>  <span class="keyword">|</span> KONTfunarg_fail <span class="keyword">(</span>loc<span class="keyword">,</span> fl<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "KONTfunarg_fail(..., "<span class="keyword">;</span> fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [KONTfunarg_fail]
</span>  <span class="keyword">|</span> KONTmatpnt mpt <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "KONTmatpnt(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [KONTmatpnt]
</span>  <span class="keyword">|</span> KONTraise vp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "KONTraise("<span class="keyword">;</span> fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [KONTraise]
</span>  <span class="keyword">|</span> KONTnone <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "KONTnone()"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [KONTnone]
</span><span class="keyword">end</span> <span class="comment">(* end of [fprint_kont] *)</span>

<span class="keyword">implement</span> fprint_kontlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ks<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> ks<span class="keyword">:</span> <span class="staexp">kontlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> ks <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>k<span class="keyword">,</span> ks<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        <span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ", "<span class="keyword">)</span><span class="keyword">;</span>
        fprint_kont <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> k<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> i+1<span class="keyword">,</span> ks<span class="keyword">)</span>
      <span class="keyword">end</span>
    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> 0<span class="keyword">,</span> ks<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_kontlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> fprint_instr <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ins<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">macdef</span> <span class="neuexp">prstr <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> fprint1_string <span class="keyword">(</span>pf <span class="keyword">|</span> out<span class="keyword">,</span> <span class="keyword">,(</span>s<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> ins<span class="keyword">.</span>instr_node <span class="keyword">of</span>
  <span class="keyword">|</span> INSTRarr_heap <span class="keyword">(</span>tmp<span class="keyword">,</span> asz<span class="keyword">,</span> hit_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRarr_heap("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> asz<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_elt<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"<span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRarr_heap]
</span>  <span class="keyword">|</span> INSTRarr_stack <span class="keyword">(</span>tmp<span class="keyword">,</span> level<span class="keyword">,</span> vp_asz<span class="keyword">,</span> hit_elt<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRarr_stack("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> level<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_asz<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_elt<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"<span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRarr_stack]
</span>  <span class="keyword">|</span> INSTRassgn_arr <span class="keyword">(</span>vp_arr<span class="keyword">,</span> vp_asz<span class="keyword">,</span> tmp_elt<span class="keyword">,</span> vp_tsz<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRassgn_arr("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_arr<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_asz<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp_elt<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_tsz<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"<span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRassgn_arr]
</span>  <span class="keyword">|</span> INSTRassgn_clo <span class="keyword">(</span>vp_clo<span class="keyword">,</span> fl<span class="keyword">,</span> env<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRassgn_clo("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_clo<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "..."<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"<span class="keyword">;</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRassgn_clo]
</span>  <span class="keyword">|</span> INSTRcall <span class="keyword">(</span>tmp<span class="keyword">,</span> hit_fun<span class="keyword">,</span> vp_fun<span class="keyword">,</span> vps_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRcall("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_fun<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_fun<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprimlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vps_arg<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRcall]
</span>  <span class="keyword">|</span> INSTRcall_tail <span class="keyword">(</span>fl<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRcall_tail("<span class="keyword">;</span> fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRcall_tail]
</span>  <span class="keyword">|</span> INSTRcond <span class="keyword">(</span>vp<span class="keyword">,</span> inss1<span class="keyword">,</span> inss2<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRcond("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
      prstr "INSTRcond_then:"<span class="keyword">;</span>
      fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
      fprint_instrlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> inss1<span class="keyword">)</span><span class="keyword">;</span>
      fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
      prstr "INSTRcond_else:"<span class="keyword">;</span>
      fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
      fprint_instrlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> inss2<span class="keyword">)</span><span class="keyword">;</span>
      fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRcond]
</span>  <span class="keyword">|</span> INSTRdefine_clo <span class="keyword">(</span>d2c<span class="keyword">,</span> fl<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRdefine_clo("<span class="keyword">;</span>
      fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRdefine_clo]
</span>  <span class="keyword">|</span> INSTRdefine_fun <span class="keyword">(</span>d2c<span class="keyword">,</span> fl<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRdefine_fun("<span class="keyword">;</span>
      fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRdefine_fun]
</span>  <span class="keyword">|</span> INSTRdefine_val <span class="keyword">(</span>d2c<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRdefine_val("<span class="keyword">;</span>
      fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRdefine_val]
</span>  <span class="keyword">|</span> INSTRextern cmd <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprintf1_exn <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "INSTRextern(\"%s\")"<span class="keyword">,</span> <span class="keyword">@(</span>cmd<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRextern]
</span>  <span class="keyword">|</span> INSTRextval <span class="keyword">(</span>name<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRextval("<span class="keyword">;</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> name<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRextval]
</span>  <span class="keyword">|</span> INSTRfreeptr vp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRfreeptr("<span class="keyword">;</span> fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRfreeptr]
</span>  <span class="keyword">|</span> INSTRfunction _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "INSTRfunction(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRfunction]
</span>  <span class="keyword">|</span> INSTRfunlab fl <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRfunlab("<span class="keyword">;</span> fprint_funlab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fl<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRfunlab]
</span>  <span class="keyword">|</span> INSTRdynload_file <span class="keyword">(</span>fil<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRdynload_file("<span class="keyword">;</span>
      $Fil<span class="keyword">.</span>fprint_filename <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> fil<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRdynload]
</span>  <span class="keyword">|</span> INSTRload_ptr <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_ptr<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRload_ptr("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_ptr<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRload_ptr]
</span>  <span class="keyword">|</span> INSTRload_ptr_offs <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_ptr<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRload_ptr_offs("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_ptr<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRload_ptr_offs]
</span>  <span class="keyword">|</span> INSTRload_var <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_var<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRload_var("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_var<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRload_var]
</span>  <span class="keyword">|</span> INSTRload_var_offs <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_var<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRload_var_offs("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_var<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRload_var_offs]
</span>  <span class="keyword">|</span> INSTRloop _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "INSTRloop(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRloop]
</span>  <span class="keyword">|</span> INSTRloopexn <span class="keyword">(</span>knd<span class="keyword">,</span> tl<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRloopexn("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> knd<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_tmplab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tl<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRloopexn]
</span>  <span class="keyword">|</span> INSTRmove_arg <span class="keyword">(</span>arg<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_arg("<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> arg<span class="keyword">)</span><span class="keyword">;</span>
      prstr ", "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRmove_arg]
</span>  <span class="keyword">|</span> INSTRmove_con <span class="keyword">(</span>tmp<span class="keyword">,</span> hit_sum<span class="keyword">,</span> d2c<span class="keyword">,</span> vps_arg<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_con("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_sum<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_d2con <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprimlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vps_arg<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRmove_con]
</span>  <span class="keyword">|</span> INSTRmove_lazy_delay <span class="keyword">(</span>tmp<span class="keyword">,</span> lin<span class="keyword">,</span> hit<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_lazy_delay("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lin<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRlazy_force]
</span>  <span class="keyword">|</span> INSTRmove_lazy_force <span class="keyword">(</span>tmp<span class="keyword">,</span> lin<span class="keyword">,</span> hit<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_lazy_force("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lin<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRlazy_force]
</span>  <span class="keyword">|</span> INSTRmove_rec_box <span class="keyword">(</span>tmp<span class="keyword">,</span> hit_rec<span class="keyword">,</span> lvps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_rec_box("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_rec<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_labvalprimlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lvps<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRmove_rec_box]
</span>  <span class="keyword">|</span> INSTRmove_rec_flt <span class="keyword">(</span>tmp<span class="keyword">,</span> hit_rec<span class="keyword">,</span> lvps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_rec_flt("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_rec<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_labvalprimlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> lvps<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRmove_rec_flt]
</span>  <span class="keyword">|</span> INSTRmove_val <span class="keyword">(</span>tmp<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_val("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRmove_val]
</span>  <span class="keyword">|</span> INSTRmove_ref <span class="keyword">(</span>tmp<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRmove_ref("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRmove_ref]
</span>  <span class="keyword">|</span> INSTRpatck <span class="keyword">(</span>vp<span class="keyword">,</span> patck<span class="keyword">,</span> k_fail<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRpatck("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_patck <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> patck<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_kont <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> k_fail<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRpatck]
</span>  <span class="keyword">|</span> INSTRraise <span class="keyword">(</span>tmp<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRraise("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRraise]
</span>  <span class="keyword">|</span> INSTRselcon <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_sum<span class="keyword">,</span> hit_sum<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRselcon("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_sum<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_sum<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRselcon]
</span>  <span class="keyword">|</span> INSTRselcon_ptr <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_sum<span class="keyword">,</span> hit_sum<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRselcon_ptr("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_sum<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_hityp <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> hityp_decode hit_sum<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRselcon_ptr]
</span>  <span class="keyword">|</span> INSTRselect <span class="keyword">(</span>tmp<span class="keyword">,</span> vp_root<span class="keyword">,</span> offs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRselect("<span class="keyword">;</span>
      fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_root<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRselect]
</span>  <span class="keyword">|</span> INSTRstore_ptr <span class="keyword">(</span>vp_ptr<span class="keyword">,</span> vp_val<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRstore_ptr("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_ptr<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_val<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRstore_ptr]
</span>  <span class="keyword">|</span> INSTRstore_ptr_offs <span class="keyword">(</span>vp_ptr<span class="keyword">,</span> offs<span class="keyword">,</span> vp_val<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRstore_ptr_offs("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_ptr<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_val<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRstore_ptr_offs]
</span>  <span class="keyword">|</span> INSTRstore_var <span class="keyword">(</span>vp_var<span class="keyword">,</span> vp_val<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRstore_var("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_var<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_val<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRstore_var]
</span>  <span class="keyword">|</span> INSTRstore_var_offs <span class="keyword">(</span>vp_var<span class="keyword">,</span> offs<span class="keyword">,</span> vp_val<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRstore_var_offs("<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_var<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_offsetlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> offs<span class="keyword">)</span><span class="keyword">;</span>
      prstr "; "<span class="keyword">;</span>
      fprint_valprim <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> vp_val<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRstore_var_offs]
</span>  <span class="keyword">|</span> INSTRswitch _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "INSTRswitch(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRswitch]
</span>  <span class="keyword">|</span> INSTRtmplabint <span class="keyword">(</span>tl<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRtmplabint("<span class="keyword">;</span>
      fprint_tmplab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tl<span class="keyword">)</span><span class="keyword">;</span>
      prstr "_"<span class="keyword">;</span>
      fprint1_int <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> i<span class="keyword">)</span><span class="keyword">;</span>
      prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRtmplabint]
</span><span class="comment">//
</span>  <span class="keyword">|</span> INSTRprfck_beg <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRprfck_beg("<span class="keyword">;</span> fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRprfck_beg]
</span>  <span class="keyword">|</span> INSTRprfck_end <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRprfck_end("<span class="keyword">;</span> fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRprfck_end]
</span>  <span class="keyword">|</span> INSTRprfck_tst <span class="keyword">(</span>d2c<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span> <span class="comment">// HX: test
</span>      prstr "INSTRprfck_tst("<span class="keyword">;</span> fprint_d2cst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> d2c<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRprfck_tst]
</span><span class="comment">//
</span>  <span class="keyword">|</span> INSTRtrywith _ <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> "INSTRtrywith(...)"<span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [INSTRtrywith]
</span>  <span class="keyword">|</span> INSTRvardec tmp <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
      prstr "INSTRvardec("<span class="keyword">;</span> fprint_tmpvar <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> tmp<span class="keyword">)</span><span class="keyword">;</span> prstr ")"
    <span class="keyword">end</span> <span class="comment">// end of [INSTRvardec]
</span><span class="comment">(*
  | _ =&gt; begin
      prstr "fprint_instr: not yet implemented.");
      fprint_newline (pf | out);
      $Err.abort {void} ()
    end // end of [_]
*)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_instr]
</span>
<span class="keyword">implement</span> fprint_instrlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> inss<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> inss<span class="keyword">:</span> <span class="staexp">instrlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">begin</span>
    <span class="keyword">case+</span> inss <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>ins<span class="keyword">,</span> inss<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        fprint_instr <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ins<span class="keyword">)</span><span class="keyword">;</span> fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
        aux <span class="keyword">(</span>out<span class="keyword">,</span> inss<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> inss<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_instrlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span>
fprint_branch <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> br<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">begin</span>
  fprint_tmplab <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> br<span class="keyword">.</span>branch_lab<span class="keyword">)</span><span class="keyword">;</span>
  fprint1_string <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> ": "<span class="keyword">)</span><span class="keyword">;</span> fprint_newline <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">)</span><span class="keyword">;</span>
  fprint_instrlst <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> br<span class="keyword">.</span>branch_inss<span class="keyword">)</span><span class="keyword">;</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_branch]
</span>
<span class="keyword">implement</span>
fprint_branchlst <span class="staexp"><span class="keyword">{</span>m<span class="keyword">}</span></span> <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> brs<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> aux <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span>FILE m</span><span class="keyword">,</span> brs<span class="keyword">:</span> <span class="staexp">branchlst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> brs <span class="keyword">of</span>
    <span class="keyword">|</span> list_cons <span class="keyword">(</span>br<span class="keyword">,</span> brs<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">begin</span>
        fprint_branch <span class="keyword">(</span><span class="prfexp">pf</span> <span class="keyword">|</span> out<span class="keyword">,</span> br<span class="keyword">)</span><span class="keyword">;</span> aux <span class="keyword">(</span>out<span class="keyword">,</span> brs<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [list_cons]
</span>    <span class="keyword">|</span> list_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span>
  <span class="comment">// end of [aux]
</span><span class="keyword">in</span>
  aux <span class="keyword">(</span>out<span class="keyword">,</span> brs<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [fprint_branchlst]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_valprim <span class="keyword">(</span>vp<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_valprim<span class="keyword">,</span> vp<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_valprim <span class="keyword">(</span>vp<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_valprim<span class="keyword">,</span> vp<span class="keyword">)</span>

<span class="keyword">implement</span> print_valprimlst <span class="keyword">(</span>vps<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_valprimlst<span class="keyword">,</span> vps<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_valprimlst <span class="keyword">(</span>vps<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_valprimlst<span class="keyword">,</span> vps<span class="keyword">)</span>
        
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_instr <span class="keyword">(</span>ins<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_instr<span class="keyword">,</span> ins<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_instr <span class="keyword">(</span>ins<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_instr<span class="keyword">,</span> ins<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> print_instrlst <span class="keyword">(</span>inss<span class="keyword">)</span> <span class="keyword">=</span> print_mac <span class="keyword">(</span>fprint_instrlst<span class="keyword">,</span> inss<span class="keyword">)</span>
<span class="keyword">implement</span> prerr_instrlst <span class="keyword">(</span>inss<span class="keyword">)</span> <span class="keyword">=</span> prerr_mac <span class="keyword">(</span>fprint_instrlst<span class="keyword">,</span> inss<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [ats_ccomp_print.dats] *)</span>
</pre>
</body>
</html>
