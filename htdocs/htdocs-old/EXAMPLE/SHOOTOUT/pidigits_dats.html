<BODY BGCOLOR="#E0E0E0" TEXT="#E80000"><PRE><FONT COLOR="#787878">(*
** The Great Computer Language Shootout
** http://shootout.alioth.debian.org/
**
** contributed by Hongwei Xi (hwxi AT cs DOT bu DOT edu)
**
** compilation command:
**   atscc -O3 -fomit-frame-pointer pidigits.dats -o pidigits -lgmp
*)</FONT>

<FONT COLOR="#000000">staload</FONT> <FONT COLOR="#0000FF">"libc/SATS/gmp.sats"</FONT>

<FONT COLOR="#000000">fn</FONT> print_digit <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT><FONT COLOR="#000000">,</FONT> d<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT><FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">begin</FONT>
  print <FONT COLOR="#000000">(</FONT>char_of_int <FONT COLOR="#000000">(</FONT>d + int_of '0'<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">;</FONT>
  <FONT COLOR="#000000">if</FONT> i mod 10 <FONT COLOR="#000000">=</FONT> 0 <FONT COLOR="#000000">then</FONT> printf <FONT COLOR="#000000">(</FONT>"\t:%i\n"<FONT COLOR="#000000">,</FONT> <FONT COLOR="#000000">@(</FONT>i<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">end</FONT>

<FONT COLOR="#000000">fun</FONT> g <FONT COLOR="#000000">(</FONT>
    q<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>mpz_vt</FONT><FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>mpz_vt</FONT><FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>mpz_vt</FONT>
  <FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT><FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF"><FONT COLOR="#000000">&amp;</FONT>mpz_vt</FONT><FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT><FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT><FONT COLOR="#000000">,</FONT> N<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">int</FONT>
  <FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">void</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">var</FONT> x1<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">mpz_vt?</FONT> <FONT COLOR="#000000">and</FONT> x2<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">mpz_vt?</FONT>
  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> mpz_init x1 <FONT COLOR="#000000">and</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> mpz_init x2
  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> mpz_mul <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> q<FONT COLOR="#000000">,</FONT> 4<FONT COLOR="#000000">)</FONT> <FONT COLOR="#787878">// x1 = 4*q
</FONT>  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> mpz_add <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT> <FONT COLOR="#787878">// x1 = 4*q + r
</FONT>  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> mpz_add <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">)</FONT> <FONT COLOR="#787878">// x2 = n+1
</FONT>  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> mpz_mul <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT> <FONT COLOR="#787878">// x2 = t * (n+1)
</FONT>  <FONT COLOR="#000000">val</FONT> cmp <FONT COLOR="#000000">=</FONT> mpz_cmp <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> x2<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  <FONT COLOR="#000000">case+</FONT> 0 <FONT COLOR="#000000">of</FONT>
  <FONT COLOR="#000000">|</FONT> _ <FONT COLOR="#000000">when</FONT> cmp &gt;= 0 <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> q<FONT COLOR="#000000">,</FONT> 7 * k + 2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_add <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> x2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_tdiv_q <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">,</FONT> x1<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> q<FONT COLOR="#000000">,</FONT> 2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_add <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">,</FONT> x2<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>q<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_clear x1<FONT COLOR="#000000">;</FONT> mpz_clear x2<FONT COLOR="#000000">;</FONT>
      g <FONT COLOR="#000000">(</FONT>q<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> k+1<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> l+2<FONT COLOR="#000000">,</FONT> i<FONT COLOR="#000000">,</FONT> N<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
  <FONT COLOR="#000000">|</FONT> _ <FONT COLOR="#000000">=&gt;</FONT> <FONT COLOR="#000000">begin</FONT>
      print_digit <FONT COLOR="#000000">(</FONT>i<FONT COLOR="#000000">,</FONT> mpz_get_int n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_sub <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">,</FONT> x1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> 10<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> q<FONT COLOR="#000000">,</FONT> 3<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_add <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> 10<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_tdiv_q <FONT COLOR="#000000">(</FONT>x1<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_set <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">,</FONT> x2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>x2<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> 10<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_sub <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">,</FONT> x1<FONT COLOR="#000000">,</FONT> x2<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_mul <FONT COLOR="#000000">(</FONT>q<FONT COLOR="#000000">,</FONT> 10<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
      mpz_clear x1<FONT COLOR="#000000">;</FONT> mpz_clear x2<FONT COLOR="#000000">;</FONT>
      <FONT COLOR="#000000">if</FONT> i <FONT COLOR="#000000">&lt;</FONT> N <FONT COLOR="#000000">then</FONT> g <FONT COLOR="#000000">(</FONT>q<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> k<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> l<FONT COLOR="#000000">,</FONT> i+1<FONT COLOR="#000000">,</FONT> N<FONT COLOR="#000000">)</FONT>
    <FONT COLOR="#000000">end</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [g]
</FONT>
<FONT COLOR="#000000">implement</FONT> main <FONT COLOR="#000000">(</FONT>argc<FONT COLOR="#000000">,</FONT> argv<FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> <FONT COLOR="#000000">let</FONT>
  <FONT COLOR="#000000">var</FONT> q<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">mpz_vt</FONT> <FONT COLOR="#000000">and</FONT> r<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">mpz_vt</FONT> <FONT COLOR="#000000">and</FONT> t<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">mpz_vt</FONT> <FONT COLOR="#000000">and</FONT> n<FONT COLOR="#000000">:</FONT> <FONT COLOR="#0000FF">mpz_vt</FONT>
  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> assert <FONT COLOR="#000000">(</FONT>argc <FONT COLOR="#000000">=</FONT> 2<FONT COLOR="#000000">)</FONT>
  <FONT COLOR="#000000">val</FONT> N <FONT COLOR="#000000">=</FONT> int1_of argv<FONT COLOR="#000000">.</FONT><FONT COLOR="#000000">[</FONT><FONT COLOR="#009000">1</FONT><FONT COLOR="#000000">]</FONT>
  <FONT COLOR="#000000">val</FONT> <FONT COLOR="#000000">(</FONT><FONT COLOR="#000000">)</FONT> <FONT COLOR="#000000">=</FONT> assert_errmsg_bool1
    <FONT COLOR="#000000">(</FONT>N &gt;= 2<FONT COLOR="#000000">,</FONT> "The input integer needs to be a natural number.\n"<FONT COLOR="#000000">)</FONT>
<FONT COLOR="#000000">in</FONT>
  mpz_init_set <FONT COLOR="#000000">(</FONT>q<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
  mpz_init_set <FONT COLOR="#000000">(</FONT>r<FONT COLOR="#000000">,</FONT> 0<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
  mpz_init_set <FONT COLOR="#000000">(</FONT>t<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
  mpz_init_set <FONT COLOR="#000000">(</FONT>n<FONT COLOR="#000000">,</FONT> 3<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
  g <FONT COLOR="#000000">(</FONT>q<FONT COLOR="#000000">,</FONT> r<FONT COLOR="#000000">,</FONT> t<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">,</FONT> n<FONT COLOR="#000000">,</FONT> 3<FONT COLOR="#000000">,</FONT> 1<FONT COLOR="#000000">,</FONT> N<FONT COLOR="#000000">)</FONT><FONT COLOR="#000000">;</FONT>
  mpz_clear q<FONT COLOR="#000000">;</FONT> mpz_clear r<FONT COLOR="#000000">;</FONT> mpz_clear t<FONT COLOR="#000000">;</FONT> mpz_clear n<FONT COLOR="#000000">;</FONT>
<FONT COLOR="#000000">end</FONT> <FONT COLOR="#787878">// end of [main]
</FONT>
<FONT COLOR="#787878">(* end of [pidigits.dats] *)</FONT>
</PRE></BODY>
