<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    span.comment {color:#787878;font-style:italic}
    span.extern  {color:#A52A2A}
    span.keyword {color:#000000;font-weight:bold}
    span.neuexp  {color:#800080}
    span.staexp  {color:#0000FF}
    span.dynexp  {color:#E80000}
    span.prfexp  {color:#009000}
    span.stacstdec  {text-decoration:none}
    span.stacstuse  {color:#0000CF;text-decoration:underline}
    span.dyncstdec  {text-decoration:none}
    span.dyncstimp  {color:#B80000;text-decoration:underline}
    span.dyncstuse  {color:#B80000;text-decoration:underline}
    body          {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre>
<span class="comment">(*
**
** Some properties on binary trees
** Author: Hongwei Xi (hwxi AT cs DOT bu DOT edu)
** Time: November, 2008
**
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datasort</span> <span class="staexp">bt <span class="keyword">=</span> E <span class="keyword">of</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">|</span> B <span class="keyword">of</span> <span class="keyword">(</span>bt<span class="keyword">,</span> bt<span class="keyword">)</span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">// size
</span><span class="keyword">dataprop</span> <span class="prfexp"><span class="staexp"><a name="220"><span class="stacstdec">btsz <span class="keyword">(</span>bt<span class="keyword">,</span> int<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="keyword">{</span><span class="staexp">t1<span class="keyword">,</span>t2<span class="keyword">:</span>bt</span><span class="keyword">}</span> <span class="keyword">{</span><span class="staexp">n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat</span><span class="keyword">}</span>
    btsz_B <span class="staexp"><span class="keyword">(</span>B <span class="keyword">(</span>t1<span class="keyword">,</span> t2<span class="keyword">)</span><span class="keyword">,</span> n1+n2+1<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>btsz <span class="keyword">(</span>t1<span class="keyword">,</span> n1<span class="keyword">)</span><span class="keyword">,</span> btsz <span class="keyword">(</span>t2<span class="keyword">,</span> n2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> btsz_E <span class="staexp"><span class="keyword">(</span>E <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> 0<span class="keyword">)</span></span></span>

<span class="comment">// height
</span><span class="keyword">dataprop</span> <span class="prfexp"><span class="staexp"><a name="372"><span class="stacstdec">btht <span class="keyword">(</span>bt<span class="keyword">,</span> int<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="keyword">{</span><span class="staexp">t1<span class="keyword">,</span>t2<span class="keyword">:</span>bt</span><span class="keyword">}</span> <span class="keyword">{</span><span class="staexp">n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat</span><span class="keyword">}</span>
    btht_B <span class="staexp"><span class="keyword">(</span>B <span class="keyword">(</span>t1<span class="keyword">,</span> t2<span class="keyword">)</span><span class="keyword">,</span> max <span class="keyword">(</span>n1<span class="keyword">,</span>n2<span class="keyword">)</span>+1<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>btht <span class="keyword">(</span>t1<span class="keyword">,</span> n1<span class="keyword">)</span><span class="keyword">,</span> btht <span class="keyword">(</span>t2<span class="keyword">,</span> n2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> btht_E <span class="staexp"><span class="keyword">(</span>E <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> 0<span class="keyword">)</span></span></span>

<span class="comment">// shortest path
</span><span class="keyword">dataprop</span> <span class="prfexp"><span class="staexp"><a name="537"><span class="stacstdec">btsp <span class="keyword">(</span>bt<span class="keyword">,</span> int<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="keyword">{</span><span class="staexp">t1<span class="keyword">,</span>t2<span class="keyword">:</span>bt</span><span class="keyword">}</span> <span class="keyword">{</span><span class="staexp">n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat</span><span class="keyword">}</span>
    btsp_B <span class="staexp"><span class="keyword">(</span>B <span class="keyword">(</span>t1<span class="keyword">,</span> t2<span class="keyword">)</span><span class="keyword">,</span> min <span class="keyword">(</span>n1<span class="keyword">,</span>n2<span class="keyword">)</span>+1<span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>btsp <span class="keyword">(</span>t1<span class="keyword">,</span> n1<span class="keyword">)</span><span class="keyword">,</span> btsp <span class="keyword">(</span>t2<span class="keyword">,</span> n2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> btsp_E <span class="staexp"><span class="keyword">(</span>E <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> 0<span class="keyword">)</span></span></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">prfun</span> <span class="prfexp">btht_isfun <span class="staexp"><span class="keyword">{</span>t<span class="keyword">:</span>bt<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>t<span class="keyword">&gt;.</span></span>
  <span class="keyword">(</span>pf1<span class="keyword">:</span> <span class="staexp">btht <span class="keyword">(</span>t<span class="keyword">,</span> n1<span class="keyword">)</span></span><span class="keyword">,</span> pf2<span class="keyword">:</span> <span class="staexp">btht <span class="keyword">(</span>t<span class="keyword">,</span> n2<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>n1==n2<span class="keyword">]</span> void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> <span class="keyword">(</span>pf1<span class="keyword">,</span> pf2<span class="keyword">)</span> <span class="keyword">of</span>
  <span class="keyword">|</span> <span class="keyword">(</span>btht_B <span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span><span class="keyword">,</span> btht_B <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> btht_isfun <span class="keyword">(</span>pf11<span class="keyword">,</span> pf21<span class="keyword">)</span> <span class="keyword">and</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> btht_isfun <span class="keyword">(</span>pf12<span class="keyword">,</span> pf22<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span> <span class="comment">// end of [btht_B, btht_B]
</span>  <span class="keyword">|</span> <span class="keyword">(</span>btht_E <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> btht_E <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">(</span><span class="keyword">)</span></span>
<span class="comment">// end of [btht_isfun]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">//
</span><span class="comment">// EXP2 is declared in $ATSHOME/prelude/SATS/arith.sats
</span><span class="comment">//
</span>
<span class="keyword">prfun</span> <span class="prfexp">bintree_SZ_HT_lemma <span class="staexp"><span class="keyword">{</span>t<span class="keyword">:</span>bt<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>s<span class="keyword">,</span>n<span class="keyword">,</span>p<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>t<span class="keyword">&gt;.</span></span>
  <span class="keyword">(</span>pf1<span class="keyword">:</span> <span class="staexp">btsz <span class="keyword">(</span>t<span class="keyword">,</span> s<span class="keyword">)</span></span><span class="keyword">,</span> pf2<span class="keyword">:</span> <span class="staexp">btht <span class="keyword">(</span>t<span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">,</span> pf3<span class="keyword">:</span> <span class="staexp">EXP2 <span class="keyword">(</span>n<span class="keyword">,</span> p<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>s <span class="keyword">&lt;</span> p<span class="keyword">]</span> void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> pf1 <span class="keyword">of</span>
  <span class="keyword">|</span> btsz_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">btht_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf2</span><span class="keyword">;</span> <span class="keyword">prval</span> <span class="prfexp">EXP2bas <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf3</span> <span class="keyword">in</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [btsz_E]
</span>  <span class="keyword">|</span> btsz_B <span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">btht_B <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span> <span class="keyword">=</span> pf2</span><span class="keyword">;</span> <span class="keyword">prval</span> <span class="prfexp">EXP2ind <span class="keyword">(</span>pf30<span class="keyword">)</span> <span class="keyword">=</span> pf3</span>
      <span class="keyword">prval</span> <span class="prfexp">pf30_1 <span class="keyword">=</span> EXP2_istot <span class="keyword">(</span><span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EXP2_monotone <span class="keyword">(</span>pf30_1<span class="keyword">,</span> pf30<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> bintree_SZ_HT_lemma <span class="keyword">(</span>pf11<span class="keyword">,</span> pf21<span class="keyword">,</span> pf30_1<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp">pf30_2 <span class="keyword">=</span> EXP2_istot <span class="keyword">(</span><span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EXP2_monotone <span class="keyword">(</span>pf30_2<span class="keyword">,</span> pf30<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> bintree_SZ_HT_lemma <span class="keyword">(</span>pf12<span class="keyword">,</span> pf22<span class="keyword">,</span> pf30_2<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span></span> <span class="comment">// end of [btsz_B]
</span><span class="comment">// end of [bintree_SZ_HT_lemma]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">prfun</span> <span class="prfexp">bintree_SZ_SP_lemma <span class="staexp"><span class="keyword">{</span>t<span class="keyword">:</span>bt<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>s<span class="keyword">,</span>n<span class="keyword">,</span>p<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>t<span class="keyword">&gt;.</span></span>
  <span class="keyword">(</span>pf1<span class="keyword">:</span> <span class="staexp">btsz <span class="keyword">(</span>t<span class="keyword">,</span> s<span class="keyword">)</span></span><span class="keyword">,</span> pf2<span class="keyword">:</span> <span class="staexp">btsp <span class="keyword">(</span>t<span class="keyword">,</span> n<span class="keyword">)</span></span><span class="keyword">,</span> pf3<span class="keyword">:</span> <span class="staexp">EXP2 <span class="keyword">(</span>n<span class="keyword">,</span> p<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>p &lt;= s+1<span class="keyword">]</span> void</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> pf1 <span class="keyword">of</span>
  <span class="keyword">|</span> btsz_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">btsp_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf2</span><span class="keyword">;</span> <span class="keyword">prval</span> <span class="prfexp">EXP2bas <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf3</span> <span class="keyword">in</span> <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">end</span> <span class="comment">// end of [btsz_E]
</span>  <span class="keyword">|</span> btsz_B <span class="keyword">(</span>pf11<span class="keyword">,</span> pf12<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">btsp_B <span class="keyword">(</span>pf21<span class="keyword">,</span> pf22<span class="keyword">)</span> <span class="keyword">=</span> pf2</span><span class="keyword">;</span> <span class="keyword">prval</span> <span class="prfexp">EXP2ind <span class="keyword">(</span>pf30<span class="keyword">)</span> <span class="keyword">=</span> pf3</span>
      <span class="keyword">prval</span> <span class="prfexp">pf30_1 <span class="keyword">=</span> EXP2_istot <span class="keyword">(</span><span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EXP2_monotone <span class="keyword">(</span>pf30<span class="keyword">,</span> pf30_1<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> bintree_SZ_SP_lemma <span class="keyword">(</span>pf11<span class="keyword">,</span> pf21<span class="keyword">,</span> pf30_1<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp">pf30_2 <span class="keyword">=</span> EXP2_istot <span class="keyword">(</span><span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> EXP2_monotone <span class="keyword">(</span>pf30<span class="keyword">,</span> pf30_2<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> bintree_SZ_SP_lemma <span class="keyword">(</span>pf12<span class="keyword">,</span> pf22<span class="keyword">,</span> pf30_2<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span></span> <span class="comment">// end of [btsz_B]
</span><span class="comment">// end of [bintree_SZ_SP_lemma]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">dataprop</span> <span class="prfexp"><span class="staexp"><a name="2603"><span class="stacstdec">isAVL <span class="keyword">(</span>bt<span class="keyword">)</span></span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="keyword">{</span><span class="staexp">t1<span class="keyword">,</span>t2<span class="keyword">:</span>bt</span><span class="keyword">}</span> <span class="keyword">{</span><span class="staexp">n1<span class="keyword">,</span>n2<span class="keyword">:</span>nat</span> <span class="keyword">|</span> <span class="staexp">n1 &lt;= n2+1</span><span class="keyword">;</span> <span class="staexp">n2 &lt;= n1+1</span><span class="keyword">}</span>
    isAVL_B <span class="staexp"><span class="keyword">(</span>B <span class="keyword">(</span>t1<span class="keyword">,</span> t2<span class="keyword">)</span><span class="keyword">)</span></span> <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>isAVL t1<span class="keyword">,</span> isAVL t2<span class="keyword">,</span> btht <span class="keyword">(</span>t1<span class="keyword">,</span> n1<span class="keyword">)</span><span class="keyword">,</span> btht <span class="keyword">(</span>t2<span class="keyword">,</span> n2<span class="keyword">)</span><span class="keyword">)</span></span>
  <span class="keyword">|</span> isAVL_E <span class="staexp"><span class="keyword">(</span>E <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span></span>
<span class="comment">// end of [isAVL]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
**
** this lemma proves that AVL trees are balanced
**
*)</span>

<span class="keyword">prfun</span> <span class="prfexp">bintree_AVL_SP_HT_lemma <span class="staexp"><span class="keyword">{</span>t<span class="keyword">:</span>bt<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">{</span>sp<span class="keyword">,</span>ht<span class="keyword">:</span>nat<span class="keyword">}</span></span> <span class="staexp"><span class="keyword">.&lt;</span>t<span class="keyword">&gt;.</span></span> <span class="keyword">(</span>
    pf_avl<span class="keyword">:</span> <span class="staexp">isAVL <span class="keyword">(</span>t<span class="keyword">)</span></span> <span class="keyword">,</span> pf_sp<span class="keyword">:</span> <span class="staexp">btsp <span class="keyword">(</span>t<span class="keyword">,</span> sp<span class="keyword">)</span></span><span class="keyword">,</span> pf_ht<span class="keyword">:</span> <span class="staexp">btht <span class="keyword">(</span>t<span class="keyword">,</span> ht<span class="keyword">)</span></span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>ht &lt;= sp + sp<span class="keyword">]</span> void</span> <span class="keyword">=</span> <span class="keyword">begin</span> <span class="keyword">case+</span> pf_avl <span class="keyword">of</span>
  <span class="keyword">|</span> isAVL_B <span class="keyword">(</span>pf1_avl<span class="keyword">,</span> pf2_avl<span class="keyword">,</span> pf1_ht<span class="keyword">,</span> pf2_ht<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">btsp_B <span class="keyword">(</span>pf1_sp<span class="keyword">,</span> pf2_sp<span class="keyword">)</span> <span class="keyword">=</span> pf_sp</span>
      <span class="keyword">prval</span> <span class="prfexp">btht_B <span class="keyword">(</span>pf1_ht_alt<span class="keyword">,</span> pf2_ht_alt<span class="keyword">)</span> <span class="keyword">=</span> pf_ht</span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> btht_isfun <span class="keyword">(</span>pf1_ht<span class="keyword">,</span> pf1_ht_alt<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> btht_isfun <span class="keyword">(</span>pf2_ht<span class="keyword">,</span> pf2_ht_alt<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> bintree_AVL_SP_HT_lemma <span class="keyword">(</span>pf1_avl<span class="keyword">,</span> pf1_sp<span class="keyword">,</span> pf1_ht<span class="keyword">)</span></span>
      <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> bintree_AVL_SP_HT_lemma <span class="keyword">(</span>pf2_avl<span class="keyword">,</span> pf2_sp<span class="keyword">,</span> pf2_ht<span class="keyword">)</span></span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span> <span class="comment">// end of [isAVL_B]
</span>  <span class="keyword">|</span> isAVL_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">prval</span> <span class="prfexp">btsp_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf_sp <span class="keyword">and</span> btht_E <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> pf_ht</span>
    <span class="keyword">in</span>
      <span class="comment">// empty
</span>    <span class="keyword">end</span> <span class="comment">// end of [isAVL_E]
</span><span class="keyword">end</span></span> <span class="comment">// end of [bintree_AVL_SP_HT]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [BinaryTree.dats] *)</span>
</pre>
</body>
</html>
