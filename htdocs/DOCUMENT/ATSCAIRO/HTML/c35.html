<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>A Simple Example: Hello, world!</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="ATS/Cairo Tutorial"
HREF="book1.html"><LINK
REL="UP"
TITLE="Basic Tutorial Topics"
HREF="p33.html"><LINK
REL="PREVIOUS"
TITLE="Basic Tutorial Topics"
HREF="p33.html"><LINK
REL="NEXT"
TITLE="Types for Some Objects in Cairo"
HREF="c93.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>ATS/Cairo Tutorial: </TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="p33.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c93.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="hello_example"
></A
>A Simple Example: Hello, world!</H1
><P
>The first program we present in this tutorial is given as follows:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN38"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
></PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>The functions in the cairo package are declared in the following file:
<A
HREF="https://ats-lang.svn.sourceforge.net/svnroot/ats-lang/trunk/contrib/cairo/SATS/cairo.sats"
TARGET="_top"
>contrib/cairo/SATS/cairo.sats</A
>
</P
><P
>Note that in this tutorial, a file name, if relative, is always relative to
the ATS home directory (stored in the environment variable ATSHOME) unless
it is specified otherwise.
</P
><P
>&#13;Suppose that the presented program is stored in a file named
<A
HREF="http://www.ats-lang.org/DOCUMENT/ATSCAIRO/CODE/tutprog_hw.dats"
TARGET="_top"
>tutprog_hw.dats</A
> the following
command can be issued to compile the program to generate an executable
<TT
CLASS="filename"
>tutprog_hw</TT
>:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN46"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;<B
CLASS="command"
>atscc</B
> -o tutprog_hw tutprog_hw.dats `pkg-config cairo --cflags --libs`
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
>

</P
><P
>&#13;By executing <TT
CLASS="filename"
>tutprog_hw</TT
>, we generate a PNG image file
<A
HREF="http://www.ats-lang.org/DOCUMENT/ATSCAIRO/IMAGE/tutprog_hw.png"
TARGET="_top"
>tutprog_hw.png</A
>, which is included as
follows:
</P
><P
><SPAN
CLASS="inlinemediaobject"
><IMG
SRC="http://www.ats-lang.org/DOCUMENT/ATSCAIRO/IMAGE/tutprog_hw.png"></SPAN
>
</P
><P
>&#13;One can also use tools such <B
CLASS="command"
>eog</B
> and <B
CLASS="command"
>gthumb</B
> to view
PNG files.

</P
><P
>&#13;We now give a brief explanation on the program in
<A
HREF="http://www.ats-lang.org/DOCUMENT/ATSCAIRO/CODE/tutprog_hw.dats"
TARGET="_top"
>tutprog_hw.dats</A
>.  We first create a
cairo surface for drawing:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN61"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val surface = // create a surface for drawing
    cairo_image_surface_create (CAIRO_FORMAT_ARGB32, 250, 80)
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>We then use the surface to create a cairo context:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN64"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val cr = cairo_create (surface)
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>We choose a font face and set the font size to 32.0:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN67"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val () = cairo_select_font_face
    (cr, "Sans", CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_BOLD)
  val () = cairo_set_font_size (cr, 32.0)
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>Imagine that we are holding a pen. We set the color of the pen
to blue:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN70"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  // the call [cairo_set_source_rgb] sets the color to blue
  val () = cairo_set_source_rgb (cr, 0.0(*r*), 0.0(*g*), 1.0(*b*))
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>&#13;We now move the pen to the postion (10.0, 50.0):
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN73"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val () = cairo_move_to (cr, 10.0, 50.0)
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>and use the pen to write down the text "Hello, world!":
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN76"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val () = cairo_show_text (cr, "Hello, world!")
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>At this point, we have finished drawing. We store the image drawn on the
surface into a PNG file:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN79"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val status = cairo_surface_write_to_png (surface, "tutprog_hw.png")
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>&#13;We now enter the cleanup phase, closing both the surface and the context:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN82"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val () = cairo_surface_destroy (surface) // a type error if omitted
  val () = cairo_destroy (cr) // a type error if omitted
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>In case of a failure, we report it:
</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN85"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  // in case of a failure ...
  val () = assert_errmsg (status = CAIRO_STATUS_SUCCESS, #LOCATION)
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>&#13;On the surface, it seems that using cairo functions in ATS is nearly
identical to using them in C (modulo syntatical difference). However, what
happens at the level of typechecking in ATS is far more sophisticated than
in C. In particular, linear types are assigned to cairo objects (e.g.,
contexts, surfaces, patterns, font faces) in ATS to allow them to be
tracked statically, that is, at compile-time, preventing potential memory
mismanagement. For instance, if the following line:

</P
><DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN88"
></A
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>  val () = cairo_surface_destroy (surface) // a type error if omitted
</PRE
></TD
></TR
></TABLE
><P
></P
></DIV
><P
>&#13;is removed from the program in
<A
HREF="http://www.ats-lang.org/DOCUMENT/ATSCAIRO/CODE/tutprog_hw.dats"
TARGET="_top"
>tutprog_hw.dats</A
>,
then a type-error message is issued at compile-time to indicate that the
resource <FONT
COLOR="RED"
>surface</FONT
> is not properly freed.  A message as such can be
of great value in practice for correcting potential memory leaks that may
otherwise readily go unnoticed.  ATS is a programming language that
distinguishes itself in its practical and effective support for precise
resource management.

</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="p33.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c93.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Basic Tutorial Topics</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="p33.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Types for Some Objects in Cairo</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>